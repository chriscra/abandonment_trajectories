---
title: "Rural land abandonment is too ephemeral to provide major benefits for biodiversity and climate"
author:
  - Christopher L. Crawford$^1$^[Corresponding Author, ccrawford@princeton.edu, Robertson Hall, Princeton University, Princeton, NJ]
  - He Yin$^2$
  - Volker C. Radeloff$^3$
  - David S. Wilcove$^{1,4}$
date: 
  $^1$Princeton School of Public and International Affairs, Princeton University, Princeton, NJ\newline 
  $^2$Department of Geography, Kent State University, Kent, OH\newline
  $^3$SILVIS Lab, Department of Forest & Wildlife Ecology, University of Wisconsin - Madison, Madison, WI\newline
  $^4$Department of Ecology & Evolutionary Biology, Princeton University, Princeton, NJ\newline
  \newline
  \today
output:
  bookdown::word_document2:
    reference_docx: /Users/christophercrawford/work/projects/writing/scripts/word_style_ref.docx
    number_sections: false
  bookdown::pdf_document2:
    toc: false
    keep_tex: false
    includes:
      in_header: "preamble.tex"
mainfont: Times New Roman
fontsize: 11pt
# linestretch: 1.25
# documentclass: report
editor_options:
  chunk_output_type: console
bibliography: [/Users/christophercrawford/work/library/library.bib, packages.bib]
link-citations: no
csl: science-advances.csl
urlcolor: blue
linkcolor: black
citecolor: black
---

```{r load-packages-functions, eval = TRUE, echo = FALSE, include = FALSE}
source("/Users/christophercrawford/work/projects/abandonment_trajectories/scripts/0_start.R")
```

```{r preview-chapter, eval=FALSE, include = FALSE}
# set table format:
my_format <- "simple"
rmarkdown::render("scripts/Crawford_abandonment_MS+SI.Rmd",
                  output_file = 
                    paste0(p_proj, "writing/previews/", "abn_duration_draft",
                           format(Sys.Date(), ("_%Y_%m_%d")), ".docx"),
                  output_format = bookdown::word_document2(
                    reference_docx = "/Users/christophercrawford/work/projects/writing/scripts/word_style_ref.docx",
                    number_sections = FALSE))

# Save final PDF with SI for submission:
my_format <- "latex"
rmarkdown::render("scripts/Crawford_abandonment_MS+SI.Rmd",
                  output_file = paste0(p_proj, "writing/previews/",
                                       "Crawford_abandonment_MS+SI",
                                       format(Sys.Date(), ("_%Y_%m_%d")),".pdf"),
                  output_format = "bookdown::pdf_document2")


# # Save html for troubleshooting:
# rmarkdown::render("scripts/abn_trajectories_ms.Rmd",
#                   output_file = paste0(p_proj, "writing/previews/", "abn_duration_draft_w_SI.html"),
#                   output_format = "bookdown::html_document2")

# bookdown::preview_chapter(
#   input = "abn_trajectories_ms.Rmd",
#   output_format = "bookdown::word_document2",
#   output_file = paste0("abn_duration_draft", format(Sys.Date(), ("_%Y_%m_%d")), ".docx"),
#   output_dir = paste0(p_proj, "writing/previews"),
#   output_options = 
#     list(reference_docx = "/Users/christophercrawford/work/projects/writing/scripts/word_style_ref.docx"),
#   preview = TRUE)
```

```{r set-chunk-opts, include = FALSE}
# set default chunk options
knitr::opts_chunk$set(
  out.width = "1\\textwidth",  # if compiling a pdf, include this option
  # comment = NA,
  # fig.width=6, fig.height=6, 
  echo = FALSE # the code itself will NOT be printed with results
  )

options(knitr.table.format = function() {
  if (knitr::is_latex_output())
    "latex" else "simple"
})
```

```{r produce-package-bib, include = FALSE, echo = FALSE}
# needed_packages
# github_packages
knitr::write_bib(x = c(needed_packages, github_packages), file = 'packages.bib')
# knitr::write_bib(x = c("car"), file = 'extra.bib')

# citation(package = needed_packages[1])

# knitr::write_bib(x = c(needed_packages[c(14)]), file = 'packages_top.bib')
# knitr::write_bib(x = c(needed_packages[3]), file = 'terra.bib')

# 
# needed_packages[1]
# packageDescription(needed_packages[1])
# 
# tinytex::tlmgr_install(
#   # pkgs = "ragged2e"
#   # pkgs = "standalone"
#   pkgs = "preview"
# )
```

```{r load-files, include = FALSE}

# set run: 
run_label # check. See "_util_main.R"


# load general spatial data on site locations --------------------------------------------------- #
site_df <- read.csv(file = paste0(p_dat_derived, "site_df.csv"))
site_df_w_size <- read.csv(file = paste0(p_dat_derived, "site_df_w_size.csv"))
site_sf <- st_read(paste0(p_dat_derived, "sf/site_sf.shp"))


# load all length data (distilled)
length_distill_df <- read_csv(file = paste0(p_derived2, 
                                            "length_distill_df", run_label, ".csv")) %>%
  left_join(site_labels)

# load mean length data
mean_length_df <- read_csv(file = paste0(p_derived2, "mean_length_df", run_label, ".csv")) %>%
  left_join(site_labels)

potential_mean_length_df <- read_csv(file = paste0(p_derived2, "potential_mean_length_df", run_label, ".csv")) %>%
  left_join(site_labels)

mean_recult_length_df <- read_csv(file = paste0(p_derived2, "mean_recult_length_df", run_label, ".csv")) %>%
  left_join(site_labels)





# load summary statistic derived from lengths
summary_stats_all_sites <- read_csv(file = paste0(p_derived2, "summary_stats_all_sites", run_label, ".csv"))
summary_stats_all_sites_pooled <- read_csv(file = paste0(p_derived2, "summary_stats_all_sites_pooled", run_label, ".csv"))

potential_summary_stats_all_sites <- read_csv(file = paste0(p_derived2, "potential_summary_stats_all_sites", run_label, ".csv"))
potential_summary_stats_all_sites_pooled <- read_csv(file = paste0(p_derived2, "potential_summary_stats_all_sites_pooled", run_label, ".csv"))

recult_summary_stats_all_sites <- read_csv(file = paste0(p_derived2, "recult_summary_stats_all_siteS", run_label, ".csv"))
recult_summary_stats_all_sites_pooled <- read_csv(file = paste0(p_derived2, "recult_summary_stats_all_sites_pooled", run_label, ".csv"))


# load area summary stats:
area_summary_df <- read_csv(file = paste0(p_derived2, "area_summary_df", run_label, ".csv")) %>%
  left_join(site_labels)

area_recult_threshold <- 
  read_csv(file = paste0(p_derived2, "area_recult_threshold", run_label, ".csv")) %>%
  left_join(site_labels)



# load stats on proportion of abandoned cropland by land cover
abn_lc_area_2017 <- read_csv(file = paste0(p_derived2, "abn_lc_area_2017", run_label, ".csv")) %>%
  left_join(site_labels)
abn_prop_lc_2017 <- read_csv(file = paste0(p_derived2, "abn_prop_lc_2017", run_label, ".csv")) %>%
  left_join(site_labels)


# load combined persistence, area, and turnover datasets:
# also known as dat_l in "4_decay_models.Rmd"

persistence_dat <- 
  # dat_l <- 
  read_csv(file = paste0(p_derived2, "persistence_dat", run_label, ".csv")) %>%
  mutate(site = as.factor(site),
         bins = as.factor(bins),
         year_abn_bins = as.factor(year_abn_bins),
         cohort = as.factor(cohort))

area_dat <- read_csv(file = paste0(p_derived2, "area_dat", run_label, ".csv"))
turnover_dat <- read_csv(file = paste0(p_derived2, "turnover_dat", run_label, ".csv"))



# load decay rate data

load(file = paste0(p_derived2, "/decay_mod_files", run_label, ".rds"), verbose = TRUE)
load(file = paste0(p_derived2, "/decay_endpoints_files", run_label, ".rds"), verbose = TRUE)

fitted_combo <- fitted_combo %>%
  left_join(site_labels)

# load new potential abandonment data:
potential_area_dat <- read_csv(file = paste0(p_derived2, "potential_area_dat", run_label, ".csv"))
potential_persistence_dat <- read_csv(file = paste0(p_derived2, "potential_persistence_dat", run_label, ".csv"))


# load carbon data:
site_carbon_df <- read_csv(file = paste0(p_derived2, "/carbon_df", run_label,".csv")) %>%
  left_join(site_labels)

read_csv(file = paste0(p_derived2, "/soc_mean.csv"))

```

```{r misc-notes, eval = FALSE}
# Authors and Affiliations, formatted to look nice in Word (i.e., nested within the abstract):
# author: Christopher L. Crawford,$^a$$^*$ He Yin,$^b$ Volker C. Radeloff,$^c$ and David S. Wilcove$^{a, d}$
# date: "`r format(Sys.time(), '%B %d, %Y')`"
# abstract: |
#   | $^a$Princeton School of Public and International Affairs, Princeton University, Princeton, NJ
#   | $^b$Department of Geography, Kent State University, Kent, OH
#   | $^c$SILVIS Lab, Department of Forest & Wildlife Ecology, University of Wisconsin - Madison, Madison, WI
#   | $^d$Department of Ecology & Evolutionary Biology, Princeton University, Princeton, NJ
#   |
#   | $^*$Corresponding Author, ccrawford@princeton.edu, Robertson Hall, Princeton University, Princeton, NJ


# the above looks ok in pdf format as well, but "Abstract" shows above the author affiliations. So, here is a pdf-specific method of formatting Authors and affiliations
# author:
#   - Christopher L. Crawford$^1$^[Corresponding Author, ccrawford@princeton.edu, Robertson Hall, Princeton University, Princeton, NJ]
#   - He Yin$^2$
#   - Volker C. Radeloff$^3$
#   - David S. Wilcove$^{1,4}$
# date: 
#   $^1$Princeton School of Public and International Affairs, Princeton University,
#   Princeton, NJ\newline 
#   $^2$Department of Geography, Kent State University, Kent, OH\newline
#   $^3$SILVIS Lab, Department of Forest & Wildlife Ecology, University of Wisconsin - Madison, Madison, WI\newline
#   $^4$Department of Ecology & Evolutionary Biology, Princeton University, Princeton, NJ\newline
#   \newline
#   \today


# --------------------------------------------------
# Miscellaneous YAML
# --------------------------------------------------
# Right after csl:
#   
# nocite: |
#   @RStudio, @R-rmarkdown, @R-bookdown, @R-knitr

# 
# - $^a$Princeton School of Public and International Affairs, Princeton University, Princeton, NJ
# - $^b$Department of Geography, Kent State University, Kent, OH
# - $^c$SILVIS Lab, Department of Forest & Wildlife Ecology, University of Wisconsin - Madison, Madison, WI
# - $^d$Department of Ecology & Evolutionary Biology, Princeton University, Princeton, NJ
# 
# 
#   | $^a$Princeton School of Public and International Affairs, Princeton University, Princeton, NJ
#   | $^b$Department of Geography, Kent State University, Kent, OH
#   | $^c$SILVIS Lab, Department of Forest & Wildlife Ecology, University of Wisconsin - Madison, Madison, WI
#   | $^d$Department of Ecology & Evolutionary Biology, Princeton University, Princeton, NJ
#   |
#   | $^*$Corresponding Author, ccrawford@princeton.edu, Robertson Hall, Princeton University, Princeton, NJ

# date: '`r format(Sys.Date(), "%B %d, %Y")`'
# 
# - Christopher L. Crawford^[Corresponding Author, ccrawford@princeton.edu, Robertson
#   Hall, Princeton University, Princeton, NJ] ^[Princeton University]
# - He Yin^[Kent State University]
# - Volker C. Radeloff^[University of Wisconsin, Madison]
# - David S. Wilcove^[Princeton University]

# author:
# - Christopher L. Crawford^[Corresponding Author, ccrawford@princeton.edu, Robertson Hall, Princeton University, Princeton, NJ] $^1$
# - He Yin$^2$
# - Volker C. Radeloff$^3$
# - David S. Wilcove$^{1, 4}$
# date: 
#   $^1$Princeton School of Public and International Affairs, Princeton University, Princeton, NJ \newline 
#   $^2$Department of Geography, Kent State University, Kent, OH \newline 
#   $^3$SILVIS Lab, Department of Forest & Wildlife Ecology, University of Wisconsin - Madison, Madison, WI \newline 
#   $^4$Department of Ecology & Evolutionary Biology, Princeton University, Princeton, NJ 


# --------------------------------------------------
# rmd-tips
# --------------------------------------------------

# Reference sections by including a tag directly after a header, such as {#section-label}, and then reference in line with the following:
# See Section \@ref(section-label)


# figures:
# this is a chunk for including a pre-existing plot or graphic.
#knitr::include_graphics("/Users/christophercrawford/work/projects/Zambia/agroEcoTradeoff/external/plots/Estes-plots_test.png")

# Figure captions:
# https://bookdown.org/yihui/rmarkdown-cookbook/cross-ref.html

# manually write figure captions outside of chunk with the following
# (ref:caption-label) Figure caption text.

# Chunk options:
# include = FALSE - this means that the code will still be evaluated, but none of the output will be included in the resulting document.

# fig.cap = '(ref:caption-label)' in the chunk options

# cross reference in line with: \@ref(fig:chunk-label) (or eq:label, or tab:label)

# can also include a list of figures by including the following in the YAML
# lof: True
# or, as I currently have it.
# \listoffigures



# Defining custom latex code for the preamble:
# You can include the following as a standalone YAML argument:
# header-includes:
#   - \usepackage[left]{lineno}
#   - \linenumbers
#   - \newcommand{\beginsupplement}{\setcounter{figure}{0} \setcounter{section}{0} \setcounter{table}{0} \setcounter{equation}{0} \renewcommand{\thefigure}{S\arabic{figure}} \renewcommand{\thesection}{S\arabic{section}} \renewcommand{\thetable}{S\arabic{table}} \renewcommand\theequation{S\arabic{equation}}}

# or, you can specify a custom preamble tex document to include, which is what I've done.
```
```{r get-duration-stats, include = FALSE}

# ^[*Note: these summary statistics are calculated based on the mean abandonment duration at each site, and are therefore the mean of means, and the standard deviation of means. The mean standard deviation is now reported in the SI Section @ref(results-si).*]

# ------------------------------------------------------------------- #
# observed abandonment duration stats
# ------------------------------------------------------------------- #
abn_duration_stats <- list(
  mean_of_means_duration = summary_stats_all_sites$mean_of_means %>% round(digits = 2),
  mean_of_sds_duration = summary_stats_all_sites$mean_of_sds %>% round(digits = 2),
  sd_of_mean_duration = summary_stats_all_sites$sd_of_means %>% round(digits = 2),
  
  # extrapolation_low = extrapolate_df_l3 %>% select(site, max_mean_age) %>% unique() %>% arrange(max_mean_age) %>% .$max_mean_age %>% .[1] %>% round(digits = 1),
  # extrapolation_high = extrapolate_df_l3 %>% select(site, max_mean_age) %>% unique() %>% arrange(max_mean_age) %>% .$max_mean_age %>% .[9] %>% round(digits = 1),
  
  duration_min = mean_length_df %>% 
    filter(abn_threshold == 5, length_type == "all") %>% 
    slice_min(mean_duration) %>% 
    select(mean_duration) %>% round(digits = 2) %>% as_vector(),
  
  duration_min_site = mean_length_df %>% 
    filter(abn_threshold == 5, length_type == "all") %>% 
    slice_min(mean_duration) %>% .$site_long,
  
  duration_max = mean_length_df %>% 
    filter(abn_threshold == 5, length_type == "all") %>% 
    slice_max(mean_duration) %>% 
    select(mean_duration) %>% round(digits = 2) %>% as_vector(),
  
  duration_max_site = mean_length_df %>% 
    filter(abn_threshold == 5, length_type == "all") %>% 
    slice_max(mean_duration) %>% .$site_long,
  
  sd_min = mean_length_df %>% filter(abn_threshold == 5, length_type == "all") %>% slice_min(sd_duration) %>% select(sd_duration) %>% round(digits = 2),
  sd_min_site = mean_length_df %>% filter(abn_threshold == 5, length_type == "all") %>% slice_min(sd_duration) %>% .$site_long,
  
  sd_max = mean_length_df %>% filter(abn_threshold == 5, length_type == "all") %>% slice_max(sd_duration) %>% select(sd_duration) %>% round(digits = 2),
  sd_max_site = mean_length_df %>% filter(abn_threshold == 5, length_type == "all") %>% slice_max(sd_duration) %>% .$site_long
)

# ------------------------------------------------------------------- #
# potential abandonment duration stats
# ------------------------------------------------------------------- #
# compare observed vs. potential mean lengths
compare_mean_lengths_df <-
  bind_rows(
  mean_length_df %>% filter(length_type == "all", abn_threshold == "5"),
  potential_mean_length_df %>% filter(length_type == "potential", abn_threshold == "5")) %>%
  pivot_wider(id_cols = c(site, abn_threshold),
              values_from = c(mean_duration#, sd_duration
                              ),
              names_from = length_type) %>%
  rename(observed = all) %>%
  mutate(diff = potential - observed, 
         p_diff = 100 * diff/potential) %>% 
  left_join(site_labels)


potential_abn_duration_stats <- list(
  mean_of_means_duration = potential_summary_stats_all_sites$mean_of_means %>% round(digits = 2),
  mean_of_sds_duration = potential_summary_stats_all_sites$mean_of_sds %>% round(digits = 2),
  sd_of_mean_duration = potential_summary_stats_all_sites$sd_of_means %>% round(digits = 2),
  
  duration_min = potential_mean_length_df %>% 
    filter(abn_threshold == 5, length_type == "potential") %>% 
    slice_min(mean_duration) %>% 
    select(mean_duration) %>% round(digits = 2) %>% as_vector(),
  
  duration_min_site = potential_mean_length_df %>% 
    filter(abn_threshold == 5, length_type == "potential") %>% 
    slice_min(mean_duration) %>% .$site_long,
  
  duration_max = potential_mean_length_df %>% 
    filter(abn_threshold == 5, length_type == "potential") %>% 
    slice_max(mean_duration) %>% 
    select(mean_duration) %>% round(digits = 2) %>% as_vector(),
  
  duration_max_site = potential_mean_length_df %>% 
    filter(abn_threshold == 5, length_type == "potential") %>% 
    slice_max(mean_duration) %>% .$site_long,
  
  sd_min = potential_mean_length_df %>% filter(abn_threshold == 5, length_type == "potential") %>% slice_min(sd_duration) %>% select(sd_duration) %>% round(digits = 2),
  sd_min_site = potential_mean_length_df %>% filter(abn_threshold == 5, length_type == "potential") %>% slice_min(sd_duration) %>% .$site_long,
  
  sd_max = potential_mean_length_df %>% filter(abn_threshold == 5, length_type == "potential") %>% slice_max(sd_duration) %>% select(sd_duration) %>% round(digits = 2),
  sd_max_site = potential_mean_length_df %>% filter(abn_threshold == 5, length_type == "potential") %>% slice_max(sd_duration) %>% .$site_long,
  
  p_diff_min = compare_mean_lengths_df %>%
    slice_min(p_diff) %>% 
    .$p_diff %>% round(digits = 2),
  p_diff_min_site = compare_mean_lengths_df %>%
    slice_min(p_diff) %>% 
    .$site_long,
  
  p_diff_max = compare_mean_lengths_df %>%
    slice_max(p_diff) %>% 
    .$p_diff %>% round(digits = 2),
  p_diff_max_site = compare_mean_lengths_df %>%
    slice_max(p_diff) %>% 
    .$site_long
)


# ------------------------------------------------------------------- #
# recultivation duration statistics:
# ------------------------------------------------------------------- #
recult_duration_stats <- list(
  mean_of_means_duration = recult_summary_stats_all_sites$mean_of_means %>% round(digits = 2) %>% format(nsmall = 2),
  mean_of_sds_duration = recult_summary_stats_all_sites$mean_of_sds %>% round(digits = 2),
  sd_of_mean_duration = recult_summary_stats_all_sites$sd_of_means %>% round(digits = 2),
  
  mean_duration_ceiling = mean_recult_length_df %>% 
    filter(recult_threshold == 1) %>% 
    slice_max(mean_duration, n = 2) %>% 
    slice_min(mean_duration) %>%
    .$mean_duration %>% ceiling(),
  
  mean_duration_ceiling_site = mean_recult_length_df %>% 
    filter(recult_threshold == 1) %>% 
    slice_max(mean_duration, n = 2) %>% 
    slice_min(mean_duration) %>%
    .$site_long,
  
  duration_min = mean_recult_length_df %>% 
    filter(recult_threshold == 1) %>% 
    slice_min(mean_duration) %>% 
    .$mean_duration %>% round(digits = 2),
  
  duration_min_site = mean_recult_length_df %>% 
    filter(recult_threshold == 1) %>% 
    slice_min(mean_duration) %>% .$site_long,
  
  duration_2nd_highest = mean_recult_length_df %>% 
    filter(recult_threshold == 1) %>% 
    slice_max(mean_duration, n = 2) %>% slice_min(mean_duration) %>%
    .$mean_duration %>% round(digits = 2),
  
  duration_2nd_highest_site = mean_recult_length_df %>% 
    filter(recult_threshold == 1) %>% 
    slice_max(mean_duration, n = 2) %>% slice_min(mean_duration) %>%
    .$site_long,
  
  
  duration_max = mean_recult_length_df %>% 
    filter(recult_threshold == 1) %>% 
    slice_max(mean_duration) %>% 
    .$mean_duration %>% round(digits = 2),
  
  duration_max_site = mean_recult_length_df %>% 
    filter(recult_threshold == 1) %>% 
    slice_max(mean_duration) %>% .$site_long,
  
  sd_min = mean_recult_length_df %>% 
    filter(recult_threshold == 1) %>% 
    slice_min(sd_duration) %>% .$sd_duration %>% round(digits = 2),
  
  sd_min_site = mean_recult_length_df %>% 
    filter(recult_threshold == 1) %>% 
    slice_min(sd_duration) %>% .$site_long,
  
  sd_max = mean_recult_length_df %>% 
    filter(recult_threshold == 1) %>% 
    slice_max(sd_duration) %>% select(sd_duration) %>% round(digits = 2),
  sd_max_site = mean_recult_length_df %>% 
    filter(recult_threshold == 1) %>% 
    slice_max(sd_duration) %>% .$site_long
)

mean_recult_length_df %>% 
  filter(recult_threshold == 1) %>% 
  slice_max(mean_duration, n = 2) %>% 
  slice_min(mean_duration) %>%
  .$mean_duration %>% ceiling()
```
```{r potential-v-obs-stats, include = FALSE}
# stats for the potential vs. observed area abandoned and carbon sequestration
# requires

a_df_2017 <- 
  bind_rows(area_dat %>% mutate(type = "Observed"),
          potential_area_dat %>% mutate(type = "Potential")) %>%
  filter(lc %in% c("Abandoned (>=5)"),
         year == 2017
         ) %>%
  pivot_wider(id_cols = c(site, year, lc), 
              names_from = type, names_prefix = "area_ha_",
              values_from = area_ha)
  

c_df_2017 <- site_carbon_df %>% 
  filter(threshold == 5, year == 2017) %>%
  pivot_wider(id_cols = c(site, year), 
              names_from = type, names_prefix = "Mg_C_",
              values_from = total_C_Mg)


# 
potential_v_obs_2017_df <- 
  left_join(a_df_2017, c_df_2017, by = c("site", "year")) %>%
  left_join(site_labels) %>%
  mutate(a_diff = 100 * (area_ha_Potential - area_ha_Observed) / area_ha_Potential,
         c_diff = 100 * (Mg_C_Potential - Mg_C_Observed) / Mg_C_Potential) %>%
  select(-c(lc)) %>%
  arrange(a_diff)


potential_v_obs_stats <- list(
  "total_area_diff_less_than" = 100 - 
    round(100* sum(potential_v_obs_2017_df$area_ha_Observed) /
            sum(potential_v_obs_2017_df$area_ha_Potential), digits = 2),
  
  "min_area_diff" = potential_v_obs_2017_df %>% 
    # filter(site != "mato_grosso") %>% 
    slice_min(a_diff) %>% .$a_diff %>% round(digits = 2),
  "min_area_diff_site" = potential_v_obs_2017_df %>% 
    # filter(site != "mato_grosso") %>% 
    slice_min(a_diff) %>% .$site_long,
  
  "max_area_diff" = potential_v_obs_2017_df %>% 
    # filter(site != "mato_grosso") %>% 
    slice_max(a_diff) %>% .$a_diff %>% round(digits = 2),
  "max_area_diff_site" = potential_v_obs_2017_df %>% 
    # filter(site != "mato_grosso") %>% 
    slice_max(a_diff) %>% .$site_long,
  
  "min_carbon_diff" = potential_v_obs_2017_df %>% 
    # filter(site != "mato_grosso") %>% 
    slice_min(c_diff) %>% .$c_diff %>% round(digits = 2),
  "min_carbon_diff_site" = potential_v_obs_2017_df %>% 
    # filter(site != "mato_grosso") %>% 
    slice_min(c_diff) %>% .$site_long,
  
  "max_carbon_diff" = potential_v_obs_2017_df %>% 
    # filter(site != "mato_grosso") %>% 
    slice_max(c_diff) %>% .$c_diff %>% round(digits = 2),
  "max_carbon_diff_site" = potential_v_obs_2017_df %>% 
    # filter(site != "mato_grosso") %>% 
    slice_max(c_diff) %>% .$site_long
)
```
```{r get-results-stats, include = FALSE}
# site_r$shaanxi$y2017
# test_area <- raster::area(site_r$shaanxi$y2017)
# plot(test_area)
# ncell(site_r$shaanxi$y2017)
# ncell(test_area)
# names(test_area) <- "area_km2"
# test_dt <- as.data.table.raster(stack(site_r$shaanxi$y2017, test_area))
# test_dt[,sum(area_km2 * 100), by = y2017]
# 1332.768 + 1021861.526 + 153480.420 + 246237.428+ 151124.082

site_df_w_size # note that this includes NA or 0 lc class cells, so is an overestimate. Use the site area from area_summary_df
area_summary_df %>% names

area_summary_df %>% 
  select(site, area_abn_ha_2017, area_ever_abn_ha, cropland_area_1987, total_crop_extent_ha, total_site_area_ha_2017, 
         area_2017_as_prop_site, area_2017_as_prop_total_crop, area_2017_as_prop_crop87) %>% 
  arrange(area_2017_as_prop_total_crop)

area_summary_df %>% 
  select(site, area_abn_ha_2017, area_ever_abn_ha, cropland_area_1987, total_crop_extent_ha, area_2017_as_prop_total_crop, area_2017_as_prop_crop87) %>% 
  arrange(area_2017_as_prop_total_crop) %>% 
  mutate(prop_crop_total_to_87 = total_crop_extent_ha/cropland_area_1987)


area_summary_df %>% select(site, area_abn_ha_2017, total_site_area_ha_2017, area_2017_as_prop_site) %>% arrange(area_2017_as_prop_site)


# ---------------------------------------------------------------------- #
# area abandoned statistics
area_abn_stats <- list(
  "min" = area_summary_df %>% filter(site != "mato_grosso") %>% slice_min(area_abn_ha_2017) %>% select(area_abn_ha_2017) %>% 
    # as.numeric() %>% 
    prettyNum(big.mark = ","),
  "min_site" = area_summary_df %>% filter(site != "mato_grosso") %>% slice_min(area_abn_ha_2017) %>% .$site_long,
  
  "max" = area_summary_df %>% slice_max(area_abn_ha_2017) %>% select(area_abn_ha_2017) %>% round(digits = 0) %>% as.numeric() %>% prettyNum(big.mark = ","),
  "max_site" = area_summary_df %>% slice_max(area_abn_ha_2017) %>% .$site_long,

  "mg" = area_summary_df %>% filter(site == "mato_grosso") %>% select(area_abn_ha_2017) %>% round(digits = 0) %>% as.numeric() %>% prettyNum(big.mark = ","),
  "mg_abn_2017_as_percent_total_crop" = area_summary_df %>% filter(site == "mato_grosso") %>% select(area_2017_as_prop_total_crop) %>% round(digits = 4) * 100,
  "mg_ever_abn_as_percent_total_crop" = area_summary_df %>% filter(site == "mato_grosso") %>% select(area_ever_abn_as_prop_total_crop) %>% round(digits = 4) * 100,
  
  "total_area_Mha_2017_all_sites" = round(area_summary_df$total_site_area_ha_2017 %>% sum() / 10^6 , digits = 2),
  "total_crop_extent_area_Mha_2017_all_sites" = round(area_summary_df$total_crop_extent_ha %>% sum() / 10^6 , digits = 2) %>% format(nsmall = 2),
  
  "total_area_ever_abn_Mha_all_sites" = round(area_summary_df %>% summarise(total_ever_abn_Mha = sum(area_ever_abn_ha)/1e6), digits = 2),
  "total_area_ever_abn_as_percent_of_total_crop_extent" = round(
    (sum(area_summary_df$area_ever_abn_ha) / sum(area_summary_df$total_crop_extent_ha)), 
    digits = 4) * 100,
  
  "total_crop_area_1987_Mha_all_sites" = round(area_summary_df$cropland_area_1987 %>% sum() / 10^6 , digits = 2),
  "total_area_abn_Mha_2017_all_sites" = round(area_summary_df$area_abn_ha_2017 %>% sum() / 10^6, digits = 2),
  
  "total_area_abn_2017_as_percent_of_total" = round((area_summary_df$area_abn_ha_2017 %>% sum()) / (area_summary_df$total_site_area_ha_2017 %>% sum()), digits = 4) * 100,
  
  "total_area_abn_2017_as_percent_of_crop87" = round(
    (sum(area_summary_df$area_abn_ha_2017) / sum(area_summary_df$cropland_area_1987)), 
    digits = 4) * 100,
  
  "total_area_abn_2017_as_percent_of_total_crop_extent" = round(
    (sum(area_summary_df$area_abn_ha_2017) / sum(area_summary_df$total_crop_extent_ha)), 
    digits = 4) * 100,
  
  # area_2017_as_prop_site
  "min_area_2017_as_prop_site" = area_summary_df %>% 
    filter(site != "mato_grosso") %>% 
    slice_min(area_2017_as_prop_site) %>% 
    select(area_2017_as_prop_site) %>% round(digits = 4) * 100,
  "min_area_2017_as_prop_site_site" =  area_summary_df %>% filter(site != "mato_grosso") %>% slice_min(area_2017_as_prop_site) %>% .$site_long,
  
  "max_area_2017_as_prop_site" = area_summary_df %>% slice_max(area_2017_as_prop_site) %>% select(area_2017_as_prop_site) %>% round(digits = 4) * 100,
  "max_area_2017_as_prop_site_site" = area_summary_df %>% slice_max(area_2017_as_prop_site) %>% .$site_long,
  
  # area_2017_as_prop_total_crop
  "min_area_2017_as_prop_total_crop" = area_summary_df %>% 
    filter(site != "mato_grosso") %>%
    slice_min(area_2017_as_prop_total_crop) %>% 
    select(area_2017_as_prop_total_crop) %>% round(digits = 4) * 100,
  "min_area_2017_as_prop_total_crop_site" =  area_summary_df %>% 
    filter(site != "mato_grosso") %>%
    slice_min(area_2017_as_prop_total_crop) %>% .$site_long,
  
  "max_area_2017_as_prop_total_crop" = area_summary_df %>% 
    slice_max(area_2017_as_prop_total_crop) %>% 
    select(area_2017_as_prop_total_crop) %>% round(digits = 4) * 100,
  "max_area_2017_as_prop_total_crop_site" = area_summary_df %>% slice_max(area_2017_as_prop_total_crop) %>% .$site_long,
  

  # area_ever_abn_as_prop_total_crop
  "min_area_ever_abn_as_prop_total_crop" = area_summary_df %>% filter(site != "mato_grosso") %>% slice_min(area_ever_abn_as_prop_total_crop) %>% select(area_ever_abn_as_prop_total_crop) %>% round(digits = 4) * 100,
  "min_area_ever_abn_as_prop_total_crop_site" =  area_summary_df %>% filter(site != "mato_grosso") %>% slice_min(area_ever_abn_as_prop_total_crop) %>% .$site_long,
  
  "max_area_ever_abn_as_prop_total_crop" = area_summary_df %>% slice_max(area_ever_abn_as_prop_total_crop) %>% select(area_ever_abn_as_prop_total_crop) %>% round(digits = 4) * 100,
  "max_area_ever_abn_as_prop_total_crop_site" = area_summary_df %>% slice_max(area_ever_abn_as_prop_total_crop) %>% .$site_long
)


# ---------------------------------------------------------------------- #
# land cover stats --------------------- #
lc_stats <- list(
  forest_min = abn_prop_lc_2017 %>% 
    filter(lc_2017 == 2) %>% slice_min(prop_lc_area_ha) %>% 
    select(prop_lc_area_ha) %>% round(digits = 2) * 100,
  
  forest_min_grassland = (1 - abn_prop_lc_2017 %>% 
                     filter(lc_2017 == 2) %>% slice_min(prop_lc_area_ha) %>% 
                     select(prop_lc_area_ha) %>% round(digits = 2)) * 100,
  
  forest_min_site = abn_prop_lc_2017 %>% 
    filter(lc_2017 == 2) %>% slice_min(prop_lc_area_ha) %>% .$site_long,
  
  forest_max = abn_prop_lc_2017 %>% 
    filter(lc_2017 == 2) %>% slice_max(prop_lc_area_ha) %>% 
    select(prop_lc_area_ha) %>% round(digits = 2) * 100,
  
  forest_max_grassland = (1 - abn_prop_lc_2017 %>% 
                         filter(lc_2017 == 2) %>% slice_max(prop_lc_area_ha) %>% 
                         select(prop_lc_area_ha) %>% round(digits = 2)) * 100,
  
  forest_max_site = abn_prop_lc_2017 %>% filter(lc_2017 == 2) %>% slice_max(prop_lc_area_ha) %>% .$site_long
  )
```
```{r recultivation-stats, include = FALSE}

area_recult_threshold # this data.frame includes the total area abandoned in 2017, the total cumulative
potential_v_obs_2017_df %>% arrange(site) %>% select(site, area_ha_Observed, area_ha_Potential) 

# The potential area in 2017 is the same as the area ever abandoned (area_ever_abn_ha).
# Both of these numbers are smaller than area_recult_threshold$total_initial_area_abn because this is the sum of
# each new group of abandonment, and some pixels can be abandoned (and recultivated) multiple times.

names(area_summary_df)
area_summary_df %>% select(site, area_ever_abn_ha)
area_recult_threshold %>% filter(abn_threshold == 5) %>% 
  select(site_long, proportion_recultivated) %>%
  arrange(proportion_recultivated) %>%
  .$proportion_recultivated %>% mean()

# ---------------------------------------------------------------------- #

# recultivation statistics
recult_stats <- list(
  "mean_thr_5" = area_recult_threshold %>% group_by(abn_threshold) %>% 
    summarise(mean_proportion = mean(proportion_recultivated),
              sd_proportion = sd(proportion_recultivated)) %>% 
    filter(abn_threshold == 5) %>% select(mean_proportion) %>% round(digits = 4) * 100,
  
  "sd_thr_5" = area_recult_threshold %>% 
    group_by(abn_threshold) %>%
    summarise(mean_proportion = mean(proportion_recultivated),
              sd_proportion = sd(proportion_recultivated)) %>%
    filter(abn_threshold == 5) %>% select(sd_proportion) %>% round(digits = 4) * 100,
  
  "mean_thr_7" = area_recult_threshold %>% group_by(abn_threshold) %>% 
    summarise(mean_proportion = mean(proportion_recultivated)) %>% 
    filter(abn_threshold == 7) %>% select(mean_proportion) %>% round(digits = 4) * 100,
  
  "mean_thr_10" = area_recult_threshold %>% group_by(abn_threshold) %>% 
    summarise(mean_proportion = mean(proportion_recultivated)) %>% 
    filter(abn_threshold == 10) %>% select(mean_proportion) %>% round(digits = 4) * 100,
  
  "min_5" = area_recult_threshold %>% filter(abn_threshold == 5) %>% slice_min(proportion_recultivated) %>% .$proportion_recultivated %>% round(digits = 4) * 100,
  "min_5_site" = area_recult_threshold %>% filter(abn_threshold == 5) %>% slice_min(proportion_recultivated) %>% .$site_long,
  
  "max_5" = area_recult_threshold %>% filter(abn_threshold == 5, site != "mato_grosso") %>% slice_max(proportion_recultivated) %>% .$proportion_recultivated %>% round(digits = 4) * 100,
  "max_5_site" = area_recult_threshold %>% filter(abn_threshold == 5, site != "mato_grosso") %>% slice_max(proportion_recultivated) %>% .$site_long,
  
  "min_10" = area_recult_threshold %>% filter(abn_threshold == 10) %>% slice_min(proportion_recultivated) %>% .$proportion_recultivated %>% round(digits = 4) * 100,
  "min_10_site" = area_recult_threshold %>% filter(abn_threshold == 10) %>% slice_min(proportion_recultivated) %>% .$site_long,
  
  "max_10" = area_recult_threshold %>% filter(abn_threshold == 10, site != "mato_grosso") %>% slice_max(proportion_recultivated) %>% .$proportion_recultivated %>% round(digits = 4) * 100,
  
  "max_10_site" = area_recult_threshold %>% filter(abn_threshold == 10, site != "mato_grosso") %>% slice_max(proportion_recultivated) %>% .$site_long

)

area_recult_threshold %>% filter(abn_threshold == 5)

mean_recult_length_df %>% filter(recult_threshold == 1)


abn_duration_stats # see "get-duration-stats"
recult_duration_stats
```
```{r get-decay-stats, include = FALSE}

# ------------------------------------------------ #

endpoint_half_lives_10_25_tmp <- 
  endpoint_half_lives %>%
  left_join(site_labels) %>%
  filter(endpoint <= 25, endpoint >= 10)

endpoint_half_lives %>%
  filter(
    # !grepl("bosnia", site), 
    # endpoint <= 25, endpoint >= 10
    ) %>%
  .$mean %>% summary() %>%
  as.vector() %>%
    tibble(cols = c("Min.", "1st Qu.", "Median", "Mean", "3rd Qu.", "Max."),
           value = .)

tmp_all <- endpoint_half_lives %>%
  filter(
    # !grepl("bosnia", site), 
    # endpoint <= 25, endpoint >= 10
    ) %>%
  .$mean %>% summary() %>%
  as.vector() %>%
    tibble(cols = c("Min.", "1st Qu.", "Median", "Mean", "3rd Qu.", "Max."),
           value = .)

tmp_1 <- endpoint_half_lives %>%
  filter(
    # !grepl("bosnia", site),
    endpoint <= 25, endpoint >= 10
    ) %>%
  .$mean %>% summary() %>%
  as.vector() %>%
    tibble(cols = c("Min.", "1st Qu.", "Median", "Mean", "3rd Qu.", "Max."),
           value = .)
tmp_2 <- endpoint_half_lives %>%
  filter(
    !grepl("bosnia", site),
    endpoint <= 25, endpoint >= 10
    ) %>%
  .$mean %>% summary() %>%
  as.vector() %>%
    tibble(cols = c("Min.", "1st Qu.", "Median", "Mean", "3rd Qu.", "Max."),
           value = .)

tmp_2 %>% mutate(paste = paste0(cols, ": ", round(value, digits = 2))) %>%
  .$paste %>% cat(sep = ", ")

names(endpoint_half_lives %>%
    filter(site == i) %>%
    .$mean %>%
    summary())


endpoints_summary_tmp <- lapply(site_df$site, function(i) {
  endpoint_half_lives %>%
    filter(site == i) %>%
    .$mean %>%
    summary() %>% as.vector() %>%
    as_tibble() %>% 
    mutate(cols = c("Min.", "1st Qu.", "Median", "Mean", "3rd Qu.", "Max."),
           site = i)
  }
  ) %>% bind_rows()

endpoints_summary_tmp %>%
  filter(cols == "Median")
  
endpoint_half_lives %>%
  filter(site == site_df$site[i]) %>%
  summary(mean)

decay_stats <- list(
  "hl_min" = endpoint_half_lives_10_25_tmp %>%
    filter(!grepl("bosnia", site)) %>%
    .$mean %>% min() %>% round(digits = 2),
  "hl_max" = endpoint_half_lives_10_25_tmp %>%
    filter(!grepl("bosnia", site)) %>%
    .$mean %>% max() %>% round(digits = 2) %>% format(nsmall = 2),
  
  "hl_mean" = endpoint_half_lives %>%
    filter(!grepl("bosnia", site), 
           endpoint <= 25, endpoint >= 10) %>%
    .$mean %>% mean() %>% round(digits = 2),
  "hl_sd" = endpoint_half_lives %>%
    filter(!grepl("bosnia", site), 
           endpoint <= 25, endpoint >= 10) %>%
    .$mean %>% sd() %>% round(digits = 2),
  
  "hl_q1" = endpoint_half_lives_10_25_tmp %>%
    filter(!grepl("bosnia", site)) %>%
    .$mean %>% quantile(probs = 0.25) %>% round(digits = 2),
  
  "hl_q3" = endpoint_half_lives_10_25_tmp %>%
    filter(!grepl("bosnia", site)) %>%
    .$mean %>% quantile(probs = 0.75) %>% round(digits = 2),
  
  "t0.5_min" = endpoint_half_lives_10_25_tmp %>%
    slice_min(mean) %>% .$mean %>% floor(),
  "t0.5_max" = endpoint_half_lives_10_25_tmp %>%
    filter(!grepl("bosnia", site)) %>%
    slice_max(mean) %>% .$mean %>% ceiling(),
  
  "t0.5_min_site" = endpoint_half_lives_10_25_tmp %>%
    slice_min(mean) %>% .$site_long,
  "t0.5_max_site" = endpoint_half_lives_10_25_tmp %>%
    filter(!grepl("bosnia", site)) %>%
    slice_max(mean) %>% .$site_long,
  
  "mg_hl_min" = endpoint_half_lives %>%
    filter(site == "mato_grosso") %>%
    .$mean %>% min() %>% round(digits = 2),
  "mg_hl_max" = endpoint_half_lives %>%
    filter(site == "mato_grosso") %>%
    .$mean %>% max() %>% round(digits = 2)
)

# ---------------------------------------------------------------------- #
# simple scenario without recultivation
sum(potential_v_obs_2017_df$area_ha_Observed) / 
  sum(potential_v_obs_2017_df$area_ha_Potential)
```
```{r carbon-stats, include = FALSE}

carbon_tmp <-
  potential_v_obs_2017_df %>%
  mutate(MgC_per_ha_Observed = Mg_C_Observed / area_ha_Observed,
         MgC_per_ha_Potential = Mg_C_Potential / area_ha_Potential) %>%
  arrange(MgC_per_ha_Observed) %>%
  select(site, site_long, MgC_per_ha_Observed, MgC_per_ha_Potential)
# 
# carbon_tmp
# carbon_tmp %>% filter(MgC_per_ha_Observed < 4) %>% .$site_long %>% paste0(collapse = "; ")
# 
# carbon_tmp %>% filter(site == "goias") %>% .$MgC_per_ha_Observed %>% round(digits = 2)
# 
# endpoint_half_lives %>%
#   arrange(desc(mean)) %>% print (n =40)
# 
# potential_v_obs_2017_df %>%
#   select(-c(site, site_long)) %>%
#   as.matrix() %>%
#   colSums(., dims = 1)/10^6
# 
# potential_v_obs_2017_df %>%
#   summarise(total_area = sum(area_ha_Observed),
#              total_MgC = sum(Mg_C_Observed)) %>%
#   mutate(MgC_per_ha = total_MgC / total_area) %>%
#   .$total_MgC / 10^6
# 
# round(100* sum(potential_v_obs_2017_df$Mg_C_Observed) / sum(potential_v_obs_2017_df$Mg_C_Potential), digits = 2)
# potential_v_obs_2017_df

carbon_stats <- list(
  "total_observed" = round(sum(potential_v_obs_2017_df$Mg_C_Observed) / 10^6, digits = 2),
  "total_potential" = round(sum(potential_v_obs_2017_df$Mg_C_Potential) / 10^6, digits = 2),
  "total_diff" = round(100* sum(potential_v_obs_2017_df$Mg_C_Observed) /
                         sum(potential_v_obs_2017_df$Mg_C_Potential), digits = 2),
  "total_diff_less_than" = 100 - round(
    100* sum(potential_v_obs_2017_df$Mg_C_Observed) /
      sum(potential_v_obs_2017_df$Mg_C_Potential), digits = 2),

  "MgC_grass_min" = carbon_tmp %>% filter(MgC_per_ha_Observed < 9) %>% slice_min(MgC_per_ha_Observed) %>% .$MgC_per_ha_Observed %>% round(digits = 2),
  
  "MgC_grass_max" = carbon_tmp %>% filter(MgC_per_ha_Observed < 9) %>% slice_max(MgC_per_ha_Observed) %>% .$MgC_per_ha_Observed %>% round(digits = 2),
  
  "MgC_for_min" = carbon_tmp %>% filter(MgC_per_ha_Observed > 10) %>% slice_min(MgC_per_ha_Observed) %>% .$MgC_per_ha_Observed %>% round(digits = 2),
  
  "MgC_for_max" = carbon_tmp %>% filter(MgC_per_ha_Observed > 10) %>% slice_max(MgC_per_ha_Observed) %>% .$MgC_per_ha_Observed %>% round(digits = 2)
)
```
```{r load-2yr-diff, include = FALSE}
abn_2yr_overestimation <- 
  read_csv(file = paste0(p_derived2, 
                         "abn_2yr_overestimation", run_label, ".csv")) %>%  
  arrange(percent_diff) %>% 
  left_join(., site_df %>% select(site, description), by = "site") %>%
  left_join(site_labels)

prettyNum(round(abn_2yr_overestimation %>% group_by() %>% summarise("sum" = sum(area_2yr)) %>% as.numeric() / 10^6, digits = 2), digits = 2, format = "f")
format(round(abn_2yr_overestimation %>% group_by() %>% summarise("sum" = sum(area_2yr)) %>% as.numeric() / 10^6, digits = 2), nsmall = 2)


abn_2yr_stats <- list(
  total_area_abn_Mha = round(abn_2yr_overestimation %>% group_by() %>% summarise("sum" = sum(area_2yr)) %>% as.numeric() / 10^6, digits = 2),
  low_percent = round(abn_2yr_overestimation %>% slice_min(percent_diff) %>% .$percent_diff, digits = 2),
  high_percent = round(abn_2yr_overestimation %>% slice_max(percent_diff) %>% .$percent_diff, digits = 2),
  
  low_p_site = abn_2yr_overestimation %>% slice_min(percent_diff) %>% .$site_long,
  high_p_site = abn_2yr_overestimation %>% slice_max(percent_diff) %>% .$site_long,
  
  jaccard_low = round(abn_2yr_overestimation %>% slice_min(jaccard) %>% .$jaccard, digits = 4) * 100,
  jaccard_high = round(abn_2yr_overestimation %>% slice_max(jaccard) %>% .$jaccard, digits = 4) * 100,
  
  jaccard_low_site = abn_2yr_overestimation %>% slice_min(jaccard) %>% .$site_long,
  jaccard_high_site = abn_2yr_overestimation %>% slice_max(jaccard) %>% .$site_long,
  
  percent_area_below_5_low = round(abn_2yr_overestimation %>% filter(site != "mato_grosso") %>% slice_min(percent_2yr_abn_area_less_than_5yrs_old) %>% .$percent_2yr_abn_area_less_than_5yrs_old, digits = 2),
  percent_area_below_5_high = round(abn_2yr_overestimation %>% filter(site != "mato_grosso") %>% slice_max(percent_2yr_abn_area_less_than_5yrs_old) %>% .$percent_2yr_abn_area_less_than_5yrs_old, digits = 2),
  
  percent_area_below_5_low_site = abn_2yr_overestimation %>% filter(site != "mato_grosso") %>% slice_min(percent_2yr_abn_area_less_than_5yrs_old) %>% .$site_long,
  percent_area_below_5_high_site = abn_2yr_overestimation %>% slice_max(percent_2yr_abn_area_less_than_5yrs_old) %>% .$site_long
  
)


abn_2yr_overestimation_char <- abn_2yr_overestimation %>%
  mutate(jaccard = jaccard %>% round(digits = 2), 
         area_ha_cc = area_ha_cc %>% round(digits = 0) %>% prettyNum(big.mark = ","),
         area_2yr = area_2yr %>% round(digits = 0) %>% prettyNum(big.mark = ","),
         percent_diff = percent_diff %>% round(digits = 2) %>% paste0(., "%"),
         percent_2yr_abn_area_less_than_5yrs_old = percent_2yr_abn_area_less_than_5yrs_old %>%
           round(digits = 2) %>% paste0(., "%"))
```

# Abstract {.unnumbered}

Hundreds of millions of hectares of cropland have been abandoned globally since 1950 due to demographic, economic, and environmental changes.
This abandonment has been seen as an important opportunity for carbon sequestration and habitat restoration, yet those benefits depend on the persistence of abandonment, which is poorly known.
Here, we track abandonment and recultivation at 11 sites across four continents using annual land cover maps for 1987-2017. 
We find that abandonment is largely fleeting, lasting on average only `r abn_duration_stats$mean_of_means_duration` years (SD = `r abn_duration_stats$sd_of_mean_duration`).
At most sites, we project that >50% of abandoned croplands will be recultivated within 30 years, precluding the accumulation of substantial amounts of carbon and biodiversity.
Recultivation resulted in `r potential_v_obs_stats$total_area_diff_less_than`% less abandonment and `r carbon_stats$total_diff_less_than`% less carbon accumulated by 2017 than expected without recultivation.
Unless policymakers take steps to reduce recultivation or provide incentives for regeneration, abandonment will remain a missed opportunity to reduce biodiversity loss and climate change.

<!-- ## Keywords {.unnumbered} -->

<!-- Agriculture, cropland abandonment, agricultural abandonment, farmland abandonment, rural land abandonment, biodiversity conservation, secondary succession, carbon sequestration, land-cover mapping -->

# Short title {.unnumbered}
Short-term abandonment limits environmental gains

# Teaser {.unnumbered}

Without incentives for restoration, cropland abandonment rarely lasts long enough to yield biodiversity or carbon benefits.

# Introduction {.unnumbered}

```{r potapov, include = FALSE}
potapov_loss <- c(115.5, 24.1) # Mha

(potapov_loss * 0.52) +  # "52% was either converted into pastures or abandoned (Table 2); such conver- sions may be temporary and followed by crop recultivation years later."
(potapov_loss * 0.16) # "The remaining 16% of cropland reduction represented tree plantations or restoration of natural vegetation after cropland abandonment."

.16 / (.52 + .16) # the percent

potapov_gain <- c(217.5, 37.7) # Mha

potapov_gain * 0.49 # "Half of the new croplands replaced natural woody and herbaceous vegetation (49% of gross cropland gain area)"
potapov_gain * 0.51 # "51% was due to pasture conversion and recultivation of abandoned arable land"
```

Human populations are in flux around the world, as people seek new economic opportunities in cities and flee changing environments and conflicts in rural areas [@Sanderson2018].
Urbanization and rural outmigration, together with environmental degradation and changing agricultural technologies, have contributed to a growing global trend of cropland abandonment [@ReyBenayas2007; @Prishchepov2021; @Naess2021].
Hundreds of millions of hectares of agricultural lands have been abandoned since 1950 [@Li2017; @Chazdon2020].
Recent estimates from satellite imagery indicate that as much as 78.5 $\pm$ 16.4 million hectares (Mha) of gross cropland abandonment took place globally just from 2003 to 2019 (of which 18.5 $\pm$ 3.9 Mha, or 24%, gained tree cover), along with 217.5 $\pm$ 37.7 Mha of gross cropland expansion (of which 49% came from the conversion of natural habitats, and 51% from recultivation of abandoned lands or pastures) [@Potapov2022].
Thus, while cropland expansion remains the dominant threat to biodiversity and carbon stocks [@Potapov2022; @Roe2019; @Tilman2017], many researchers view cropland abandonment as providing a badly needed opportunity to regain natural ecosystems, thereby helping to restore biodiversity [@Chazdon2020; @Xie2019; @Navarro2012], sequester carbon [@Chazdon2016a; @Yang2019], and potentially offset some of the impact of agricultural expansion.
Spatial heterogeneity in the distribution of abandonment (and biodiversity and carbon stocks) means that abandonment may have a substantial effect on the biodiversity and carbon stocks of some regions.

This opportunity figures prominently in global scenarios of both future climate change and biodiversity conservation.
In fact, nearly all climate scenarios in which global warming is limited to 1.5°C rely on substantial amounts of carbon removal, whether through reforestation, afforestation, or bioenergy with carbon capture and storage [@IPCC2018; @Popp2017; @Houghton2018].
Abandoned agricultural lands are seen as ideal places to achieve these carbon removal goals while avoiding competition with food production, particularly by advocates for bioenergy [@Naess2021; @Campbell2008].
Bioenergy production, however, often precludes the potential for biodiversity gains alongside climate mitigation benefits, because bioenergy plantations are usually poor in biodiversity (though these trade-offs may be reduced in some cases through the use of native perennial species) [@Robertson2017].
Optimistic scenarios in which biodiversity loss is reversed often rely on forest and grassland regeneration on former agricultural lands [@Henry2019; @Leclere2020; @Folberth2020].
Agricultural abandonment is also integral to forecasts of “forest transitions,” in which economic development, increasing crop yields, a scarcity of forest products and services, and rural outmigration collectively result in the abandonment of marginal farmlands, allowing a region to transition from net deforestation to net reforestation as regeneration takes place [@Meyfroidt2011; @Rudel2020].

While abandonment is predicted to continue in Europe, Russia and Central Asia, East Asia, and the Americas [@Sanderson2018; @Popp2017; @Leclere2020], for how long and to what end remains unclear.
Moreover, despite recent reforestation in many regions, recent evidence from Latin America has called the durability of such reforestation into question [@Schwartz2020; @Sloan2022].
Understanding the true potential of cropland abandonment to contribute to biodiversity and climate goals requires detailed information not only on where and when abandonment is taking place, but also on what happens to croplands after they are abandoned.
To produce substantial environmental benefits, abandoned lands must stay abandoned long enough to accumulate appreciable amounts of both plant biomass and the species that make up intact ecological communities, a process that can take many decades in order to approach the levels of carbon sequestration or biodiversity typical of intact ecosystems [@Rozendaal2019; @Acevedo-Charry2019; @Isbell2019; @Nerlekar2020; @Gilroy2014; @Cook-Patton2020; @Poorter2016].
Knowing how long abandonment persists is therefore critical to understanding its potential to help mitigate the ongoing climate and biodiversity crises, yet this question of persistence has received little attention from researchers.

This lack of attention is not entirely surprising because, until recently, it has been difficult to gather detailed information on the duration and long-term trajectories of abandonment.
Many existing estimates of abandonment have been inferred by aggregating regional estimates of cultivation, such as country-level FAO (Food and Agriculture Organization of the United Nations) data on cultivated areas, to look for trends over time [@Isbell2019; @Munroe2013].
When derived from satellite imagery, abandonment is most frequently estimated by simply comparing cropland maps for two time points [e.g., 1992 and 2015, @Naess2021].
In other cases, maps are made for periods covering multiple years [e.g., four-year epochs, @Potapov2022].
Annual land-cover time series are becoming more common, but are typically limited to a few years [e.g., 2-12 years, @Alcantara2013, @Estel2015, @Lark2015] or are coarse in resolution [e.g., $\geq250$ m, @Naess2021, @Estel2015].
In addition, most analyses have been restricted to a single region [@Dara2018].
These approaches all lack the spatial and temporal detail needed to understand long-term outcomes for abandoned croplands.
Moreover, by failing to capture the dynamic patterns of abandonment and recultivation, scientists may substantially overestimate abandonment and the potential for associated environmental benefits [@Yin2020].

Recent advances in remote sensing have made it possible to produce maps of cropland abandonment at both high spatial and temporal resolution.
Yin et al. [-@Yin2020] used a trajectory-based approach to produce accurate maps of annual cropland abandonment at 30-m resolution from 1987 to 2017 with an average overall mapping accuracy of 85 $\pm$ 4% (see Materials and Methods).
Notably, their approach did not rely on woody revegetation as a proxy for abandonment, thereby allowing for a direct measurement of abandonment at earlier stages of regeneration and across both forest and non-forest biomes.

Here, we utilize these time-series data [@Yin2020] to quantify the magnitude and persistence of abandonment at 11 sites across four continents (Fig. \@ref(fig:global-map)).
We address four questions: 
(i) How long did abandoned cropland stay abandoned on average, and how did this vary among sites?
(ii) If we model the persistence of abandonment as a decay process over time, how long did abandoned croplands persist before they were recultivated, and did recultivation (or "decay") rates vary through time and among sites?
(iii) How much carbon can accumulate in forests and grasslands as they regenerate in abandoned croplands (in the form of above and belowground biomass and soil organic carbon, respectively)?
(iv) Finally, if abandoned croplands had not been recultivated as observed, how much area would have remained abandoned and how much carbon could have been accumulated by the end of our time series?
By making use of more accurate and finer resolution maps for a longer period and a broader set of sites than previous studies, we provide the most detailed analysis to date of the longevity of cropland abandonment.
Collectively, our results reveal the temporal nature of cropland abandonment and its potential to sequester carbon and conserve biodiversity.

# Results {.unnumbered}

## Abandonment duration {.unnumbered}

Cropland abandonment was widespread across our 11 study sites (Fig. \@ref(fig:maps-abn-duration)).
We found that `r area_abn_stats$total_area_ever_abn_Mha_all_sites` Mha of croplands were abandoned at least once between 1987 and 2017 across our 11 sites (Figs. \@ref(fig:area-abn-by-age-class) and \@ref(fig:maps-max-abn-duration)).
(To exclude normal fallow periods, we classify croplands as "abandoned" only when they have not been cultivated for at least 5 years in a row; see Materials and Methods.)
This corresponds to `r area_abn_stats$total_area_ever_abn_as_percent_of_total_crop_extent`% of the total cropland extent (`r area_abn_stats$total_crop_extent_area_Mha_2017_all_sites` Mha) of our sites (i.e., all lands that were cultivated at some point during the time series; see Table \@ref(tab:abn-panel-table)).
At individual sites, the area of cropland abandoned at least once ranged from `r area_abn_stats$min_area_ever_abn_as_prop_total_crop`% (`r area_abn_stats$min_area_ever_abn_as_prop_total_crop_site`) to `r area_abn_stats$max_area_ever_abn_as_prop_total_crop`% (`r area_abn_stats$max_area_ever_abn_as_prop_total_crop_site`) of the total cropland extent (Figs. \@ref(fig:area-abn-by-age-class) and \@ref(fig:area-abn-panel), Table \@ref(tab:abn-panel-table)), except for Mato Grosso, Brazil, where only `r area_abn_stats$mg_ever_abn_as_percent_total_crop`% was abandoned at least once.
(Given that land use trends in Mato Grosso were dominated by expansion, not abandonment, we exclude this site from the general results, unless otherwise noted; see detailed results in Section \@ref(mato-grosso-si).)

However, we also found that many of these abandoned croplands were recultivated: On average, `r recult_stats$mean_thr_5`% of abandoned cropland area at each site had been recultivated by 2017 (SD = `r recult_stats$sd_thr_5`%; Fig. \@ref(fig:recult-by-threshold)).
In fact, only `r area_abn_stats$total_area_abn_Mha_2017_all_sites` Mha of croplands remained abandoned as of 2017 across our sites (Figs. \@ref(fig:maps-abn-duration) and \@ref(fig:area-abn-by-age-class)), constituting `r potential_v_obs_stats$total_area_diff_less_than`% less than the area abandoned at least once during the time series (i.e., the potential area abandoned in 2017 in a scenario without recultivation).
The magnitude of recultivation varied across sites, with observed abandonment as of 2017 occupying between `r potential_v_obs_stats$min_area_diff`% (`r potential_v_obs_stats$min_area_diff_site`) and `r potential_v_obs_stats$max_area_diff`% (`r potential_v_obs_stats$max_area_diff_site`) less area relative to the potential area without recultivation at each site (Figs. \@ref(fig:area-abn-by-age-class) and \@ref(fig:potential-area-bins), Table \@ref(tab:abn-panel-table)).
The share of total cropland abandoned also declined by 2017, corresponding to `r area_abn_stats$total_area_abn_2017_as_percent_of_total_crop_extent`% of total cropland extent overall and ranging from `r area_abn_stats$min_area_2017_as_prop_total_crop`% (`r area_abn_stats$min_area_2017_as_prop_total_crop_site`) to `r area_abn_stats$max_area_2017_as_prop_total_crop`% (`r area_abn_stats$max_area_2017_as_prop_total_crop_site`) at individual sites.

As a result of recultivation, the mean duration of abandonment across all sites was short: `r abn_duration_stats$mean_of_means_duration` years (SD = `r abn_duration_stats$sd_of_mean_duration`; see Section \@ref(summary-stats-si)), ranging from `r abn_duration_stats$duration_min` (`r abn_duration_stats$duration_min_site`) to `r abn_duration_stats$duration_max` years (`r abn_duration_stats$duration_max_site`; Fig. \@ref(fig:mean-abn-duration), Table \@ref(tab:summary-stats-table)).
For comparison, these observed mean abandonment durations were much shorter than the potential durations in our scenario without recultivation, which reached `r potential_abn_duration_stats$mean_of_means_duration` years (SD = `r potential_abn_duration_stats$sd_of_mean_duration`) on average across all sites, ranging from `r potential_abn_duration_stats$duration_min %>% format(nsmall = 2)` (`r potential_abn_duration_stats$duration_min_site`) to `r potential_abn_duration_stats$duration_max` years (`r potential_abn_duration_stats$duration_max_site`; Fig. \@ref(fig:mean-potential-abn-duration), Table \@ref(tab:potential-summary-stats-table)).
Compared to their potential values, our observed mean durations declined by between `r potential_abn_duration_stats$p_diff_min`% (`r potential_abn_duration_stats$p_diff_min_site`) and `r potential_abn_duration_stats$p_diff_max`% (`r potential_abn_duration_stats$p_diff_max_site`).
Observed abandonment duration also varied substantially within sites, with the standard deviation in abandonment duration (representing the variation among instances of abandonment at a given site) ranging from `r abn_duration_stats$sd_min` (`r abn_duration_stats$sd_min_site`) to `r abn_duration_stats$sd_max` years (`r abn_duration_stats$sd_max_site`), for an average of `r abn_duration_stats$mean_of_sds_duration` years across all sites (Table \@ref(tab:summary-stats-table), Section \@ref(summary-stats-si)).
We also found that recultivation at most sites was usually short-term, lasting `r recult_duration_stats$mean_of_means_duration` years on average (SD = `r recult_duration_stats$sd_of_mean_duration`), until either the recultivated land was abandoned again and allowed to regenerate, or the time series ended.
`r recult_duration_stats$duration_max_site`, had a mean recultivation length of `r recult_duration_stats$duration_max` years, whereas recultivation at the other sites lasted between `r recult_duration_stats$duration_min` and `r recult_duration_stats$duration_2nd_highest` years (Fig. \@ref(fig:mean-recult-duration), Table \@ref(tab:recult-summary-stats-table)).

## Estimated carbon sequestration in abandoned croplands {.unnumbered}

Using recently published global maps of potential carbon accumulation in forest biomass [1-km resolution, @Cook-Patton2020] and soil organic carbon [250-m resolution, @Sanderman2020] during natural regrowth of native vegetation, we estimated total carbon accumulation in abandoned croplands as a function of their age and biome (Fig. \@ref(fig:carbon-over-time), Table \@ref(tab:carbon-table)).
We estimated a total carbon accumulation of `r carbon_stats$total_observed` Tg C ($10^{6}$ tons C) total across our 11 sites by 2017.
However, this was `r carbon_stats$total_diff_less_than`% less than the `r carbon_stats$total_potential` Tg C total that could have accumulated in our scenario without recultivation, a scenario in which regrowth was permitted from the time of abandonment through the end of the time series, irrespective of observed recultivation.
At individual sites, recultivation reduced estimated carbon accumulation by between `r potential_v_obs_stats$min_carbon_diff` and `r potential_v_obs_stats$max_carbon_diff`% by 2017 (Fig. \@ref(fig:carbon-over-time), Table \@ref(tab:carbon-table)).

Carbon sequestration was not equally distributed across sites (Figs. \@ref(fig:carbon-map-2017-observed)-\@ref(fig:carbon-map-2017-potential)), due partially to differences between sites in the age distribution of abandoned croplands, but more substantially to differences between forest and non-forest biomes (Figs. \@ref(fig:site-biomes)-\@ref(fig:site-ecoregions); annual carbon accumulation rates are shown in Figs. \@ref(fig:carbon-map-Y20-rate)-\@ref(fig:carbon-map-YSS-rate)).
Sites in largely non-forest biomes accumulated much less carbon per hectare by 2017 (<3.50 Mg C per ha, on average, at `r carbon_tmp %>% filter(MgC_per_ha_Observed < 4) %>% .$site_long %>% paste0(collapse = "; ")`) than did sites in forest biomes, which accumulated `r carbon_stats$MgC_for_min` - `r carbon_stats$MgC_for_max` Mg C per ha on average (`r carbon_tmp %>% filter(MgC_per_ha_Observed > 10) %>% .$site_long %>% paste0(collapse = "; ")`; see Table \@ref(tab:carbon-table), Fig \@ref(fig:carbon-per-ha)).
Goiás, Brazil, which is mostly tropical grassland, savanna, and shrubland with only a small area in forest, had intermediate carbon accumulation per ha, at `r carbon_tmp %>% filter(site == "goias") %>% .$MgC_per_ha_Observed %>% round(digits = 2)` Mg C per ha on average (Table \@ref(tab:carbon-table), Fig \@ref(fig:carbon-per-ha)).

## Modeling recultivation of abandoned croplands {.unnumbered}

We developed models to predict how long a given pixel of abandoned cropland will remain abandoned before it is recultivated.
To do so, we defined a cohort of abandoned cropland as all cropland abandoned in a given year at a given site.
We modeled the proportion of each cohort remaining abandoned at each site as a function of time since initial abandonment, which we refer to as "recultivation trajectories" (or "decay trajectories"; see Materials and Methods and Fig. \@ref(fig:decay-model-grid)).
Given that some abandonment periods are inherently limited by the length of our time series (i.e., cropland may remain abandoned beyond the three decades covered by our data), tracking recultivation rates by the year abandoned provides a more accurate estimate of persistence than simply relying on the mean duration of abandonment at each site.
These models also allowed us to compare mean recultivation trajectories among sites and explore how recultivation trajectories changed over time at each site. 
Because the number of observations varies across cohorts, we calculated the mean recultivation trajectory at each site after constraining our data to a range of common “endpoints” (ranging from 10 to 25 years), thereby ensuring that mean values were calculated across a common number of observations for each cohort (see Materials and Methods).
We subsequently calculated the half-life, defined as the time required for half of the croplands abandoned in a given year to be recultivated, based on the mean recultivation trajectory at each endpoint.

Our models show that recultivation happened quickly: They predict that >50% of abandoned croplands will be recultivated within 30 years of initial abandonment at almost all sites (Fig. \@ref(fig:endpoint-half-lives)).
At all sites except Bosnia & Herzegovina, the half-life ranged from `r decay_stats$hl_min` to `r decay_stats$hl_max` years for endpoints between 10 and 25 years (mean $\pm$ SD: `r decay_stats$hl_mean` $\pm$ `r decay_stats$hl_sd` years; Fig. \@ref(fig:endpoint-half-lives)).
Interestingly, these half-lives were similar regardless of how widespread abandonment was at each site (Fig. \@ref(fig:quadrant)). 
Bosnia & Herzegovina, which had the longest mean abandonment duration, was a notable exception.
Here, our models predicted much longer half-lives: >50 years for endpoints of 16 years or longer (Figs. \@ref(fig:endpoint-half-lives) and \@ref(fig:endpoint-half-lives-all)).
Shaanxi/Shanxi, China, also showed relatively more durable abandonment than other sites, with half-lives of `r filter(endpoint_half_lives, grepl("shaanxi", site))$mean %>% min() %>% round(digits = 2)`-`r filter(endpoint_half_lives, grepl("shaanxi", site))$mean %>% max() %>% round(digits = 2)` years for all endpoints we considered.

In modeling recultivation for each abandonment cohort, we also investigated whether recultivation of abandoned cropland accelerated.
Many sites showed recultivation trajectories growing steeper over time (Fig. \@ref(fig:decay-model-grid)), indicating that abandoned croplands were being recultivated more quickly in more recent years.
This is also apparent in Fig. \@ref(fig:endpoint-half-lives), which shows the half-lives declining for shorter endpoints, which incorporate more recent cohorts to a greater extent.
This pattern was strongest in Bosnia & Herzegovina, and a linear regression on the half-life confirmed this to be the only site to have a statistically significant and negative rate of change in half-life, whereas more recent cohorts were recultivated more quickly (Fig. \@ref(fig:decay-rate-of-change)).

# Discussion {.unnumbered}

The degree to which cropland abandonment offers opportunities to sequester carbon and recover biodiversity depends largely on how much farmland is abandoned and how long it stays abandoned.
Using a new annual land-cover time series, we uncovered high levels of cropland abandonment across 11 sites in diverse biomes on four continents (Fig. \@ref(fig:maps-abn-duration)). 
However, by tracking abandonment from year to year, we showed that a large portion of this abandonment was ephemeral (Figs. \@ref(fig:area-abn-by-age-class) and \@ref(fig:mean-abn-duration)). 
Previous estimates of the amount of cropland abandoned based on just two points in time (e.g., a global estimate of 83 Mha between 1992 and 2015 in ref. [@Naess2021]) likely underestimate abandonment by excluding any new cultivation and subsequent abandonment that takes place between the chosen time points. 
More importantly, two-timepoint estimates almost certainly overestimate the amount of persistent abandonment, due to a failure to exclude short-term fallow periods, and, as our analysis shows, high rates of recultivation. 
Had we estimated “abandonment” based on cultivation at only two points in time (1987 and 2017), we would have found `r round((area_abn_stats$total_area_abn_Mha_2017_all_sites - abn_2yr_stats$total_area_abn_Mha) / area_abn_stats$total_area_abn_Mha_2017_all_sites, digits = 4) * 100`% less abandonment as of 2017 (with even greater variation at individual sites), the inclusion of substantial amounts of “abandonment” that did not meet our five-year abandonment definition, and low spatial agreement between areas identified as abandoned (Table \@ref(tab:twoyr-diff-table), Section \@ref(twoyr-vs-annual)).

Our results also demonstrate the value of considering the dynamics of abandoned croplands as a function of time since abandonment, rather than relying only on the average durations observed during a time series.
This is most apparent in Shaanxi/Shanxi, China: Although this site had one of the shortest mean abandonment durations (because most abandonment took place toward the end of the time series; Fig. \@ref(fig:turnover-grid)), it also had some of the longest half-lives of any of our sites (consistently ~30 years; Figs. \@ref(fig:endpoint-half-lives) and \@ref(fig:endpoint-half-lives-all)).
Therefore, our modeled recultivation trajectories indicate that abandonment may be longer-lasting at this site than initially demonstrated by the abandonment periods we observe during our time series.
By modeling recultivation as a function of the time since initial abandonment, we estimate that half of the croplands abandoned in a given year will be recultivated within 10-30 years at almost all of our sites (Fig. \@ref(fig:endpoint-half-lives-all)).
These modeled decay rates portray a dynamic process, where abandonment is rarely a final stage but rather part of a cycle of turnover on decadal timescales [@Munroe2013], with strong implications for the biodiversity and climate opportunity of abandonment.

The impermanence of abandonment that we observed generally matches the findings of the small number of comparable case studies that have considered this issue [@Chazdon2016a].
To the best of our knowledge, only one other study used an annual time series to investigate agricultural abandonment [@Dara2018].
That 1991–2017 study of a grassland region of northern Kazakhstan observed abandonment of about 40.5% of cultivated areas, and subsequent recultivation of about 20.0% of that abandonment.
This recultivation rate was similar to our most persistent site (`r recult_stats$min_5_site`, `r recult_stats$min_5`%), but was much lower than our average recultivation rate across sites (`r recult_stats$mean_thr_5`%), and lower still than our two sites closest to the region of Kazakhstan studied by ref. @Dara2018: `r site_labels$site_long[8]` and `r site_labels$site_long[10]`, which had higher recultivation rates of `r area_recult_threshold %>% filter(abn_threshold == 5, site == "orenburg") %>% .$proportion_recultivated %>% round(digits = 4) * 100` and `r area_recult_threshold %>% filter(abn_threshold == 5, site == "volgograd") %>% .$proportion_recultivated %>% round(digits = 4) * 100`% respectively (Fig. \@ref(fig:recult-by-threshold)).

Our projected half-lives were similar to those found in a study from Costa Rica [$\leq20$ years, @Reid2019], but longer than in other parts of the Neotropics, where empirical evidence indicates that secondary forest regeneration is often very short-lived [@Chazdon2016a; @Nunes2020; @Smith2020; @Schwartz2020].
Secondary forests were cleared and recultivated even more quickly in the Brazilian Amazon (50% within 5 to 8 years), where 80% of secondary forests were $\leq20$ years old [@Chazdon2016a; @Nunes2020; @Smith2020].
Across the tropics, only 33% of forests regenerating on sites that had been recently cleared were $\geq10$ years old [@Vancutsem2021].
However, these differences may be the result of (i)) a time delay between abandonment and sufficient regrowth of secondary woody vegetation to be detected by satellites, (ii)) our exclusion of abandonment of less than five years to avoid confusion with normal fallow periods, or (iii)) our models of recultivation for each cohort, which eliminate the influence of the time series length, and lengthen abandonment estimates.

## Implications for biodiversity recovery {.unnumbered}

Our results show that most cropland abandonment is ephemeral, contrary to optimistic assumptions [@Campbell2008; @Naess2021], and that even sites with the most persistent abandonment are unlikely to retain large areas where natural vegetation is allowed to regenerate for $\geq50$ years.
Thus, the recultivation of abandoned croplands comes with substantial trade-offs [@Meyfroidt2016], and the high recultivation rate we observed will markedly limit the scope for abandoned croplands to play a major role in carbon sequestration or the recovery of biodiversity.

Even under optimal conditions, recovery of natural ecosystems requires time, typically multiple decades, in order for locations to recover species richness approximating that found in reference systems [@Meli2017; @Acevedo-Charry2019; @Isbell2019; @Nerlekar2020; @Chazdon2020; @Reid2018b].
Species richness values for rarer, forest-adapted, or old-growth-dependent species recover even more slowly.
When recovery toward old-growth ecosystems is measured in terms of community composition, species similarity, and vegetation structure, it can take much longer than when measured simply by the recovery of total species richness or abundance (which can be dominated by widespread generalist species) [@Meli2017; @Arroyo-Rodriguez2017; @Crouzeilles2016].
In chronosequences, lowland Neotropical forests recover quickly in terms of tree species richness (reaching 80% of old-growth levels after 20 years and 90% after 31 years), but much more slowly in terms of tree species composition (34% of old-growth levels after 20 years, requiring 487 years to reach 90%) [@Rozendaal2019].
Furthermore, these estimates may be overly optimistic, due to positive site selection bias [@Reid2018b], especially if the area around fast-recovering sites retained relatively high forest cover (76% on average in ref. [@Rozendaal2019]).
Recovery is likely to be much slower in heavily deforested landscapes.

Faunal recovery also typically takes a long time, at least for most groups of vertebrates.
Across tropical forests, amphibian, bird, mammal, and reptile species richness largely recovers within 40 years, but species compositional similarity for these groups takes much longer to recover (if at all), particularly for late-successional species, insectivorous birds, and forest specialists [@Acevedo-Charry2019].
No vertebrate groups reach species compositional similarity to reference old-growth forests, even in the oldest secondary forests (30 to 65 years) [@Acevedo-Charry2019].
There is, however, substantial variability in how quickly and how completely ecosystems recover following disturbances and abandonment [@Norden2015; @Crouzeilles2016; @Arroyo-Rodriguez2017; @Reid2018b].
Natural regeneration is likely to progress more quickly and successfully under the right conditions, especially after low-intensity disturbances (e.g., selective logging) and when there are relatively undisturbed or mature ecosystems nearby to act as propagule sources [@Crouzeilles2016; @Gilroy2014; @Arroyo-Rodriguez2017].
Recovery can also be rapid for certain animal groups in specific cases [e.g., birds and dung beetles in the Colombian Andes; @Gilroy2014], but these are the exceptions rather than the rule. 

Grassland ecosystems can sometimes recover more quickly following disturbances than forests [@Jones2009], but not often [@Nerlekar2020; @Isbell2019].
<!-- On average, secondary grasslands distributed around the world that are between 1-251 years old contain only 53-76% of the plant species richness of never-cultivated (i.e., undisturbed) grasslands [@Nerlekar2020]. -->
Yet even after full recovery of species richness (with minimum estimated recovery times of \>100 years), compositional similarity of secondary grasslands to undisturbed grasslands remains low (43%) [@Nerlekar2020].
For example, Minnesota (USA) grasslands showed quick initial gains in biodiversity following abandonment, but thereafter both biodiversity and productivity increased slowly, reaching only 73% of the diversity and 53% of the productivity levels of the reference ecosystem after 91 years [@Isbell2019].
Similarly, Eurasian grasslands, where widespread conversion and subsequent abandonment have occurred, showed increases in biodiversity in older abandoned fields, yet still had not fully recovered with respect to either plant species richness and community composition [@Kampf2016] nor bird species richness and diversity [@Kamp2011] after 24 and 18 years of observation, respectively.

## Carbon accumulation in abandoned croplands {.unnumbered}

Abandoned croplands will achieve only a small fraction of their carbon storage potential if abandonment lasts only a couple of decades.
Despite relatively quick accumulation of carbon in aboveground biomass in forests during the first few decades of regeneration, it can take between 50 and 100 years for secondary forests to achieve similar levels of biomass to old-growth forests [@Poorter2016; @Martin2013].
For example, studies have shown that Neotropical aboveground forest biomass on abandoned cropland reached 90% of old-growth forest biomass after a median of 66 years, but biomass remained at only 50% of old-growth levels after 20 years [@Poorter2016].
Furthermore, carbon accumulation estimates vary widely by biome and by prior land use.

Our estimates of carbon accumulation in both forest biomass and soils as a function of time and biome confirmed that while abandoned croplands hold substantial potential to accumulate carbon over time (`r carbon_stats$total_observed` Tg C total by 2017 across our sites), they only accumulated `r carbon_stats$total_diff`% of their potential as a result of recultivation, even when that potential is only estimated over our relatively short time series. 
While a `r carbon_stats$total_diff_less_than`% loss is not as large as has been noted in another recent study of ephemeral forest regeneration [@Piffer2021], which estimated forest carbon accumulation of 70% less than the potential maximum if no secondary forests were recleared, this lost opportunity is nonetheless considerable.

Abandoned croplands in forested biomes showed a much higher carbon accumulation, and correspondingly higher opportunity costs of recultivation, than abandoned croplands in grassland biomes (Table \@ref(tab:carbon-table), Fig. \@ref(fig:site-biomes-for-nonfor)).
While grasslands can also harbor substantial amounts of carbon sequestered in soils [@Lal2004], grassland soil carbon may accumulate even more slowly than aboveground forest biomass, taking a century or longer to return to reference levels [@Yang2019].
For example, studies have shown that while abandoned croplands across Russia accumulated a total of `r format(0.66 * 20, nsmall = 2)` Mg C/ha in the top 5 cm of soil on average during the first 20 years following abandonment, these fields still had significantly less carbon sequestered than reference grasslands after 24 years of observation, and were expected to take >60 years to recover to reference levels [@Wertebach2017]. 
Here, we estimate accumulation of only `r carbon_stats$MgC_grass_min` to `r carbon_stats$MgC_grass_max` Mg C per ha by 2017 on average (Table \@ref(tab:carbon-table)) at our predominantly grassland sites – only a fraction of the total observed by [@Wertebach2017], largely a result of the short abandonment lengths at these sites.

## Study limitations {.unnumbered}

We note several limitations to our work here.
First, multiple factors beyond the duration of abandonment will affect outcomes with respect to both biodiversity and carbon.
For example, the fact that these lands were being used for agriculture can impede full achievement of carbon or biodiversity goals, given the impact of soil erosion and other abiotic (e.g., residual pesticides and excess nutrients) and biotic (e.g., invasive species) legacies associated with farming [@Crouzeilles2016; @Cramer2008; @Meli2017; @Isbell2019].
A lack of nearby source populations in heavily disturbed landscapes can hinder recolonization by plants and animals, thereby affecting both biodiversity and carbon sequestration, as can climate change or the loss of natural disturbance regimes [@Crouzeilles2016; @Parkhurst2021; @Chazdon2016].
While natural regeneration is typically cheaper than active restoration, it is not clear that natural regeneration outperforms active restoration on abandoned croplands.
Meta-analyses suggesting that natural regeneration outperforms active restoration have suffered from site-selection biases, in that sites that did not regenerate naturally were not included, whereas examples of unsuccessful active restoration were [@Reid2018b].
In addition, more heavily altered systems typically require active restoration approaches such as invasive species control or translocation of plants and animals, and experience longer recovery times [@Crouzeilles2016; @Gilroy2014; @Meli2017; @Yang2019].

Grassland regeneration is particularly challenging, because many grasslands require natural disturbance regimes (e.g., grazing or fire), which may be absent following abandonment [@Nerlekar2020].
Without such disturbances, grassland biodiversity can be lost if low-intensity farmlands are abandoned, particularly when historically unforested ecosystems are colonized by woody vegetation [@ReyBenayas2007; @Nerlekar2020; @Queiroz2014; @Sirami2008].
This is especially the case in Europe, where many remaining species of conservation concern are dependent on low-intensity farmland - a product of both cultural preferences and a very long history of cultivation [@Batary2015].
Although we focus here on the potential for abandonment to benefit biodiversity through the long-term regeneration of native vegetation, there may be cases where long-term regeneration may run counter to conservation goals, in which active intervention and management (through grazing, hunting, or otherwise) may be necessary to maintain grasslands and other high-biodiversity habitats such as wetlands [@Navarro2012; @ReyBenayas2007].

Second, our sites were specifically selected on the basis of documented abandonment.
Thus, while our results are likely representative of areas that have experienced substantial abandonment, they are not a representative sample of the entire globe, and they focus on regions with more cropland abandonment than the global average. 
Nevertheless, because these abandonment hotspots hold the greatest potential to provide associated environmental benefits, it is precisely in these places that our findings will have the greatest implications. 
Therefore, these data represent a unique opportunity to study the long-term outcomes of cropland abandonment.
However, there is some indication that abandonment may be more durable in Europe, another region that has experienced significant abandonment [@Estel2015; @Navarro2012].
A recent review of post-abandonment trajectories in Europe found that in most cases (`r round(100 * 87 / (115 + 2 + 18), digits = 2)`%, or 87 of 135 studies reviewed), abandoned lands went through secondary succession and transitioned toward semi-natural landscapes, although Eastern Europe and Russian abandonment may be more prone to recultivation [@Fayet2022].
This study did not include time since initial abandonment as a factor, however, and the differences in abandonment persistence between regions merit future investigation.

## Policy implications {.unnumbered}

Harnessing abandonment as an environmental opportunity will require an understanding of the drivers of abandonment and recultivation. 
Abandonment is certainly related to agricultural suitability [@Levers2018], but it is also driven by a combination of socioeconomic and demographic changes, policies, and broader environmental factors [@Yin2019; @Prishchepov2021; @Meyfroidt2016; @Levers2018]. 
Abandonment is often a by-product of urban migration and rural depopulation, particularly in Europe, East Asia, and Latin America [@ReyBenayas2007; @Sloan2022].
Other cases are more directly related to sociopolitical change. 
For example, the collapse of the Soviet Union triggered large-scale abandonment in Eastern Europe, especially in less productive areas that had been supported by state subsidies [@Prishchepov2013; @Estel2015; @Alcantara2013; @Meyfroidt2016].
While studies have shown that economically marginal lands like these are less likely to be recultivated on the whole than more productive lands [@Smaliychuk2016; @Meyfroidt2016], our data show that our three former Soviet sites (Orenburg, Russia / Uralsk, Kazakhstan; Volgograd, Russia; and Vitebsk, Belarus / Smolensk, Russia) experienced some of the highest recultivation rates and shortest half-lives.
In northern China, on the other hand, abandonment (and reforestation) was encouraged through one of the world’s largest reforestation schemes, the “Grain for Green Program” (also known as the Sloping Land Conversion Program), which provides financial incentives to reforest croplands for erosion control and other forest-related ecosystem services [@Hua2016].
We found relatively durable abandonment in Shaanxi/Shanxi, China, a site with some of the most consistently long half-lives. 
The persistence of abandonment in this region, however, will depend on the consistency and continuity of national land use policy [@Yin2018a].
Recultivation may occur when incentives for reforestation are removed [@Yin2018a] or when subsidies for cultivation are reestablished [@Meyfroidt2016].
Recultivation can also be triggered when short-term stressors are removed, as is frequently observed in post-conflict regions [@Yin2019; @Olsen2021], or when international or rural-urban migration pathways are disrupted, as has recently occurred between Latin America and the United States [@Sloan2022]. 
Our research demonstrates the value of long-term analysis at annual intervals, which has the potential to improve our understanding of the drivers of abandonment and recultivation.

Even once abandonment occurs, there are many socioeconomic and political barriers that can hinder habitat regeneration in abandoned croplands.
These include policies that obligate farmers to cultivate land, a lack of incentives to protect and foster regenerating habitats, and perhaps most importantly, negative cultural perceptions of abandonment and the "messy" landscapes that result [@Chazdon2020].
The loss of certain types of landscapes or rural ways of life can cause emotional distress and regional economic upheaval, which, in turn, can spur efforts to avoid or reverse abandonment [@ReyBenayas2007; @Meyfroidt2016; @Li2017; @Munroe2013].
Behavioral research also highlights the importance of social factors such as corruption, political and institutional support, and demographic changes in driving decisions to abandon or recultivate cropland, alongside the more obvious biophysical and economic conditions [@Prishchepov2021a].

For abandoned croplands to reach levels of carbon stocks and biodiversity comparable to more intact natural ecosystems, they should, in general, persist for >50 years [@Acevedo-Charry2019; @Rozendaal2019; @Nerlekar2020; @Isbell2019; @Poorter2016; @Yang2019], which is at least three decades longer than the mean length of abandonment we observed.
Without new policies and incentives to discourage recultivation, abandoned areas are unlikely to provide meaningful biodiversity and carbon benefits, despite their considerable potential and expected importance for meeting both climate and biodiversity goals.
When recultivation occurred, its duration was relatively short (Fig. \@ref(fig:mean-recult-duration)). 
These short recultivation periods may partly be a function of when recultivation took place (by our definition, it must follow at least 5 years of abandonment), but they could also be a sign that these croplands are marginal economically.
In this case, taking them out of production for longer periods of time is unlikely to seriously affect overall food supplies.

Encouraging the persistence of abandonment, especially on marginal croplands, could be achieved by designating abandoned fields as protected areas, by incorporating natural regeneration into payments for ecosystem service programs to allow landowners to benefit economically from abandoning their croplands, or by taking steps to support sustainable long-term cultivation of some sites, thereby reducing turnover among fields that have previously been part of long-term fallowing cycles [@Meyfroidt2016].
The relative durability of cropland abandonment in Shaanxi/Shanxi Province provides some evidence that incentive programs designed to restore or reforest cropland for long periods of time can be successful.
This is encouraging, yet there continues to be a need to improve the biodiversity outcomes of such programs, many of which prioritize the planting of nonnative forests at the expense of local biodiversity, ecosystem stability, and local livelihoods [@Hua2016]. 
More alarming, however, are recent studies that indicate that some large-scale reforestation programs fail to provide either environmental or livelihood benefits; this may especially be the case when nonforested biomes are targeted for afforestation, or when programs fail to take into account the local socioeconomic context [@Coleman2021]. 
Clearly, more research is needed to improve the outcomes of such programs, and we stress that any policies should be developed jointly with local communities to address trade-offs between biodiversity, carbon storage, and livelihoods.

Our results make one thing clear: if cropland abandonment continues to be as short-lived as we have shown here, the large potential benefits of regenerating habitats for both carbon storage and biodiversity conservation will remain an untapped opportunity.

# Materials and Methods {.unnumbered #methods}

## Abandonment maps {.unnumbered}

We use annual land cover maps with a 30-m resolution from 1987 to 2017 [@Yin2020], derived from publicly available Landsat satellite imagery, mapping four land cover classes: (i) cropland, (ii) herbaceous vegetation (e.g., grassland), (iii) woody vegetation (e.g., forests), and (iv) non-vegetation (e.g., water, urban, or barren land) (Fig. \@ref(fig:area-by-lc)).
Our 11 sites were mapped with high accuracy (average overall accuracy, $85\pm4$%) and provide broad coverage of different continents and ecosystems (site locations are shown in Fig. \@ref(fig:global-map), and site ecoregions and biomes are shown in Figs. \@ref(fig:site-biomes) to \@ref(fig:site-ecoregions) and Section \@ref(section-biomes)).
We focused exclusively on cropland abandonment, because pasture abandonment is very difficult to discern from satellite imagery and is not captured in our data.

We selected our study areas to analyze abandonment in a wide range of biomes from drylands (Iraq; Nebraska, USA; Shannxi/Shanxi, China; and Orenburg, Russia / Uralsk, Kazakhstan), to temperate regions (Vitebsk, Belarus / Smolensk, Russia; Bosnia & Herzegovina; Volgograd, Russia; Wisconsin, USA), to the sub-tropic and wet tropics (Chongqing, China; Goiás, Brazil; and Mato Grosso, Brazil; see Section \@ref(section-biomes)). 
Furthermore, Yin et al. [@Yin2020] selected these regions because of their documented histories of cropland abandonment in the past three decades, in order to develop a method that can accurately map abandonment at high spatial and temporal resolution. 
Our study regions also captured a diverse mix of three potential abandonment drivers including sociopolitical (e.g., Shannxi/Shanxi, China; Bosnia & Herzegovina), economic (e.g., Chongqing, China), and environmental change (e.g., Iraq).
Here, we use data for 11 of the 14 areas originally mapped by Yin et al. [@Yin2020], dropping three sites (Sardinia, Nepal, and Uganda) due to low map accuracy (classification accuracy for abandonment < 0.4).
Accordingly, while our study sites are not a representative sample for the globe, they are likely representative of those areas that have recently experienced abandonment, and present a unique opportunity to understand the issue of abandonment.

## Defining abandonment {.unnumbered}

Differentiating abandonment from short-term fallowing or crop rotations is difficult because agricultural practices can vary widely by region, and studies use many different definitions [@Yin2020].
Here, in order to exclude short-term fallowing, we define "abandonment" as cropland that is no longer under active cultivation, is left free of direct human influence (e.g., is not converted to urban land use), and remains so for at least five subsequent years, following FAO [@FAO2016].
Recognizing that longer abandonment thresholds may be more appropriate in certain contexts, we performed a sensitivity analysis by varying our abandonment definition (Section \@ref(abn-thresholds)) and found that, as expected, longer definitions resulted in less abandonment overall, longer average abandonment durations (Fig. \@ref(fig:abn-duration-by-threshold)), and lower recultivation rates (Fig. \@ref(fig:recult-by-threshold)).
However, even when only considering abandonment $\geq10$ years, we still observed between `r recult_stats$min_10` and `r recult_stats$max_10`% recultivation across our sites (in `r recult_stats$min_10_site` and `r recult_stats$max_10_site` respectively), suggesting the reliability of our abandonment definition.
We defined an abandoned pixel as "recultivated" if it was subsequently classified as cropland for one year or more because even a single year of recultivation restarts the regeneration process.
Similarly, we assessed how different thresholds of recultivation affected the mean duration of recultivation (Fig. \@ref(fig:recult-duration-by-threshold)), in addition to the extent to which recultivation depends on abandonment threshold (Fig. \@ref(fig:recult-by-threshold)).

## Data processing {.unnumbered}

```{r prop-non-veg, include = FALSE}
# ----------------------------------------------------------- #
# Proportion of each site's area in non-vegetated land
# ----------------------------------------------------------- #
prop_non_veg <- area_dat %>% 
  filter(lc %in% c("Non-veg.", "Woody veg.", "Cropland", "Grassland"), year == 2017) %>%
  group_by(site) %>%
  summarise(total_site_area_ha = sum(area_ha)) %>% 
  left_join(area_dat, ., by = c("site")) %>% 
  mutate(prop_total_area = area_ha/total_site_area_ha)

max_prop_non_veg <- prop_non_veg %>%
  group_by(site, lc) %>%
  summarise(max_prop_in_non_veg = max(prop_total_area)) %>%
  arrange(max_prop_in_non_veg) %>%
  filter(., lc == "Non-veg.") %>%
  left_join(site_labels)


non_veg_stats <- list(
  site1 = max_prop_non_veg %>% filter(max_prop_in_non_veg > 0.1) %>% .[1, ] %>% .$site_long,
  site1_p = max_prop_non_veg %>% filter(max_prop_in_non_veg > 0.1) %>% .[1, ] %>% .$max_prop_in_non_veg %>% round(., digits = 4)*100,
  site2 = max_prop_non_veg %>% filter(max_prop_in_non_veg > 0.1) %>% .[2, ] %>% .$site_long,
  site2_p = max_prop_non_veg %>% filter(max_prop_in_non_veg > 0.1) %>% .[2, ] %>% .$max_prop_in_non_veg %>% round(., digits = 4)*100
)

# prop_non_veg %>% filter(lc == "Non-veg.", year %in% c(1987, 2017)) %>% print(n = 22)


# # plot
  # ggplot(data = prop_non_veg %>% filter(., lc == "Non-veg.")) +
  #   theme_classic() +
  #   labs(y = expression("Area  (10"^{6}*" ha)"), x = "Year",
  #        title = "Area by Land Cover, with Abandonment",
  #        color = NULL) +
  #   geom_line(mapping = aes(x = year, y = prop_total_area, #area_ha / (10^6), # convert to millions of ha
  #                           group = lc, color = fct_reorder(lc, lc, .desc = TRUE)),
  #             size = 1.5) +
  #   geom_hline(yintercept = 0.1) +
  #   theme(legend.position = "bottom",
  #         legend.title = element_text(size = 10)) +
  #   guides(color = guide_legend(nrow = 2, ncol = 3)) +
  # 
  #   scale_color_manual(values = plot_cols) +
  # facet_wrap(vars(site))
```

We processed and analyzed abandonment map data in RStudio version `r rstudioapi::versionInfo()$version` [-@RStudio], using `r R.Version()$version.string` [-@R-base], primarily with the terra [@R-terra], data.table [@R-data.table], and tidyverse [@R-tidyverse] packages.

We identified periods of cropland abandonment by tracking each pixel's land cover through time to identify signs of land-cover changes that indicated transitions between active cropland use (i.e., cultivation) and subsequent inactivity (i.e., left fallow, or uncultivated).
We first implemented 5- and 8-year moving window temporal filters to smooth land-cover trajectories and remove land-cover changes that are temporally unlikely (Section \@ref(temporal-filters)).
Together with our 5-year abandonment threshold, these temporal filters address very short-term misclassifications that might otherwise appear like recultivation.

We classified a pixel as "abandoned" anytime it transitioned from cropland to either herbaceous or woody vegetation (collectively referred to as "non-cropland") and subsequently remained classified as non-cropland for five or more consecutive years (see Section \@ref(classifying-abn) for full details).
We considered an abandoned pixel to be "recultivated" when it transitioned from non-cropland back to cropland for one or more years.
Pixels that transitioned from cropland to the non-vegetation class were not considered "abandoned," and were excluded from our analysis.
Non-vegetated land consisted of \<10% of total site area in all sites except `r non_veg_stats$site1` (`r non_veg_stats$site1_p`%) and `r non_veg_stats$site2` (`r non_veg_stats$site2_p`%), and remained stable or declined over time in all 11 sites.

## Calculating observed and potential abandonment duration {.unnumbered}

We calculated abandonment duration as the number of years that elapsed between the initial transition from cropland to non-cropland, and either recultivation or the end of the time series.
Because our abandonment definition only considers croplands that have been abandoned for five or more contiguous years, the minimum abandonment duration is 5 years.
Because a pixel may be abandoned and recultivated multiple times throughout the time series, we calculated the mean abandonment duration in two ways: (i) across all periods of abandonment (Fig. \@ref(fig:mean-abn-duration)), and (ii) across only the longest period of abandonment experienced by each pixel (Figs. \@ref(fig:maps-max-abn-duration) and \@ref(fig:mean-abn-duration-w-max)).
Using a similar method, we also tracked the duration of recultivation periods that followed periods of abandonment (Fig. \@ref(fig:mean-recult-duration)).

To understand the opportunity cost of recultivation, we also developed a simple scenario assuming that no recultivation took place during our time series.
This scenario assumed that all abandoned croplands remained abandoned from their initial abandonment through the end of the time series. 
We calculated the area abandoned in each year according to age (i.e., time since initial abandonment), and used this to calculate potential carbon sequestration (see below).
Potential area abandoned without recultivation is shown as a dashed line in Fig. \@ref(fig:area-abn-by-age-class).

## Estimating carbon accumulation in abandoned croplands {.unnumbered}

We estimated carbon sequestration in abandoned croplands using recently published maps of annual carbon accumulation rates during secondary succession.
For forest biomes (delineated using the Ecoregions2017 map [@Dinerstein2017]; see Fig. \@ref(fig:site-biomes) and Section \@ref(section-biomes)), we applied rates from @Cook-Patton2020, which provides annual carbon accumulation rates for the first 30 years of natural forest regrowth in terms of aboveground biomass, belowground biomass, and soil carbon (which we subsequently combined).
For non-forest biomes (e.g., grasslands and savannas; see Fig. \@ref(fig:site-biomes)), we conservatively assumed that most of the ecosystem carbon is stored in soils [@Bossio2020], and therefore used soil organic carbon (SOC) sequestration as a proxy for potential carbon sequestration.
We applied annual SOC sequestration rates estimated from the recently published Soils Revealed database [@Sanderman2020], which includes estimates of potential SOC stocks in former agricultural lands as they return to native vegetation after 20 and 80 years.
We extracted only pixels representing transitions from cropland to native vegetation, and calculated the mean SOC stock for former croplands at each of our sites after 20 and 80 years of regeneration (see more details in Section \@ref(section-soc-si)).
We used these two mean SOC stock estimates to calculate annual SOC sequestration rates for years 1 to 20 and 21 to 80 of regeneration.
These SOC sequestration rates were then combined with our forest carbon accumulation rate layer and applied to our abandonment age data to calculate potential forest and soil carbon accumulation during the duration of abandonment.

Maps showing the combined forest and SOC sequestration rates are shown for years 1-20 in Fig. \@ref(fig:carbon-map-Y20-rate) and years 21-80 in Fig. \@ref(fig:carbon-map-YSS-rate).
Total and potential carbon accumulation at each site by 2017 is shown in Figs. \@ref(fig:carbon-map-2017-observed) and \@ref(fig:carbon-map-2017-potential) respectively.
Maps of forest and soil carbon accumulation rates were resampled from their original resolutions (1-km and 250-m, respectively) to match the 30-m resolution of our land cover maps.

## Modeling abandonment recultivation (or "decay") {.unnumbered}

Because some abandonment periods are limited by the length of the time series (potentially causing some observed periods of abandonment to end before they are truly recultivated), we modeled recultivation of abandoned croplands as a function of time since initial abandonment.
We tracked recultivation ("decay") by calculating the proportion of each cohort of pixels abandoned in a given year that remain abandoned in each year following abandonment.
We parameterized a linear model predicting the proportion of abandoned cropland in each cohort at each site remaining abandoned as a function of time since initial abandonment ("decay trajectories").
We tested a range of model specifications, including linear and log transformations of both proportion and time, and multiple time predictor terms.
Importantly, we included both cohort and site level fixed effects, fitting unique coefficients for each cohort at each site in a single linear model for all data pooled across sites.

We selected the highest performing model based on Akaike information criterion values (AIC; Fig. \@ref(fig:AIC)).
For cohorts of abandonment initially abandoned in years $y = 1988, ... , 2013$, our model predicted the proportion $p$ of each cohort $y$ at site $z$ remaining abandoned as a function of time $t$ (i.e., the number of years following initial abandonment), with one log-transformed and one linear term of time (Eq. \@ref(eq:mod-spec)).

\begin{equation}
p_{yz} = 1 + \beta_{yz,1} log(t + 1) + \beta_{yz,2} t (\#eq:mod-spec)
\end{equation}

where $\beta_{yz,1}$ and $\beta_{yz,2}$ represent the regression coefficients on the log and linear terms of time $t$, respectively, for cohort $y$ at site $z$.
Model assumptions were tested through visual inspection of diagnostic plots (Fig. \@ref(fig:diag-combo); full details in Section \@ref(decay-models-si)).
The observations and fitted values from our pooled linear model are shown in Fig. \@ref(fig:decay-model-grid), and all individual model coefficients are shown in Fig. \@ref(fig:decay-mod-coef).

Due to the nature of our time series, each cohort has a different number of observations (corresponding to the number of years between the year of initial abandonment and the end of the time series), complicating efforts to compare cohorts and calculate mean trajectories across cohorts at each site.
To address this issue, we developed an approach to parameterize our linear model using subsets of data restricted to common endpoints (e.g., 15 years), such that each cohort had the same number of observations.
For example, for a given endpoint of 15 years, we included only those cohorts with at least 15 years of observations, and also excluded all observations beyond 15 years for cohorts that met the 15-year threshold.
We then parameterized our linear model with this subset and calculated mean log and linear coefficients across cohorts at each site, from which we then calculated the time required for half of the abandoned cropland at each site to be recultivated ("half-lives").

We repeated this analysis for the full range of possible common endpoints that included more than one cohort (7 to 29 years).
Half-lives for a few select endpoints (10, 15, 20, and 25 years) are shown in Fig. \@ref(fig:endpoint-half-lives), and model results for these subsets and their corresponding mean decay trajectories are shown in Figs. \@ref(fig:endpoint-panel-a) - \@ref(fig:endpoint-panel-b).
Half-lives for all modeled endpoints (7 to 29 years) are shown in Fig. \@ref(fig:endpoint-half-lives-all).

This method for modeling half-lives based on common endpoints allows us to draw fair but conservative comparisons across cohorts, without assigning disproportionate weight to cohorts with fewer observations.
We prioritize intermediate endpoints in our reporting of the results for two reasons: Longer endpoints are biased toward older cohorts (by excluding more recent abandonment), and while shorter endpoints incorporate a more complete set of cohorts, they make use of fewer observations overall and place relatively more weight on the initial stages of abandonment.
As a result, these endpoint results should be interpreted with a careful consideration of the number of cohorts and observations that went into each specific model run.

To estimate changes in persistence over time, we calculated the half-life for each cohort at each site and parameterized a linear model on these half-life values (*n* = 26 at each site) to identify temporal changes in recultivation patterns at each of our 11 sites (Section \@ref(section-methods-rate-of-change)).
Trends were considered statistically significant when the 95% confidence interval for model coefficients did not include zero (Fig. \@ref(fig:decay-rate-of-change)).


# References {.unnumbered}

::: {#refs}
:::

\newpage

# Acknowledgements {.unnumbered}

We thank the following researchers at the University of Wisconsin-Madison, whose land cover maps made our analysis possible, and who generously shared their data: Amintas Brandão, Johanna Buchner, David Helmers, Benjamin G. Iuliano, Niwaeli E. Kimambo, Katarzyna E. Lewińska, Elena Razenkova, Afag Rizayeva, Natalia Rogova, Seth A. Spawn-Lee, and Yanhua Xie.
We thank J. Leighton Reid, three anonymous reviewers, and editor Shahid Naeem, whose helpful reviews greatly strengthened our manuscript.
We are deeply indebted to R. Alex Wiebe, whose statistical advice significantly improved our models of abandonment recultivation.
We also thank the Drongos research group for advice and companionship.
Analyses were performed using Princeton Research Computing resources at Princeton University.
This research contributes to the Global Land Programme (<https://glp.earth/>).

## Funding {.unnumbered}

High Meadows Foundation (DSW).
NASA Land Cover and Land Use Change Program (Grant no. 80NSSC18K0343) (VCR, HY).
Publication of this article was supported by the Princeton University Library Open Access Fund.

## Author contributions {.unnumbered}

CLC and DSW conceived of the project in collaboration with HY and VCR.
HY contributed guidance on data curation and the analysis of raw land cover data.
CLC designed and conducted the data analysis, with feedback from HY, DSW, and VCR.
All authors contributed to writing the manuscript, with CLC preparing the initial draft.

## Competing interests {.unnumbered}

The authors declare no competing interests.

## Data and code availability {.unnumbered}

The annual land cover maps that underlie our analysis are archived at Zenodo (<https://doi.org/10.5281/zenodo.5348287>), along with other datasets generated and analyzed for this article (including maps of abandonment age and datasets summarizing area, persistence, and turnover). 
Code to replicate these analyses is available on GitHub at <https://github.com/chriscra/abandonment_trajectories>, and is archived at Zenodo (<https://doi.org/10.5281/zenodo.6383127>).
Forest carbon accumulation rates are freely available from Global Forest Watch (http://www.globalforestwatch.org; Ref. @Cook-Patton2020), and soil carbon accumulation rates are available from Soils Revealed (https://doi.org/10.7910/DVN/HA17D3; Ref. @Sanderman2020).

<!-- # Supplementary information {.unnumbered} -->

<!-- Supplementary Information for this manuscript [can be found here](https://drive.google.com/file/d/1G5pzgpoEultZ69eiODsiBFrtd7NuLIUr/view?usp=sharing). -->


\newpage

# Figures and Tables {.unnumbered}

(ref:caption-global-map) *Site locations.* The locations of our 11 sites, from Yin et al. [@Yin2020]. Sites are labeled as follows: (b) Vitebsk, Belarus / Smolensk, Russia; (bh) Bosnia & Herzegovina; (c) Chongqing, China; (g) Goiás, Brazil; (i) Iraq; (mg) Mato Grosso, Brazil; (n) Nebraska/Wyoming, USA; (o) Orenburg, Russia / Uralsk, Kazakhstan; (s) Shaanxi/Shanxi, China; (v) Volgograd, Russia; (w) Wisconsin, USA.

```{r global-map, fig.cap = '(ref:caption-global-map)'}
# just plain site locations
knitr::include_graphics(path = paste0(p_plots, "fig0.pdf"))
```

\newpage

(ref:caption-maps-abn-duration) *Spatial patterns of abandonment duration.* Observed duration of cropland abandonment (in years) as of 2017 in our 11 study sites. X axes show degrees longitude relative to the prime meridian (negative indicating west and positive indicating east), and y axes show degrees latitude relative to equator (negative indicating south and positive indicating north). Site locations are shown in Fig. \@ref(fig:global-map) and maps of maximum abandonment duration are shown in Fig. \@ref(fig:maps-max-abn-duration).

```{r maps-abn-duration, fig.cap = '(ref:caption-maps-abn-duration)', fig.pos = "ht"}
knitr::include_graphics(path = paste0(p_plots, "fig1_filled", run_label, ".pdf"))
```

\newpage

(ref:caption-area-abn-by-age-class) *Abandonment through time. *Cumulative area abandoned at each site through time, according to age class (in years). The solid black line represents the total observed area abandoned at each site, and the dashed black line represents the potential area abandoned, assuming a scenario without recultivation. The corresponding area of potential abandonment by age class is shown in Fig. \@ref(fig:potential-area-bins).

```{r area-abn-by-age-class, fig.cap = '(ref:caption-area-abn-by-age-class)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/abn_area_by_age_grid_w_potential", run_label, ".pdf"))
```

\newpage

(ref:caption-mean-abn-duration) *Distribution of abandonment duration during time series.* The distribution of observed abandonment duration (in years) for all periods of abandonment from 1987 to 2017. The y axes shows the proportion of abandonment periods of a given duration at each site. The red points represent the mean abandonment duration (in years) at each site, and the red vertical dashed line represents the mean of these site-level mean duration values across all sites. Note that these distributions include multiple periods of abandonment for those pixels that experienced abandonment and recultivation multiple times during the time series. See Supplementary Materials for distributions of the maximum abandonment duration for each pixel (Fig. \@ref(fig:mean-abn-duration-w-max)), the potential abandonment duration without recultivation (Fig. \@ref(fig:mean-potential-abn-duration)), and the duration of recultivation (Fig. \@ref(fig:mean-recult-duration)).

```{r mean-abn-duration, fig.cap = '(ref:caption-mean-abn-duration)', fig.pos = "ht", out.width = "11cm", echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, "fig2", run_label, ".pdf"))
```

\newpage

(ref:caption-carbon-over-time) *Carbon accumulation following abandonment.* Cumulative carbon accumulation in abandoned croplands over time, in terms of millions of Mg C ($10^6$ tons C). The solid green line represents the total observed carbon accumulation at each site, and the dashed green line represents the potential carbon accumulation, assuming a scenario without recultivation.

```{r carbon-over-time, fig.cap = '(ref:caption-carbon-over-time)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/carbon/carbon_accumulated_over_time.pdf"))
```

\newpage

(ref:caption-decay-model-grid) *Recultivation of abandoned croplands.* Modeled recultivation ("decay") trajectories showing the proportion of each cohort of abandoned land (i.e., all pixels abandoned in a given year) remaining abandoned over time for each of our 11 sites. Points represent actual observations by cohort and dashed lines represent linear model predictions for each cohort as a function of time (including a linear and logarithmic term of time). Colors of both points and dashed lines correspond to roughly five-year group of cohorts, ranging from dark purple (oldest cohorts) to green and yellow (most recent cohorts). The horizontal black dashed line shows a proportion of 0.5, indicating the point where half of a cohort has been recultivated. Model diagnostic plots are shown in Fig. \@ref(fig:diag-combo).

```{r decay-model-grid, fig.cap = '(ref:caption-decay-model-grid)', echo = FALSE}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "decay_mod_grid", run_label, ".pdf"))
```

\newpage

(ref:caption-endpoint-half-lives) *Half-life of abandonment.* Mean half-lives of abandoned croplands at each site, calculated across a range of common endpoints. In order to make fair comparisons across cohorts with varying numbers of observations, we subset our data to a range of common endpoints (e.g., 15 years), restricting cohorts to the same number of observations. For each endpoint, we then calculated the mean trajectory across cohorts that meet the endpoint threshold, and used these mean trajectories to calculate the half-life (i.e., the time required for half of a cohort to be recultivated; see Materials and Methods). See Fig. \@ref(fig:endpoint-half-lives-all) to see half-lives for the full range of endpoints.

```{r endpoint-half-lives, fig.cap = '(ref:caption-endpoint-half-lives)', echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "half_lives_endpoints_by_obs_10_25", run_label, ".pdf"))
```

<!-- (ref:caption-decay-curves-by-site) Mean decay trajectories for each site, based on a linear model predicting the proportion of abandoned land remaining abandoned as a function of time (including a linear and a logarithmic term of time). The function describing each site's mean trajectory is calculated by taking the mean of each time coefficient across all cohorts of abandonment at each site. The light gray dashed line at a proportion of 0.50 indicates the half-life at each site, defined as the time required for half of the croplands abandoned in a given year to be recultivated. -->

<!-- ```{r decay-curves-by-site, fig.cap = '(ref:caption-decay-curves-by-site)', echo=FALSE} -->
<!-- knitr::include_graphics(path = paste0(p_plots, "fig3", run_label, ".pdf")) -->
<!-- ``` -->

<!-- (ref:caption-abn-decay-s) Recultivation (decay) of abandoned land in Shaanxi/Shanxi (China), showing the proportion of each cohort of abandoned land (i.e., all pixels abandoned in a given year) remaining abandoned over time. Points represent actual observations by cohort (n = 351), dashed lines represent linear model predictions (fitted values) for each cohort as a function of time (including a linear and logarithmic term of time), and the solid black line represents the mean trend across all cohorts (calculated by taking the mean of each time coefficient value across all cohorts). Colors of both points and dashed lines correspond to roughly five-year groups of cohorts, ranging from dark purple (oldest cohorts) to green and yellow (most recent cohorts). See Fig. \@ref(fig:decay-model-grid) for model results for all sites. -->

<!-- ```{r abn-decay-s, fig.cap = '(ref:caption-abn-decay-s)', out.width = "9cm", echo=FALSE} -->
<!-- # knitr::include_graphics(path = paste0(p_plots, run_label, "persistence_proportion", run_label, "_s.png")) -->
<!-- knitr::include_graphics( -->
<!--   path = paste0(p_plots, "fig4", run_label, ".pdf" -->
<!--                                  )) -->

<!-- # persistence_dat %>% group_by(site) %>% summarise(n = n()) -->
<!-- # persistence_dat %>% filter(site == "belarus") %>% .$cohort %>% levels() %>% length -->
<!-- # persistence_dat %>% group_by(site) %>% summarise(n = length(unique(cohort))) -->
<!-- ``` -->

\newpage

\beginsupplement

# Supplementary information {.unnumbered}

\tableofcontents
<!-- \listoftables -->
<!-- \listoffigures -->

<!-- \newpage -->

# Extended Results {#results-si}

## Summary statistics {#summary-stats-si}

On average, we found that cropland abandonment lasted for only `r abn_duration_stats$mean_of_means_duration` years (SD = `r abn_duration_stats$sd_of_mean_duration` years) across our time series at our 11 sites (Table \@ref(tab:abn-panel-table)).
Note, however, that these summary statistics are calculated based on the mean abandonment duration at each site, in order to account for different site sizes.
The summary statistics reported above and in the main text are therefore the mean of the individual mean abandonment duration values for each of our 11 sites, and the corresponding standard deviation of these individual mean abandonment duration values.
This standard deviation represents the variation in mean abandonment duration among sites.
For comparison, we also calculated the standard deviation of abandonment duration values at each individual site, which represents the variation among instances of abandonment at that particular site.
The mean of these 11 standard deviation values was `r abn_duration_stats$mean_of_sds_duration` years.
These values, along with the mean and standard deviation across the 11 site summary values, are presented in Tables \@ref(tab:summary-stats-table)-\@ref(tab:recult-summary-stats-table).

## Limited abandonment in Mato Grosso {#mato-grosso-si}

Mato Grosso, Brazil, was the only site that did not experience substantial amounts of cropland abandonment during our time series (see Table \@ref(tab:abn-panel-table)).
This is unsurprising given the recent history of agriculturally-driven land-use change in Mato Grosso over the last few decades.
Moreover, the abandonment that did take place in Mato Grosso was subject to relatively quick recultivation, with half-lives ranging from `r decay_stats$mg_hl_min` to `r decay_stats$mg_hl_max` years across our full range of endpoints (Fig. \@ref(fig:endpoint-half-lives-all)).
These half-lives were the shortest of any of our sites.
However, because Mato Grosso showed large amounts of new cultivation over the course of our time series and relatively little abandonment (`r area_abn_stats$mg` ha, or only `r area_abn_stats$mg_abn_2017_as_percent_total_crop`% of the total cropland extent, as of 2017; Table \@ref(tab:abn-panel-table)), these results should be interpreted with care.
In Mato Grosso, agricultural expansion is undoubtedly the dominant force affecting biodiversity and carbon stocks.

## Biomes {#section-biomes}

<!-- Some ecosystems and biomes seem to recover more quickly than others, namely in relatively higher latitudes, relatively colder climates, and in relatively more humid biomes [@Prach2018]. -->
Our sites cover a range of biomes (Fig. \@ref(fig:site-biomes)), as delineated by the Ecoregions2017 map [@Dinerstein2017], including:

- Temperate Broadleaf and Mixed Forests (Vitebsk Belarus/Smolensk, Russia; Bosnia & Herzegovina; Wisconsin, USA),
- Temperate Grasslands, Savannas, and Shrublands (Nebraska/Wyoming, USA; Orenburg, Russia/Uralsk, Kazakhstan; Volgograd, Russia),
- Tropical Grassland (Goiás and Mato Grosso, Brazil),
- Tropical Moist Broadleaf Forests (Chongqing, China; Mato Grosso, Brazil),
- Montane Grassland and Shrublands (Shaanxi/Shanxi, China), and
- Deserts & Xeric Shrublands (Iraq).

Individual ecoregions from the Ecoregions2017 layer are shown in Fig. \@ref(fig:site-ecoregions), and the broad categorization of these biomes into forest and non-forest is shown in Fig. \@ref(fig:site-biomes-for-nonfor).

The long-term land-cover outcomes for abandoned croplands (as of 2017) are shown in Fig. \@ref(fig:abn-prop-lc).
Land-cover outcomes for abandoned croplands showed wide variation across sites, with the majority of abandonment in Wisconsin being classified as forest by 2017 (`r lc_stats$forest_max`% forest, `r lc_stats$forest_max_grassland`% grassland), while most abandonment remained in grassland at our other sites (Fig. \@ref(fig:abn-prop-lc)).
This limited regrowth of woody vegetation may be a product of the biome (the four sites with the highest proportion of abandoned cropland classified as woody vegetation by 2017 were also the four sites entirely in forest biomes: `r site_labels$site_long[c(11, 3, 2, 1)] %>% paste0(collapse = "; ")`), but it may simply be a result of insufficient time for woody biomass to develop, even in forest biomes.
Land cover alone cannot confidently serve as a proxy for ecosystem recovery.

## The effect of varying abandonment definitions {#abn-thresholds}

```{r, include = FALSE}

# mean_length_df %>% filter(length_type == "all") %>% arrange(site)

overall_means <- mean_length_df %>%
  group_by(abn_threshold, length_type) %>%
  summarise(overall_mean = mean(mean_duration, na.rm = TRUE)) %>% ungroup()


threshold_stats <- list(
  one = overall_means %>% filter(abn_threshold == 1, length_type == "all") %>% .$overall_mean %>% round(digits = 0),
  three = overall_means %>% filter(abn_threshold == 3, length_type == "all") %>% .$overall_mean %>% round(digits = 0),
  five = overall_means %>% filter(abn_threshold == 5, length_type == "all") %>% .$overall_mean %>% round(digits = 0),
  ten = overall_means %>% filter(abn_threshold == 10, length_type == "all") %>% .$overall_mean %>% round(digits = 0)
)
```

A relatively short-term definition of abandonment might result in an overestimation of recultivation, by misclassifying long-term fallow cycles as periods of abandonment.
In some cases, short-term abandonment may be better understood as cyclical fallow periods rather than true abandonment [@Munroe2013].
Because the length of a typical fallow period may vary around the world, we tested multiple abandonment thresholds in order to test the sensitivity of our results to our choice of a five-year abandonment definition (which we selected following the FAO [@FAO2016]).
As our abandonment threshold increased in length, the mean abandonment duration across our sites increased accordingly, ranging between `r threshold_stats$one` years (no threshold) and `r threshold_stats$ten` years (ten-year threshold; see Fig. \@ref(fig:abn-duration-by-threshold)).
As expected, using a longer abandonment definition reduced the amount of cropland abandonment we detected, which is also shown in the area in the different colored age classes in Fig. \@ref(fig:area-abn-by-age-class).

The proportion of abandoned croplands that were recultivated by the end of the time series also responded to our abandonment threshold, with less recultivation for longer abandonment thresholds (Fig. \@ref(fig:recult-by-threshold)).
However, even at the longest abandonment definition ($\geq10$ years), we still saw that between `r recult_stats$min_10` and `r recult_stats$max_10`% of abandoned croplands were recultivated by the end of the time series (in `r recult_stats$min_10_site` and `r recult_stats$max_10_site` respectively).
We find that the mean area of abandoned croplands that get recultivated by the end of the time series declined from `r recult_stats$mean_thr_5`% with a five-year threshold to `r recult_stats$mean_thr_7`% with a seven-year threshold, and `r recult_stats$mean_thr_10`% with a ten-year threshold.
This indicates that the abandonment and recultivation we observe is not merely a function of our five-year abandonment definition.

Finally, we also assessed how different thresholds of recultivation affected the mean duration of recultivation, finding a similar pattern to abandonment.
When qualifying periods of abandonment were recultivated, we found that the mean length of recultivation increased as we increased the number of years that land needed to be continuously recultivated in order to be considered "recultivated" (Fig. \@ref(fig:recult-duration-by-threshold)).

## Comparing approaches to estimating abandonment: annual vs. two-timepoint estimates {#twoyr-vs-annual}

Some studies estimate cropland abandonment by simply looking for differences between two cropland maps - in other words, by identifying areas where land cover is classified as "cultivated" in one year, but not in a later year (e.g., 1992 and 2015 in ref. [@Naess2021]).
Such a method has the potential to overestimate abandonment by including short-term fallow periods and discounting the potential for future recultivation. 
It also has the potential to underestimate abandonment by missing any new cultivation (and subsequent abandonment) that takes place between the two timepoints. 
To illustrate this point and understand the effect of using this simplified approach instead of our full annual time series, we estimated cropland abandonment by simply identifying areas that were classified as "cropland" in 1987 and classified as either "woody vegetation" or "herbaceous vegetation" in 2017 (excluding "non-vegetation").

Using this two-timepoint approach, we find only `r format(abn_2yr_stats$total_area_abn_Mha, nsmall = 2)` Mha of "abandonment," a `r  round((area_abn_stats$total_area_abn_Mha_2017_all_sites - abn_2yr_stats$total_area_abn_Mha) / area_abn_stats$total_area_abn_Mha_2017_all_sites, digits = 4) * 100`% underestimate compared to the `r area_abn_stats$total_area_abn_Mha_2017_all_sites` Mha of abandonment as of 2017 observed using our full annual time series.
This "abandoned" area ranged from `r abs(abn_2yr_stats$low_percent)`% less (`r abn_2yr_stats$low_p_site`) to `r abn_2yr_stats$high_percent`% more (`r abn_2yr_stats$high_p_site`) area abandoned at each site than the area identified using the full time series (Table \@ref(tab:twoyr-diff-table)).
Furthermore, much of this "abandonment" consisted of croplands that had been abandoned for less than five years and therefore did not meet our definition of abandonment (ranging from `r abn_2yr_stats$percent_area_below_5_low`% to `r abn_2yr_stats$percent_area_below_5_high`% of area at all sites except Mato Grosso; see Table \@ref(tab:twoyr-diff-table)). 

Not only did the two-timepoint method produce different area estimates, but it also identified geographically distinct areas of abandonment, with spatial agreement ranging from `r abn_2yr_stats$jaccard_low`% (`r abn_2yr_stats$jaccard_low_site`) to `r abn_2yr_stats$jaccard_high`% (`r abn_2yr_stats$jaccard_high_site`) at our sites (Table \@ref(tab:twoyr-diff-table)).
We measured spatial agreement using the Jaccard similarity index [@Legendre2012], a measure of overlap between two sets, defined as the proportion of shared elements, or the intersection divided by the union (Equation \@ref(eq:jaccard-equation)) [@Legendre2012]:

\begin{equation}
J(a,b) = \frac{a\cap b}{a\cup b} (\#eq:jaccard-equation)
\end{equation}

# Extended Methods {#methods-si}

Our analysis builds on annual land cover maps for 1987-2017 developed by Yin et al. [@Yin2020].
The following section outlines our data processing and analytical methods in greater detail than was possible in the main text.
We processed and analyzed our abandonment map data in RStudio version `r rstudioapi::versionInfo()$version` [@RStudio], using `r R.Version()$version.string` [@R-base], relying heavily on the `terra` [@R-terra], `data.table` [@R-data.table], and `tidyverse` [@R-tidyverse] packages.
All area calculations were performed using the `terra` package's `cellSize()` function, which calculates the spherical area of each cell as defined by its four corners [@R-terra].

## Temporal filters {#temporal-filters}

In order to address potential land-cover classification errors, we implemented a series of temporal filters designed to smooth trajectories by looking for short-term land-cover changes that are temporally unlikely.
We applied five-year and eight-year moving-window filters that searched for short periods of land cover classifications that did not match those immediately before and after, and subsequently updated them to match the surrounding classifications.
More specifically, the five-year filter searched for one year periods that did not match the two years immediately before and after the central year (e.g., patterns of `11011`, where `1` represents non-cropland and `0` represents cropland, or vice versa), and our eight-year filter searched for two year periods that did not match the three years before and after (i.e., `11100111`).
Both filters then updated the central classifications to match the classes on either end.
We applied these filters to the raw land cover maps for each land cover class sequentially (cropland, herbaceous vegetation, woody vegetation, and non-vegetation), prior the identification of abandoned cropland.

## Classifying abandonment {#classifying-abn}

We only included periods of abandonment that verifiably followed agricultural activity during our time series.
Accordingly, pixels that were consistently cropland or consistently non-cropland (i.e., herbaceous or woody vegetation) classes throughout time were excluded.
This also meant that we excluded periods of non-cropland classification that began in the first year of the time series, because of a lack of information on whether this non-cropland had been previously cultivated.
Accordingly, if pixels were initially non-cropland, then changed to cropland and were subsequently abandoned, we only counted these last periods as abandonment.

To illustrate this, consider the following time series read left to right, which represents twenty years beginning at the start of our time series (where `1` represents non-cropland and `0` represents cropland):

> `'87 '88 '89 '90 '91 '92 '93 '94 '95 '96 '97 '98 '99 '00 '01 '02 '03 '04 '05 '06`  
> `..1   1   1   1   1   1   1   0   0   0   0   1   1   1   1   1   1   1   1   1`

This represents seven years of non-cropland to start the time series, followed by four years of cropland cultivation, followed by nine years of non-cropland. 
Though this pixel experienced two periods of non-cropland classification of five or more years (from 1987 through 1993, and from 1998 through 2006), we only include the second, nine-year period (1998 through 2006), because it clearly followed cropland classification.

As noted in the main text, pixels that transitioned from cropland to the non-vegetation land cover class were not considered "abandoned," and therefore we excluded all non-vegetation pixels from our entire analysis.
These pixels accounted for <10% of total site area at all sites except `r non_veg_stats$site1` (`r non_veg_stats$site1_p`%) and `r non_veg_stats$site2` (`r non_veg_stats$site2_p`%), and remained stable or declined over time at all 11 sites (see Fig. \@ref(fig:area-by-lc)).

## Estimating soil organic carbon accumulation {#section-soc-si}

We derived mean soil organic carbon (SOC) accumulation rates from the Soils Revealed database [@Sanderman2020].
Soils Revealed contains multiple scenarios of SOC accumulation under different land-use change outcomes, including one that estimates the SOC that could accumulate in agricultural lands (cropland and pastures) following a full return to native vegetation.
This scenario estimates SOC stocks after 20 years and 80 years of natural regeneration.
In order to translate this into an annual rate of soil organic carbon accumulation, we first extracted SOC stock values for only those pixels that transitioned from cropland to native vegetation (after identifying cropland pixels with the IPCC land cover map used in development of the database), and calculated the mean stock at 20 and 80 years at each site, to allow for consistent application to our finer resolution cropland map, which included some cropland areas not mapped by the coarser IPCC land cover map.
First, we calculated an annual SOC accumulation rate to be applied during the first 20 years of regeneration by simply dividing the 20-year stock value by 20 (Fig. \@ref(fig:carbon-map-Y20-rate)).
To calculate an annual SOC accumulation rate to apply to years 21 through 80, we divided the difference between the 80-year and 20-year SOC stock by 60 (Fig. \@ref(fig:carbon-map-YSS-rate)).

## Modeling abandonment recultivation as a "decay" process {#decay-models-si}

Our mean abandonment duration metric tells us about the general persistence of abandoned croplands throughout the time series.
However, this duration value is limited by the time series length, and does not account for when the majority of the abandonment took place at a site, nor whether a period of abandonment ends as a result of recultivation or the end of the time series.
As a result, the mean abandonment duration does not tell us how long to expect a piece of land to remain abandoned, nor how abandonment length varies through time.
To address this constraint, we track the trajectory of each abandoned pixel through time following its initial abandonment, grouping pixels abandoned in a given year into "cohorts."
Decay trajectories derived from this approach provide information about how long it takes for land to be recultivated, complementing the mean abandonment length and providing a more nuanced story about how long to expect abandonment to last.

For example, a site may have a relatively short mean length of abandonment (e.g., Shaanxi/Shanxi, China, with a mean abandonment length of `r mean_length_df %>% filter(site == "shaanxi", abn_threshold == 5, length_type == "all") %>% .$mean_duration %>% round(digits = 2)` years; Fig. \@ref(fig:mean-abn-duration), Table \@ref(tab:abn-panel-table)), but also have a gradual decay rate, indicating that land is like to stay abandoned for a relatively longer amount of time than observed during the time window of our time series.
This may result from more abandonment occurring toward the end of the time series; this land simply does not have as long to age and shows up as younger in our data, regardless of how long it may last in the future.
Looking at abandonment decay rates for each cohort individually allows us to produce mean decay trajectories for each site in a way that accounts for when a piece of land was first abandoned during the time series (i.e., giving us a sense of how long to expect a given piece of land to remain abandoned, even into the future).

### Model selection and diagnostics

We fit a linear model using the `lm()` function in R's core statistics package `stats`, predicting the proportion of abandoned cropland in each cohort remaining abandoned as a function of time since initial abandonment at each site.
The proportion of abandoned cropland remaining abandoned is measured relative to the area abandoned five years following the year of initial abandonment, as dictated by our five-year abandonment definition.

We tested a range of model specifications, including linear and log transformations of both *proportion* and *time*.
Due to a linear relationship between model residuals and time when including only one term for *time*, we also tested models containing multiple *time* predictor terms, including both log and linear terms.

We chose a model with the specifications shown in Equation 1 and reproduced here in Equation \@ref(eq:mod-spec-SI).
For cohorts of abandonment initially abandoned in years $y = 1988, ... , 2013$, we estimate the proportion $p$ of each cohort $y$ at site $z$ remaining abandoned as a function of time $t$ (i.e., based on the number of years after initial abandonment).

\begin{equation}
p_{yz} = 1 + \beta_{yz,1} log(t + 1) + \beta_{yz,2} t (\#eq:mod-spec-SI)
\end{equation}

Where $\beta_{yz,1}$ represents the regression coefficient on the log term of time $t$ for cohort $y$ at site $z$, and $\beta_{yz,2}$ represents the regression coefficient on the linear term of time $t$ for cohort $y$ at site $z$.
We allow for *cohort* and *site* fixed effects, fitting unique coefficients for each cohort at each site.
We ran a single pooled model using data across all 11 sites, using the following function call: `stats::lm(formula = I(proportion - 1) ~ 0 + log(time + 1):cohort:site + I(time):cohort:site)`.
The observations and fitted values for each cohort from our pooled linear model are shown in Fig. \@ref(fig:decay-model-grid).

Model selection was performed based on Akaike Information Criterion (AIC) values (Fig. \@ref(fig:AIC)), selecting the model with the lowest (i.e., more negative) AIC value.
We confirmed that linear model assumptions were not violated through visual inspection of both residuals vs. fitted plots and Q-Q plots (Fig. \@ref(fig:diag-combo)).

### Comparing across cohorts using common endpoints

As noted in the main text, we calculate mean decay trajectories at each site for a range of common endpoints (7-29 years; see Fig. \@ref(fig:endpoint-half-lives-all)). 
This method of parameterizing our pooled linear model for subsets of our data according to common endpoints was developed in order to facilitate fair comparisons across cohorts, specifically by ensuring that mean coefficient values would be calculated after restricting each cohort to the same number of observations in the calculation of coefficients to be averaged.
In order to calculate the mean decay trajectory for a given site at a given endpoint (as shown by the red lines in Figs. \@ref(fig:endpoint-panel-a) - \@ref(fig:endpoint-panel-b)), we took the mean of the log coefficients ($\beta_{\bar{y}z, 1}$) and the mean of the linear coefficients ($\beta_{\bar{y}z, 2}$) respectively across all cohorts $y$ at each site $z$ that met the threshold for each given endpoint.
We then used these mean coefficient values ($\beta_{\bar{y}z,1}$ and $\beta_{\bar{y}z,2}$) to define a new function describing the mean recultivation (or decay) trajectory for each site at each endpoint, using the same form as Equation \@ref(eq:mod-spec-SI).

## Change in recultivation rates over time {#section-methods-rate-of-change}

We examined the rate of change of recultivation rates by calculating the half-life, defined as the time required for half (50%) of a given cohort of abandoned cropland to be recultivated at a given site, and parameterizing a simple linear model on these half-life values as a function of time, using the `stats::lm()` function in R's core statistics package `stats`.
This resulted in *n* = 26 half-life values (one for each cohort) at each of our 11 sites.
We estimate the half-life, $t_{half,z}$, as a function of the year of initial abandonment ($yearabn_{z}$), at each site $z$, as shown in Equation \@ref(eq:rate-of-change-lm).

\begin{equation}
t_{half,z} = \beta_{0,z} + \beta_{1,z} yearabn_{z} (\#eq:rate-of-change-lm)
\end{equation}

Where $\beta_{1,z}$ represents the regression slope on the year abandoned (cohort) for site $z$ ($yearabn_{z}$), and $\beta_{0,z}$ represents the intercept.
This corresponds to a `stats::lm()` call of `lm(formula = t_half ~ year_abandoned)`, run for each site individually.
Results are shown in Fig. \@ref(fig:decay-rate-of-change).
We confirmed that model assumptions were met through visual inspection of residuals vs. fitted plots and Q-Q plots (Fig. \@ref(fig:rate-of-change-diag-combo)).

\newpage

# Supplementary tables

```{r abn-panel-table, echo = FALSE, fig.pos = "ht"}
area_summary_df %>% 
  select(site_long, area_ha_Observed = area_abn_ha_2017, 
         area_ha_Potential = area_ever_abn_ha, 
         total_crop_extent_ha, 
         area_2017_as_prop_total_crop) %>%
  mutate(a_diff = 100 * (area_ha_Potential - area_ha_Observed) / area_ha_Potential) %>%
  arrange(desc(area_2017_as_prop_total_crop)) %>%
  
  # add the total row:
  bind_rows(
    tibble(site_long = "Total Across Sites",
           area_ha_Observed = sum(area_summary_df$area_abn_ha_2017),
           area_ha_Potential = sum(area_summary_df$area_ever_abn_ha),
           total_crop_extent_ha = sum(area_summary_df$total_crop_extent_ha)) %>%
      mutate(area_2017_as_prop_total_crop = area_ha_Observed/total_crop_extent_ha,
             a_diff = 100 * (area_ha_Potential - area_ha_Observed) / area_ha_Potential)
    ) %>%

  select(site_long, area_ha_Observed, area_ha_Potential, 
         a_diff, area_2017_as_prop_total_crop) %>%
  
  mutate(
    area_ha_Observed = area_ha_Observed %>% round(digits = 0) %>% prettyNum(big.mark = ","), 
    area_ha_Potential = area_ha_Potential %>% round(digits = 0) %>% prettyNum(big.mark = ","), 
    area_2017_as_prop_total_crop = round(area_2017_as_prop_total_crop*100, digits = 2) %>% 
      paste0(., "%"),
    a_diff = round(-1 * a_diff, digits = 2) %>% paste0(., "%")
    ) %>%
  knitr::kable(., 
             col.names = c("Site", 
                           "Observed area (ha)", 
                           "Potential area (ha)",
                           "Percent (%) difference from potential",
                           "Observed area as percent of total cropland extent"),
             align = "r", 
             #format = "simple",
             format = my_format,
             booktabs = TRUE,
             caption = "Observed area abandoned (Mha) as of 2017, potential area abandoned by 2017 (Mha) assuming no recultivation, the percent difference between observed and potential abandonment, and observed abandonment as of 2017 as a percent of the total cropland extent (i.e., the area of all lands that were cultivated at some point during the time series). This table replicates Figure S2. Note that sites are shown in descending order of area abandoned as of 2017 as a proportion of total cropland extent."
             ) %>%
  kableExtra::kable_styling(
    # latex_options = "scale_down"
    latex_options = "hold_position"
    ) %>%
  row_spec(11, hline_after = TRUE) %>%
  row_spec(12, bold = TRUE) %>%
  column_spec(1, width = "4.1cm") %>%
  column_spec(2, width = "1.5cm") %>%
  column_spec(3, width = "1.7cm") %>%
  column_spec(4, width = "2.5cm") %>%
  column_spec(5, width = "3.2cm")

```

\newpage

```{r summary-stats-table, echo = FALSE, fig.pos = "ht"}
mean_length_df %>% filter(length_type == "all", abn_threshold == 5) %>% 
  select(site_long, mean_duration, median_duration, sd_duration) %>%
  bind_rows(
    mean_length_df %>%
      filter(length_type == "all", abn_threshold == 5) %>%
      summarise(mean_duration = mean(mean_duration),
                median_duration = mean(median_duration),
                sd_duration = mean(sd_duration)) %>%
      mutate(site_long = "Mean across site summary statistics:"),
    mean_length_df %>%
      filter(length_type == "all", abn_threshold == 5) %>%
      summarise(mean_duration = sd(mean_duration),
                median_duration = sd(median_duration),
                sd_duration = sd(sd_duration)) %>%
      mutate(site_long = "Standard deviation across site summary statistics:"),
  ) %>%
  mutate(mean_duration = round(mean_duration, digits = 2), 
         median_duration = round(median_duration, digits = 2),
         sd_duration = round(sd_duration, digits = 2)) %>%
  
  knitr::kable(., 
             col.names = c("Site", "Mean", "Median", "Standard Deviation"),
             align = "r", #format = "simple",
             format = my_format,
             booktabs = TRUE,
             caption = "Summary statistics describing the duration of abandonment (in years) at our 11 sites between 1987 and 2017, using a five-year abandonment definition, and incorporating all periods of abandonment (allowing for multiple per pixel)."
             ) %>%
  kableExtra::kable_styling(
    # latex_options = "scale_down"
    latex_options = "hold_position"
    ) %>%
  row_spec(11, hline_after = TRUE) %>%
  row_spec(12, bold = TRUE) %>%
  row_spec(13, bold = TRUE) %>%
  column_spec(1, width = "5cm") %>%
  column_spec(4, width = "1.8cm") #%>%
#   readr::write_file(., "kable_out.pdf")
# 
#   kableExtra::save_kable(#width = 5, height = 2,
#            file = paste0(p_plots, "my_table.html"),
#            keep_tex = TRUE
#              #paste0(p_plots, run_label, "/", "table_s1.pdf")
#                  )
# 
# tinytex::tlmgr_install(
#   # pkgs = "ragged2e"
#   # pkgs = "standalone"
#   pkgs = "fontspec"#"polyglossia"#"preview"
# )
```

\newpage

```{r potential-summary-stats-table, echo = FALSE, fig.pos = "ht"}
potential_mean_length_df %>% 
  filter(length_type == "potential", abn_threshold == 5) %>% 
  select(site_long, mean_duration, median_duration, sd_duration) %>%
  bind_rows(
    potential_mean_length_df %>%
      filter(length_type == "potential", abn_threshold == 5) %>%
      summarise(mean_duration = mean(mean_duration),
                median_duration = mean(median_duration),
                sd_duration = mean(sd_duration)) %>%
      mutate(site_long = "Mean across site summary statistics:"),
    potential_mean_length_df %>%
      filter(length_type == "potential", abn_threshold == 5) %>%
      summarise(mean_duration = sd(mean_duration),
                median_duration = sd(median_duration),
                sd_duration = sd(sd_duration)) %>%
      mutate(site_long = "Standard deviation across site summary statistics:")) %>%
  mutate(mean_duration = round(mean_duration, digits = 2), 
         median_duration = round(median_duration, digits = 2),
         sd_duration = round(sd_duration, digits = 2)) %>%
  knitr::kable(., 
             col.names = c("Site", "Mean", "Median", "Standard Deviation"),
             align = "r", #format = "simple",
             format = my_format,
             booktabs = TRUE,
             caption = "Summary statistics describing the duration of potential abandonment (in years) for our scenario without recultivation, at our 11 sites between 1987 and 2017, using a five-year abandonment definition, and incorporating all periods of abandonment (allowing for multiple per pixel)."
             ) %>%
  kableExtra::kable_styling(
    # latex_options = "scale_down"
    latex_options = "hold_position"
    ) %>%
  row_spec(11, hline_after = TRUE) %>%
  row_spec(12, bold = TRUE) %>%
  row_spec(13, bold = TRUE) %>%
  column_spec(1, width = "5cm") %>%
  column_spec(4, width = "1.8cm")
```

\newpage

```{r recult-summary-stats-table, echo = FALSE, fig.pos = "ht"}
mean_recult_length_df %>% 
  filter(length_type == "recult", recult_threshold == 1) %>% 
  select(site_long, mean_duration, median_duration, sd_duration) %>%
  bind_rows(
    mean_recult_length_df %>%
      filter(length_type == "recult", recult_threshold == 1) %>%
      summarise(mean_duration = mean(mean_duration),
                median_duration = mean(median_duration),
                sd_duration = mean(sd_duration)) %>%
      mutate(site_long = "Mean across site summary statistics:"),
    mean_recult_length_df %>%
      filter(length_type == "recult", recult_threshold == 1) %>%
      summarise(mean_duration = sd(mean_duration),
                median_duration = sd(median_duration),
                sd_duration = sd(sd_duration)) %>%
      mutate(site_long = "Standard deviation across site summary statistics:")) %>%
  mutate(mean_duration = round(mean_duration, digits = 2), 
         median_duration = round(median_duration, digits = 2),
         sd_duration = round(sd_duration, digits = 2)) %>%
  knitr::kable(., 
             col.names = c("Site", "Mean", "Median", "Standard Deviation"),
             align = "r", #format = "simple",
             format = my_format,
             booktabs = TRUE,
             caption = "Summary statistics describing the duration of recultivation (in years) following qualifying periods of abandonment, at our 11 sites between 1987 and 2017, using a five-year abandonment definition and a one-year recultivation definition, and incorporating all periods of abandonment (allowing for multiple per pixel)."
             ) %>%
  kableExtra::kable_styling(
    # latex_options = "scale_down"
    latex_options = "hold_position"
    ) %>%
  row_spec(11, hline_after = TRUE) %>%
  row_spec(12, bold = TRUE) %>%
  row_spec(13, bold = TRUE) %>%
  column_spec(1, width = "5cm") %>%
  column_spec(4, width = "1.8cm")
```

\newpage

```{r carbon-table, echo = FALSE, fig.pos = "ht"}

potential_v_obs_2017_df %>%
  select(site_long, 
         area_ha_Observed, area_ha_Potential,
         Mg_C_Observed, Mg_C_Potential, c_diff) %>%
  mutate(MgC_per_ha_Observed = (Mg_C_Observed / area_ha_Observed)) %>%
  arrange(MgC_per_ha_Observed) %>%

  # add the total row:
  bind_rows(
    tibble(site_long = "Total Across Sites",
           area_ha_Observed = sum(potential_v_obs_2017_df$area_ha_Observed),
           area_ha_Potential = sum(potential_v_obs_2017_df$area_ha_Potential),
           Mg_C_Observed = sum(potential_v_obs_2017_df$Mg_C_Observed),
           Mg_C_Potential = sum(potential_v_obs_2017_df$Mg_C_Potential)) %>%
      mutate(c_diff = 100 * (Mg_C_Potential - Mg_C_Observed) / Mg_C_Potential)
    ) %>%

  
  mutate(
    MgC_per_ha_Observed = (Mg_C_Observed / area_ha_Observed) %>% round(digits = 2),
    MgC_per_ha_Potential = (Mg_C_Potential / area_ha_Potential) %>% round(digits = 2),
    Mg_C_Observed = Mg_C_Observed %>% round(digits = 0) %>% prettyNum(big.mark = ","),
    Mg_C_Potential = Mg_C_Potential %>% round(digits = 0) %>% prettyNum(big.mark = ","),
    c_diff = (-1 * c_diff) %>% round(digits = 2) %>% paste0(., "%")
    ) %>%
  select(-c(area_ha_Observed, area_ha_Potential)) %>%

  knitr::kable(., 
             col.names = c("Site",
                           "Carbon (Mg C, observed)",
                           "Carbon (Mg C, potential)",
                           "Carbon (% diff. from potential)",
                           "Mg C per ha, observed",
                           "Mg C per ha, potential"),
             align = "r", 
             format = my_format,
             booktabs = TRUE,
             caption = "Estimated carbon sequestration in observed and potential area abandoned by 2017, reported in terms of Mg C, as the percent difference between observed and potential accumulation, and as Mg C per ha."
             ) %>%
  kableExtra::kable_styling(
    # latex_options = "scale_down"
    latex_options = "hold_position"
    ) %>%
  row_spec(11, hline_after = TRUE) %>%
  row_spec(12, bold = TRUE) %>%
  column_spec(1, width = "4.2cm") %>%
  column_spec(c(2:3), width = "1.9cm") %>%
  column_spec(c(4), width = "2.3cm") %>%
  column_spec(c(5:6), width = "1.7cm")
```

\newpage

```{r twoyr-diff-table, echo = FALSE, fig.pos = "ht"}
abn_2yr_overestimation_char %>% 
  select(site_long, area_ha_cc, area_2yr, percent_diff, jaccard, percent_2yr_abn_area_less_than_5yrs_old) %>%

  knitr::kable(., 
             col.names = c("Site", 
                           "Area (annual, as of 2017)", 
                           "Area \n(two year: 2017-1987)", 
                           "Percent % from annual area", 
                           "Jaccard Similarity",
                           "Percent Area <5 Years Old (two year)"),
             align = "r", 
             format = my_format,
             booktabs = TRUE,
             caption = "Cropland abandonment (in Mha) as of 2017 as identified using a) our annual time series and a five-year abandonment definition and b) a two-year method taking the difference between land cover in 1987 and 2017."
             ) %>%
  kableExtra::kable_styling(
    # latex_options = "scale_down"
    latex_options = "hold_position"
    )%>%
  column_spec(1, width = "4.2cm") %>%
  column_spec(c(2:3), width = "2cm") %>%
  # column_spec(3, width = "2cm") %>%
  column_spec(4:5, width = "1.7cm") %>%
  column_spec(6, width = "2cm")
```

\newpage

# Supplementary figures

(ref:caption-maps-max-abn-duration) Maximum duration of cropland abandonment (in years) observed at each pixel between 1987 and 2017 in our 11 study sites. X axes show degrees longitude relative to the prime meridian (negative indicating west and positive indicating east), and y axes show degrees latitude relative to equator (negative indicating south and positive indicating north). This serves as a companion to maps of the abandonment duration as of 2017 shown in Fig. \@ref(fig:maps-abn-duration). Site locations are shown in Fig. \@ref(fig:global-map).

```{r maps-max-abn-duration, fig.cap = '(ref:caption-maps-max-abn-duration)', echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, "fig1_max", run_label, ".pdf"))
```

\newpage

(ref:caption-mean-abn-duration-w-max) The distribution of the maximum abandonment duration (in years) for each pixel at each site from 1987 to 2017. The y-scale shows the proportion of pixels with maximum duration values of a given duration at each site. As previously noted, abandonment and recultivation can occur multiple times at a single pixel during our time series, and this figure serves as a companion to the distribution of all abandonment periods shown in Fig. \@ref(fig:mean-abn-duration). Site-level mean duration values are shown in the red and blue dots, corresponding to mean values calculated across all periods of abandonment (in red, including multiple periods per pixel) and mean values calculated across only the maximum duration of abandonment at each pixel (in blue). The vertical dashed lines represent the mean of these site-level mean duration values, for all abandonment periods (red) and only the maximum duration at each pixel (blue), respectively.

```{r mean-abn-duration-w-max, fig.cap = '(ref:caption-mean-abn-duration-w-max)', out.width = "11cm", echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, "fig2_w_max", run_label, ".pdf"))
```

\newpage

(ref:caption-area-abn-panel) Abandonment area as of 2017, across three categories: a) area of abandonment observed as of 2017, b) area of all croplands abandoned at least once between 1987-2017 (i.e., the potential area abandoned by 2017, assuming no recultivation), c) observed area abandoned as of 2017 as a proportion of the total cropland extent (i.e., the area of all lands that were cultivated at some point during the time series). Note that sites are shown in ascending order of area abandoned as of 2017 as a proportion of total cropland extent.

```{r area-abn-panel, fig.cap = '(ref:caption-area-abn-panel)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/area_abn_panel", run_label, ".pdf"))
```

\newpage

(ref:caption-recult-by-threshold) Recultivation rates shown for various abandonment thresholds.

```{r recult-by-threshold, fig.cap = '(ref:caption-recult-by-threshold)'}
knitr::include_graphics(path = paste0(p_output, "plots/", run_label, "/recultivation_rates_by_threshold", run_label, ".pdf"))
```

\newpage

(ref:caption-potential-area-bins) Potential area abandoned over time, assuming no recultivation took place, shown according to age class (in years). Cumulative potential area abandoned at each site is shown as the dashed black line, and the cumulative observed area abandoned is shown for comparison as the solid black line. This figure serves as a companion to Fig. \@ref(fig:area-abn-by-age-class).

```{r potential-area-bins, fig.cap = '(ref:caption-potential-area-bins)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/potential_area_age_bins", run_label, ".pdf"))
```

\newpage

(ref:caption-mean-potential-abn-duration) The distribution of potential abandonment duration (in years) for all periods of abandonment from 1987 to 2017, assuming no recultivation occurred following abandonment that met our five-year threshold. The y-scale shows the proportion of potential abandonment periods of a given duration at each site. The red points represent the potential mean abandonment duration (in years) at each site, and the red vertical dashed line represents the mean of these site-level mean duration values across all sites. This serves as a companion to the distribution of observed abandonment periods in Fig. \@ref(fig:mean-abn-duration).

```{r mean-potential-abn-duration, fig.cap = '(ref:caption-mean-potential-abn-duration)', out.width = "11cm", echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, "fig2_potential", run_label, ".pdf"))
```

\newpage

(ref:caption-mean-recult-duration) The distribution of duration of recultivation periods that took place after qualifying periods of abandonment. Recultivation (in which abandoned croplands were reclassified as active cropland for one or more years) could take place at any point in or after 1993 (as a result of our five-year abandonment threshold). Note that we included all periods of recultivation, regardless of length, given that recultivation of even one year is biologically relevant to the process of secondary succession. The y-scale shows the proportion of pixels with recultivation periods of a given duration at each site. As previously noted, abandonment and recultivation can occur multiple times at a single pixel during our time series, and this figure serves as a companion to the distribution of all abandonment periods shown in Fig. \@ref(fig:mean-abn-duration). Site-level mean duration values are shown as red dots, corresponding to mean values calculated across all periods of recultivation (including the possibility of multiple periods per pixel). The vertical dashed lines represent the mean of these site-level mean duration values, for all recultivation periods.

```{r mean-recult-duration, fig.cap = '(ref:caption-mean-recult-duration)', out.width = "11cm", echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, "fig2_recult", run_label, ".pdf"))
```

\newpage

(ref:caption-carbon-map-2017-observed) Cumulative carbon accumulation in abandoned croplands as of 2017, in terms of Mg C per pixel (30-m resolution). This cumulative value incorporates both carbon accumulated in forested biomes (including aboveground biomass, belowground biomass, and soil organic carbon; [@Cook-Patton2020]) and soil organic carbon accumulated in non-forested biomes [@Sanderman2020]. Forested biomes were delineated using Ecoregions2017 [@Dinerstein2017]. X axes show degrees longitude relative to the prime meridian (negative indicating west and positive indicating east), and y axes show degrees latitude relative to equator (negative indicating south and positive indicating north).

```{r carbon-map-2017-observed, fig.cap = '(ref:caption-carbon-map-2017-observed)'}
knitr::include_graphics(path = paste0(p_output, "plots/", run_label, 
                                      "/carbon/total_c_accumulation_5_2017",
                                      run_label, ".pdf"))
```

\newpage

(ref:caption-carbon-map-2017-potential) Potential carbon accumulation in abandoned croplands as of 2017, assuming no recultivation of abandoned croplands, in terms of Mg C per pixel (30-m resolution). Calculated using identical carbon accumulation rates as Fig. \@ref(fig:carbon-map-2017-observed), but assuming no recultivation. X axes show degrees longitude relative to the prime meridian (negative indicating west and positive indicating east), and y axes show degrees latitude relative to equator (negative indicating south and positive indicating north).

```{r carbon-map-2017-potential, fig.cap = '(ref:caption-carbon-map-2017-potential)'}
knitr::include_graphics(path = paste0(p_output, "plots/", run_label, 
                                      "/carbon/potential_total_c_accumulation_5_2017",
                                      run_label, ".pdf"))
```


(ref:caption-site-biomes) Biomes at each site, derived from Ecoregions2017 [@Dinerstein2017].

```{r site-biomes, fig.cap = '(ref:caption-site-biomes)', echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, "biomes2017_by_site.pdf"))
```

(ref:caption-site-biomes-for-nonfor) Biomes at each site, separated into forest and non-forest, derived from Ecoregions2017 [@Dinerstein2017].

```{r site-biomes-for-nonfor, fig.cap = '(ref:caption-site-biomes-for-nonfor)', echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, "biomes2017_forest_nonforest.pdf"))
```

(ref:caption-site-ecoregions) Ecoregions at each site, from Ecoregions2017 [@Dinerstein2017].

```{r site-ecoregions, fig.cap = '(ref:caption-site-ecoregions)', echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, "ecoregions2017_by_site_tall.pdf"))
```

(ref:caption-carbon-map-Y20-rate) Annual carbon sequestration rates for the first 20 years of secondary succession, in terms of Mg C per hectare. Forest carbon sequestration rates are drawn from @Cook-Patton2020, and include aboveground biomass, belowground biomass, and soil organic carbon, and apply for the first 30 years of secondary succession. Soil organic carbon sequestration rates in non-forest biomes are drawn from @Sanderman2020, and apply for the first 20 years of secondary succession. Forested biomes were delineated using Ecoregions2017 [@Dinerstein2017]. See Fig. \@ref(fig:site-biomes-for-nonfor). X axes show degrees longitude relative to the prime meridian (negative indicating west and positive indicating east), and y axes show degrees latitude relative to equator (negative indicating south and positive indicating north).

```{r carbon-map-Y20-rate, fig.cap = '(ref:caption-carbon-map-Y20-rate)'}
knitr::include_graphics(path = paste0(p_output, "plots/", run_label, 
                                      "/carbon/forest_soc_combined",
                                      # "_per_pixel",
                                      "_Y20",
                                      run_label, ".pdf"))
```

(ref:caption-carbon-map-YSS-rate) Annual carbon sequestration rates for the third decade of secondary succession (years 21 through 30), in terms of Mg C per hectare. Forest carbon sequestration rates are drawn from @Cook-Patton2020, and include aboveground biomass, belowground biomass, and soil organic carbon, and apply for the first 30 years of secondary succession. Soil organic carbon sequestration rates in non-forest biomes are drawn from @Sanderman2020, and are calculated from estimated "steady state" values after 80 years of succession. Forested biomes were delineated using Ecoregions2017 [@Dinerstein2017]. See Fig. \@ref(fig:site-biomes-for-nonfor). X axes show degrees longitude relative to the prime meridian (negative indicating west and positive indicating east), and y axes show degrees latitude relative to equator (negative indicating south and positive indicating north).

```{r carbon-map-YSS-rate, fig.cap = '(ref:caption-carbon-map-YSS-rate)'}
knitr::include_graphics(path = paste0(p_output, "plots/", run_label, 
                                      "/carbon/forest_soc_combined",
                                      # "_per_pixel",
                                      "_YSS",
                                      run_label, ".pdf"))
```

(ref:caption-carbon-per-ha) Total carbon accumulation per hectare over time.

```{r carbon-per-ha, fig.cap = '(ref:caption-carbon-per-ha)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/carbon/carbon_accumulated_per_ha.pdf"))
```

(ref:caption-quadrant) Abandonment decay as a function of extent of abandonment at each site. Abandonment decay is shown on the y-axis, as half-lives for endpoints of 10, 15, 20, and 25 years (represented by yellow to purple colors). Abandonment extent is shown on the x-axis as the area abandoned in 2017 as a proportion of the total cropland extent at each site. The absolute area abandoned as of 2017 is shown by the size of the points for each site. The red dashed lines represent the mean values for each axis.

```{r quadrant, fig.cap = '(ref:caption-quadrant)', fig.width = 7.5}
knitr::include_graphics(path = paste0(p_plots, run_label, "/quadrant_endpoints_10_25yr", 
                                     run_label, ".pdf"))
```

(ref:caption-endpoint-half-lives-all) Mean half-lives of abandoned croplands at each site, calculated across our full range of common endpoints (7 to 29 years). See Materials and Methods for a description of our common endpoint modeling approach. These half-lives are calculated for mean site trajectories calculated across model runs at a specific common endpoint (e.g., 15 years), in order to make fair comparisons across cohorts with varying numbers of observations. This serves as a full companion to Fig. \@ref(fig:endpoint-half-lives)

```{r endpoint-half-lives-all, fig.cap = '(ref:caption-endpoint-half-lives-all)', fig.width = 7.5}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/",
                                     "half_lives_endpoints_by_obs",
                                     run_label, 
                                     # "_grid",
                                     ".pdf"))
```

(ref:caption-decay-rate-of-change) The rate of change of decay rates (measured as the half-life, or the time required for 50% of each cohort to be recultivated) at each site over the course of the time series. Individual site trends are shown in panel a. Solid lines show simple linear regressions, the slopes of which are shown in panel b. Gray bands around the linear trends in panel a and the error bars on slope estimates in panel b both represent 95% confidence intervals. These models are described by Eq. \@ref(eq:rate-of-change-lm). Model diagnostic plots are shown in Fig. \@ref(fig:rate-of-change-diag-combo).

```{r decay-rate-of-change, fig.cap = '(ref:caption-decay-rate-of-change)', echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/",
                                      "rate_of_change_recultivation_speed_combo", 
                                      "_lincom", run_label, ".pdf"))

# To include the figure using the linear combination, and a full model including all sites:
# Note - I decided to stick with individual models for each site, to match how the decay models were structured.

# knitr::include_graphics(path = paste0(p_plots, run_label,
#                                       "/decay/rate_of_change_recultivation_speed_combo", 
#                                       "_lincom", run_label, ".pdf"))


# old confidence intervals
# knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/rate_of_change_recultivation_speed_combo",
#                                       "_old", run_label, ".pdf"))


# old version, with quadrants, and old CIs
# knitr::include_graphics(path = paste0(p_plots, run_label, "/presentation/rate_of_change_recultivation_speed", run_label, ".pdf"))
# knitr::include_graphics(path = paste0(p_plots, run_label, "/presentation/rate_of_change_recultivation_speed_old", run_label, ".pdf"))
```

(ref:caption-turnover-grid) Annual turnover of abandoned croplands at each site, showing the annual gain (dark green) and annual loss (i.e., recultivation, light green) and net change (black line) of abandoned croplands.

```{r turnover-grid, fig.cap = '(ref:caption-turnover-grid)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/turnover_grid", run_label, ".pdf"))
```

(ref:caption-area-by-lc) Area in each land cover class at each site through time. Mapped land cover classes are cropland, grassland, woody vegetation, and non-vegetation. Note that the area abandoned (for at least 5 years, shown in pink) consists of increases in grassland and woody vegetation that took place on former croplands. Therefore, these three classes are not mutually exclusive.

```{r area-by-lc, fig.cap = '(ref:caption-area-by-lc)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/area_by_lc_grid", run_label, ".pdf"))
```

(ref:caption-abn-duration-by-threshold) Mean abandonment lengths shown for various abandonment thresholds.

```{r abn-duration-by-threshold, fig.cap = '(ref:caption-abn-duration-by-threshold)'}
knitr::include_graphics(path = paste0(p_output, "plots/", run_label, "/mean_lengths_by_threshold", run_label, ".pdf"))
```

(ref:caption-recult-duration-by-threshold) Mean recultivation duration at each site, shown for various recultivation thresholds.

```{r recult-duration-by-threshold, fig.cap = '(ref:caption-recult-duration-by-threshold)'}
knitr::include_graphics(path = paste0(p_output, "plots/", run_label, "/mean_recult_lengths_by_threshold", run_label, ".pdf"))
```

(ref:caption-abn-prop-lc) Proportion of abandoned cropland in each land cover class as of 2017.

```{r abn-prop-lc, fig.cap = '(ref:caption-abn-prop-lc)', out.width = "14cm", echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, run_label, "/abn_prop_lc_2017", run_label, ".pdf"))
```

(ref:caption-AIC) Akaike Information Criterion (AIC) values for various recultivation ("decay") model specifications polled across all 11 sites. Specifications included multiple combinations of site and cohort fixed effects, and linear and log transformations. More negative AIC values indicate a better model fit.

```{r AIC, fig.cap = '(ref:caption-AIC)', fig.width = 7.5}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "mod_AIC_mega_plot", run_label, ".pdf"))
```

(ref:caption-decay-mod-coef) All model coefficients from our pooled model across all 11 sites, shown with associated uncertainty (95% confidence intervals).

```{r decay-mod-coef, fig.cap = '(ref:caption-decay-mod-coef)', echo = FALSE}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", 
                                      "mod_coef_uncertainty_mega", run_label, ".pdf"))
```

(ref:caption-endpoint-panel-a) Recultivation ("decay") of abandoned croplands through time, modeled from subsets based on common endpoints, developed in order to make fair comparisons across cohorts. Observations are shown as points, and model decay trends are shown as dashed lines. Mean decay trajectories (shown in red) are calculated across selections of our data subset to four common endpoints (10, 15, 20, and 25 years in columns left to right) at each site, and the full dataset is shown in the rightmost column for comparison (corresponding to Fig. \@ref(fig:decay-model-grid)). These site mean decay trends were used to calculate the endpoint half-lives shown in Figs. \@ref(fig:endpoint-half-lives) and \@ref(fig:endpoint-half-lives-all). This figure shows our first five sites; the final six sites are shown in Fig. \@ref(fig:endpoint-panel-b).

```{r endpoint-panel-a, fig.cap = '(ref:caption-endpoint-panel-a)', fig.width = 7.5}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/",
                                     "endpoints_by_site_5_25_a", 
                                     run_label, ".pdf"))
```

(ref:caption-endpoint-panel-b) Companion figure to Fig. \@ref(fig:endpoint-panel-a). Refer to associated caption to Fig. \@ref(fig:endpoint-panel-a) above.

```{r endpoint-panel-b, fig.cap = '(ref:caption-endpoint-panel-b)', fig.width = 7.5}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/",
                                     "endpoints_by_site_5_25_b", 
                                     run_label, ".pdf"))
```


<!-- (ref:caption-decay-mod-coef-mean) Mean decay model coefficients across cohorts at each site. The left panel shows the mean coefficient on the log(time) terms and the right shows the site mean coefficient on the linear time terms. These mean coefficients are used to plot the mean decay trajectories shown in Fig. 3. -->

<!-- ```{r decay-mod-coef-mean, fig.cap = '(ref:caption-decay-mod-coef-mean)', echo = FALSE} -->
<!-- knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "mean_coef_ci", run_label, ".pdf")) -->
<!-- ``` -->

(ref:caption-diag-combo) Diagnostic plots for our final linear model of the recultivation ("decay") of abandonment across sites. These models take the form shown in Equation \@ref(eq:mod-spec-SI), and are shown in Fig. \@ref(fig:decay-model-grid).

```{r diag-combo, fig.cap = '(ref:caption-diag-combo)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "decay_mod_diagnostics_l3_combo", run_label, ".png"))
```

(ref:caption-rate-of-change-diag-combo) Residuals vs. fitted values (left) and QQ (right) diagnostic plots, for a simple `lm` call corresponding to Eq. \@ref(eq:rate-of-change-lm), in which the half-life (i.e., the time required for 50% of a given cohort of abandoned cropland to be recultivated) is modeled as a function of the year of initial abandonment at each site.

```{r rate-of-change-diag-combo, fig.cap = '(ref:caption-rate-of-change-diag-combo)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "rate_of_change_l3_diag_full_mod", run_label, ".png"))
```

