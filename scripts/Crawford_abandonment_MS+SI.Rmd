---
title: "Rural land abandonment is too ephemeral to provide major benefits for biodiversity and climate"
author:
  - Christopher L. Crawford$^1$^[Corresponding Author, ccrawford@princeton.edu, Robertson Hall, Princeton University, Princeton, NJ]
  - He Yin$^2$
  - Volker C. Radeloff$^3$
  - David S. Wilcove$^{1,4}$
date: 
  $^1$Princeton School of Public and International Affairs, Princeton University, Princeton, NJ\newline 
  $^2$Department of Geography, Kent State University, Kent, OH\newline
  $^3$SILVIS Lab, Department of Forest & Wildlife Ecology, University of Wisconsin - Madison, Madison, WI\newline
  $^4$Department of Ecology & Evolutionary Biology, Princeton University, Princeton, NJ\newline
  \newline
  \today
output:
  bookdown::word_document2:
    reference_docx: /Users/christophercrawford/work/projects/writing/scripts/word_style_ref.docx
    number_sections: false
  bookdown::pdf_document2:
    toc: false
    keep_tex: false
    includes:
      in_header: "preamble.tex"
mainfont: Times New Roman
fontsize: 11pt
# linestretch: 1.25
# documentclass: report
editor_options:
  chunk_output_type: console
bibliography: [/Users/christophercrawford/work/library/library.bib, packages.bib]
link-citations: yes
csl: science-advances.csl
urlcolor: blue
linkcolor: black
citecolor: black
---

```{r load-packages-functions, eval = TRUE, echo = FALSE, include = FALSE}
source("/Users/christophercrawford/work/projects/abandonment_trajectories/scripts/0_start.R")
```

```{r preview-chapter, eval=FALSE, include = FALSE}
# set table format:
my_format <- "simple"
rmarkdown::render("scripts/Crawford_abandonment_MS+SI.Rmd",
                  output_file = 
                    paste0(p_proj, "writing/previews/", "abn_duration_draft",
                           format(Sys.Date(), ("_%Y_%m_%d")), ".docx"),
                  output_format = bookdown::word_document2(
                    reference_docx = "/Users/christophercrawford/work/projects/writing/scripts/word_style_ref.docx",
                    number_sections = FALSE))

# Save final PDF with SI for submission:
my_format <- "latex"
rmarkdown::render("scripts/Crawford_abandonment_MS+SI.Rmd",
                  output_file = paste0(p_proj, "writing/previews/",
                                       "Crawford_abandonment_MS+SI",
                                       format(Sys.Date(), ("_%Y_%m_%d")),".pdf"),
                  output_format = "bookdown::pdf_document2")


# # Save html for troubleshooting:
# rmarkdown::render("scripts/abn_trajectories_ms.Rmd",
#                   output_file = paste0(p_proj, "writing/previews/", "abn_duration_draft_w_SI.html"),
#                   output_format = "bookdown::html_document2")

# bookdown::preview_chapter(
#   input = "abn_trajectories_ms.Rmd",
#   output_format = "bookdown::word_document2",
#   output_file = paste0("abn_duration_draft", format(Sys.Date(), ("_%Y_%m_%d")), ".docx"),
#   output_dir = paste0(p_proj, "writing/previews"),
#   output_options = 
#     list(reference_docx = "/Users/christophercrawford/work/projects/writing/scripts/word_style_ref.docx"),
#   preview = TRUE)
```

```{r set-chunk-opts, include = FALSE}
# set default chunk options
knitr::opts_chunk$set(
  out.width = "1\\textwidth",  # if compiling a pdf, include this option
  # comment = NA,
  # fig.width=6, fig.height=6, 
  echo = FALSE # the code itself will NOT be printed with results
  )

options(knitr.table.format = function() {
  if (knitr::is_latex_output())
    "latex" else "simple"
})
```

```{r produce-package-bib, include = FALSE, echo = FALSE}
# needed_packages
# github_packages
knitr::write_bib(x = c(needed_packages, github_packages), file = 'packages.bib')
# knitr::write_bib(x = c("car"), file = 'extra.bib')

# citation(package = needed_packages[1])

# knitr::write_bib(x = c(needed_packages[c(14)]), file = 'packages_top.bib')
# knitr::write_bib(x = c(needed_packages[3]), file = 'terra.bib')

# 
# needed_packages[1]
# packageDescription(needed_packages[1])
# 
# tinytex::tlmgr_install(
#   # pkgs = "ragged2e"
#   # pkgs = "standalone"
#   pkgs = "preview"
# )
```

```{r load-files, include = FALSE}

# set run: 
run_label # check. See "_util_main.R"


# load general spatial data on site locations --------------------------------------------------- #
site_df <- read.csv(file = paste0(p_dat_derived, "site_df.csv"))
site_df_w_size <- read.csv(file = paste0(p_dat_derived, "site_df_w_size.csv"))
site_sf <- st_read(paste0(p_dat_derived, "sf/site_sf.shp"))


# load all length data (distilled)
length_distill_df <- read_csv(file = paste0(p_derived2, 
                                            "length_distill_df", run_label, ".csv")) %>%
  left_join(site_labels)

# load mean length data
mean_length_df <- read_csv(file = paste0(p_derived2, "mean_length_df", run_label, ".csv")) %>%
  left_join(site_labels)

potential_mean_length_df <- read_csv(file = paste0(p_derived2, "potential_mean_length_df", run_label, ".csv")) %>%
  left_join(site_labels)

mean_recult_length_df <- read_csv(file = paste0(p_derived2, "mean_recult_length_df", run_label, ".csv")) %>%
  left_join(site_labels)





# load summary statistic derived from lengths
summary_stats_all_sites <- read_csv(file = paste0(p_derived2, "summary_stats_all_sites", run_label, ".csv"))
summary_stats_all_sites_pooled <- read_csv(file = paste0(p_derived2, "summary_stats_all_sites_pooled", run_label, ".csv"))

potential_summary_stats_all_sites <- read_csv(file = paste0(p_derived2, "potential_summary_stats_all_sites", run_label, ".csv"))
potential_summary_stats_all_sites_pooled <- read_csv(file = paste0(p_derived2, "potential_summary_stats_all_sites_pooled", run_label, ".csv"))

recult_summary_stats_all_sites <- read_csv(file = paste0(p_derived2, "recult_summary_stats_all_siteS", run_label, ".csv"))
recult_summary_stats_all_sites_pooled <- read_csv(file = paste0(p_derived2, "recult_summary_stats_all_sites_pooled", run_label, ".csv"))


# load area summary stats:
area_summary_df <- read_csv(file = paste0(p_derived2, "area_summary_df", run_label, ".csv")) %>%
  left_join(site_labels)

area_recult_threshold <- 
  read_csv(file = paste0(p_derived2, "area_recult_threshold", run_label, ".csv")) %>%
  left_join(site_labels)



# load stats on proportion of abandoned cropland by land cover
abn_lc_area_2017 <- read_csv(file = paste0(p_derived2, "abn_lc_area_2017", run_label, ".csv")) %>%
  left_join(site_labels)
abn_prop_lc_2017 <- read_csv(file = paste0(p_derived2, "abn_prop_lc_2017", run_label, ".csv")) %>%
  left_join(site_labels)


# load combined persistence, area, and turnover datasets:
# also known as dat_l in "4_decay_models.Rmd"

persistence_dat <- 
  # dat_l <- 
  read_csv(file = paste0(p_derived2, "persistence_dat", run_label, ".csv")) %>%
  mutate(site = as.factor(site),
         bins = as.factor(bins),
         year_abn_bins = as.factor(year_abn_bins),
         cohort = as.factor(cohort))

area_dat <- read_csv(file = paste0(p_derived2, "area_dat", run_label, ".csv"))
turnover_dat <- read_csv(file = paste0(p_derived2, "turnover_dat", run_label, ".csv"))



# load decay rate data

load(file = paste0(p_derived2, "/decay_mod_files", run_label, ".rds"), verbose = TRUE)
load(file = paste0(p_derived2, "/decay_endpoints_files", run_label, ".rds"), verbose = TRUE)

fitted_combo <- fitted_combo %>%
  left_join(site_labels)

# load new extrapolation data:
potential_area_dat <- read_csv(file = paste0(p_derived2, "potential_area_dat", run_label, ".csv"))
potential_persistence_dat <- read_csv(file = paste0(p_derived2, "potential_persistence_dat", run_label, ".csv"))

# load carbon data:
site_carbon_df <- read_csv(file = paste0(p_derived2, "/carbon_df", run_label,".csv")) %>%
  left_join(site_labels)

```

```{r misc-notes, eval = FALSE}
# Authors and Affiliations, formatted to look nice in Word (i.e., nested within the abstract):
# author: Christopher L. Crawford,$^a$$^*$ He Yin,$^b$ Volker C. Radeloff,$^c$ and David S. Wilcove$^{a, d}$
# date: "`r format(Sys.time(), '%B %d, %Y')`"
# abstract: |
#   | $^a$Princeton School of Public and International Affairs, Princeton University, Princeton, NJ
#   | $^b$Department of Geography, Kent State University, Kent, OH
#   | $^c$SILVIS Lab, Department of Forest & Wildlife Ecology, University of Wisconsin - Madison, Madison, WI
#   | $^d$Department of Ecology & Evolutionary Biology, Princeton University, Princeton, NJ
#   |
#   | $^*$Corresponding Author, ccrawford@princeton.edu, Robertson Hall, Princeton University, Princeton, NJ


# the above looks ok in pdf format as well, but "Abstract" shows above the author affiliations. So, here is a pdf-specific method of formatting Authors and affiliations
# author:
#   - Christopher L. Crawford$^1$^[Corresponding Author, ccrawford@princeton.edu, Robertson Hall, Princeton University, Princeton, NJ]
#   - He Yin$^2$
#   - Volker C. Radeloff$^3$
#   - David S. Wilcove$^{1,4}$
# date: 
#   $^1$Princeton School of Public and International Affairs, Princeton University,
#   Princeton, NJ\newline 
#   $^2$Department of Geography, Kent State University, Kent, OH\newline
#   $^3$SILVIS Lab, Department of Forest & Wildlife Ecology, University of Wisconsin - Madison, Madison, WI\newline
#   $^4$Department of Ecology & Evolutionary Biology, Princeton University, Princeton, NJ\newline
#   \newline
#   \today


# --------------------------------------------------
# Miscellaneous YAML
# --------------------------------------------------
# Right after csl:
#   
# nocite: |
#   @RStudio, @R-rmarkdown, @R-bookdown, @R-knitr

# 
# - $^a$Princeton School of Public and International Affairs, Princeton University, Princeton, NJ
# - $^b$Department of Geography, Kent State University, Kent, OH
# - $^c$SILVIS Lab, Department of Forest & Wildlife Ecology, University of Wisconsin - Madison, Madison, WI
# - $^d$Department of Ecology & Evolutionary Biology, Princeton University, Princeton, NJ
# 
# 
#   | $^a$Princeton School of Public and International Affairs, Princeton University, Princeton, NJ
#   | $^b$Department of Geography, Kent State University, Kent, OH
#   | $^c$SILVIS Lab, Department of Forest & Wildlife Ecology, University of Wisconsin - Madison, Madison, WI
#   | $^d$Department of Ecology & Evolutionary Biology, Princeton University, Princeton, NJ
#   |
#   | $^*$Corresponding Author, ccrawford@princeton.edu, Robertson Hall, Princeton University, Princeton, NJ

# date: '`r format(Sys.Date(), "%B %d, %Y")`'
# 
# - Christopher L. Crawford^[Corresponding Author, ccrawford@princeton.edu, Robertson
#   Hall, Princeton University, Princeton, NJ] ^[Princeton University]
# - He Yin^[Kent State University]
# - Volker C. Radeloff^[University of Wisconsin, Madison]
# - David S. Wilcove^[Princeton University]

# author:
# - Christopher L. Crawford^[Corresponding Author, ccrawford@princeton.edu, Robertson Hall, Princeton University, Princeton, NJ] $^1$
# - He Yin$^2$
# - Volker C. Radeloff$^3$
# - David S. Wilcove$^{1, 4}$
# date: 
#   $^1$Princeton School of Public and International Affairs, Princeton University, Princeton, NJ \newline 
#   $^2$Department of Geography, Kent State University, Kent, OH \newline 
#   $^3$SILVIS Lab, Department of Forest & Wildlife Ecology, University of Wisconsin - Madison, Madison, WI \newline 
#   $^4$Department of Ecology & Evolutionary Biology, Princeton University, Princeton, NJ 


# --------------------------------------------------
# rmd-tips
# --------------------------------------------------

# Reference sections by including a tag directly after a header, such as {#section-label}, and then reference in line with the following:
# See Section \@ref(section-label)


# figures:
# this is a chunk for including a pre-existing plot or graphic.
#knitr::include_graphics("/Users/christophercrawford/work/projects/Zambia/agroEcoTradeoff/external/plots/Estes-plots_test.png")

# Figure captions:
# https://bookdown.org/yihui/rmarkdown-cookbook/cross-ref.html

# manually write figure captions outside of chunk with the following
# (ref:caption-label) Figure caption text.

# Chunk options:
# include = FALSE - this means that the code will still be evaluated, but none of the output will be included in the resulting document.

# fig.cap = '(ref:caption-label)' in the chunk options

# cross reference in line with: \@ref(fig:chunk-label) (or eq:label, or tab:label)

# can also include a list of figures by including the following in the YAML
# lof: True
# or, as I currently have it.
# \listoffigures



# Defining custom latex code for the preamble:
# You can include the following as a standalone YAML argument:
# header-includes:
#   - \usepackage[left]{lineno}
#   - \linenumbers
#   - \newcommand{\beginsupplement}{\setcounter{figure}{0} \setcounter{section}{0} \setcounter{table}{0} \setcounter{equation}{0} \renewcommand{\thefigure}{S\arabic{figure}} \renewcommand{\thesection}{S\arabic{section}} \renewcommand{\thetable}{S\arabic{table}} \renewcommand\theequation{S\arabic{equation}}}

# or, you can specify a custom preamble tex document to include, which is what I've done.
```

```{r get-duration-stats, include = FALSE}

# ^[*Note: these summary statistics are calculated based on the mean abandonment duration at each site, and are therefore the mean of means, and the standard deviation of means. The mean standard deviation is now reported in the SI Section @ref(results-si).*]

# ------------------------------------------------------------------- #
# observed abandonment duration stats
# ------------------------------------------------------------------- #
abn_duration_stats <- list(
  mean_of_means_duration = summary_stats_all_sites$mean_of_means %>% round(digits = 2),
  mean_of_sds_duration = summary_stats_all_sites$mean_of_sds %>% round(digits = 2),
  sd_of_mean_duration = summary_stats_all_sites$sd_of_means %>% round(digits = 2),
  
  # extrapolation_low = extrapolate_df_l3 %>% select(site, max_mean_age) %>% unique() %>% arrange(max_mean_age) %>% .$max_mean_age %>% .[1] %>% round(digits = 1),
  # extrapolation_high = extrapolate_df_l3 %>% select(site, max_mean_age) %>% unique() %>% arrange(max_mean_age) %>% .$max_mean_age %>% .[9] %>% round(digits = 1),
  
  duration_min = mean_length_df %>% 
    filter(abn_threshold == 5, length_type == "all") %>% 
    slice_min(mean_duration) %>% 
    select(mean_duration) %>% round(digits = 2) %>% as_vector(),
  
  duration_min_site = mean_length_df %>% 
    filter(abn_threshold == 5, length_type == "all") %>% 
    slice_min(mean_duration) %>% .$site_long,
  
  duration_max = mean_length_df %>% 
    filter(abn_threshold == 5, length_type == "all") %>% 
    slice_max(mean_duration) %>% 
    select(mean_duration) %>% round(digits = 2) %>% as_vector(),
  
  duration_max_site = mean_length_df %>% 
    filter(abn_threshold == 5, length_type == "all") %>% 
    slice_max(mean_duration) %>% .$site_long,
  
  sd_min = mean_length_df %>% filter(abn_threshold == 5, length_type == "all") %>% slice_min(sd_duration) %>% select(sd_duration) %>% round(digits = 2),
  sd_min_site = mean_length_df %>% filter(abn_threshold == 5, length_type == "all") %>% slice_min(sd_duration) %>% .$site_long,
  
  sd_max = mean_length_df %>% filter(abn_threshold == 5, length_type == "all") %>% slice_max(sd_duration) %>% select(sd_duration) %>% round(digits = 2),
  sd_max_site = mean_length_df %>% filter(abn_threshold == 5, length_type == "all") %>% slice_max(sd_duration) %>% .$site_long
)

# ------------------------------------------------------------------- #
# potential abandonment duration stats
# ------------------------------------------------------------------- #
# compare observed vs. potential mean lengths
compare_mean_lengths_df <-
  bind_rows(
  mean_length_df %>% filter(length_type == "all", abn_threshold == "5"),
  potential_mean_length_df %>% filter(length_type == "potential", abn_threshold == "5")) %>%
  pivot_wider(id_cols = c(site, abn_threshold),
              values_from = c(mean_duration#, sd_duration
                              ),
              names_from = length_type) %>%
  rename(observed = all) %>%
  mutate(diff = potential - observed, 
         p_diff = 100 * diff/potential) %>% 
  left_join(site_labels)


potential_abn_duration_stats <- list(
  mean_of_means_duration = potential_summary_stats_all_sites$mean_of_means %>% round(digits = 2),
  mean_of_sds_duration = potential_summary_stats_all_sites$mean_of_sds %>% round(digits = 2),
  sd_of_mean_duration = potential_summary_stats_all_sites$sd_of_means %>% round(digits = 2),
  
  duration_min = potential_mean_length_df %>% 
    filter(abn_threshold == 5, length_type == "potential") %>% 
    slice_min(mean_duration) %>% 
    select(mean_duration) %>% round(digits = 2) %>% as_vector(),
  
  duration_min_site = potential_mean_length_df %>% 
    filter(abn_threshold == 5, length_type == "potential") %>% 
    slice_min(mean_duration) %>% .$site_long,
  
  duration_max = potential_mean_length_df %>% 
    filter(abn_threshold == 5, length_type == "potential") %>% 
    slice_max(mean_duration) %>% 
    select(mean_duration) %>% round(digits = 2) %>% as_vector(),
  
  duration_max_site = potential_mean_length_df %>% 
    filter(abn_threshold == 5, length_type == "potential") %>% 
    slice_max(mean_duration) %>% .$site_long,
  
  sd_min = potential_mean_length_df %>% filter(abn_threshold == 5, length_type == "potential") %>% slice_min(sd_duration) %>% select(sd_duration) %>% round(digits = 2),
  sd_min_site = potential_mean_length_df %>% filter(abn_threshold == 5, length_type == "potential") %>% slice_min(sd_duration) %>% .$site_long,
  
  sd_max = potential_mean_length_df %>% filter(abn_threshold == 5, length_type == "potential") %>% slice_max(sd_duration) %>% select(sd_duration) %>% round(digits = 2),
  sd_max_site = potential_mean_length_df %>% filter(abn_threshold == 5, length_type == "potential") %>% slice_max(sd_duration) %>% .$site_long,
  
  p_diff_min = compare_mean_lengths_df %>%
    slice_min(p_diff) %>% 
    .$p_diff %>% round(digits = 2),
  p_diff_min_site = compare_mean_lengths_df %>%
    slice_min(p_diff) %>% 
    .$site_long,
  
  p_diff_max = compare_mean_lengths_df %>%
    slice_max(p_diff) %>% 
    .$p_diff %>% round(digits = 2),
  p_diff_max_site = compare_mean_lengths_df %>%
    slice_max(p_diff) %>% 
    .$site_long
)


# ------------------------------------------------------------------- #
# recultivation duration statistics:
# ------------------------------------------------------------------- #
recult_duration_stats <- list(
  mean_of_means_duration = recult_summary_stats_all_sites$mean_of_means %>% round(digits = 2) %>% format(nsmall = 2),
  mean_of_sds_duration = recult_summary_stats_all_sites$mean_of_sds %>% round(digits = 2),
  sd_of_mean_duration = recult_summary_stats_all_sites$sd_of_means %>% round(digits = 2),
  
  mean_duration_ceiling = mean_recult_length_df %>% 
    filter(recult_threshold == 1) %>% 
    slice_max(mean_duration, n = 2) %>% 
    slice_min(mean_duration) %>%
    .$mean_duration %>% ceiling(),
  
  mean_duration_ceiling_site = mean_recult_length_df %>% 
    filter(recult_threshold == 1) %>% 
    slice_max(mean_duration, n = 2) %>% 
    slice_min(mean_duration) %>%
    .$site_long,
  
  duration_min = mean_recult_length_df %>% 
    filter(recult_threshold == 1) %>% 
    slice_min(mean_duration) %>% 
    .$mean_duration %>% round(digits = 2),
  
  duration_min_site = mean_recult_length_df %>% 
    filter(recult_threshold == 1) %>% 
    slice_min(mean_duration) %>% .$site_long,
  
  duration_2nd_highest = mean_recult_length_df %>% 
    filter(recult_threshold == 1) %>% 
    slice_max(mean_duration, n = 2) %>% slice_min(mean_duration) %>%
    .$mean_duration %>% round(digits = 2),
  
  duration_2nd_highest_site = mean_recult_length_df %>% 
    filter(recult_threshold == 1) %>% 
    slice_max(mean_duration, n = 2) %>% slice_min(mean_duration) %>%
    .$site_long,
  
  
  duration_max = mean_recult_length_df %>% 
    filter(recult_threshold == 1) %>% 
    slice_max(mean_duration) %>% 
    .$mean_duration %>% round(digits = 2),
  
  duration_max_site = mean_recult_length_df %>% 
    filter(recult_threshold == 1) %>% 
    slice_max(mean_duration) %>% .$site_long,
  
  sd_min = mean_recult_length_df %>% 
    filter(recult_threshold == 1) %>% 
    slice_min(sd_duration) %>% .$sd_duration %>% round(digits = 2),
  
  sd_min_site = mean_recult_length_df %>% 
    filter(recult_threshold == 1) %>% 
    slice_min(sd_duration) %>% .$site_long,
  
  sd_max = mean_recult_length_df %>% 
    filter(recult_threshold == 1) %>% 
    slice_max(sd_duration) %>% select(sd_duration) %>% round(digits = 2),
  sd_max_site = mean_recult_length_df %>% 
    filter(recult_threshold == 1) %>% 
    slice_max(sd_duration) %>% .$site_long
)

mean_recult_length_df %>% 
  filter(recult_threshold == 1) %>% 
  slice_max(mean_duration, n = 2) %>% 
  slice_min(mean_duration) %>%
  .$mean_duration %>% ceiling()
```

```{r potential-v-obs-stats, include = FALSE}
# stats for the potential vs. observed area abandoned and carbon sequestration
# requires

a_df_2017 <- 
  bind_rows(area_dat %>% mutate(type = "Observed"),
          potential_area_dat %>% mutate(type = "Potential")) %>%
  filter(lc %in% c("Abandoned (>=5)"),
         year == 2017
         ) %>%
  pivot_wider(id_cols = c(site, year, lc), 
              names_from = type, names_prefix = "area_ha_",
              values_from = area_ha)
  

c_df_2017 <- site_carbon_df %>% 
  filter(threshold == 5, year == 2017) %>%
  pivot_wider(id_cols = c(site, year), 
              names_from = type, names_prefix = "Mg_C_",
              values_from = total_C_Mg)


# 
potential_v_obs_2017_df <- 
  left_join(a_df_2017, c_df_2017, by = c("site", "year")) %>%
  left_join(site_labels) %>%
  mutate(a_diff = 100 * (area_ha_Potential - area_ha_Observed) / area_ha_Potential,
         c_diff = 100 * (Mg_C_Potential - Mg_C_Observed) / Mg_C_Potential) %>%
  select(-c(lc)) %>%
  arrange(a_diff)



potential_v_obs_stats <- list(
  "min_area_diff" = potential_v_obs_2017_df %>% 
    # filter(site != "mato_grosso") %>% 
    slice_min(a_diff) %>% .$a_diff %>% round(digits = 2),
  "min_area_diff_site" = potential_v_obs_2017_df %>% 
    # filter(site != "mato_grosso") %>% 
    slice_min(a_diff) %>% .$site_long,
  
  "max_area_diff" = potential_v_obs_2017_df %>% 
    # filter(site != "mato_grosso") %>% 
    slice_max(a_diff) %>% .$a_diff %>% round(digits = 2),
  "max_area_diff_site" = potential_v_obs_2017_df %>% 
    # filter(site != "mato_grosso") %>% 
    slice_max(a_diff) %>% .$site_long,
  
  "min_carbon_diff" = potential_v_obs_2017_df %>% 
    # filter(site != "mato_grosso") %>% 
    slice_min(c_diff) %>% .$c_diff %>% round(digits = 2),
  "min_carbon_diff_site" = potential_v_obs_2017_df %>% 
    # filter(site != "mato_grosso") %>% 
    slice_min(c_diff) %>% .$site_long,
  
  "max_carbon_diff" = potential_v_obs_2017_df %>% 
    # filter(site != "mato_grosso") %>% 
    slice_max(c_diff) %>% .$c_diff %>% round(digits = 2),
  "max_carbon_diff_site" = potential_v_obs_2017_df %>% 
    # filter(site != "mato_grosso") %>% 
    slice_max(c_diff) %>% .$site_long
)
```

# Abstract^[word limit is 150; with updates, we are now at 162] {.unnumbered}

Tens of millions of hectares of cropland have been abandoned globally since 1950 due to demographic, economic, and environmental changes.
This abandonment has been seen as a vast opportunity for carbon sequestration and habitat restoration.
However, those environmental benefits depend on the longevity of abandonment, which is poorly known.
Here, we track abandonment and recultivation at eleven sites across four continents using annual land cover maps for 1987 through 2017. 
We find that abandonment is almost always fleeting, lasting on average only `r abn_duration_stats$mean_of_means_duration` years (SD = `r abn_duration_stats$sd_of_mean_duration`).
At most sites, we project that \>50% of abandoned croplands will be recultivated within 30 years, limiting their ability to accumulate substantial amounts of carbon and biodiversity.
Recultivation resulted in `r potential_v_obs_stats$min_area_diff`-`r potential_v_obs_stats$max_area_diff`% less area and `r potential_v_obs_stats$min_carbon_diff`-`r potential_v_obs_stats$max_carbon_diff`% less carbon sequestered in abandoned croplands by 2017 than would have been possible without recultivation.
Unless policymakers take steps to reduce recultivation or provide incentives for regeneration, abandonment will remain a missed opportunity to reduce biodiversity loss and climate change.

<!-- ## Keywords {.unnumbered} -->

<!-- Agriculture, cropland abandonment, agricultural abandonment, farmland abandonment, rural land abandonment, biodiversity conservation, secondary succession, carbon sequestration, land-cover mapping -->

# Short title (max 50 characters) {.unnumbered}
Short-term abandonment limits environmental gains

# Teaser (max 125 characters) {.unnumbered}

Without incentives for restoration, cropland abandonment rarely lasts long enough to yield biodiversity or carbon benefits.

# Introduction {.unnumbered}

Human populations are in flux around the world, as people seek new economic opportunities in cities and flee changing environments and conflicts in rural areas [@Sanderson2018].
Urbanization and rural outmigration, together with environmental degradation and changing agricultural technologies, have reduced the economic viability of many agricultural lands and contributed to a growing global trend of cropland abandonment [@ReyBenayas2007; @Prishchepov2021].
Many analysts have viewed these demographic shifts as creating an opportunity for natural ecosystems to regenerate on abandoned croplands, in the process restoring biodiversity [@Chazdon2020; @Xie2019; @Navarro2012; @Perino2019] and sequestering carbon [@Griscom2017; @Chazdon2016a; @Yang2019].
Although agricultural expansion and deforestation continues to be a dominant, and concerning, trend in many regions [@Potapov2022], increasing levels of abandonment have raised hopes for recovery in some places.
<!-- ~~Given increasing competition for land, abandoned croplands have been targeted for diverse goals such as biofuel production [@Naess2021], carbon sequestration [@Griscom2017; @Chazdon2016a], biodiversity and ecosystem restoration [@Chazdon2020; @Xie2019; @Navarro2012; @Perino2019], or recultivation [@Meyfroidt2016].~~ -->

This opportunity figures prominently in global scenarios of both climate change and biodiversity.
In fact, nearly all climate scenarios in which global warming is limited to 1.5°C rely on substantial amounts of carbon removal, whether through reforestation, afforestation, or bioenergy with carbon capture and storage (BECCS) [@IPCC2018; @Popp2017; @Houghton2018].
Abandoned agricultural lands are seen as ideal places to achieve these carbon removal goals while also avoiding competition with food production, particularly in the context of bioenergy [@Naess2021; @Campbell2008].
Bioenergy production, however, would preclude the potential for biodiversity gains alongside carbon sequestration.
Optimistic scenarios in which biodiversity loss is reversed often rely on forest and grassland regeneration on former agricultural lands [@Henry2019; @Martins2020; @Leclere2020; @Folberth2020].
Agricultural abandonment is also integral to forecasts of “forest transitions,” in which economic development, increasing crop yields, a scarcity of forest products and services, and rural outmigration collectively result in the abandonment of marginal farmlands, allowing a region to transition from net deforestation to net reforestation as regeneration takes place [@Meyfroidt2011; @Rudel2020].

Tens of millions of hectares of agricultural lands have been abandoned since 1950 [@Li2017; @Potapov2022].
Recent estimates from satellite imagery indicate that as much as $115.5\pm24.1$ Mha of gross cropland abandonment took place globally between 2003 and 2019, amidst $217.5\pm37.7$ Mha of gross cropland expansion [@Potapov2022].
Expansion undoubtedly remains the top threat to biodiversity and carbon stocks in natural ecosystems, but the extent to which this expansion is offset by abandonment (as is sometimes assumed when net statistics are reported) depends on its longevity.
While abandonment is predicted to continue in many places, particularly Europe, Russia and Central Asia, East Asia, and North America [@Sanderson2018; @Popp2017; @Leclere2020], for how long and to what end remains unclear.
Moreover, despite recent reforestation in many parts of the world, recent evidence has called the durability of such reforestation into question [@Schwartz2020; @Sloan2022].
Understanding the true potential of cropland abandonment to contribute to biodiversity and climate goals requires detailed information on not only where and when abandonment is taking place, but also on what happens to croplands after they are abandoned.
To produce significant environmental benefits, abandoned lands must stay abandoned long enough to accumulate appreciable amounts of both plant biomass and the species that make up intact ecological communities, a process that can take many decades in order to approach the levels of carbon sequestration or biodiversity typical of intact ecosystems [@Rozendaal2019; @Acevedo-Charry2019; @Isbell2019; @Nerlekar2020; @Gilroy2014; @Cook-Patton2020; @Poorter2016].
Knowing how long abandonment persists for is therefore critical to understanding its potential to help mitigate the ongoing climate and biodiversity crises, yet this question of longevity has received surprisingly little attention from researchers.

Until recently, it has been difficult to gather detailed information on the longevity and long-term trajectories of abandonment.
Many estimates of abandonment are inferred by aggregating regional estimates of cultivation, such as country-level FAO data on cultivated areas, to look for trends over time [@Isbell2019; @Munroe2013].
When derived from satellite imagery, abandonment is most frequently estimated by simply comparing cropland maps for two time points (e.g., 1992 and 2015, ref. [@Naess2021]).
In other cases, maps are made for periods covering multiple years (e.g., four-year epochs, ref. [@Potapov2022]).
Annual land-cover time series are becoming more common, but are typically limited to a few years (e.g., 2-12 years, refs. [@Alcantara2013; @Estel2015; @Lark2015]) or are coarse in resolution (e.g., $\geq250$-m, refs. [@Naess2021; @Estel2015]).
In addition, most analyses have been restricted to a single region [@Dara2018].
These approaches all lack the spatial and temporal detail needed to understand long-term outcomes for abandoned croplands.
Moreover, by failing to capture the dynamic patterns of abandonment and recultivation, scientists may substantially overestimate abandonment and the potential for associated environmental benefits [@Yin2020].

<!-- Empirical evidence for secondary forests in the Neotropics shows that forest regeneration is often short-lived [@Reid2019; @Nunes2020; @Smith2020; @Schwartz2020]. -->
<!-- For example, in the Brazilian Amazon, half of secondary forests were recleared in 5 to 8 years [@Chazdon2016a; @Nunes2020], and in southern Costa Rica in $\leq20$ years [@Reid2019]. -->
<!-- However, estimates based on the growth of woody vegetation miss abandonment in earlier stages of regeneration and in biomes where succession does not lead to woody vegetation [@Yin2020]. -->

Recent advances in remote sensing have made it possible to produce maps of cropland abandonment at both high spatial and temporal resolution.
Yin et al. [-@Yin2020] used a trajectory-based approach to produce accurate maps of annual cropland abandonment at 30-m resolution from 1987 to 2017 (average overall mapping accuracy of $85\pm4$% ^[He, should we also include other accuracy statistics, such as F1, cropland specific or abandonment specific accuracies, etc.?]; see Materials and Methods).
Importantly, this approach did not rely on woody revegetation as a proxy of abandonment, thereby allowing for a direct measurement of abandonment at earlier stages of regeneration and across both forest and non-forest biomes.

Here, we utilize this new time-series [@Yin2020] to quantify the magnitude and persistence of abandonment at eleven sites across four continents (Fig. \@ref(fig:global-map)).
We address four questions: 
(1) How long did abandoned cropland stay abandoned on average during our time series, and how does this vary geographically?
(2) If we model the persistence of abandonment as a decay process as a function of time, how long can we expect abandoned croplands to persist before they are recultivated, and do recultivation (or "decay") rates vary through time and across sites?
(3) How much carbon could accumulate in forest biomass and soil organic carbon in abandoned croplands?
(4) Finally, if abandoned croplands were not recultivated as observed, how much area would remain abandoned and how much carbon could potentially accumulate by the end of our time series?
By making use of more accurate and finer resolution abandonment maps for a longer period and a broader set of sites than previous studies, we provide the most detailed analysis to date of the longevity of cropland abandonment.
Collectively, our results reveal the temporal nature of cropland abandonment and its potential to sequester carbon and conserve biodiversity.

# Results {.unnumbered}

```{r get-results-stats, include = FALSE}
# site_r$shaanxi$y2017
# test_area <- raster::area(site_r$shaanxi$y2017)
# plot(test_area)
# ncell(site_r$shaanxi$y2017)
# ncell(test_area)
# names(test_area) <- "area_km2"
# test_dt <- as.data.table.raster(stack(site_r$shaanxi$y2017, test_area))
# test_dt[,sum(area_km2 * 100), by = y2017]
# 1332.768 + 1021861.526 + 153480.420 + 246237.428+ 151124.082

site_df_w_size # note that this includes NA or 0 lc class cells, so is an overestimate. Use the site area from area_summary_df
area_summary_df %>% names

area_summary_df %>% 
  select(site, area_abn_ha_2017, area_ever_abn_ha, cropland_area_1987, total_crop_extent_ha, total_site_area_ha_2017, 
         area_2017_as_prop_site, area_2017_as_prop_total_crop, area_2017_as_prop_crop87) %>% 
  arrange(area_2017_as_prop_total_crop)

area_summary_df %>% 
  select(site, area_abn_ha_2017, area_ever_abn_ha, cropland_area_1987, total_crop_extent_ha, area_2017_as_prop_total_crop, area_2017_as_prop_crop87) %>% 
  arrange(area_2017_as_prop_total_crop) %>% 
  mutate(prop_crop_total_to_87 = total_crop_extent_ha/cropland_area_1987)


area_summary_df %>% select(site, area_abn_ha_2017, total_site_area_ha_2017, area_2017_as_prop_site) %>% arrange(area_2017_as_prop_site)


# ---------------------------------------------------------------------- #
# area abandoned statistics
area_abn_stats <- list(
  "min" = area_summary_df %>% filter(site != "mato_grosso") %>% slice_min(area_abn_ha_2017) %>% select(area_abn_ha_2017) %>% 
    # as.numeric() %>% 
    prettyNum(big.mark = ","),
  "min_site" = area_summary_df %>% filter(site != "mato_grosso") %>% slice_min(area_abn_ha_2017) %>% .$site_long,
  
  "max" = area_summary_df %>% slice_max(area_abn_ha_2017) %>% select(area_abn_ha_2017) %>% round(digits = 0) %>% as.numeric() %>% prettyNum(big.mark = ","),
  "max_site" = area_summary_df %>% slice_max(area_abn_ha_2017) %>% .$site_long,

  "mg" = area_summary_df %>% filter(site == "mato_grosso") %>% select(area_abn_ha_2017) %>% round(digits = 0) %>% as.numeric() %>% prettyNum(big.mark = ","),
  "mg_abn_2017_as_percent_total_crop" = area_summary_df %>% filter(site == "mato_grosso") %>% select(area_2017_as_prop_total_crop) %>% round(digits = 4) * 100,
  "mg_ever_abn_as_percent_total_crop" = area_summary_df %>% filter(site == "mato_grosso") %>% select(area_ever_abn_as_prop_total_crop) %>% round(digits = 4) * 100,
  
  "total_area_Mha_2017_all_sites" = round(area_summary_df$total_site_area_ha_2017 %>% sum() / 10^6 , digits = 2),
  "total_crop_extent_area_Mha_2017_all_sites" = round(area_summary_df$total_crop_extent_ha %>% sum() / 10^6 , digits = 2) %>% format(nsmall = 2),
  
  "total_area_ever_abn_Mha_all_sites" = round(area_summary_df %>% summarise(total_ever_abn_Mha = sum(area_ever_abn_ha)/1e6), digits = 2),
  "total_area_ever_abn_as_percent_of_total_crop_extent" = round(
    (sum(area_summary_df$area_ever_abn_ha) / sum(area_summary_df$total_crop_extent_ha)), 
    digits = 4) * 100,
  
  "total_crop_area_1987_Mha_all_sites" = round(area_summary_df$cropland_area_1987 %>% sum() / 10^6 , digits = 2),
  "total_area_abn_Mha_2017_all_sites" = round(area_summary_df$area_abn_ha_2017 %>% sum() / 10^6, digits = 2),
  
  "total_area_abn_2017_as_percent_of_total" = round((area_summary_df$area_abn_ha_2017 %>% sum()) / (area_summary_df$total_site_area_ha_2017 %>% sum()), digits = 4) * 100,
  
  "total_area_abn_2017_as_percent_of_crop87" = round(
    (sum(area_summary_df$area_abn_ha_2017) / sum(area_summary_df$cropland_area_1987)), 
    digits = 4) * 100,
  
  "total_area_abn_2017_as_percent_of_total_crop_extent" = round(
    (sum(area_summary_df$area_abn_ha_2017) / sum(area_summary_df$total_crop_extent_ha)), 
    digits = 4) * 100,
  
  # area_2017_as_prop_site
  "min_area_2017_as_prop_site" = area_summary_df %>% 
    filter(site != "mato_grosso") %>% 
    slice_min(area_2017_as_prop_site) %>% 
    select(area_2017_as_prop_site) %>% round(digits = 4) * 100,
  "min_area_2017_as_prop_site_site" =  area_summary_df %>% filter(site != "mato_grosso") %>% slice_min(area_2017_as_prop_site) %>% .$site_long,
  
  "max_area_2017_as_prop_site" = area_summary_df %>% slice_max(area_2017_as_prop_site) %>% select(area_2017_as_prop_site) %>% round(digits = 4) * 100,
  "max_area_2017_as_prop_site_site" = area_summary_df %>% slice_max(area_2017_as_prop_site) %>% .$site_long,
  
  # area_2017_as_prop_total_crop
  "min_area_2017_as_prop_total_crop" = area_summary_df %>% 
    filter(site != "mato_grosso") %>%
    slice_min(area_2017_as_prop_total_crop) %>% 
    select(area_2017_as_prop_total_crop) %>% round(digits = 4) * 100,
  "min_area_2017_as_prop_total_crop_site" =  area_summary_df %>% 
    filter(site != "mato_grosso") %>%
    slice_min(area_2017_as_prop_total_crop) %>% .$site_long,
  
  "max_area_2017_as_prop_total_crop" = area_summary_df %>% 
    slice_max(area_2017_as_prop_total_crop) %>% 
    select(area_2017_as_prop_total_crop) %>% round(digits = 4) * 100,
  "max_area_2017_as_prop_total_crop_site" = area_summary_df %>% slice_max(area_2017_as_prop_total_crop) %>% .$site_long,
  

  # area_ever_abn_as_prop_total_crop
  "min_area_ever_abn_as_prop_total_crop" = area_summary_df %>% filter(site != "mato_grosso") %>% slice_min(area_ever_abn_as_prop_total_crop) %>% select(area_ever_abn_as_prop_total_crop) %>% round(digits = 4) * 100,
  "min_area_ever_abn_as_prop_total_crop_site" =  area_summary_df %>% filter(site != "mato_grosso") %>% slice_min(area_ever_abn_as_prop_total_crop) %>% .$site_long,
  
  "max_area_ever_abn_as_prop_total_crop" = area_summary_df %>% slice_max(area_ever_abn_as_prop_total_crop) %>% select(area_ever_abn_as_prop_total_crop) %>% round(digits = 4) * 100,
  "max_area_ever_abn_as_prop_total_crop_site" = area_summary_df %>% slice_max(area_ever_abn_as_prop_total_crop) %>% .$site_long
)


# ---------------------------------------------------------------------- #
# land cover stats --------------------- #
lc_stats <- list(
  forest_min = abn_prop_lc_2017 %>% 
    filter(lc_2017 == 2) %>% slice_min(prop_lc_area_ha) %>% 
    select(prop_lc_area_ha) %>% round(digits = 2) * 100,
  
  forest_min_grassland = (1 - abn_prop_lc_2017 %>% 
                     filter(lc_2017 == 2) %>% slice_min(prop_lc_area_ha) %>% 
                     select(prop_lc_area_ha) %>% round(digits = 2)) * 100,
  
  forest_min_site = abn_prop_lc_2017 %>% 
    filter(lc_2017 == 2) %>% slice_min(prop_lc_area_ha) %>% .$site_long,
  
  forest_max = abn_prop_lc_2017 %>% 
    filter(lc_2017 == 2) %>% slice_max(prop_lc_area_ha) %>% 
    select(prop_lc_area_ha) %>% round(digits = 2) * 100,
  
  forest_max_grassland = (1 - abn_prop_lc_2017 %>% 
                         filter(lc_2017 == 2) %>% slice_max(prop_lc_area_ha) %>% 
                         select(prop_lc_area_ha) %>% round(digits = 2)) * 100,
  
  forest_max_site = abn_prop_lc_2017 %>% filter(lc_2017 == 2) %>% slice_max(prop_lc_area_ha) %>% .$site_long
  )
```
```{r recultivation-stats, include = FALSE}

area_recult_threshold # this data.frame includes the total area abandoned in 2017, the total cumulative
potential_v_obs_2017_df %>% arrange(site) %>% select(site, area_ha_Observed, area_ha_Potential) 

# The potential area in 2017 is the same as the area ever abandoned (area_ever_abn_ha).
# Both of these numbers are smaller than area_recult_threshold$total_initial_area_abn because this is the sum of
# each new group of abandonment, and some pixels can be abandoned (and recultivated) multiple times.

names(area_summary_df)
area_summary_df %>% select(site, area_ever_abn_ha)
area_recult_threshold %>% filter(abn_threshold == 5) %>% 
  select(site_long, proportion_recultivated) %>% arrange(proportion_recultivated)
# ---------------------------------------------------------------------- #

# recultivation statistics
recult_stats <- list(
  "mean_thr_5" = area_recult_threshold %>% group_by(abn_threshold) %>% 
    summarise(mean_proportion = mean(proportion_recultivated),
              sd_proportion = sd(proportion_recultivated)) %>% 
    filter(abn_threshold == 5) %>% select(mean_proportion) %>% round(digits = 4) * 100,
  
  "sd_thr_5" = area_recult_threshold %>% group_by(abn_threshold) %>% 
    summarise(mean_proportion = mean(proportion_recultivated),
              sd_proportion = sd(proportion_recultivated)) %>% 
    filter(abn_threshold == 5) %>% select(sd_proportion) %>% round(digits = 4) * 100,
  
  "mean_thr_7" = area_recult_threshold %>% group_by(abn_threshold) %>% 
    summarise(mean_proportion = mean(proportion_recultivated)) %>% 
    filter(abn_threshold == 7) %>% select(mean_proportion) %>% round(digits = 4) * 100,
  
  "mean_thr_10" = area_recult_threshold %>% group_by(abn_threshold) %>% 
    summarise(mean_proportion = mean(proportion_recultivated)) %>% 
    filter(abn_threshold == 10) %>% select(mean_proportion) %>% round(digits = 4) * 100,
  
  "min_5" = area_recult_threshold %>% filter(abn_threshold == 5) %>% slice_min(proportion_recultivated) %>% .$proportion_recultivated %>% round(digits = 4) * 100,
  "min_5_site" = area_recult_threshold %>% filter(abn_threshold == 5) %>% slice_min(proportion_recultivated) %>% .$site_long,
  
  "max_5" = area_recult_threshold %>% filter(abn_threshold == 5, site != "mato_grosso") %>% slice_max(proportion_recultivated) %>% .$proportion_recultivated %>% round(digits = 4) * 100,
  "max_5_site" = area_recult_threshold %>% filter(abn_threshold == 5, site != "mato_grosso") %>% slice_max(proportion_recultivated) %>% .$site_long,
  
  "min_10" = area_recult_threshold %>% filter(abn_threshold == 10) %>% slice_min(proportion_recultivated) %>% .$proportion_recultivated %>% round(digits = 4) * 100,
  "min_10_site" = area_recult_threshold %>% filter(abn_threshold == 10) %>% slice_min(proportion_recultivated) %>% .$site_long,
  
  "max_10" = area_recult_threshold %>% filter(abn_threshold == 10, site != "mato_grosso") %>% slice_max(proportion_recultivated) %>% .$proportion_recultivated %>% round(digits = 4) * 100,
  "max_10_site" = area_recult_threshold %>% filter(abn_threshold == 10, site != "mato_grosso") %>% slice_max(proportion_recultivated) %>% .$site_long

)

area_recult_threshold %>% filter(abn_threshold == 5)

mean_recult_length_df %>% filter(recult_threshold == 1)


abn_duration_stats # see "get-duration-stats"
recult_duration_stats
```

```{r get-decay-stats, include = FALSE}

# ------------------------------------------------ #

endpoint_half_lives_10_25_tmp <- 
  endpoint_half_lives %>%
  left_join(site_labels) %>%
  filter(endpoint <= 25, endpoint >= 10)

endpoint_half_lives %>%
  filter(
    # !grepl("bosnia", site), 
    # endpoint <= 25, endpoint >= 10
    ) %>%
  .$mean %>% summary() %>%
  as.vector() %>%
    tibble(cols = c("Min.", "1st Qu.", "Median", "Mean", "3rd Qu.", "Max."),
           value = .)

tmp_all <- endpoint_half_lives %>%
  filter(
    # !grepl("bosnia", site), 
    # endpoint <= 25, endpoint >= 10
    ) %>%
  .$mean %>% summary() %>%
  as.vector() %>%
    tibble(cols = c("Min.", "1st Qu.", "Median", "Mean", "3rd Qu.", "Max."),
           value = .)

tmp_1 <- endpoint_half_lives %>%
  filter(
    # !grepl("bosnia", site),
    endpoint <= 25, endpoint >= 10
    ) %>%
  .$mean %>% summary() %>%
  as.vector() %>%
    tibble(cols = c("Min.", "1st Qu.", "Median", "Mean", "3rd Qu.", "Max."),
           value = .)
tmp_2 <- endpoint_half_lives %>%
  filter(
    !grepl("bosnia", site),
    endpoint <= 25, endpoint >= 10
    ) %>%
  .$mean %>% summary() %>%
  as.vector() %>%
    tibble(cols = c("Min.", "1st Qu.", "Median", "Mean", "3rd Qu.", "Max."),
           value = .)

tmp_2 %>% mutate(paste = paste0(cols, ": ", round(value, digits = 2))) %>%
  .$paste %>% cat(sep = ", ")

names(endpoint_half_lives %>%
    filter(site == i) %>%
    .$mean %>%
    summary())


endpoints_summary_tmp <- lapply(site_df$site, function(i) {
  endpoint_half_lives %>%
    filter(site == i) %>%
    .$mean %>%
    summary() %>% as.vector() %>%
    as_tibble() %>% 
    mutate(cols = c("Min.", "1st Qu.", "Median", "Mean", "3rd Qu.", "Max."),
           site = i)
  }
  ) %>% bind_rows()

endpoints_summary_tmp %>%
  filter(cols == "Median")
  
endpoint_half_lives %>%
  filter(site == site_df$site[i]) %>%
  summary(mean)

decay_stats <- list(
  "hl_mean" = endpoint_half_lives %>%
    filter(!grepl("bosnia", site), 
           endpoint <= 25, endpoint >= 10) %>%
    .$mean %>% mean() %>% round(digits = 2),
  "hl_sd" = endpoint_half_lives %>%
    filter(!grepl("bosnia", site), 
           endpoint <= 25, endpoint >= 10) %>%
    .$mean %>% sd() %>% round(digits = 2),
  
  "hl_min" = endpoint_half_lives_10_25_tmp %>%
    filter(!grepl("bosnia", site)) %>%
    .$mean %>% min() %>% round(digits = 2),
  "hl_max" = endpoint_half_lives_10_25_tmp %>%
    filter(!grepl("bosnia", site)) %>%
    .$mean %>% max() %>% round(digits = 2),
  
  "hl_q1" = endpoint_half_lives_10_25_tmp %>%
    filter(!grepl("bosnia", site)) %>%
    .$mean %>% quantile(probs = 0.25) %>% round(digits = 2),
  
  "hl_q3" = endpoint_half_lives_10_25_tmp %>%
    filter(!grepl("bosnia", site)) %>%
    .$mean %>% quantile(probs = 0.75) %>% round(digits = 2),
  
  "t0.5_min" = endpoint_half_lives_10_25_tmp %>%
    slice_min(mean) %>% .$mean %>% floor(),
  "t0.5_max" = endpoint_half_lives_10_25_tmp %>%
    filter(!grepl("bosnia", site)) %>%
    slice_max(mean) %>% .$mean %>% ceiling(),
  
  "t0.5_min_site" = endpoint_half_lives_10_25_tmp %>%
    slice_min(mean) %>% .$site_long,
  "t0.5_max_site" = endpoint_half_lives_10_25_tmp %>%
    filter(!grepl("bosnia", site)) %>%
    slice_max(mean) %>% .$site_long
)

# ---------------------------------------------------------------------- #
# simple scenario without recultivation
sum(potential_v_obs_2017_df$area_ha_Observed) / 
  sum(potential_v_obs_2017_df$area_ha_Potential)
```

```{r carbon-stats, include = FALSE}

carbon_tmp <-
  potential_v_obs_2017_df %>%
  mutate(MgC_per_ha_Observed = Mg_C_Observed / area_ha_Observed,
         MgC_per_ha_Potential = Mg_C_Potential / area_ha_Potential) %>%
  arrange(MgC_per_ha_Observed) %>%
  select(site, site_long, MgC_per_ha_Observed, MgC_per_ha_Potential)
# 
# carbon_tmp
# carbon_tmp %>% filter(MgC_per_ha_Observed < 4) %>% .$site_long %>% paste0(collapse = "; ")
# 
# carbon_tmp %>% filter(site == "goias") %>% .$MgC_per_ha_Observed %>% round(digits = 2)
# 
# endpoint_half_lives %>%
#   arrange(desc(mean)) %>% print (n =40)
# 
# potential_v_obs_2017_df %>%
#   select(-c(site, site_long)) %>%
#   as.matrix() %>%
#   colSums(., dims = 1)/10^6
# 
# potential_v_obs_2017_df %>%
#   summarise(total_area = sum(area_ha_Observed),
#              total_MgC = sum(Mg_C_Observed)) %>%
#   mutate(MgC_per_ha = total_MgC / total_area) %>%
#   .$total_MgC / 10^6
# 
# round(100* sum(potential_v_obs_2017_df$Mg_C_Observed) / sum(potential_v_obs_2017_df$Mg_C_Potential), digits = 2)
# potential_v_obs_2017_df

carbon_stats <- list(
  "total_observed" = round(sum(potential_v_obs_2017_df$Mg_C_Observed) / 10^6, digits = 2),
  "total_potential" = round(sum(potential_v_obs_2017_df$Mg_C_Potential) / 10^6, digits = 2),
  "total_diff" = round(100* sum(potential_v_obs_2017_df$Mg_C_Observed) /
                         sum(potential_v_obs_2017_df$Mg_C_Potential), digits = 2),

  "MgC_grass_min" = carbon_tmp %>% filter(MgC_per_ha_Observed < 9) %>% slice_min(MgC_per_ha_Observed) %>% .$MgC_per_ha_Observed %>% round(digits = 2),
  
  "MgC_grass_max" = carbon_tmp %>% filter(MgC_per_ha_Observed < 9) %>% slice_max(MgC_per_ha_Observed) %>% .$MgC_per_ha_Observed %>% round(digits = 2),
  
  "MgC_for_min" = carbon_tmp %>% filter(MgC_per_ha_Observed > 10) %>% slice_min(MgC_per_ha_Observed) %>% .$MgC_per_ha_Observed %>% round(digits = 2),
  
  "MgC_for_max" = carbon_tmp %>% filter(MgC_per_ha_Observed > 10) %>% slice_max(MgC_per_ha_Observed) %>% .$MgC_per_ha_Observed %>% round(digits = 2)
)
```

```{r load-2yr-diff, include = FALSE}
abn_2yr_overestimation <- 
  read_csv(file = paste0(p_derived2, 
                         "abn_2yr_overestimation", run_label, ".csv")) %>%  
  arrange(percent_diff) %>% 
  left_join(., site_df %>% select(site, description), by = "site") %>%
  left_join(site_labels)

prettyNum(round(abn_2yr_overestimation %>% group_by() %>% summarise("sum" = sum(area_2yr)) %>% as.numeric() / 10^6, digits = 2), digits = 2, format = "f")
format(round(abn_2yr_overestimation %>% group_by() %>% summarise("sum" = sum(area_2yr)) %>% as.numeric() / 10^6, digits = 2), nsmall = 2)


abn_2yr_stats <- list(
  total_area_abn_Mha = round(abn_2yr_overestimation %>% group_by() %>% summarise("sum" = sum(area_2yr)) %>% as.numeric() / 10^6, digits = 2),
  low_percent = round(abn_2yr_overestimation %>% slice_min(percent_diff) %>% .$percent_diff, digits = 2),
  high_percent = round(abn_2yr_overestimation %>% slice_max(percent_diff) %>% .$percent_diff, digits = 2),
  
  low_p_site = abn_2yr_overestimation %>% slice_min(percent_diff) %>% .$site_long,
  high_p_site = abn_2yr_overestimation %>% slice_max(percent_diff) %>% .$site_long,
  
  jaccard_low = round(abn_2yr_overestimation %>% slice_min(jaccard) %>% .$jaccard, digits = 4) * 100,
  jaccard_high = round(abn_2yr_overestimation %>% slice_max(jaccard) %>% .$jaccard, digits = 4) * 100,
  
  jaccard_low_site = abn_2yr_overestimation %>% slice_min(jaccard) %>% .$site_long,
  jaccard_high_site = abn_2yr_overestimation %>% slice_max(jaccard) %>% .$site_long,
  
  percent_area_below_5_low = round(abn_2yr_overestimation %>% filter(site != "mato_grosso") %>% slice_min(percent_2yr_abn_area_less_than_5yrs_old) %>% .$percent_2yr_abn_area_less_than_5yrs_old, digits = 2),
  percent_area_below_5_high = round(abn_2yr_overestimation %>% filter(site != "mato_grosso") %>% slice_max(percent_2yr_abn_area_less_than_5yrs_old) %>% .$percent_2yr_abn_area_less_than_5yrs_old, digits = 2),
  
  percent_area_below_5_low_site = abn_2yr_overestimation %>% filter(site != "mato_grosso") %>% slice_min(percent_2yr_abn_area_less_than_5yrs_old) %>% .$site_long,
  percent_area_below_5_high_site = abn_2yr_overestimation %>% slice_max(percent_2yr_abn_area_less_than_5yrs_old) %>% .$site_long
  
)


abn_2yr_overestimation_char <- abn_2yr_overestimation %>%
  mutate(jaccard = jaccard %>% round(digits = 2), 
         area_ha_cc = area_ha_cc %>% round(digits = 0) %>% prettyNum(big.mark = ","),
         area_2yr = area_2yr %>% round(digits = 0) %>% prettyNum(big.mark = ","),
         percent_diff = percent_diff %>% round(digits = 2) %>% paste0(., "%"),
         percent_2yr_abn_area_less_than_5yrs_old = percent_2yr_abn_area_less_than_5yrs_old %>%
           round(digits = 2) %>% paste0(., "%"))
```

## Abandonment duration {.unnumbered}

Cropland abandonment was widespread across our eleven study sites (Fig. \@ref(fig:maps-abn-duration)).
We found that `r area_abn_stats$total_area_ever_abn_Mha_all_sites` million ha (Mha) of croplands were abandoned at least once between 1987 and 2017 across our eleven sites (Figs. \@ref(fig:area-abn-by-age-class) and \@ref(fig:maps-max-abn-duration)^[Note: these figure numbers will be updated in final version to read "Fig. S..."]).
(To exclude normal fallow periods, we only classify croplands as "abandoned" when they have not been cultivated for at least five years in a row; see Materials and Methods.)
This corresponds to `r area_abn_stats$total_area_ever_abn_as_percent_of_total_crop_extent`% of the total cropland extent of `r area_abn_stats$total_crop_extent_area_Mha_2017_all_sites` Mha across our sites (i.e., all lands that were cultivated at some point during the time series; see Table \@ref(tab:abn-panel-table)).
At individual sites, the area of cropland abandoned at least once ranged from `r area_abn_stats$min_area_ever_abn_as_prop_total_crop`% (`r area_abn_stats$min_area_ever_abn_as_prop_total_crop_site`) to `r area_abn_stats$max_area_ever_abn_as_prop_total_crop`% (`r area_abn_stats$max_area_ever_abn_as_prop_total_crop_site`) of the total cropland extent (Figs. \@ref(fig:area-abn-by-age-class) and \@ref(fig:area-abn-panel), Table \@ref(tab:abn-panel-table)), except for Mato Grosso, Brazil, where only `r area_abn_stats$mg_ever_abn_as_percent_total_crop`% was abandoned at least once.
(Given that land use trends in Mato Grosso were dominated by expansion, not abandonment, we exclude this site from the general results reported throughout, unless otherwise noted; see detailed results in Section \@ref(mato-grosso).)

However, we also found that many of these abandoned croplands were recultivated: on average, `r recult_stats$mean_thr_5`% of abandoned area at each site had been recultivated by 2017 (SD = `r recult_stats$sd_thr_5`%; Fig. \@ref(fig:recult-by-threshold)).
In fact, only `r area_abn_stats$total_area_abn_Mha_2017_all_sites` Mha of croplands remained abandoned as of 2017 across our sites (Figs. \@ref(fig:maps-abn-duration) and \@ref(fig:area-abn-by-age-class)), or only `r round(100* sum(potential_v_obs_2017_df$area_ha_Observed) / sum(potential_v_obs_2017_df$area_ha_Potential), digits = 2)`% of the area abandoned at least once during the time series (in other words, the potential area abandoned in 2017 in a scenario without recultivation).
Recultivation had a varied impact across sites, with reductions in total area abandoned by 2017 compared to this potential area ranging from `r potential_v_obs_stats$min_area_diff`% (`r potential_v_obs_stats$min_area_diff_site`) to `r potential_v_obs_stats$max_area_diff`% (`r potential_v_obs_stats$max_area_diff_site`) (see Figs. \@ref(fig:area-abn-by-age-class) and \@ref(fig:potential-area-bins)).
The share of total cropland abandoned also declined by 2017, corresponding to `r area_abn_stats$total_area_abn_2017_as_percent_of_total_crop_extent`% of total cropland extent overall and ranging from `r area_abn_stats$min_area_2017_as_prop_total_crop`% (`r area_abn_stats$min_area_2017_as_prop_total_crop_site`) to `r area_abn_stats$max_area_2017_as_prop_total_crop`% (`r area_abn_stats$max_area_2017_as_prop_total_crop_site`) at individual sites.

As a result of this recultivation, the mean duration of abandonment across all sites was short: `r abn_duration_stats$mean_of_means_duration` years (SD = `r abn_duration_stats$sd_of_mean_duration`), ranging from `r abn_duration_stats$duration_min` (`r abn_duration_stats$duration_min_site`) to `r abn_duration_stats$duration_max` years (`r abn_duration_stats$duration_max_site`; Fig. \@ref(fig:mean-abn-duration)).
For comparison, these observed mean abandonment durations were much shorter than then potential durations in our scenario without recultivation, which reached `r potential_abn_duration_stats$mean_of_means_duration` years (SD = `r potential_abn_duration_stats$sd_of_mean_duration`) on average across all sites, ranging from `r potential_abn_duration_stats$duration_min %>% format(nsmall = 2)` (`r potential_abn_duration_stats$duration_min_site`) to `r potential_abn_duration_stats$duration_max` years (`r potential_abn_duration_stats$duration_max_site`; Fig. \@ref(fig:mean-potential-abn-duration)).
Compared to their potential values, our observed mean durations declined by between `r potential_abn_duration_stats$p_diff_min`% (`r potential_abn_duration_stats$p_diff_min_site`) and `r potential_abn_duration_stats$p_diff_max`% (`r potential_abn_duration_stats$p_diff_max_site`).
Observed abandonment duration also varied substantially within sites, with individual site standard deviations ranging from `r abn_duration_stats$sd_min` (`r abn_duration_stats$sd_min_site`) to `r abn_duration_stats$sd_max` years (`r abn_duration_stats$sd_max_site`), for an average of `r abn_duration_stats$mean_of_sds_duration` years across all sites.
We also found that recultivation at most sites was usually short-term, lasting `r recult_duration_stats$mean_of_means_duration` years on average (SD = `r recult_duration_stats$sd_of_mean_duration`).
`r recult_duration_stats$duration_max_site`, which experienced more permanent recultivation, was the only site that had a mean recultivation length of more than `r recult_duration_stats$mean_duration_ceiling` years (`r recult_duration_stats$duration_max` years on average); recultivation at the remaining sites lasted between `r recult_duration_stats$duration_min` and `r recult_duration_stats$duration_2nd_highest` years; see Fig. \@ref(fig:mean-recult-duration)).

## Estimated carbon sequestration in abandoned croplands {.unnumbered}

Using recently published maps of potential carbon sequestration in forest biomass and soil organic carbon, we estimated the total carbon that could accumulate in abandoned croplands as a function of their age and biome (Fig. \@ref(fig:carbon-over-time), Table \@ref(tab:carbon-table)).
We estimated a total carbon accumulation of `r carbon_stats$total_observed` Tg C ($10^{12}$ g C, or $10^{6}$ tons C) total across our 11 sites by 2017.
However, this was only `r carbon_stats$total_diff`% of the `r carbon_stats$total_potential` Tg C that could have accumulated in our scenario without recultivation.
At individual sites, recultivation reduced estimated carbon accumulation by between `r potential_v_obs_stats$min_carbon_diff`% and `r potential_v_obs_stats$max_carbon_diff`% by 2017 (Fig. \@ref(fig:carbon-over-time)).

Carbon sequestration potential was not equally distributed across our sites (Figs. \@ref(fig:carbon-map-2017-observed)-\@ref(fig:carbon-map-2017-potential)), due partially to differences between sites in the age distribution of abandoned croplands, but more substantially to differences between forest and non-forest biomes (Figs. \@ref(fig:site-biomes)-\@ref(fig:site-ecoregions); annual carbon accumulation rates are shown in Figs. \@ref(fig:carbon-map-Y20-rate)-\@ref(fig:carbon-map-YSS-rate)).
Sites in largely non-forest biomes (`r carbon_tmp %>% filter(MgC_per_ha_Observed < 4) %>% .$site_long %>% paste0(collapse = "; ")`) accumulated much less carbon per hectare by 2017 (<3.50 Mg C per ha, on average) than sites in forest biomes (`r carbon_tmp %>% filter(MgC_per_ha_Observed > 10) %>% .$site_long %>% paste0(collapse = "; ")`), which accumulated `r carbon_stats$MgC_for_min` - `r carbon_stats$MgC_for_max` Mg C per ha on average (Table \@ref(tab:carbon-table), Fig \@ref(fig:carbon-per-ha)).
Goiás, Brazil, which is mostly tropical grassland, savanna, and shrubland, but with a small area in forest, had intermediate carbon accumulation per ha, at `r carbon_tmp %>% filter(site == "goias") %>% .$MgC_per_ha_Observed %>% round(digits = 2)` Mg C per ha on average (Table \@ref(tab:carbon-table), Fig \@ref(fig:carbon-per-ha)).

## Modeling abandonment recultivation as decay {.unnumbered}

To better understand recultivation, we developed models to predict how long a given pixel of abandoned cropland will remain abandoned before it is recultivated, regardless of when it was abandoned during the time series.
To do so, we defined a cohort of abandoned cropland as all cropland abandoned in a given year at a given site.
We modeled the proportion of each cohort remaining abandoned at each site as a function of time since initial abandonment (see Materials and Methods, Fig. \@ref(fig:decay-model-grid)).
Given that some abandonment periods are inherently limited by the length of our time series (i.e., some cropland may remain abandoned beyond the three decades covered by our data), tracking recultivation rates by year abandoned provides a more accurate estimate of persistence than simply relying on the mean duration of abandonment at each site.
These models also allow us to explore how recultivation rates changed through time at each site, and calculate mean recultivation (or "decay") trajectories to compare across sites (see Materials and Methods).

Our models show that recultivation occurred quickly: we predict that >50% of abandoned croplands will be recultivated within 30 years of initial abandonment at almost all sites (Fig. \@ref(fig:endpoint-half-lives)).
At all sites except Bosnia & Herzegovina, the half-life (defined as the time required for half of the croplands abandoned in a given year to be recultivated) ranged from `r decay_stats$t0.5_min` to `r decay_stats$t0.5_max` years for endpoints between 10 and 25 years (mean $\pm$ sd: `r decay_stats$hl_mean` $\pm$ `r decay_stats$hl_sd` years).
Interestingly, these half-lives were relatively consistent regardless of how widespread abandonment was at each site (as shown in Fig. \@ref(fig:quadrant), which shows half-lives as a function of proportion of cropland abandoned as of 2017). 
Bosnia & Herzegovina was a notable exception; here, our models predicted much longer half-lives, greater than 50 years for endpoints of 16 years or longer (Figs. \@ref(fig:endpoint-half-lives) and \@ref(fig:endpoint-half-lives-all)).
This is apparent in Fig. \@ref(fig:decay-model-grid), which shows that early cohorts of abandonment in Bosnia & Herzegovina were remarkably durable, declining much more slowly than more recent cohorts.
Shaanxi/Shanxi, China, also showed relatively more durable abandonment than other sites, with half-lives between `r filter(endpoint_half_lives, grepl("shaanxi", site))$mean %>% min() %>% round(digits = 2)`-`r filter(endpoint_half_lives, grepl("shaanxi", site))$mean %>% max() %>% round(digits = 2)` years for all endpoints we considered.

In modeling recultivation for each abandonment cohort, we also investigated whether recultivation of abandoned cropland accelerated.
Many sites showed decay trajectories growing steeper over time (Fig. \@ref(fig:decay-model-grid)), indicating that abandoned croplands were being recultivated more quickly in more recent years.
This is also apparent in Fig. \@ref(fig:endpoint-half-lives), which shows the half-live declining for shorter endpoints, which incorporate more recent cohorts to a greater extent.
This pattern was strongest in Bosnia & Herzegovina: a linear regression on the half-life confirmed that Bosnia & Herzegovina was the only site to show a statistically significant and negative rate of change in half-life (Fig. \@ref(fig:decay-rate-of-change)).

## Comparing approaches to measuring abandonment {.unnumbered}

Estimates of abandonment based on just two points in time (e.g., 83 Mha estimated in ref. [@Naess2021]) may underestimate abandonment by excluding any new cultivation and subsequent abandonment that takes place between the chosen time points.
More importantly, these two-year estimates (along with estimates from short time series) almost certainly overestimate the amount of persistent abandonment, due to both a failure to exclude short-term fallow periods, and, as our analysis shows, high rates of recultivation.
When estimating abandonment at our sites based on cultivation in two points in time (1987 and 2017), we find `r format(abn_2yr_stats$total_area_abn_Mha, nsmall = 2)` Mha of "abandonment," a `r  round((area_abn_stats$total_area_abn_Mha_2017_all_sites - abn_2yr_stats$total_area_abn_Mha) / area_abn_stats$total_area_abn_Mha_2017_all_sites, digits = 4) * 100`% underestimate compared to the `r area_abn_stats$total_area_abn_Mha_2017_all_sites` Mha of abandonment as of 2017 observed using our full annual time series.
This corresponds to site-level estimates that ranged from `r abs(abn_2yr_stats$low_percent)`% less (`r abn_2yr_stats$low_p_site`) to `r abn_2yr_stats$high_percent`% more (`r abn_2yr_stats$high_p_site`) area abandoned than the area identified using the full time series.
<!--Double check that this is still MG: `r abn_2yr_stats$high_p_site` -->
Importantly, however, this "abandonment" incorporated many croplands that had been abandoned for less than five years and therefore did not meet our definition of abandonment (ranging from `r abn_2yr_stats$percent_area_below_5_low`% to `r abn_2yr_stats$percent_area_below_5_high`% of area at all sites except Mato Grosso; see Table \@ref(tab:twoyr-diff-table)). 
Moreover, the two-year assessments identify different areas of abandonment from those derived from our full annual time series, with spatial agreement ranging from `r abn_2yr_stats$jaccard_low`% (`r abn_2yr_stats$jaccard_low_site`) to `r abn_2yr_stats$jaccard_high`% (`r abn_2yr_stats$jaccard_high_site`) (see Table \@ref(tab:twoyr-diff-table), Section \@ref(twoyr-vs-annual)).


# Discussion {.unnumbered}

Using a new annual land-cover times series, we uncovered high levels of abandonment across eleven sites in diverse biomes on four continents (Fig. \@ref(fig:maps-abn-duration)). 
However, by tracking abandonment from year to year, we showed that a large portion of this abandonment was recultivated by 2017 (Fig. \@ref(fig:area-abn-by-age-class)), and was on the whole relatively short-lived (Fig. \@ref(fig:mean-abn-duration)). 
More concerningly, by modeling recultivation as a function of the time since initial abandonment, we estimate that half of the croplands abandoned in a given year will be recultivated within 10-30 years at almost all of our sites (Fig. 7).
Our modeled decay rates portray a dynamic process, where abandonment is rarely a final stage but rather part of a cycle of turnover on decadal timescales [@Munroe2013].
Even the sites with the most persistent abandonment are unlikely to retain large areas of croplands abandoned continuously for $\geq50$ years, with substantial ramifications for the potential abandonment holds as an environmental opportunity.^[Condensed in an effort to reduce redundancy in this first section.]

<!-- Using a new annual land-cover time series, we found substantial amounts of cropland abandonment from 1987 to 2017 in eleven sites on four continents: `r area_abn_stats$total_area_ever_abn_as_percent_of_total_crop_extent`% of all lands that were cultivated during our time series were abandoned at least once between 1987 and 2017. -->
<!-- However, we also found substantial amounts of recultivation, so that only `r area_abn_stats$total_area_abn_2017_as_percent_of_total_crop_extent`% of total cropland remained in an abandoned state as of 2017. -->
<!-- On average, abandonment lasted less than `r ceiling(abn_duration_stats$mean_of_means_duration)` years, and `r recult_stats$mean_thr_5`% of abandoned croplands had been recultivated by 2017. -->
<!-- Furthermore, some sites had accelerating rates of recultivation, and because almost all sites have half-lives of 30 years or less, even the sites with the most persistent abandonment are unlikely to retain large areas of croplands abandoned continuously for $\geq50$ years. -->
Our modeling approach provides a much more detailed and nuanced picture of abandonment persistence than previous studies.
This is apparent in Shaanxi/Shanxi: although this site had one of the shortest mean abandonment durations (because most abandonment took place towards the end of the time series), current recultivation trajectories indicate more persistent abandonment than we are able to observe during the time series, as indicated by among the most consistently long half-lives (~30 years; Figs. \@ref(fig:endpoint-half-lives) and \@ref(fig:endpoint-half-lives-all)).

Similarly, our method for modeling half-lives based on common endpoints allows us to draw fair but conservative comparisons across cohorts, without assigning disproportionate weight to cohorts with fewer observations.
However, we prioritize intermediate endpoints in our reporting of the results: longer endpoints are biased towards older cohorts (by excluding more recent abandonment), and while shorter endpoints incorporate a more complete set of cohorts, they make use of fewer observations overall and place relatively more weight on the initial stages of abandonment.
For example, Bosnia & Herzegovina, which had the longest mean abandonment duration, showed the longest half-lives for longer endpoints (i.e., $\geq15$ years), but experienced accelerating recultivation in recent years, causing half-lives to decline for shorter endpoints, indicating that future persistence may be relatively limited.
As a result, these endpoint results should be interpreted with a careful consideration of the number of cohorts and observations that went into each specific model run.
Yet no matter how we subset these data, one primary conclusion stands out: half-lives at almost all sites are almost always short.
For endpoints between 10-25 years, half-lives range from `r decay_stats$hl_min`-`r decay_stats$hl_max` years (interquartile range: `r decay_stats$hl_q1`-`r decay_stats$hl_q3` years)^[We could report other summary stats, such as the mean, median, and interquartile range, or for a different subset of the data. For endpoints 10-25, excluding Bosnia & Herzegovnia, these are: `r tmp_2 %>% mutate(paste = paste0(cols, ": ", round(value, digits = 2))) %>% .$paste %>% paste0(collapse = ", ")`. For 10-25, but including BH, they are: `r tmp_1 %>% mutate(paste = paste0(cols, ": ", round(value, digits = 2))) %>% .$paste %>% paste0(collapse = ", ")`. When including all sites and all endpoints (7-29), they are `r tmp_all %>% mutate(paste = paste0(cols, ": ", round(value, digits = 2))) %>% .$paste %>% paste0(collapse = ", ")`. What do you think would be easiest for the reader?] for all sites but Bosnia & Herzegovina (Fig. \@ref(fig:endpoint-half-lives)).

The impermanence of abandonment that we found generally matches that observed in the few other comparable case studies [@Chazdon2016a].
To the best of our knowledge, the only other study that uses an annual time series to investigate agricultural abandonment (in a grassland region of northern Kazakhstan between 1991-2017; ref. [@Dara2018]), observed abandonment of about 40.5% of cultivated areas, and the subsequent recultivation of about 20.0% of that abandonment.
This recultivation rate was similar to our most persistent site (`r recult_stats$min_5_site`, `r recult_stats$min_5`%), but much lower than both our average recultivation rate across sites (`r recult_stats$mean_thr_5`%), and in our sites closest to Kazakhstan, Orenburg/Uralsk and Volgograd, which had higher recultivation rates of `r area_recult_threshold %>% filter(abn_threshold == 5, site == "orenburg") %>% .$proportion_recultivated %>% round(digits = 4) * 100`% and `r area_recult_threshold %>% filter(abn_threshold == 5, site == "volgograd") %>% .$proportion_recultivated %>% round(digits = 4) * 100`% respectively (Fig. \@ref(fig:recult-by-threshold)).

Our projected half-lives were similar to those found in Costa Rica ($\leq20$ years, ref. [@Reid2019]), but longer than in other parts of the Neotropics, where empirical evidence shows that secondary forest regeneration is often short-lived [@Chazdon2016a; @Nunes2020; @Smith2020; @Schwartz2020].
Secondary forests were recleared more quickly in the Brazilian Amazon (50% within 5 to 8 years), where 80% of secondary forests were $\leq20$ years old [@Chazdon2016a; @Nunes2020; @Smith2020].
Across the tropics, only 33% of forests regenerating after recent deforestation were $\geq10$ years [@Vancutsem2021].
However, these differences may be the result of 1) a time delay between abandonment and sufficient regrowth of secondary woody vegetation to be detected by satellites, 2) our exclusion of abandonment of less than five years, or 3) our models of recultivation for each cohort, which eliminate the influence of the time series length, and lengthen abandonment estimates.

## Implications for biodiversity recovery {.unnumbered}

Together, our results show that most cropland abandonment is unlikely to be long-lasting, contrary to optimistic assumptions [@Campbell2008; @Naess2021].
The recultivation of abandoned croplands comes with substantial trade-offs [@Meyfroidt2016], and the high recultivation rate we observed will dramatically limit the scope for abandoned croplands to play a major role in carbon sequestration or the recovery of biodiversity.

There is, of course, substantial variability in how quickly and how completely ecosystems recover following disturbances and abandonment [@Norden2015; @Crouzeilles2016; @Arroyo-Rodriguez2017; @Reid2018b].
Natural regeneration can be a viable restoration strategy under the right conditions, especially after low-intensity disturbances (e.g., selective logging) and when there are relatively undisturbed or mature ecosystems nearby to act as propagule sources.
Under such conditions, plant and animal dispersal can result in secondary growth that can approach the habitat and carbon values of undisturbed ecosystems [@Crouzeilles2016; @Gilroy2014; @Arroyo-Rodriguez2017].

However, even under optimal conditions, recovery requires time, typically multiple decades, in order to recover species richness to values approximating those in reference systems [@Meli2017; @Acevedo-Charry2019; @Isbell2019; @Nerlekar2020; @Chazdon2020; @Reid2018b].
Species richness values for rarer, forest-adapted, or old-growth-dependent species recover even more slowly.
Importantly, when recovery towards old-growth ecosystems is measured in terms of community composition, species similarity, and vegetation structure, it can take much longer than when measured simply by the recovery of total species richness or abundance (which can be dominated by widespread generalist species) [@Meli2017; @Arroyo-Rodriguez2017; @Crouzeilles2016; @Rydgren2020].

In some cases species-rich tropical ecosystems can regenerate quickly, but never on a time scale as short as the abandonment durations we observe here.
Chronosequences show that lowland Neotropical forests recover quickly in terms of tree species richness (reaching 80% of old-growth levels after 20 years and 90% after 31 years), but much more slowly in terms of tree species composition (34% of old-growth levels after 20 years, requiring 487 years to reach 90%) [@Rozendaal2019].
These estimates may be overly optimistic, however, given the potential for positive site select biases [@Reid2018b]: the area around these sites retained relatively high forest cover (76% on average), and recovery is likely to be slower in more deforested landscapes [@Rozendaal2019].

Recovery can be rapid for certain animal groups in specific cases (e.g., birds and dung beetles in the Colombian Andes; ref. [@Gilroy2014]), but typically takes a long time for most types of vertebrates.
Across tropical forests, amphibian, bird, mammal, and reptile species richness largely recovers within 40 years, but species compositional similarity for these vertebrate groups takes much longer to recover (if at all), particularly for late-successional species, insectivorous birds, and forest specialists [@Acevedo-Charry2019].
No vertebrate groups reach species compositional similarity to reference old-growth forests, even in the oldest secondary forests (30-65 years) [@Acevedo-Charry2019].

Grassland ecosystems can sometimes recover more quickly following disturbances than forests [@Jones2009], but not often [@Nerlekar2020; @Isbell2019].
<!-- On average, secondary grasslands distributed around the world that are between 1-251 years old contain only 53-76% of the plant species richness of never-cultivated (i.e., undisturbed) grasslands [@Nerlekar2020]. -->
Even after full recovery of species richness (with minimum estimated recovery times of \>100 years), compositional similarity of secondary grasslands to undisturbed grasslands remains low (43%) [@Nerlekar2020].
Similarly, Minnesota (USA) grasslands showed quick initial gains in biodiversity following abandonment, but both biodiversity and productivity increased slowly, reaching only 73% of the diversity and 53% of the productivity levels of the reference ecosystem after 91 years [@Isbell2019].
Eurasian grasslands, where widespread conversion and subsequent abandonment has occurred, had not fully recovered with respect to either plant species richness or community composition after 24 years of observation [@Kampf2016], nor with respect to bird species richness and diversity after 18 years of observation [@Kamp2011].

## Carbon accumulation in abandoned croplands {.unnumbered}

Abandoned croplands may also only achieve a small fraction of their carbon storage potential if abandonment lasts only a couple of decades.
Despite relatively quick accumulation of carbon in aboveground biomass in forests during the first few decades of regeneration, it can take between 50-100 years for secondary forests to achieve similar levels of biomass to old-growth forests [@Poorter2016; @Martin2013].
For example, Neotropical aboveground forest biomass reached 90% of old-growth forest biomass after a median of 66 years, but biomass remained at about 50% after 20 years following shifting cultivation [@Poorter2016].
Furthermore, carbon accumulation estimates vary widely by biome and by prior land use.

Our estimates of carbon accumulation in both forest biomass and soil organic carbon as a function of time and biome (using data from refs. [@Cook-Patton2020; @Sanderman2020; @Woolf2020]) confirmed that while abandoned croplands hold substantial potential to accumulate carbon over time (`r carbon_stats$total_observed` Tg C total by 2017 across our sites), they only accumulated `r carbon_stats$total_diff`% of their potential as a result of recultivation, even when that potential is only estimated over our relatively short time series. 
While this `r 100 - carbon_stats$total_diff`% loss is not as significant as has been noted in another recent study of ephemeral forest regeneration [@Piffer2021], which estimated forest carbon accumulation of 70% less than the potential sequestration, this lost opportunity as result of recultivation remains troubling.

Abandonment taking place in forested biomes had much higher carbon accumulation, and correspondingly higher opportunity costs of recultivation (Table \@ref(tab:carbon-table)), yet grassland biomes, where much of the abandonment we observed occurred, can also harbor substantial amounts of carbon sequestered in soils [@Lal2004].
However, grassland soil carbon may accumulate even more slowly than aboveground forest biomass, taking a century or longer to return to reference levels [@Yang2019].
For example, while abandoned croplands across Russia accumulated a total of 13.2 Mg C/ha in the top 5 cm of soil during the first 20 years following abandonment, these fields still had significantly less carbon sequestered than reference grasslands after 24 years of observation, and were expected to take >60 years to recover to reference levels [@Wertebach2017]. 
Yet we estimate accumulation of only `r carbon_stats$MgC_grass_min` - `r carbon_stats$MgC_grass_max` Mg C per ha on average (see Table \@ref(tab:carbon-table)) at our predominantly grassland sites - only a fraction of the total observed by ref. [@Wertebach2017], largely a result of the short abandonment lengths at these sites.

## Limitations {.unnumbered}

A few limitations are worth noting.
First, beyond the short-lived duration of abandonment, the very fact that these lands were used for agriculture can impede full achievement of carbon or biodiversity goals.
The degradation and slow recovery of soils, a lack of nearby source populations, a lack of natural disturbance regimes, and climate change all pose obstacles to successful recovery of stored carbon or biodiversity [@Crouzeilles2016; @Crouzeilles2019; @Parkhurst2021].
While natural regeneration is typically cheaper than active restoration and can be a viable and important strategy in many places, it is not clear that natural regeneration will outperform active restoration on abandoned croplands.
Meta-analyses suggesting that natural regeneration outperforms active restoration often suffer from site-selection biases, in which sites that do not regenerate successfully on their own are not typically included, whereas examples of unsuccessful active restoration typically are [@Reid2018b].
More heavily altered systems typically require more active approaches such as invasive species control or translocation of plants and animals, and experience longer recovery times [@Crouzeilles2017; @Gilroy2014; @Meli2017; @Yang2019].

Grassland regeneration is particularly challenging, because many grasslands require natural disturbance regimes (e.g., grazing or fire), which may be absent following abandonment [@Nerlekar2020].
Without such disturbances, grassland biodiversity can be lost if low-intensity farmlands are abandoned, particularly in historically unforested ecosystems [@ReyBenayas2007; @Nerlekar2020; @Queiroz2014; @Sirami2008].
Although we focus here on the potential for long-term regeneration of habitat on abandoned cropland to enhance biodiversity, there are cases where long-term regeneration may not favor certain aspects of biodiversity. 
In those cases, active intervention and management (through grazing, hunting, or otherwise) may be necessary to maintain grasslands and other high-biodiversity habitats like wetlands [@Navarro2012; @ReyBenayas2007].

Second, we emphasize that our sites were specifically selected from regions with documented cases of abandonment.
Thus, while our results are likely reasonably representative of those areas that have recently experienced abandonment (with the exception of Mato Grosso, Brazil), they are not a representative sample of the globe, and overestimate the overall prevalence of abandonment across all cropland regions. 
Given the ephemerality of abandonment in these hotspot regions, it seems logical to expect regions with less abandonment overall to have equally short-lived abandonment, if not more so, when it occurs. 
However, there is some indication that abandonment may be more durable in Europe, another region that has experienced significant abandonment [@Estel2015; @Navarro2012]. 
A recent review of post-abandonment trajectories in Europe found that most studies reviewed experienced in passive succession towards semi-natural landscapes (`r round(100 * 87 / (115 + 2 + 18), digits = 2)`%, or 87 of 135 studies reviewed), though Eastern Europe and Russian abandonment may be more prone to recultivation [@Fayet2022].
This study did not include time since initial abandonment as a factor, however, and the differences in abandonment persistence between regions merits future investigation.

## Policy implications {.unnumbered}

We found strong evidence that abandoned croplands did not remain uncultivated for long periods of time at eleven sites across the globe.
Without new policies and incentives to discourage recultivation, abandoned areas are unlikely to provide meaningful biodiversity and carbon benefits, despite their considerable potential and expected importance for meeting both climate and biodiversity goals.
Our results reinforce growing calls for enhanced monitoring of regeneration after abandonment [@Cook-Patton2021], and the development of a stronger policy framework for managing such lands [@Chazdon2020].
In some cases, active management of abandoned sites will be needed to achieve biodiversity and carbon goals.

Harnessing abandonment as an environmental opportunity will require an understanding of the local drivers of abandonment.
These drivers are complex and site-specific, but include conflict, demographic shifts, sociopolitical upheaval, and globalization.
[@Yin2019; @Prishchepov2021].
^[This is where we could insert a few more sentences or a paragraph to address Reviewer 4's first comment. However, we do have a more detailed description of the drivers at our sites in our new methods section.]

There is a range of socioeconomic and political barriers hindering habitat regeneration in abandoned croplands.
These include policies that obligate farmers to cultivate land, a lack of incentives to protect and foster regenerating habitats, and perhaps most importantly, negative cultural perceptions of "abandonment" and the "messy" landscapes that result [@Chazdon2020].
Agricultural abandonment is a consequence of complex societal changes, and the loss of certain types of landscapes and rural ways of life is sometimes accompanied by substantial emotional distress, often motivating efforts to avoid or reverse abandonment [@ReyBenayas2007; @Meyfroidt2016; @Li2017; @Munroe2013].
Behavioral research into decisions to recultivate abandoned croplands highlights the importance of addressing human factors such as corruption, political and institutional support for agriculture, and demographic changes in order to sustainably manage abandonment, alongside biophysical and environmental conditions [@Prishchepov2021a].

In order for abandoned croplands to provide environmental benefits through habitat regeneration or carbon sequestration, they must persist for longer periods than we observed.
Based on the previous research cited above, regeneration may take more than 50 years to reach similar levels of carbon stocks and biodiversity – at least three decades longer than the mean length of abandonment we observe here.
Reducing recultivation and lengthening regeneration on abandoned croplands may be difficult, but a consideration of the temporal dynamics of recultivation at our sites may inform the feasibility of reducing recultivation of abandoned croplands. 
When recultivation occurred, the duration of recultivation was relatively short (Fig. \@ref(fig:mean-recult-duration)). 
While these short recultivation periods may simply be a function of when during the time series recultivation took place (which must follow abandonment by at least five years, by definition), they could also indicate that these croplands continue to be marginal economically, and that taking them out of production for longer periods of time may not present significant issues.

Encouraging the longevity of abandonment could be achieved by designating abandoned fields as protected areas, incorporating natural regeneration into payments for ecosystem service programs to allow landowners to benefit economically, or by taking steps to support sustainable long-term cultivation of some sites, thereby reducing turnover among fields that have previously been part of long-term fallowing cycles.
As a case in point, the relative durability of abandonment in Shaanxi/Shanxi may be due to large-scale ecosystem restoration programs that began in the late 1990s and created economic incentives to reforest croplands.^[Reviewer 4 encourages us to include more detail on “rewilding”]
This is encouraging, even though there continues to be a need to improve the biodiversity outcomes of such programs [@Hua2016].
We stress that any policies should be developed jointly with local communities to address trade-offs between biodiversity, carbon storage, and livelihoods.

Our results make one thing clear: if cropland abandonment continues to be as short-lived as we show here, the large potential benefits of regenerating habitats to both store carbon and sustain biodiversity will remain an untapped opportunity.

# Materials and Methods {.unnumbered #methods}

## Abandonment maps {.unnumbered}

We use annual land cover maps with 30-m resolution from 1987-2017 [@Yin2020], derived from publicly available Landsat satellite imagery, mapping four land cover classes: 1) cropland, 2) herbaceous vegetation (e.g., grassland), 3) woody vegetation (e.g., forests), and 4) non-vegetation (e.g., water, urban, or barren land) (Fig. \@ref(fig:area-by-lc)).
Our eleven sites were mapped with high accuracy (average overall accuracy $85\pm4$%) and provide broad coverage of different continents and ecosystems (site locations are shown in Fig. \@ref(fig:global-map), and site ecoregions and biomes are shown in Figs. \@ref(fig:site-biomes)-\@ref(fig:site-ecoregions); Section \@ref(section-biomes)).
We focused exclusively on cropland abandonment, because pasture abandonment is very difficult to discern from satellite imagery and is not captured in our data.

Our study areas range from drylands (Iraq; Nebraska, USA; Shannxi/Shanxi, China; and Orenburg, Russia / Uralsk, Kazakhstan), to temperate regions (Vitebsk, Belarus / Smolensk, Russia; Bosnia & Herzegovina; Volgograd, Russia; Wisconsin, USA), to the sub-tropic and wet tropics (Chongqing, China; Goiás, Brazil; and Mato Grosso, Brazil; see Section \@ref(section-biomes)). 
Yin et al. [@Yin2020] selected these regions because of their documented histories of cropland abandonment in the past three decades. 
Our study regions also captured a diverse mix of three potential abandonment drivers including sociopolitical (e.g., Shannxi/Shanxi, China; Bosnia & Herzegovina), economic (e.g., Chongqing, China), and environmental change (e.g., Iraq).
Here, we use data for only 11 of the 14 areas originally mapped by Yin et al. [@Yin2020], dropping three sites (Sardinia, Nepal, and Uganda) due to low map accuracy (*insert statistic here*^[He: Can we include a statistic here that we used to exclude these three sites? Something like: <80% overall map accuracy. Or was this based on a few different metrics, like overall map accuracy, F1 scores, cropland map accuracy, etc.?]).
Thus, while our results are likely representative of those areas that have recently experienced abandonment, they are not a representative sample for the globe, and overestimate the overall prevalence of abandonment.

## Defining abandonment {.unnumbered}

Differentiating abandonment from short-term fallowing or crop rotations is difficult because agricultural practices can vary widely by region, and studies use many different definitions [@Yin2020].
Here, in order to exclude short-term fallowing, we define "abandonment" as cropland that is no longer under active cultivation, is left free of direct human influence (e.g., is not converted to urban land use), and remains so for at least five subsequent years, following FAO [@FAO2016].
Recognizing that longer abandonment thresholds may be more appropriate in certain contexts, we performed a sensitivity analysis by varying our abandonment definition (Section \@ref(abn-thresholds)) and found that, as expected, longer definitions resulted in less abandonment overall, longer average abandonment durations (Fig. \@ref(fig:abn-duration-by-threshold)), and lower recultivation rates (Fig. \@ref(fig:recult-by-threshold)).
However, even when only considering abandonment $\geq10$ years, we still observed between `r recult_stats$min_10`% and `r recult_stats$max_10`% recultivation across our sites (in `r recult_stats$min_10_site` and `r recult_stats$max_10_site` respectively), suggesting the reliability of our abandonment definition.
We did not apply any duration threshold when measuring recultivation (i.e., measuring recultivation periods as short as one year), given that even one year of recultivation can effectively restart the process of regeneration.
We did, however, assess how different thresholds of recultivation would affect the mean duration of recultivation (Fig. \@ref(fig:recult-duration-by-threshold)), in addition to the extent to which recultivation depends on abandonment threshold (Fig. \@ref(fig:recult-by-threshold)).

## Data processing {.unnumbered}

We processed and analyzed abandonment map data in RStudio version `r rstudioapi::versionInfo()$version` [-@RStudio], using `r R.Version()$version.string`, primarily with the raster [@R-raster], terra [@R-terra], data.table [@R-data.table], and tidyverse [@R-tidyverse] packages.

```{r prop-non-veg, include = FALSE}
# ----------------------------------------------------------- #
# Proportion of each site's area in non-vegetated land
# ----------------------------------------------------------- #
prop_non_veg <- area_dat %>% 
  filter(lc %in% c("Non-veg.", "Woody veg.", "Cropland", "Grassland"), year == 2017) %>%
  group_by(site) %>%
  summarise(total_site_area_ha = sum(area_ha)) %>% 
  left_join(area_dat, ., by = c("site")) %>% 
  mutate(prop_total_area = area_ha/total_site_area_ha)

max_prop_non_veg <- prop_non_veg %>%
  group_by(site, lc) %>%
  summarise(max_prop_in_non_veg = max(prop_total_area)) %>%
  arrange(max_prop_in_non_veg) %>%
  filter(., lc == "Non-veg.") %>%
  left_join(site_labels)


non_veg_stats <- list(
  site1 = max_prop_non_veg %>% filter(max_prop_in_non_veg > 0.1) %>% .[1, ] %>% .$site_long,
  site1_p = max_prop_non_veg %>% filter(max_prop_in_non_veg > 0.1) %>% .[1, ] %>% .$max_prop_in_non_veg %>% round(., digits = 4)*100,
  site2 = max_prop_non_veg %>% filter(max_prop_in_non_veg > 0.1) %>% .[2, ] %>% .$site_long,
  site2_p = max_prop_non_veg %>% filter(max_prop_in_non_veg > 0.1) %>% .[2, ] %>% .$max_prop_in_non_veg %>% round(., digits = 4)*100
)

# prop_non_veg %>% filter(lc == "Non-veg.", year %in% c(1987, 2017)) %>% print(n = 22)


# # plot
  # ggplot(data = prop_non_veg %>% filter(., lc == "Non-veg.")) +
  #   theme_classic() +
  #   labs(y = expression("Area  (10"^{6}*" ha)"), x = "Year",
  #        title = "Area by Land Cover, with Abandonment",
  #        color = NULL) +
  #   geom_line(mapping = aes(x = year, y = prop_total_area, #area_ha / (10^6), # convert to millions of ha
  #                           group = lc, color = fct_reorder(lc, lc, .desc = TRUE)),
  #             size = 1.5) +
  #   geom_hline(yintercept = 0.1) +
  #   theme(legend.position = "bottom",
  #         legend.title = element_text(size = 10)) +
  #   guides(color = guide_legend(nrow = 2, ncol = 3)) +
  # 
  #   scale_color_manual(values = plot_cols) +
  # facet_wrap(vars(site))
```

We identified periods of cropland abandonment by tracking each pixel's land cover through time and looking for land-cover changes that indicated transitions between active cropland use (i.e., cultivation) and subsequent inactivity (i.e., left fallow, or uncultivated).
We first implemented five- and eight-year moving window temporal filters to smooth land-cover trajectories and remove land-cover changes that are temporally unlikely (Section \@ref(temporal-filters)).
Together with our five-year abandonment threshold, these temporal filters address very short-term misclassifications that might otherwise appear like recultivation.

We classified a pixel as "abandoned" anytime it transitioned from cropland to either herbaceous or woody vegetation (collectively referred to as "non-cropland") and subsequently remained classified as non-cropland for five or more consecutive years (see Section \@ref(classifying-abn) for full details).
We considered an abandoned pixel to be "recultivated" when it transitioned from abandoned back to cropland for one or more years.
Pixels that transitioned from cropland to the non-vegetation class were not considered "abandoned," and were excluded from our analysis.
Non-vegetated land consisted of \<10% of total site area in all sites except `r non_veg_stats$site1` (`r non_veg_stats$site1_p`%) and `r non_veg_stats$site2` (`r non_veg_stats$site2_p`%), and remained stable or declined over time in all eleven sites.

## Calculating observed and potential abandonment duration {.unnumbered}

We calculated abandonment duration as the number of years that elapsed between the initial transition from cropland to non-cropland, and either recultivation or the end of the time series.
Because our abandonment definition only considers croplands that have been abandoned for five or more contiguous years, the minimum abandonment duration is five years.
Because a pixel may be abandoned and recultivated multiple times throughout the time series, we calculated the mean abandonment duration in two ways: 1) across all periods of abandonment (Fig. \@ref(fig:mean-abn-duration)), and 2) across only the longest period of abandonment experienced by each pixel (Figs. \@ref(fig:maps-max-abn-duration) and \@ref(fig:mean-abn-duration-w-max)).
Using a similar method, we also tracked the duration of recultivation periods that followed periods of abandonment (Fig. \@ref(fig:mean-recult-duration)).

In order to understand the opportunity cost of recultivation, we also developed a simple scenario assuming that no recultivation took place during our time series.
This scenario assumed that all abandoned croplands remained abandoned from their initial abandonment through the end of the time series. 
We calculated the area abandoned in each year according to age (i.e., time since initial abandonment), and used this to calculate potential carbon sequestration (see below).
Potential area abandoned without recultivation is shown as a dashed line in Fig. \@ref(fig:area-abn-by-age-class).

## Estimating carbon accumulation in abandoned croplands {.unnumbered}

We estimated carbon sequestration in abandoned croplands using recently published maps of annual carbon accumulation rates during secondary succession.
For forest biomes (delineated using the Ecoregions2017 map [@Dinerstein2017]; see Fig. \@ref(fig:site-biomes) and Section \@ref(section-biomes)), we applied rates from @Cook-Patton2020, which provides annual carbon accumulation rates for the first 30 years of natural forest regrowth in terms of aboveground biomass, belowground biomass, and soil carbon (which we subsequently combined).
For non-forest biomes (e.g., grasslands, savannas, etc.; see Fig. \@ref(fig:site-biomes)), we conservatively assumed that the majority of ecosystem carbon is stored in soils [@Bossio2020], and therefore used soil organic carbon (SOC) sequestration as a proxy for potential carbon sequestration.
We applied annual SOC sequestration rates estimated from the recently published SoilsRevealed database [@Sanderman2020; @Woolf2020], which includes estimates of potential SOC stocks in former agricultural lands as they return to native vegetation after 20 and 80 years.
We extracted only pixels representing transitions from cropland to native vegetation, and calculated the mean SOC stock for former croplands at each of our sites after 20 and 80 years of regeneration (see more details in Section \@ref(section-soc-si).
We used these two mean SOC stock estimates to calculate annual SOC sequestration rates for years 1-20 and 21-80 of regeneration.
These SOC sequestration rates were then combined with our forest carbon accumulation rate layer and applied to our abandonment age data to calculate potential forest and soil carbon accumulation during the duration of abandonment.

Maps showing the combined forest and soil organic carbon sequestration rates are shown for years 1-20 in Fig. \@ref(fig:carbon-map-Y20-rate) and years 21-80 in Fig. \@ref(fig:carbon-map-YSS-rate).
Total and potential carbon accumulation at each site by 2017 is shown in Figs. \@ref(fig:carbon-map-2017-observed) and Fig. \@ref(fig:carbon-map-2017-potential) respectively.
Maps of forest and soil carbon accumulation rates were resampled from their original resolutions (1 km and 250 m, respectively) to match the 30 m resolution of our land cover maps.

## Modeling abandonment decay {.unnumbered}

Because some abandonment periods are limited by the length of the time series (potentially causing some observed periods of abandonment to end before they are truly recultivated), we modeled recultivation of abandoned croplands as a function of time since initial abandonment.
We tracked recultivation ("decay") by calculating the proportion of each cohort of pixels abandoned in a given year that remain abandoned in each year following abandonment.
We parameterized a linear model predicting the proportion of abandoned cropland in each cohort at each site remaining abandoned as a function of time since initial abandonment.
We tested a range of model specifications, including linear and log transformations of both proportion and time, and multiple time predictor terms.
Importantly, we included both cohort and site level fixed effects, fitting unique coefficients for each cohort at each site in a single linear model for all data pooled across sites.

We selected the highest performing model based on Akaike Information Criterion values (AIC; Fig. \@ref(fig:AIC)).
For cohorts of abandonment initially abandoned in years $y = 1988, ... , 2013$, our model predicted the proportion $p$ of each cohort $y$ at site $z$ remaining abandoned as a function of time $t$ (i.e., the number of years following initial abandonment), with one log-transformed and one linear term of time (Equation \@ref(eq:mod-spec)).

\begin{equation}
p_{yz} = 1 + \beta_{yz,1} log(t + 1) + \beta_{yz,2} t (\#eq:mod-spec)
\end{equation}

Where $\beta_{yz,1}$ and $\beta_{yz,2}$ represent the regression coefficients on the log and linear terms of time $t$, respectively, for cohort $y$ at site $z$.
Model assumptions were tested through visual inspection of diagnostic plots (Fig. \@ref(fig:diag-combo); full details in Section \@ref(decay-models-si)).
The observations and fitted values from our pooled linear model are shown in Fig. \@ref(fig:decay-model-grid), and all individual model coefficients are shown in Fig. \@ref(fig:decay-mod-coef).

Due to the nature of our time series, each cohort has a different number of observations (corresponding to the number of years between the year of initial abandonment and the end of the time series), complicating efforts to compare cohorts and calculate mean trajectories across cohorts at each site.
In order to address this issue, we developed an approach to parameterize our linear model using subsets of data restricted to common endpoints (e.g., 15 years), such that each cohort had the same number of observations.
For example, for a given endpoint of 15 years, we included only those cohorts with at least 15 years of observations, and also excluded all observations for those cohorts beyond that 15 year threshold.
We then parameterized our linear model with this subset and calculated mean log and linear coefficients across cohorts at each site, from which we then calculated the time required for half of the abandoned cropland at each site to be recultivated ("half-lives").

We repeated this analysis for the full range of possible common endpoints that included more than one cohort (7 through 29 years).
Half-lives for a few select endpoints (10, 15, 20, and 25 years) are shown in Fig. \@ref(fig:endpoint-half-lives), and model results for these subsets and their corresponding mean decay trajectories are shown in Figs. \@ref(fig:endpoint-panel-a) - \@ref(fig:endpoint-panel-b).
Half-lives for all modeled endpoints (7 through 29 years) are shown in Fig. \@ref(fig:endpoint-half-lives-all).

To estimate changes in persistence over time, we calculated the half-life for each cohort at each site and parameterized a linear model on these half-life values (*n* = 26 at each site) to identify temporal changes in recultivation patterns at each of our eleven sites (Section \@ref(section-methods-rate-of-change)).
Trends were considered statistically significant when the 95% confidence interval for model coefficients did not include zero (Fig. \@ref(fig:decay-rate-of-change)).


# References {.unnumbered}

::: {#refs}
:::

\newpage

# Acknowledgements {.unnumbered}

We thank the following researchers at the University of Wisconsin-Madison, whose land cover maps made our analysis possible, and who generously shared their data: Amintas Brandão, Johanna Buchner, David Helmers, Benjamin G. Iuliano, Niwaeli E. Kimambo, Katarzyna E. Lewińska, Elena Razenkova, Afag Rizayeva, Natalia Rogova, Seth A. Spawn, and Yanhua Xie.
We thank J. Leighton Reid, three anonymous reviewers, and editor Shahid Naeem, whose helpful reviews greatly strengthened our manuscript.
We are deeply indebted to Alex Wiebe, whose statistical advice significantly improved our models of abandonment decay and recultivation.
We also thank the Drongos research group for advice and companionship.
Analyses were performed using Princeton Research Computing resources at Princeton University.
This research contributes to the Global Land Programme (<https://glp.earth/>).

## Funding {.unnumbered}

High Meadows Foundation (DSW)
NASA Land Cover and Land Use Change Program (Grant no. 80NSSC18K0343) (VCR, HY)

## Author contributions {.unnumbered}

CLC and DSW conceived of the project in collaboration with HY and VCR.
HY contributed guidance on data curation and the analysis of raw land cover data.
CLC designed and conducted the data analysis, with feedback from HY, DSW, and VCR.
All authors contributed to writing the manuscript, with CLC preparing the initial draft.

## Competing interests {.unnumbered}

The authors declare no competing interests.

## Data and code availability {.unnumbered}

The annual land cover maps that underlie our analysis are archived at Zenodo (URL TBD), along with other datasets generated and analyzed for this article (including maps of abandonment age and datasets summarizing area, persistence, and turnover). 
Code to replicate these analyses is available on GitHub at <https://github.com/chriscra/abandonment_trajectories>, and is archived at Zenodo (URL TBD).
Forest carbon accumulation rates are freely available from Global Forest Watch (http://www.globalforestwatch.org), and soil carbon accumulation rates are available from SoilsRevealed (https://doi.org/10.7910/DVN/HA17D3).

<!-- # Supplementary information {.unnumbered} -->

<!-- Supplementary Information for this manuscript [can be found here](https://drive.google.com/file/d/1G5pzgpoEultZ69eiODsiBFrtd7NuLIUr/view?usp=sharing). -->


\newpage

# Figures and Tables {.unnumbered}

(ref:caption-global-map) The locations of our 11 sites, from Yin et al. [@Yin2020]. Sites are labeled as follows: (b) Vitebsk, Belarus / Smolensk, Russia; (bh) Bosnia & Herzegovina; (c) Chongqing, China; (g) Goiás, Brazil; (i) Iraq; (mg) Mato Grosso, Brazil; (n) Nebraska/Wyoming, USA; (o) Orenburg, Russia / Uralsk, Kazakhstan; (s) Shaanxi/Shanxi, China; (v) Volgograd, Russia; (w) Wisconsin, USA.

```{r global-map, fig.cap = '(ref:caption-global-map)'}
# just plain site locations
knitr::include_graphics(path = paste0(p_plots, "fig0.pdf"))
```

\newpage

(ref:caption-maps-abn-duration) Observed duration of cropland abandonment (in years) as of 2017 in our eleven study sites. Site locations are shown in Fig. \@ref(fig:global-map), and maps of maximum abandonment duration are shown in Fig. \@ref(fig:maps-max-abn-duration).

```{r maps-abn-duration, fig.cap = '(ref:caption-maps-abn-duration)', fig.pos = "ht"}
knitr::include_graphics(path = paste0(p_plots, "fig1_filled", run_label, ".pdf"))
```

\newpage

(ref:caption-area-abn-by-age-class) Cumulative area abandoned at each site through time, according to age class (in years). The solid black line represents the total observed area abandoned at each site, and the dashed black line represents the potential area abandoned, assuming a scenario without recultivation. The corresponding area of potential abandonment by age class is shown in Fig. \@ref(fig:potential-area-bins).

```{r area-abn-by-age-class, fig.cap = '(ref:caption-area-abn-by-age-class)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/abn_area_by_age_grid_w_potential", run_label, ".pdf"))
```

\newpage

(ref:caption-mean-abn-duration) The distribution of observed abandonment duration (in years) for all periods of abandonment from 1987 to 2017. The y-scale shows the proportion of abandonment periods of a given duration at each site. The red points represent the mean abandonment duration (in years) at each site, and the red vertical dashed line represents the mean of these site-level mean duration values across all sites. Note that these distributions include multiple periods of abandonment for those pixels that experienced abandonment and recultivation multiple times during the time series. See Fig. \@ref(fig:mean-abn-duration-w-max) to view distributions of the maximum abandonment duration for each pixel.

```{r mean-abn-duration, fig.cap = '(ref:caption-mean-abn-duration)', fig.pos = "ht", out.width = "11cm", echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, "fig2", run_label, ".pdf"))
```

\newpage

(ref:caption-carbon-over-time) Cumulative carbon accumulation in abandoned croplands over time, in terms of millions of Mg C ($10^6$ tC). Cumulative area abandoned at each site through time, according to age class (in years). The solid black line represents the total observed area abandoned at each site, and the dashed black line represents the potential area abandoned, assuming a scenario without recultivation.

```{r carbon-over-time, fig.cap = '(ref:caption-carbon-over-time)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/carbon/carbon_accumulated_over_time.pdf"))
```

\newpage

(ref:caption-decay-model-grid) Decay model results for all sites, showing the proportion of each cohort of abandoned land (i.e., all pixels abandoned in a given year) remaining abandoned over time for each of our eleven sites. Points represent actual observations by cohort and the dashed lines represent linear model predictions (fitted values) for each cohort as a function of time (including a linear and logarithmic term of time). Colors of both points and dashed lines correspond to roughly five-year group of cohorts, ranging from dark purple (oldest cohorts) to green and yellow (most recent cohorts). The horizontal black dashed line shows a proportion of 0.5, indicating the point where half of a cohort has been recultivated. Model diagnostic plots are shown in Fig. \@ref(fig:diag-combo).

```{r decay-model-grid, fig.cap = '(ref:caption-decay-model-grid)', echo = FALSE}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "decay_mod_grid", run_label, ".pdf"))
```

\newpage

(ref:caption-endpoint-half-lives) Mean half-lives of abandoned croplands at each site, calculated across a range of common endpoints. In order to make fair comparisons across cohorts with varying numbers of observations, we subset our data to a range of common endpoints (e.g., 15 years), restricting cohorts to the same number of observations. For each endpoint, we then calculated the mean trajectory across cohorts, and used these mean trajectories to calculate the half-life (i.e., the time required for half of a cohort to be recultivated). See Fig. \@ref(fig:endpoint-half-lives-all) to see half-lives for the full range of endpoints.

```{r endpoint-half-lives, fig.cap = '(ref:caption-endpoint-half-lives)', echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "half_lives_endpoints_by_obs_10_25", run_label, ".pdf"))
```

<!-- (ref:caption-decay-curves-by-site) Mean decay trajectories for each site, based on a linear model predicting the proportion of abandoned land remaining abandoned as a function of time (including a linear and a logarithmic term of time). The function describing each site's mean trajectory is calculated by taking the mean of each time coefficient across all cohorts of abandonment at each site. The light gray dashed line at a proportion of 0.50 indicates the half-life at each site, defined as the time required for half of the croplands abandoned in a given year to be recultivated. -->

<!-- ```{r decay-curves-by-site, fig.cap = '(ref:caption-decay-curves-by-site)', echo=FALSE} -->
<!-- knitr::include_graphics(path = paste0(p_plots, "fig3", run_label, ".pdf")) -->
<!-- ``` -->

<!-- (ref:caption-abn-decay-s) Recultivation (decay) of abandoned land in Shaanxi/Shanxi (China), showing the proportion of each cohort of abandoned land (i.e., all pixels abandoned in a given year) remaining abandoned over time. Points represent actual observations by cohort (n = 351), dashed lines represent linear model predictions (fitted values) for each cohort as a function of time (including a linear and logarithmic term of time), and the solid black line represents the mean trend across all cohorts (calculated by taking the mean of each time coefficient value across all cohorts). Colors of both points and dashed lines correspond to roughly five-year groups of cohorts, ranging from dark purple (oldest cohorts) to green and yellow (most recent cohorts). See Fig. \@ref(fig:decay-model-grid) for model results for all sites. -->

<!-- ```{r abn-decay-s, fig.cap = '(ref:caption-abn-decay-s)', out.width = "9cm", echo=FALSE} -->
<!-- # knitr::include_graphics(path = paste0(p_plots, run_label, "persistence_proportion", run_label, "_s.png")) -->
<!-- knitr::include_graphics( -->
<!--   path = paste0(p_plots, "fig4", run_label, ".pdf" -->
<!--                                  )) -->

<!-- # persistence_dat %>% group_by(site) %>% summarise(n = n()) -->
<!-- # persistence_dat %>% filter(site == "belarus") %>% .$cohort %>% levels() %>% length -->
<!-- # persistence_dat %>% group_by(site) %>% summarise(n = length(unique(cohort))) -->
<!-- ``` -->

\newpage

\beginsupplement

# Supplementary information {.unnumbered}

\tableofcontents
<!-- \listoftables -->
<!-- \listoffigures -->

<!-- \newpage -->

# Extended Results {#results-si}

Cropland abandonment at individual sites (excluding Mato Grosso, see Section S1.A.) ranged between `r area_abn_stats$min` ha (`r area_abn_stats$min_site`) and `r area_abn_stats$max` ha (`r area_abn_stats$max_site`) as of 2017 (Fig. \@ref(fig:area-abn-by-age-class)), and because our sites varied in size, this corresponded to between `r area_abn_stats$min_area_2017_as_prop_site`% (`r area_abn_stats$min_area_2017_as_prop_site_site`) and `r area_abn_stats$max_area_2017_as_prop_site`% (`r area_abn_stats$max_area_2017_as_prop_site_site`) of the total area of each site (Fig. \@ref(fig:area-abn-panel)).

On average, we found that cropland abandonment lasted for only `r abn_duration_stats$mean_of_means_duration` years (SD = `r abn_duration_stats$sd_of_mean_duration` years) across our time series at our eleven sites.
Note, however, that these summary statistics are calculated based on the mean abandonment duration at each site, to account for different site sizes.
The summary statistics reported are therefore the mean of the mean abandonment duration at each of our eleven sites, and the standard deviation of the mean abandonment duration at each of our eleven sites.

We also calculated the mean standard deviation of abandonment duration across our sites, which was `r abn_duration_stats$mean_of_sds_duration` years.
The former is a measure of the spread of mean abandonment lengths across the 11 sites, whereas the latter is a measure of the average spread of abandonment lengths at each site.
See Table \@ref(tab:summary-stats-table).

The area abandoned at each site is shown in Fig. \@ref(fig:area-abn-panel) (see also Table \@ref(tab:abn-panel-table)).
The area abandoned at each site, by age class, is shown in Fig. \@ref(fig:area-abn-by-age-class), and the area in each land cover class at each site is shown in Fig. \@ref(fig:area-by-lc).
Fig. \@ref(fig:area-abn-by-age-class) shows that the timing of abandonment varied across sites; some sites showed more abandonment earlier in the time series (e.g., Iraq; Bosnia & Herzegovina; Volgograd, Russia; Nebraska/Wyoming, USA; & Mato Grosso, Brazil), some showed consistent abandonment over time (e.g., Vitebsk, Belarus/Smolensk, Russia; Goiás, Brazil; and Wisconsin, USA), and others showed increasing abandonment later on in the time series (e.g., sites in Shaanxi/Shanxi and Chongqing, China).
Furthermore, Fig. \@ref(fig:turnover-grid) shows the annual gain, loss, and net change in the area of abandoned croplands abandoned at each site.

## Limited abandonment in Mato Grosso {#mato-grosso}

Mato Grosso, Brazil, was the only site that did not experience significant amounts of cropland abandonment during our time series.
This is unsurprising given the recent history of agriculturally-driven land-use change over the last few decades.
That being said, the abandonment that did take place in Mato Grosso was relatively more durable, requiring `r decay_stats$mg_0.5` years to decline by half and `r decay_stats$mg_0` years for complete turnover.
However, because Mato Grosso showed large amounts of new cultivation over the source of our time series and relatively little abandonment (`r area_abn_stats$mg` ha, or `r area_abn_stats$mg_abn_2017_as_percent_total_crop`% of the total cropland extent, as of 2017), these results should be interpreted with care.

## Biomes {#section-biomes}

Some ecosystems and biomes seem to recover more quickly than others, namely in relatively higher latitudes, relatively colder climates, and in relatively more humid biomes [@Prach2018].
Our sites cover a range of biomes (Fig. \@ref(fig:site-biomes)), as delineated by the Ecoregions2017 (RESOLVE) layer [@Dinerstein2017], including:

- Temperate Broadleaf and Mixed Forests (Vitebsk Belarus/Smolensk, Russia; Bosnia & Herzegovina; Wisconsin, USA),
- Temperate Grasslands, Savannas, and Shrublands (Nebraska/Wyoming, USA; Orenburg, Russia/Uralsk, Kazakhstan; Volgograd, Russia),
- Tropical Grassland (Goiás and Mato Grosso, Brazil),
- Tropical Moist Broadleaf Forests (Chongqing, China; Mato Grosso, Brazil),
- Montane Grassland and Shrublands (Shaanxi/Shanxi, China), and
- Deserts & Xeric Shrublands (Iraq).

Individual ecoregions from the Ecoregions2017 layer are shown in Fig. \@ref(fig:site-ecoregions), and the broad categorization of these biomes into forest and non-forest is shown in Fig. \@ref(fig:site-biomes-for-nonfor).

The long-term land-cover outcomes for abandoned croplands are shown (as of 2017) in Fig. \@ref(fig:abn-prop-lc).
Land cover outcomes for abandoned croplands showed wide variation across sites, with most abandonment in Wisconsin being classified as forest by 2017 (`r lc_stats$forest_max`% forest, `r lc_stats$forest_max_grassland`% grassland), but remaining mostly in grassland elsewhere (Fig. \@ref(fig:abn-prop-lc)).
This limited woody vegetation regrowth may be a product of the biome, but it may simply be a result of insufficient time for woody biomass to develop.
Land cover alone cannot confidently serve as a proxy for ecosystem recovery.

## The effect of varying abandonment definitions {#abn-thresholds}

```{r, include = FALSE}

# mean_length_df %>% filter(length_type == "all") %>% arrange(site)

overall_means <- mean_length_df %>%
  group_by(abn_threshold, length_type) %>%
  summarise(overall_mean = mean(mean_duration, na.rm = TRUE)) %>% ungroup()


threshold_stats <- list(
  one = overall_means %>% filter(abn_threshold == 1, length_type == "all") %>% .$overall_mean %>% round(digits = 0),
  three = overall_means %>% filter(abn_threshold == 3, length_type == "all") %>% .$overall_mean %>% round(digits = 0),
  five = overall_means %>% filter(abn_threshold == 5, length_type == "all") %>% .$overall_mean %>% round(digits = 0),
  ten = overall_means %>% filter(abn_threshold == 10, length_type == "all") %>% .$overall_mean %>% round(digits = 0)
)
```

A relatively short-term definition of abandonment might result in an overestimation of recultivation, because short-term abandonment may be better understood as cyclical fallow periods, not true abandonment [@Munroe2013].
Because typical fallow period length may vary around the world, we tested multiple abandonment thresholds in order to test the sensitivity of our results to our choice of a five-year abandonment definition, following the FAO [@FAO2016].
As our abandonment threshold increased in length, the mean abandonment duration across our sites increased accordingly, ranging between `r threshold_stats$one` years (no threshold) and `r threshold_stats$ten` years (10-year threshold).
As expected, using a longer abandonment definition reduced the amount of cropland abandonment we detected, which is also shown in the area in the different colored age classes in Fig. \@ref(fig:area-abn-by-age-class).

The proportion of abandoned croplands that were recultivated by the end of the time series also responded to our abandonment threshold, with less recultivation for longer abandonment thresholds (Fig. \@ref(fig:recult-by-threshold)).
However, even at the longest abandonment definition (10 years), we still saw that between 10% and 30% of abandoned croplands were recultivated by the end of the time series.
We find that the mean area of abandoned croplands that get recultivated by the end of the time series declines from `r recult_stats$mean_thr_5`% with a 5 year threshold to `r recult_stats$mean_thr_7`% with a 7 year threshold, and `r recult_stats$mean_thr_10`% with a 10 year threshold.
This indicates that the abandonment and recultivation we observe is not merely a function of our five-year abandonment definition.

## Comparing annual and two-year estimates of abandonment {#twoyr-vs-annual}

Some studies estimate cropland abandonment by simply looking for areas where land cover is classified as "cultivated" in one year, but not in a later year (e.g., 1992 and 2015 in ref. [@Naess2021]).
In order to understand the magnitude of the differences that could result from using this two-year approach, we estimated cropland abandonment by simply identifying areas that were classified as "cropland" in 1987 and classified as either "woody vegetation" or "herbaceous vegetation" in 2017 (i.e., excluding "non-vegetation").

Table \@ref(tab:twoyr-diff-table) shows the area of abandoned croplands as identified using a five-year abandonment definition and the full annual time series (Column 2), and the area of abandoned croplands identified using only the difference between 2017 and 1987 (Column 3).
These two methods produced abandonment area estimates that ranged between `r abs(abn_2yr_stats$low_percent)`% lower (`r abn_2yr_stats$low_p_site`) and `r abn_2yr_stats$high_percent`% higher (`r abn_2yr_stats$high_p_site`) than the abandoned area identified using the full time series.

Not only do these methods produce different area estimates, but they also differ in the location of the abandonment they identify, with spatial agreement of only `r abn_2yr_stats$jaccard_low`% (`r abn_2yr_stats$jaccard_low_site`) to `r abn_2yr_stats$jaccard_high`% (`r abn_2yr_stats$jaccard_high_site`) (see Table \@ref(tab:twoyr-diff-table)).
We measure spatial agreement using the Jaccard similarity index [@Legendre2012], a measure of overlap between two sets, defined as the proportion of shared elements, or the intersection divided by the union (Equation \@ref(eq:jaccard-equation)) [@Legendre2012]:

\begin{equation}
J(a,b) = \frac{a\cap b}{a\cup b} (\#eq:jaccard-equation)
\end{equation}

Additionally, a large portion of the "abandoned" area identified with the two-year method does not meet our five year abandonment definition, leading to an overestimate of true abandonment. 
Column 6 in Table \@ref(tab:twoyr-diff-table) shows the percent of the "abandoned" area identified with the two-year method that has been abandoned for than 5 years, and therefore would not be considered "abandoned" by our definition.

# Extended Methods {#methods-si}

As noted in our main text, we build on annual land cover maps for 1987-2017 developed by Yin et al. [@Yin2020].
The following section outlines our data processing and analytical methods in more specific detail than was possible in the main text.
We processed and analyzed our abandonment map data in RStudio version `r rstudioapi::versionInfo()$version` [-@RStudio], using `r R.Version()$version.string`, relying heavily on the `{raster}` [@R-raster], `{terra}` [@R-terra], `{data.table}` [@R-data.table], and `{tidyverse}` [@R-tidyverse] packages.

## Temporal filters {#temporal-filters}

In order to address potential classification errors in a single year, we implemented a series of temporal filters designed to smooth trajectories by looking for short-term land-cover changes that are temporally unlikely.
We applied five-year and eight-year moving-window filters that searched for short periods of land cover classifications that do not match those immediately before and after, and subsequently updated them to match the surrounding classifications.
Specifically, the five-year filter searched for one year periods that did not match the two years immediately before and after (i.e., patterns of `11011`, where `1` represents non-cropland and `0` represents cropland), and our eight-year filter searched for two year periods that did not match the three years before and after (i.e., `11100111`).
The central classifications were then updated to match the classes on either end.

```{r unused-edge-filter-text, include = FALSE, eval = FALSE}
# To be more conservative about the identification of abandonment, we also applied modified versions of these five- and eight-year moving window filters to the start of the times series. 
# By conservatively assuming the years immediately prior to our time series to be classified as non-cropland, we are able to use our moving window filters to exclude additional cases where a one or two year period of cropland may not represent stable cultivation (e.g., reading from left to right, starting in 1987: 011, 1011, 00111, 100111, and 1100111). 
# Non-cropland periods that follow potentially misclassified cropland would more accurately reflect a continuation of existing non-cropland, rather than cropland abandonment.
# 
# This has the effect of applying a three-year threshold on the number of consecutive years of cropland required at the start of the time series in order to confidently signify agricultural activity that could be subsequently abandoned.^[Where 1 represents non-cropland and 0 represents cropland:  
# 87__88__89__90__91__92__93__94  
# 0___1___1___1___1___1___1___1 - caught by edge filter (011)  
# 0___0___1___1___1___1___1___1 - caught by edge filter (00111)  
# 0___0___0___1___1___1___1___1 - Age count starts in '90, classified as abandoned in '94
# ]
# 
# Collectively, these filters mean that the first year a piece of land could be abandoned is 1990, as long as it remains consecutively uncultivated at least through 1994.
# These edge patterns were uncommon, however, with the edge filtering at the beginning of the time series affecting fewer than 7% of pixels at each site. *^[Should this be relative to all pixels, or those that experience some abandonment?]* See Figure 
# 
# No special actions were taken on the end of the time series, with the possible effect of including erroneous recultivation at the end of the time series, making our estimates of the length of time abandoned conservative (i.e., shorter). 
# We decided to only address the edge cases at the start of the time series because we prefer to be conservative by excluding lands that may be consistently noncrop lands from our estimate of abandonment.
# In contrast, edge cases at the end of the time series only affect our estimate of the length of time abandoned, because one or two year periods of cropland, if misclassified, may erroneously mark recultivation in the final years of the time series.
# However, we decline to address any potential misclassifications at the end of the time series in order to take the more conservative approach with regards to recultivation.

knitr::include_graphics(path = paste0(p_plots, run_label, "/temp_filter_counts_plot_full.png"))
```

## Classifying abandonment {#classifying-abn}

We only counted periods of abandonment that we could verify had followed agricultural activity during our time series.
Accordingly, pixels that remained in cropland or non-cropland classes throughout the entire time series were excluded.
This also meant that we excluded periods of non-cropland that began in the first year of the time series, because we had no way of knowing whether this non-cropland represented previously uncultivated land or land that had been cultivated in the past but now in a state of abandonment.
As a result, for pixels that began as non-cropland but were later classified as cropland and subsequently abandoned, we only counted periods of abandonment that directly followed classification as cropland.

To illustrate this, consider the following time series, which read left to right represents twenty years beginning at the start of our time series (where `1` represents non-cropland and `0` represents cropland):

> `'87 '88 '89 '90 '91 '92 '93 '94 '95 '96 '97 '98 '99 '00 '01 '02 '03 '04 '05 '06`  
> `..1   1   1   1   1   1   1   0   0   0   0   1   1   1   1   1   1   1   1   1`

This represents seven years of non-cropland to start the time series, followed by four years of cropland cultivation, followed by nine years of non-cropland. 
Though this pixel includes two periods of non-cropland classification of five or more years, we only include the second, nine year period, because we could verify that it followed cropland classification.

As noted, pixels that transitioned from cropland to the non-vegetation land cover class were not considered "abandoned," and therefore we excluded all non-vegetation pixels from our entire analysis.
These pixels accounted for <10% of total site area at all sites except `r non_veg_stats$site1` (`r non_veg_stats$site1_p`%) and `r non_veg_stats$site2` (`r non_veg_stats$site2_p`%), and remained stable or declined over time at all eleven sites (see Fig. \@ref(fig:area-by-lc)).

All area calculations were performed using the `terra` package's `cellSize()` function, which calculates the spherical area of each cell as defined by its four corners [@R-terra].


## Modeling abandonment decay {#decay-models-si}

Our mean abandonment duration metric tells us about the general persistence of abandoned croplands throughout the time series.
However, this value is limited by the time series length, and does not account for when the majority of the abandonment took place at a site, nor whether a period of abandonment ends as a result of recultivation or the end of the time series.
As a result, the mean abandonment duration does not tell us how long to expect a piece of land to remain abandoned, nor how abandonment length varies through time.
To address this constraint, we track the trajectory of each pixel through time following its initial abandonment, grouping pixels abandoned in a given year into "cohorts."
Decay rates provide information about how long it takes for land to be recultivated, complementing the mean abandonment length and providing a more nuanced story about how long to expect abandonment to last.

For example, a site may have a relatively short mean length of abandonment (e.g., Shaanxi/Shanxi, China, with a mean abandonment length of 13 years; see Fig. \@ref(fig:mean-abn-duration)), but also have a gradual decay rate, indicating that land is like to stay abandoned for a relatively longer amount of time.
This may result from more abandonment occurring towards the end of the time series; this land simply does not have as long to age and shows up as younger in our data, regardless of how long it may last.
Looking at abandonment decay rates for each cohort individually allows us to produce a decay rate for each site in general in a way that accounts for when during the time series a piece of land was abandoned (i.e., giving us a sense of how long to expect a given piece of land to remain abandoned, even into the future).

### Model selection and diagnostics

We fit a linear model using the `lm()` function in R's core statistics package `{stats}`, predicting the proportion of abandoned cropland in each cohort remaining abandoned as a function of time since initial abandonment at each site.
The proportion of abandoned cropland remaining abandoned is measured relative to the area abandoned 5 years following the year of initial abandonment, as dictated by our five year abandonment definition.

We tested a range of model specifications, including linear and log transformations of both *proportion* and *time*.
Due to a linear relationship between model residuals and time when including only one term for *time*, we also tested models containing multiple *time* predictor terms, including both log and linear terms.

We chose a model with the following specifications shown in Equation 1 and reproduced here in Equation \@ref(eq:mod-spec-SI).
For cohorts of abandonment initially abandoned in years $i = 1988, ... , 2013$, we estimate the proportion $p$ of each cohort $i$ at site $j$ remaining abandoned as a function of time $t$ (i.e., based on the number of years after initial abandonment).

\begin{equation}
p_{yz} = 1 + \beta_{yz,1} log(t + 1) + \beta_{yz,2} t (\#eq:mod-spec-SI)
\end{equation}

Where $\beta_{yz,1}$ represents the regression coefficient on the log term of time $t$ for cohort $y$ at site $z$, and $\beta_{yz,2}$ represents the regression coefficient on the linear term of time $t$ for cohort $y$ at site $z$.
We allow for *cohort* and *site* level fixed effects, fitting unique coefficients for each cohort at each site.
We ran a single pooled model using data across all 11 sites, using the following function call: `stats::lm(formula = I(proportion - 1)  ~ 0 + log(time + 1):cohort:site + I(time):cohort:site)`.

Model selection was performed based on Akaike Information Criterion (AIC) values (Fig. \@ref(fig:AIC)), selecting the model with the lowest (i.e., more negative) AIC value.
We confirmed that linear model assumptions were not violated through visual inspection of both residuals vs. fitted plots and Q-Q plots (Fig. \@ref(fig:diag-combo)).

The observations and fitted values for each cohort from our pooled linear model are shown in Fig. \@ref(fig:decay-model-grid).

### Comparing across cohorts using common endpoints

Our method of parameterizing our pooled linear model for subsets of our data according to common endpoints was developed primarily to facilitate fair comparisons across cohorts, particularly by calculating mean trajectories for each site at different endpoints.
In order to calculate the mean decay trajectory for a given site at a given endpoint (as shown by the red lines in Figs. \@ref(fig:endpoint-panel-a) - \@ref(fig:endpoint-panel-b)), we took the mean of the log coefficients ($\beta_{\bar{y}z, 1}$) and the mean of the linear coefficients ($\beta_{\bar{y}z, 2}$) respectively across all cohorts $y$ at each site $z$, for a given endpoint.
<!-- These mean values are shown in Fig. \@ref(fig:decay-mod-coef). -->
We then used these mean coefficient values ($\beta_{\bar{y}z,1}$ and $\beta_{\bar{y}z,2}$) to define a new function describing the mean recultivation (or decay) trajectory for each site at each endpoint, using the same for as Equation \@ref(eq:mod-spec-SI).

## Estimating soil organic carbon accumulation {#section-soc-si}

We derived mean soil organic carbon sequestration rates from the Soils Revealed database [@Sanderman2020; @Woolf2020].
Soils Revealed contains multiple scenarios of SOC accumulation under different land use change outcomes, including one that estimates the soil organic carbon that could accumulate in agricultural lands (cropland and pastures) from a full return to native vegetation.
This scenario provides estimates SOC stocks at 20 years and 80 years of regeneration.
In order to translate this into an annual rate of soil organic carbon accumulation, we first extracted SOC stock values for only those pixels that transitioned from cropland to native vegetation (using the IPCC land cover map used in development of the database), and calculated the mean stock at 20 and 80 years at each site. 
First we calculated an annual SOC accumulation rate to be applied during the first 20 years of regeneration by simply dividing the 20 year stock value by 20.
To calculate an annual rate to apply for years 21 through 80, we divided the difference of the 80 year and 20 year SOC stock by 60.

## Change in recultivation rates over time {#section-methods-rate-of-change}

We examined the rate of change of recultivation rates by calculating the half-life, $t_{half,s}$, defined as the time required for half (50%) of a given cohort of abandoned cropland to be recultivated, and parameterizing a simple linear model on these half-life values as a function of time, using the `stats::lm()` function in R's core statistics package `{stats}`.
This resulted in *n* = 26 half-life values (one for each cohort) at each of our 11 sites.
We estimate the half-life, $t_{half,s}$, as a function of the year of initial abandonment ($yearabn_{s}$), at each site $s$, as shown in Equation \@ref(eq:rate-of-change-lm).

\begin{equation}
t_{half,s} = \beta_{0,s} + \beta_{1,s} yearabn_{s} (\#eq:rate-of-change-lm)
\end{equation}

Where $\beta_{1,s}$ represents the regression slope on the year abandoned (cohort) for site $s$ ($yearabn_{s}$), and $\beta_{0,s}$ represents the intercept.
This corresponds to a `stats::lm()` call of `lm(formula = t_half ~ year_abandoned)`, run for each site individually.
Results are shown in Fig. \@ref(fig:decay-rate-of-change).

We confirmed that model assumptions were met through visual inspection of residuals vs. fitted plots and Q-Q plots (Fig. \@ref(fig:rate-of-change-diag-combo)).

\newpage

# Supplementary tables

```{r abn-panel-table, echo = FALSE, fig.pos = "ht"}
area_summary_df %>% 
  select(site_long, area_ha_Observed = area_abn_ha_2017, 
         area_ha_Potential = area_ever_abn_ha, 
         total_crop_extent_ha, 
         area_2017_as_prop_total_crop) %>%
  mutate(a_diff = -1 * 100 * (area_ha_Potential - area_ha_Observed) / area_ha_Potential) %>%
  arrange(desc(area_2017_as_prop_total_crop)) %>%
  
  # add the total row:
  bind_rows(
    tibble(site_long = "Total Across Sites",
           area_ha_Observed = sum(area_summary_df$area_abn_ha_2017),
           area_ha_Potential = sum(area_summary_df$area_ever_abn_ha),
           total_crop_extent_ha = sum(area_summary_df$total_crop_extent_ha)) %>%
      mutate(area_2017_as_prop_total_crop = area_ha_Observed/total_crop_extent_ha,
             a_diff = 100 * (area_ha_Potential - area_ha_Observed) / area_ha_Potential)
    ) %>%

  select(site_long, area_ha_Observed, area_ha_Potential, 
         a_diff, area_2017_as_prop_total_crop) %>%
  
  mutate(
    area_ha_Observed = area_ha_Observed %>% round(digits = 0) %>% prettyNum(big.mark = ","), 
    area_ha_Potential = area_ha_Potential %>% round(digits = 0) %>% prettyNum(big.mark = ","), 
    area_2017_as_prop_total_crop = round(area_2017_as_prop_total_crop*100, digits = 2) %>% 
      paste0(., "%"),
    a_diff = round(a_diff, digits = 2) %>% paste0(., "%")
    ) %>%
  knitr::kable(., 
             col.names = c("Site", 
                           "Observed area (ha)", 
                           "Potential area (ha)",
                           "Percent (%) difference from potential",
                           "Observed area as percent of total cropland extent"),
             align = "r", 
             #format = "simple",
             format = my_format,
             booktabs = TRUE,
             caption = "Observed area abandoned (Mha) as of 2017, potential area abandoned by 2017 (Mha) assuming no recultivation, the percent difference bewteen observed and potential abandonment, and observed abandonment as of 2017 as a percent of the total cropland extent (i.e., the area of all lands that were cultivated at some point during the time series). This table replicates Figure S2. Note that sites are shown in descending order of area abandoned as of 2017 as a proportion of total cropland extent."
             ) %>%
  kableExtra::kable_styling(
    # latex_options = "scale_down"
    latex_options = "hold_position"
    ) %>%
  column_spec(1, width = "4.1cm") %>%
  column_spec(2, width = "1.5cm") %>%
  column_spec(3, width = "1.7cm") %>%
  column_spec(4, width = "3.2cm") %>%
  column_spec(5, width = "3.2cm")

```

\newpage

```{r carbon-table, echo = FALSE, fig.pos = "ht"}

potential_v_obs_2017_df %>%
  select(site_long, 
         area_ha_Observed, area_ha_Potential,
         Mg_C_Observed, Mg_C_Potential, c_diff) %>%
  mutate(MgC_per_ha_Observed = (Mg_C_Observed / area_ha_Observed)) %>%
  arrange(MgC_per_ha_Observed) %>%

  # add the total row:
  bind_rows(
    tibble(site_long = "Total Across Sites",
           area_ha_Observed = sum(potential_v_obs_2017_df$area_ha_Observed),
           area_ha_Potential = sum(potential_v_obs_2017_df$area_ha_Potential),
           Mg_C_Observed = sum(potential_v_obs_2017_df$Mg_C_Observed),
           Mg_C_Potential = sum(potential_v_obs_2017_df$Mg_C_Potential)) %>%
      mutate(c_diff = 100 * (Mg_C_Potential - Mg_C_Observed) / Mg_C_Potential)
    ) %>%

  
  mutate(
    MgC_per_ha_Observed = (Mg_C_Observed / area_ha_Observed) %>% round(digits = 2),
    MgC_per_ha_Potential = (Mg_C_Potential / area_ha_Potential) %>% round(digits = 2),
    Mg_C_Observed = Mg_C_Observed %>% round(digits = 0) %>% prettyNum(big.mark = ","),
    Mg_C_Potential = Mg_C_Potential %>% round(digits = 0) %>% prettyNum(big.mark = ","),
    c_diff = (-1 * c_diff) %>% round(digits = 2) %>% paste0(., "%")
    ) %>%
  select(-c(area_ha_Observed, area_ha_Potential)) %>%

  knitr::kable(., 
             col.names = c("Site",
                           "Carbon (Mg C, observed)",
                           "Carbon (Mg C, potential)",
                           "Carbon (% diff. from potential)",
                           "Mg C per ha, observed",
                           "Mg C per ha, potential"),
             align = "r", 
             format = my_format,
             booktabs = TRUE,
             caption = "Estimated carbon sequestration in observed and potential area abandoned by 2017, reported in terms of Mg C, as the percent difference between observed and potential accumulation, and as Mg C per ha."
             ) %>%
  kableExtra::kable_styling(
    # latex_options = "scale_down"
    latex_options = "hold_position"
    ) %>%
  column_spec(1, width = "4.2cm") %>%
  column_spec(c(2:3), width = "2.1cm") %>%
  column_spec(c(4), width = "3cm") %>%
  column_spec(c(5:6), width = "2cm")
```

\newpage

```{r twoyr-diff-table, echo = FALSE, fig.pos = "ht"}
abn_2yr_overestimation_char %>% 
  select(site_long, area_ha_cc, area_2yr, percent_diff, jaccard, percent_2yr_abn_area_less_than_5yrs_old) %>%

  knitr::kable(., 
             col.names = c("Site", 
                           "Area (annual, as of 2017)", 
                           "Area (two year: 2017-1987)", 
                           "Percent % from annual area", 
                           "Jaccard Similarity",
                           "Percent Area <5 Years Old (two year)"),
             align = "r", 
             format = my_format,
             booktabs = TRUE,
             caption = "Cropland abandonment (in Mha) as of 2017 as identified using a) our annual time series and a five-year abandonment definition and b) a two year method taking the difference between land cover in 1987 and 2017."
             ) %>%
  kableExtra::kable_styling(
    # latex_options = "scale_down"
    latex_options = "hold_position"
    )%>%
  column_spec(1, width = "4.2cm") %>%
  column_spec(c(2:3), width = "2cm") %>%
  # column_spec(3, width = "2cm") %>%
  column_spec(4:5, width = "1.7cm") %>%
  column_spec(6, width = "2cm")
```

\newpage

```{r summary-stats-table, echo = FALSE, fig.pos = "ht"}
mean_length_df %>% filter(length_type == "all", abn_threshold == 5) %>% 
  left_join(., select(site_df, site, description), by = "site") %>%
  select(site = description, mean_duration, median_duration, sd_duration) %>%
  mutate(mean_duration = round(mean_duration, digits = 2), 
         sd_duration = round(sd_duration, digits = 2)) %>%
  
  knitr::kable(., 
             col.names = c("Site", "Mean", "Median", "Standard Deviation"),
             align = "r", #format = "simple",
             format = my_format,
             booktabs = TRUE,
             caption = "Summary statistics describing the duration of abandonment (in years) at our eleven sites between 1987 and 2017, using a five year abandonment definition, and incorporating all periods of abandonment (allowing for multiple per pixel)."
             ) %>%
  kableExtra::kable_styling(
    # latex_options = "scale_down"
    latex_options = "hold_position"
    ) #%>%
#   readr::write_file(., "kable_out.pdf")
# 
#   kableExtra::save_kable(#width = 5, height = 2,
#            file = paste0(p_plots, "my_table.html"),
#            keep_tex = TRUE
#              #paste0(p_plots, run_label, "/", "table_s1.pdf")
#                  )
# 
# tinytex::tlmgr_install(
#   # pkgs = "ragged2e"
#   # pkgs = "standalone"
#   pkgs = "fontspec"#"polyglossia"#"preview"
# )

```

\newpage

# Supplementary figures

(ref:caption-maps-max-abn-duration) Maximum duration of cropland abandonment (in years) observed at each pixel between 1987 and 2017 in our eleven study sites. This serves as a companion to maps of the abandonment duration as of 2017 shown in Fig. \@ref(fig:maps-abn-duration). Site locations are shown in Fig. \@ref(fig:global-map).

```{r maps-max-abn-duration, fig.cap = '(ref:caption-maps-max-abn-duration)', echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, "fig1_max", run_label, ".pdf"))
```

\newpage

(ref:caption-mean-abn-duration-w-max) The distribution of the maximum abandonment duration (in years) for each pixel at each site from 1987 to 2017. The y-scale shows the proportion of pixels with maximum duration values of a given duration at each site. As previously noted, abandonment and recultivation can occur multiple times at a single pixel during our time series, and this figure serves as a companion to the distribution of all abandonment periods shown in Fig. \@ref(fig:mean-abn-duration). Site-level mean duration values are shown in the red and blue dots, corresponding to mean values calculated across all periods of abandonment (in red, including multiple periods per pixel) and mean values calculated across only the maximum duration of abandonment at each pixel (in blue). The vertical dashed lines represent the mean of these site-level mean duration values, for all abandonment periods (red) and only the maximum duration at each pixel (blue), respectively.

```{r mean-abn-duration-w-max, fig.cap = '(ref:caption-mean-abn-duration-w-max)', out.width = "11cm", echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, "fig2_w_max", run_label, ".pdf"))
```

\newpage

(ref:caption-area-abn-panel) Abandonment area as of 2017, across three categories: a) area of abandonment observed as of 2017, b) area of all croplands abandoned at least once between 1987-2017 (i.e., the potential area abandoned by 2017, assuming no recultivation), c) observed area abandoned as of 2017 as a proportion of the total cropland extent (i.e., the area of all lands that were cultivated at some point during the time series). Note that sites are shown in ascending order of area abandoned as of 2017 as a proportion of total cropland extent.

```{r area-abn-panel, fig.cap = '(ref:caption-area-abn-panel)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/area_abn_panel", run_label, ".pdf"))
```

\newpage

(ref:caption-recult-by-threshold) Recultivation rates shown for various abandonment thresholds.

```{r recult-by-threshold, fig.cap = '(ref:caption-recult-by-threshold)'}
knitr::include_graphics(path = paste0(p_output, "plots/", run_label, "/recultivation_rates_by_threshold", run_label, ".pdf"))
```

\newpage

(ref:caption-potential-area-bins) Potential area abandoned over time, assuming no recultivation took place, shown according to age class (in years). Cumulative potential area abandoned at each site is shown as the dashed black line, and the cumulative observed area abandoned is shown for comparison as the solid black line. This figure serves as a companion to Fig. \@ref(fig:area-abn-by-age-class).

```{r potential-area-bins, fig.cap = '(ref:caption-potential-area-bins)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/potential_area_age_bins", run_label, ".pdf"))
```

\newpage

(ref:caption-mean-potential-abn-duration) The distribution of potential abandonment duration (in years) for all periods of abandonment from 1987 to 2017, assuming no recultivation occurred following abandonment that met our five year threshold. The y-scale shows the proportion of potential abandonment periods of a given duration at each site. The red points represent the potential mean abandonment duration (in years) at each site, and the red vertical dashed line represents the mean of these site-level mean duration values across all sites. This serves as a companion to the distribution of observed abandonment periods in Fig. \@ref(fig:mean-abn-duration).

```{r mean-potential-abn-duration, fig.cap = '(ref:caption-mean-potential-abn-duration)', out.width = "11cm", echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, "fig2_potential", run_label, ".pdf"))
```

\newpage

(ref:caption-mean-recult-duration) The distribution of duration of recultivation periods that took place after qualifying periods of abandonment. Recultivation (in which abandoned croplands were reclassified as active cropland for one or more years) could take place at any point in or after 1993 (as a result of our five year abandonment threshold). Note that we included all periods of recultivation, regardless of length, given that recultivation of even one year is biologically relevant to the process of secondary succession. The y-scale shows the proportion of pixels with recultivation periods of a given duration at each site. As previously noted, abandonment and recultivation can occur multiple times at a single pixel during our time series, and this figure serves as a companion to the distribution of all abandonment periods shown in Fig. \@ref(fig:mean-abn-duration). Site-level mean duration values are shown as red dots, corresponding to mean values calculated across all periods of recultivation (including the possibility of multiple periods per pixel). The vertical dashed lines represent the mean of these site-level mean duration values, for all recultivation periods.

```{r mean-recult-duration, fig.cap = '(ref:caption-mean-recult-duration)', out.width = "11cm", echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, "fig2_recult", run_label, ".pdf"))
```

\newpage

(ref:caption-carbon-map-2017-observed) Cumulative carbon accumulation in abandoned croplands as of 2017. This cumulative value incorporates both carbon accumulated in forested biomes (including aboveground biomass, belowground biomass, and soil organic carbon, from [@Cook-Patton2020]) and soil organic carbon accumulated in non-forested biomes [@Sanderman2020; @Woolf2020]. Forested biomes were delineated using Ecoregions2017 (RESOLVE) [@Dinerstein2017].

```{r carbon-map-2017-observed, fig.cap = '(ref:caption-carbon-map-2017-observed)'}
knitr::include_graphics(path = paste0(p_output, "plots/", run_label, 
                                      "/carbon/total_c_accumulation_5_2017",
                                      run_label, ".pdf"))
```

\newpage

(ref:caption-carbon-map-2017-potential) Potential carbon accumulation in abandoned croplands as of 2017, assuming no recultivation of abandoned croplands. Calculated using identical carbon accumulation rates as \@ref(fig:carbon-map-2017-observed), but assuming no recultivation.

```{r carbon-map-2017-potential, fig.cap = '(ref:caption-carbon-map-2017-potential)'}
knitr::include_graphics(path = paste0(p_output, "plots/", run_label, 
                                      "/carbon/potential_total_c_accumulation_5_2017",
                                      run_label, ".pdf"))
```


(ref:caption-site-biomes) Biomes at each site, derived from Ecoregions2017 (RESOLVE) [@Dinerstein2017].

```{r site-biomes, fig.cap = '(ref:caption-site-biomes)', echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, "biomes2017_by_site.pdf"))
```

(ref:caption-site-biomes-for-nonfor) Biomes at each site, separated into forest and non-forest, derived from Ecoregions2017 (RESOLVE) [@Dinerstein2017].

```{r site-biomes-for-nonfor, fig.cap = '(ref:caption-site-biomes-for-nonfor)', echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, "biomes2017_for_nonfor.pdf"))
```

(ref:caption-site-ecoregions) Ecoregions at each site, from Ecoregions2017 (RESOLVE) [@Dinerstein2017].

```{r site-ecoregions, fig.cap = '(ref:caption-site-ecoregions)', echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, "ecoregions2017_by_site_tall.pdf"))
```

(ref:caption-carbon-map-Y20-rate) Annual carbon sequestration rates for the first 20 years of secondary succession, in terms of Mg C per hectare. Forest carbon sequestration rates are drawn from @Cook-Patton2020, and include aboveground biomass, belowground biomass, and soil organic carbon, and apply for the first 30 years of secondary succession. Soil organic carbon sequestration rates in non-forest biomes are drawn from @Sanderman2020 and @Woolf2020, and apply for the first 20 years of secondary succession. Forested biomes were delineated using Ecoregions2017 (RESOLVE) [@Dinerstein2017]. See Fig. \@ref(fig:site-biomes-for-nonfor).

```{r carbon-map-Y20-rate, fig.cap = '(ref:caption-carbon-map-Y20-rate)'}
knitr::include_graphics(path = paste0(p_output, "plots/", run_label, 
                                      "/carbon/forest_soc_combined",
                                      # "_per_pixel",
                                      "_Y20",
                                      run_label, ".pdf"))
```

(ref:caption-carbon-map-YSS-rate) Annual carbon sequestration rates for the third decade of secondary succession (years 21 through 30), in terms of Mg C per hectare. Forest carbon sequestration rates are drawn from @Cook-Patton2020, and include aboveground biomass, belowground biomass, and soil organic carbon, and apply for the first 30 years of secondary succession. Soil organic carbon sequestration rates in non-forest biomes are drawn from @Sanderman2020 and @Woolf2020, and are calculated from estimated "steady state" values after 80 years of succession. Forested biomes were delineated using Ecoregions2017 (RESOLVE) [@Dinerstein2017]. See Fig. \@ref(fig:site-biomes-for-nonfor).

```{r carbon-map-YSS-rate, fig.cap = '(ref:caption-carbon-map-YSS-rate)'}
knitr::include_graphics(path = paste0(p_output, "plots/", run_label, 
                                      "/carbon/forest_soc_combined",
                                      # "_per_pixel",
                                      "_YSS",
                                      run_label, ".pdf"))
```

(ref:caption-carbon-per-ha) Total carbon accumulation per hectare over time.

```{r carbon-per-ha, fig.cap = '(ref:caption-carbon-per-ha)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/carbon/carbon_accumulated_per_ha.pdf"))
```

(ref:caption-quadrant) Abandonment decay as a function of extent of abandonment at each site. Abandonment decay is shown on the y-axis, as half-lives for endpoints of 10, 15, 20, and 25 years (represented by yellow to purple colors). Abandonment extent is shown on the x-axis as the area abandoned in 2017 as a proportion of the total cropland extent at each site. The absolute area abandoned as of 2017 is shown by the size of the points for each site. The red dashed lines represent the mean values for each axis.

```{r quadrant, fig.cap = '(ref:caption-quadrant)', fig.width = 7.5}
knitr::include_graphics(path = paste0(p_plots, run_label, "/quadrant_endpoints_10_25yr", 
                                     run_label, ".pdf"))
```

(ref:caption-endpoint-half-lives-all) Mean half-lives of abandoned croplands at each site, calculated across our full range of common endpoints (7 to 29 years). See Materials and Methods for a description of our common endpoint modeling approach. These half-lives are calculated for mean site trajectories calculated across model runs at a specific common endpoint (e.g., 15 years), in order to make fair comparisons across cohorts with varying numbers of observations. This serves as a full companion to Fig. \@ref(fig:endpoint-half-lives)

```{r endpoint-half-lives-all, fig.cap = '(ref:caption-endpoint-half-lives-all)', fig.width = 7.5}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/",
                                     "half_lives_endpoints_by_obs",
                                     run_label, 
                                     # "_grid",
                                     ".pdf"))
```

(ref:caption-decay-rate-of-change) The rate of change of decay rates (measured as the half-life, or the time required for 50% of each cohort to be recultivated) at each site over the course of the time series. Individual site trends are shown in panel a. Solid lines show simple linear regressions, the slopes of which are shown in panel b. Gray bands around the linear trends in panel a and the error bars on slope estimates in panel b both represent 95% confidence intervals. These models are described by Eq. \@ref(eq:rate-of-change-lm). Model diagnostic plots are shown in Fig. \@ref(fig:rate-of-change-diag-combo).

```{r decay-rate-of-change, fig.cap = '(ref:caption-decay-rate-of-change)', echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/",
                                      "rate_of_change_recultivation_speed_combo", 
                                      "_lincom", run_label, ".pdf"))

# To include the figure using the linear combination, and a full model including all sites:
# Note - I decided to stick with individual models for each site, to match how the decay models were structured.

# knitr::include_graphics(path = paste0(p_plots, run_label,
#                                       "/decay/rate_of_change_recultivation_speed_combo", 
#                                       "_lincom", run_label, ".pdf"))


# old confidence intervals
# knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/rate_of_change_recultivation_speed_combo",
#                                       "_old", run_label, ".pdf"))


# old version, with quadrants, and old CIs
# knitr::include_graphics(path = paste0(p_plots, run_label, "/presentation/rate_of_change_recultivation_speed", run_label, ".pdf"))
# knitr::include_graphics(path = paste0(p_plots, run_label, "/presentation/rate_of_change_recultivation_speed_old", run_label, ".pdf"))
```

(ref:caption-area-by-lc) Area in each land cover class at each site through time. Mapped land cover classes are cropland, grassland, woody vegetation, and non-vegetation. Note that the area abandoned (for at least 5 years, shown in pink) consists of increases in grassland and woody vegetation that took place on former croplands. Therefore, these three classes are not mutually exclusive.

```{r area-by-lc, fig.cap = '(ref:caption-area-by-lc)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/area_by_lc_grid", run_label, ".pdf"))
```

(ref:caption-abn-duration-by-threshold) Mean abandonment lengths shown for various abandonment thresholds.

```{r abn-duration-by-threshold, fig.cap = '(ref:caption-abn-duration-by-threshold)'}
knitr::include_graphics(path = paste0(p_output, "plots/", run_label, "/mean_lengths_by_threshold", run_label, ".pdf"))
```

(ref:caption-recult-duration-by-threshold) Mean recultivation duration at each site, shown for various abandonment thresholds.

```{r recult-duration-by-threshold, fig.cap = '(ref:caption-recult-duration-by-threshold)'}
knitr::include_graphics(path = paste0(p_output, "plots/", run_label, "/mean_recult_lengths_by_threshold", run_label, ".pdf"))
```


(ref:caption-turnover-grid) Annual turnover of abandoned croplands at each site, showing the annual gain (dark green) and annual loss (i.e., recultivation, light green) and net change (black line) of abandoned croplands.

```{r turnover-grid, fig.cap = '(ref:caption-turnover-grid)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/turnover_grid", run_label, ".pdf"))
```

(ref:caption-abn-prop-lc) Proportion of abandoned cropland in each land cover class as of 2017.

```{r abn-prop-lc, fig.cap = '(ref:caption-abn-prop-lc)', out.width = "14cm", echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, run_label, "/abn_prop_lc_2017", run_label, ".pdf"))
```

(ref:caption-AIC) Akaike Information Criterion (AIC) values for various recultivation ("decay") model specifications polled across all 11 sites. Specifications included multiple combinations of site and cohort fixed effects, and linear and log transformations. More negative AIC values indicate a better model fit.

```{r AIC, fig.cap = '(ref:caption-AIC)', fig.width = 7.5}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "mod_AIC_mega_plot", run_label, ".pdf"))
```

(ref:caption-decay-mod-coef) All model coefficients from our pooled model across all 11 sites, shown with associated uncertainty (95% confidence intervals).

```{r decay-mod-coef, fig.cap = '(ref:caption-decay-mod-coef)', echo = FALSE}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", 
                                      "mod_coef_uncertainty_mega", run_label, ".pdf"))
```

(ref:caption-endpoint-panel-a) Recultivation ("decay") of abandoned croplands through time, modeled from subsets based on common endpoints, developed in order to make fair comparisons across cohorts. Observations are shown as points, and model decay trends are shown as dashed lines. Mean decay trajectories are shown in red for site across four common endpoints (10, 15, 20, and 25 years in columns left to right), along side the full dataset shown in the rightmost column for comparison (corresponding to Fig. \@ref(fig:decay-model-grid)). These site mean decay trends were used to calculate the endpoint half-lives shown in Figs. \@ref(fig:endpoint-half-lives) and \@ref(fig:endpoint-half-lives-all). This figure shows our first five sites; the final six sites are shown in Fig. \@ref(fig:endpoint-panel-b). 

```{r endpoint-panel-a, fig.cap = '(ref:caption-endpoint-panel-a)', fig.width = 7.5}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/",
                                     "endpoints_by_site_5_25_a", 
                                     run_label, ".pdf"))
```

(ref:caption-endpoint-panel-b) Companion figure to Fig. \@ref(fig:endpoint-panel-a). Refer to associated caption to Fig. \@ref(fig:endpoint-panel-a) above.

```{r endpoint-panel-b, fig.cap = '(ref:caption-endpoint-panel-b)', fig.width = 7.5}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/",
                                     "endpoints_by_site_5_25_b", 
                                     run_label, ".pdf"))
```


<!-- (ref:caption-decay-mod-coef-mean) Mean decay model coefficients across cohorts at each site. The left panel shows the mean coefficient on the log(time) terms and the right shows the site mean coefficient on the linear time terms. These mean coefficients are used to plot the mean decay trajectories shown in Fig. 3. -->

<!-- ```{r decay-mod-coef-mean, fig.cap = '(ref:caption-decay-mod-coef-mean)', echo = FALSE} -->
<!-- knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "mean_coef_ci", run_label, ".pdf")) -->
<!-- ``` -->

(ref:caption-diag-combo) Diagnostic plots for our final linear model of the recultivation ("decay") of abandonment across sites. These models take the form shown in Equation \@ref(eq:mod-spec-SI), and are shown in Fig. \@ref(fig:decay-model-grid).

```{r diag-combo, fig.cap = '(ref:caption-diag-combo)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "decay_mod_diagnostics_l3_combo", run_label, ".png"))
```

(ref:caption-rate-of-change-diag-combo) Residuals vs. fitted values (left) and QQ (right) diagnostic plots, for a simple `lm` call corresponding to Eq. \@ref(eq:rate-of-change-lm), in which the half-life (i.e., the time required for 50% of a given cohort of abandoned cropland to be recultivated) is modeled as a function of the year of initial abandonment at each site.

```{r rate-of-change-diag-combo, fig.cap = '(ref:caption-rate-of-change-diag-combo)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "rate_of_change_l3_diag_full_mod", run_label, ".png"))
```

