---
title: "Supplementary information for: Rural cropland abandonment is too ephemeral to benefit carbon sequestration or biodiversity conservation"
author:
  - Christopher L. Crawford$^1$^[Corresponding Author, ccrawford@princeton.edu, Robertson Hall, Princeton University, Princeton, NJ]
  - He Yin$^2$
  - Volker C. Radeloff$^3$
  - David S. Wilcove$^{1,4}$
date: 
  $^1$Princeton School of Public and International Affairs, Princeton University, Princeton, NJ\newline 
  $^2$Department of Geography, Kent State University, Kent, OH\newline
  $^3$SILVIS Lab, Department of Forest & Wildlife Ecology, University of Wisconsin - Madison, Madison, WI\newline
  $^4$Department of Ecology & Evolutionary Biology, Princeton University, Princeton, NJ\newline
  \newline
  \today
output:
  bookdown::pdf_document2:
    keep_tex: true
    includes:
      in_header: "preamble.tex"
editor_options:
  chunk_output_type: console
bibliography: [/Users/christophercrawford/work/library/library.bib, packages.bib]
link-citations: yes
csl: science-advances.csl
lineno: true
urlcolor: blue
linkcolor: black
citecolor: black
---
\beginsupplement

```{r render}
# Save final PDF of SI for submission:
rmarkdown::render("scripts/Crawford_abandonment_SI.Rmd",
                  output_file = paste0(p_proj, "writing/", "Crawford_abandonment_SI.pdf"),
                  output_format = "bookdown::pdf_document2")
```


```{r load-packages-functions, eval = TRUE, echo = FALSE, include = FALSE}
source("/Users/christophercrawford/work/projects/abandonment_trajectories/scripts/0_start.R")
# source(paste0(p_proj, "scripts/util/_util_main.R"))
# devtools::install_github("benmarwick/wordcountaddin", type = "source", dependencies = TRUE)

# replace the following figure references:
# \@ref(fig:maps-abn-duration) = Figure 1
# \@ref(fig:mean-abn-duration) = Figure 2
# \@ref(fig:decay-curves-by-site) = Figure 3
# \@ref(fig:abn-decay-s) = Figure 4
```

```{r set-chunk-opts, include = FALSE}
# set default chunk options
knitr::opts_chunk$set(
  out.width = "1\\textwidth",  # if compiling a pdf, include this option
  # comment = NA,
  # fig.width=6, fig.height=6, 
  echo = FALSE # the code itself will NOT be printed with results
  )

options(knitr.table.format = function() {
  if (knitr::is_latex_output())
    "latex" else "pipe"
})
```

```{r produce-package-bib, include = FALSE, echo = FALSE}
# needed_packages
# github_packages
knitr::write_bib(x = c(needed_packages, github_packages), file = 'packages.bib')
# knitr::write_bib(x = c("car"), file = 'extra.bib')

# citation(package = needed_packages[1])

# knitr::write_bib(x = c(needed_packages[c(14)]), file = 'packages_top.bib')
# knitr::write_bib(x = c(needed_packages[3]), file = 'terra.bib')

# 
# needed_packages[1]
# packageDescription(needed_packages[1])
```

```{r load-files, include = FALSE}

# set run:
run_label <- "_2021_03_13"

# Additional paths --------------------------------------------------- #
p_plots <- "/Users/christophercrawford/work/projects/abandonment_trajectories/output/plots/"
p_derived2 <- paste0(p_dat_derived, run_label, "/derived_data/")

# load general spatial data on site locations --------------------------------------------------- #
site_df <- read.csv(file = paste0(p_dat_derived, "site_df.csv"))
site_df_w_size <- read.csv(file = paste0(p_dat_derived, "site_df_w_size.csv"))
site_sf <- st_read(paste0(p_dat_derived, "site_sf.shp"))


# load all length data (distilled)
length_distill_df <- read_csv(file = paste0(p_derived2, 
                                            "length_distill_df", run_label, ".csv"))

# load mean length data
mean_length_df <- read_csv(file = paste0(p_derived2, "mean_length_df", run_label, ".csv"))


# load summary statistic derived from lengths
summary_stats_all_sites <- read_csv(file = paste0(p_derived2, "summary_stats_all_sites", run_label, ".csv"))
summary_stats_all_sites_pooled <- read_csv(file = paste0(p_derived2, "summary_stats_all_sites_pooled", run_label, ".csv"))

# load area summary stats:
area_summary_df <- read_csv(file = paste0(p_derived2, "area_summary_df", run_label, ".csv"))
area_recult_threshold <- read_csv(file = paste0(p_derived2, "area_recult_threshold", run_label, ".csv"))


# load stats on proportion of abandoned cropland by land cover
abn_lc_count_2017 <- read_csv(file = paste0(p_derived2, "abn_lc_count_2017", run_label, ".csv"))
abn_prop_lc_2017 <- read_csv(file = paste0(p_derived2, "abn_prop_lc_2017", run_label, ".csv"))


# load combined persistence, area, and turnover datasets:
# also known as dat_l in "4_decay_models.Rmd"

persistence_dat <- 
  # dat_l <- 
  read_csv(file = paste0(p_derived2, "persistence_dat", run_label, ".csv")) %>%
  mutate(site = as.factor(site),
         bins = as.factor(bins),
         year_abn_bins = as.factor(year_abn_bins),
         cohort = as.factor(cohort))

area_dat <- read_csv(file = paste0(p_derived2, "area_dat", run_label, ".csv"))
turnover_dat <- read_csv(file = paste0(p_derived2, "turnover_dat", run_label, ".csv"))



# load decay rate data
load(file = paste0(p_derived2, "/decay_mod_coef_dfs.rds"), 
     verbose = TRUE)

# load extrapolation data
extrapolate_df_l3 <- read_csv(file = paste0(p_derived2, "/extrapolate_df_l3", run_label, ".csv"))
extrapolate_df_l3_a2 <- read_csv(file = paste0(p_derived2, "/extrapolate_df_l3_a2", run_label, ".csv"))


# load data for shaanxi maps --------------------------------------------------- #

# load data for decay models --------------------------------------------------- #
fitted_df_l3 <- read_csv(file = paste0(p_derived2, "/decay_mod_fitted_df_l3", run_label, ".csv"))

load(file = paste0(p_derived2, "/decay_mod_coef_dfs.rds"), verbose = TRUE)
# contains:
# coef_df_l3, coef_df_wide_l3, mean_coef_df_l3, mean_coef_df_wide_l3, mean_coef_proj_l3, time_to_l3


# load extrapolation data
extrapolate_df_l3 <- read_csv(file = paste0(p_derived2, "/extrapolate_df_l3", run_label, ".csv"))

future_df_l3 <- read_csv(file = paste0(p_derived2, "/future_df_l3", run_label, ".csv"))

```

```{r misc-notes, eval = FALSE}
# --------------------------------------------------
# Miscellaneous YAML
# --------------------------------------------------
# Right after csl:
#   
# nocite: |
#   @RStudio, @R-rmarkdown, @R-bookdown, @R-knitr

# 
# - $^a$Princeton School of Public and International Affairs, Princeton University, Princeton, NJ
# - $^b$Department of Geography, Kent State University, Kent, OH
# - $^c$Department of Forest & Wildlife Ecology, University of Wisconsin - Madison, Madison, WI
# - $^d$Department of Ecology & Evolutionary Biology, Princeton University, Princeton, NJ
# 

# date: '`r format(Sys.Date(), "%B %d, %Y")`'
# 
# - Christopher L. Crawford^[Corresponding Author, ccrawford@princeton.edu, Robertson
#   Hall, Princeton University, Princeton, NJ] ^[Princeton University]
# - He Yin^[Kent State University]
# - Volker Radeloff^[University of Wisconsin, Madison]
# - David S. Wilcove^[Princeton University]

# author:
# - Christopher L. Crawford^[Corresponding Author, ccrawford@princeton.edu, Robertson Hall, Princeton University, Princeton, NJ] $^1$
# - He Yin$^2$
# - Volker Radeloff$^3$
# - David S. Wilcove$^{1, 4}$
# date: 
#   $^1$Princeton School of Public and International Affairs, Princeton University, Princeton, NJ \newline 
#   $^2$Department of Geography, Kent State University, Kent, OH \newline 
#   $^3$Department of Forest & Wildlife Ecology, University of Wisconsin - Madison, Madison, WI \newline 
#   $^4$Department of Ecology & Evolutionary Biology, Princeton University, Princeton, NJ


# --------------------------------------------------
# rmd-tips
# --------------------------------------------------

# Reference sections by including a tag directly after a header, such as {#section-label}, and then reference in line with the following:
# See Section \@ref(section-label)


# figures:
# this is a chunk for including a pre-existing plot or graphic.
#knitr::include_graphics("/Users/christophercrawford/work/projects/Zambia/agroEcoTradeoff/external/plots/Estes-plots_test.png")

# Figure captions:
# https://bookdown.org/yihui/rmarkdown-cookbook/cross-ref.html

# manually write figure captions outside of chunk with the following
# (ref:caption-label) Figure caption text.

# Chunk options:
# include = FALSE - this means that the code will still be evaluated, but none of the output will be included in the resulting document.

# fig.cap = '(ref:caption-label)' in the chunk options

# cross reference in line with: \@ref(fig:chunk-label) (or eq:label, or tab:label)

# can also include a list of figures by including the following in the YAML
# lof: True
# or, as I currently have it.
# \listoffigures

```

```{r get-summary-stats, include = FALSE}
summary_stats_all_sites
extrapolate_df_l3

abn_duration_stats <- list(
  mean_of_means_duration = summary_stats_all_sites$mean_of_means %>% round(digits = 2),
  mean_of_sds_duration = summary_stats_all_sites$mean_of_sds %>% round(digits = 2),
  sd_of_mean_duration = summary_stats_all_sites$sd_of_means %>% round(digits = 2),
  
  extrapolation_low = extrapolate_df_l3 %>% select(site, max_mean_age) %>% unique() %>% arrange(max_mean_age) %>% .$max_mean_age %>% .[1] %>% round(digits = 1),
  extrapolation_high = extrapolate_df_l3 %>% select(site, max_mean_age) %>% unique() %>% arrange(max_mean_age) %>% .$max_mean_age %>% .[9] %>% round(digits = 1),
  
  duration_min = mean_length_df %>% 
    filter(abn_threshold == 5, length_type == "all") %>% 
    slice_min(mean_duration) %>% 
    select(mean_duration) %>% round(digits = 2),
  
  duration_min_site = mean_length_df %>% 
    filter(abn_threshold == 5, length_type == "all") %>% 
    slice_min(mean_duration) %>% .$site %>% capwords(),
  
  duration_max = mean_length_df %>% 
    filter(abn_threshold == 5, length_type == "all") %>% 
    slice_max(mean_duration) %>% 
    select(mean_duration) %>% round(digits = 2),
  
  duration_max_site = mean_length_df %>% 
    filter(abn_threshold == 5, length_type == "all") %>% 
    slice_max(mean_duration) %>% .$site %>% gsub("_", " & ",.) %>% capwords(),
  
  sd_min = mean_length_df %>% filter(abn_threshold == 5, length_type == "all") %>% slice_min(sd_duration) %>% select(sd_duration) %>% round(digits = 2),
  sd_min_site = mean_length_df %>% filter(abn_threshold == 5, length_type == "all") %>% slice_min(sd_duration) %>% .$site %>% capwords(),
  
  sd_max = mean_length_df %>% filter(abn_threshold == 5, length_type == "all") %>% slice_max(sd_duration) %>% select(sd_duration) %>% round(digits = 2),
  sd_max_site = mean_length_df %>% filter(abn_threshold == 5, length_type == "all") %>% slice_max(sd_duration) %>% .$site %>% gsub("_", " ",.) %>% capwords()
)


mean_length_df %>% filter(abn_threshold == 5, length_type == "all") %>% summarise(mean_sd = mean(sd_duration))
```

```{r get-results-stats, include = FALSE}
# site_r$shaanxi$y2017
# test_area <- raster::area(site_r$shaanxi$y2017)
# plot(test_area)
# ncell(site_r$shaanxi$y2017)
# ncell(test_area)
# names(test_area) <- "area_km2"
# test_dt <- as.data.table.raster(stack(site_r$shaanxi$y2017, test_area))
# test_dt[,sum(area_km2 * 100), by = y2017]
# 1332.768 + 1021861.526 + 153480.420 + 246237.428+ 151124.082

site_df_w_size # note that this includes NA or 0 lc class cells, so is an overestimate. Use the site area from area_summary_df
area_summary_df %>% names

area_summary_df %>% 
  select(site, area_abn_ha_2017, area_ever_abn_ha, cropland_area_1987, total_crop_extent_ha, total_site_area_ha_2017, 
         area_2017_as_prop_site, area_2017_as_prop_total_crop, area_2017_as_prop_crop87) %>% 
  arrange(area_2017_as_prop_total_crop)

area_summary_df %>% 
  select(site, area_abn_ha_2017, area_ever_abn_ha, cropland_area_1987, total_crop_extent_ha, area_2017_as_prop_total_crop, area_2017_as_prop_crop87) %>% 
  arrange(area_2017_as_prop_total_crop) %>% 
  mutate(prop_crop_total_to_87 = total_crop_extent_ha/cropland_area_1987)


area_summary_df %>% select(site, area_abn_ha_2017, total_site_area_ha_2017, area_2017_as_prop_site) %>% arrange(area_2017_as_prop_site)


# ---------------------------------------------------------------------- #
# area abandoned statistics
area_abn_stats <- list(
  "min" = area_summary_df %>% filter(site != "mato_grosso") %>% slice_min(area_abn_ha_2017) %>% select(area_abn_ha_2017) %>% 
    # as.numeric() %>% 
    prettyNum(big.mark = ","),
  "min_site" = area_summary_df %>% filter(site != "mato_grosso") %>% slice_min(area_abn_ha_2017) %>% .$site %>% capwords(),
  
  "max" = area_summary_df %>% slice_max(area_abn_ha_2017) %>% select(area_abn_ha_2017) %>% round(digits = 0) %>% as.numeric() %>% prettyNum(big.mark = ","),
  "max_site" = area_summary_df %>% slice_max(area_abn_ha_2017) %>% .$site %>% capwords(),

  "mg" = area_summary_df %>% filter(site == "mato_grosso") %>% select(area_abn_ha_2017) %>% round(digits = 0) %>% as.numeric() %>% prettyNum(big.mark = ","),
  "mg_abn_2017_as_percent_total_crop" = area_summary_df %>% filter(site == "mato_grosso") %>% select(area_2017_as_prop_total_crop) %>% round(digits = 4) * 100,
  "mg_ever_abn_as_percent_total_crop" = area_summary_df %>% filter(site == "mato_grosso") %>% select(area_ever_abn_as_prop_total_crop) %>% round(digits = 4) * 100,
  
  "total_area_Mha_2017_all_sites" = round(area_summary_df$total_site_area_ha_2017 %>% sum() / 10^6 , digits = 2),
  "total_crop_extent_area_Mha_2017_all_sites" = round(area_summary_df$total_crop_extent_ha %>% sum() / 10^6 , digits = 2),
  
  "total_area_ever_abn_Mha_all_sites" = round(area_summary_df %>% summarise(total_ever_abn_Mha = sum(area_ever_abn_ha)/1e6), digits = 2),
  "total_area_ever_abn_as_percent_of_total_crop_extent" = round(
    (sum(area_summary_df$area_ever_abn_ha) / sum(area_summary_df$total_crop_extent_ha)), 
    digits = 4) * 100,
  
  "total_crop_area_1987_Mha_all_sites" = round(area_summary_df$cropland_area_1987 %>% sum() / 10^6 , digits = 2),
  "total_area_abn_Mha_2017_all_sites" = round(area_summary_df$area_abn_ha_2017 %>% sum() / 10^6, digits = 2),
  
  "total_area_abn_2017_as_percent_of_total" = round((area_summary_df$area_abn_ha_2017 %>% sum()) / (area_summary_df$total_site_area_ha_2017 %>% sum()), digits = 4) * 100,
  
  "total_area_abn_2017_as_percent_of_crop87" = round(
    (sum(area_summary_df$area_abn_ha_2017) / sum(area_summary_df$cropland_area_1987)), 
    digits = 4) * 100,
  
  "total_area_abn_2017_as_percent_of_total_crop_extent" = round(
    (sum(area_summary_df$area_abn_ha_2017) / sum(area_summary_df$total_crop_extent_ha)), 
    digits = 4) * 100,
  
  # area_2017_as_prop_site
  "min_area_2017_as_prop_site" = area_summary_df %>% filter(site != "mato_grosso") %>% slice_min(area_2017_as_prop_site) %>% select(area_2017_as_prop_site) %>% round(digits = 4) * 100,
  "min_area_2017_as_prop_site_site" =  area_summary_df %>% filter(site != "mato_grosso") %>% slice_min(area_2017_as_prop_site) %>% .$site %>% capwords(),
  
  "max_area_2017_as_prop_site" = area_summary_df %>% slice_max(area_2017_as_prop_site) %>% select(area_2017_as_prop_site) %>% round(digits = 4) * 100,
  "max_area_2017_as_prop_site_site" = area_summary_df %>% slice_max(area_2017_as_prop_site) %>% .$site %>% capwords(),
  
  # area_2017_as_prop_total_crop
  "min_area_2017_as_prop_total_crop" = area_summary_df %>% filter(site != "mato_grosso") %>% slice_min(area_2017_as_prop_total_crop) %>% select(area_2017_as_prop_total_crop) %>% round(digits = 4) * 100,
  "min_area_2017_as_prop_total_crop_site" =  area_summary_df %>% filter(site != "mato_grosso") %>% slice_min(area_2017_as_prop_total_crop) %>% .$site %>% capwords(),
  
  "max_area_2017_as_prop_total_crop" = area_summary_df %>% slice_max(area_2017_as_prop_total_crop) %>% select(area_2017_as_prop_total_crop) %>% round(digits = 4) * 100,
  "max_area_2017_as_prop_total_crop_site" = area_summary_df %>% slice_max(area_2017_as_prop_total_crop) %>% .$site %>% gsub("_", " & ", .) %>% capwords(),
  

  # area_ever_abn_as_prop_total_crop
  "min_area_ever_abn_as_prop_total_crop" = area_summary_df %>% filter(site != "mato_grosso") %>% slice_min(area_ever_abn_as_prop_total_crop) %>% select(area_ever_abn_as_prop_total_crop) %>% round(digits = 4) * 100,
  "min_area_ever_abn_as_prop_total_crop_site" =  area_summary_df %>% filter(site != "mato_grosso") %>% slice_min(area_ever_abn_as_prop_total_crop) %>% .$site %>% capwords(),
  
  "max_area_ever_abn_as_prop_total_crop" = area_summary_df %>% slice_max(area_ever_abn_as_prop_total_crop) %>% select(area_ever_abn_as_prop_total_crop) %>% round(digits = 4) * 100,
  "max_area_ever_abn_as_prop_total_crop_site" = area_summary_df %>% slice_max(area_ever_abn_as_prop_total_crop) %>% .$site %>% gsub("_", " & ", .) %>% capwords()
)

## replace these
# area_2017_as_prop_site
# area_2017_as_prop_total_crop
# area_2017_as_prop_crop87
# area_ever_abn_as_prop_site
# area_ever_abn_as_prop_total_crop
# area_ever_abn_as_prop_crop87

# ---------------------------------------------------------------------- #
area_recult_threshold %>% filter(abn_threshold == 10) %>% select(site, proportion_recultivated) %>% arrange(proportion_recultivated)

# recultivation statistics
recult_stats <- list(
  "mean_thr_5" = area_recult_threshold %>% group_by(abn_threshold) %>% 
    summarise(mean_proportion = mean(proportion_recultivated),
              sd_proportion = sd(proportion_recultivated)) %>% 
    filter(abn_threshold == 5) %>% select(mean_proportion) %>% round(digits = 4) * 100,
  
  "sd_thr_5" = area_recult_threshold %>% group_by(abn_threshold) %>% 
    summarise(mean_proportion = mean(proportion_recultivated),
              sd_proportion = sd(proportion_recultivated)) %>% 
    filter(abn_threshold == 5) %>% select(sd_proportion) %>% round(digits = 4) * 100,
  
  "mean_thr_7" = area_recult_threshold %>% group_by(abn_threshold) %>% summarise(mean_proportion = mean(proportion_recultivated)) %>% 
    filter(abn_threshold == 7) %>% select(mean_proportion) %>% round(digits = 4) * 100,
  
  "mean_thr_10" = area_recult_threshold %>% group_by(abn_threshold) %>% summarise(mean_proportion = mean(proportion_recultivated)) %>% 
    filter(abn_threshold == 10) %>% select(mean_proportion) %>% round(digits = 4) * 100,
  
  "min_5" = area_recult_threshold %>% filter(abn_threshold == 5) %>% slice_min(proportion_recultivated) %>% .$proportion_recultivated %>% round(digits = 4) * 100,
  "min_5_site" = area_recult_threshold %>% filter(abn_threshold == 5) %>% slice_min(proportion_recultivated) %>% .$site %>% capwords(),
  
  "max_5" = area_recult_threshold %>% filter(abn_threshold == 5, site != "mato_grosso") %>% slice_max(proportion_recultivated) %>% .$proportion_recultivated %>% round(digits = 4) * 100,
  "max_5_site" = area_recult_threshold %>% filter(abn_threshold == 5, site != "mato_grosso") %>% slice_max(proportion_recultivated) %>% .$site %>% capwords(),
  
  "min_10" = area_recult_threshold %>% filter(abn_threshold == 10) %>% slice_min(proportion_recultivated) %>% .$proportion_recultivated %>% round(digits = 4) * 100,
  "min_10_site" = area_recult_threshold %>% filter(abn_threshold == 10) %>% slice_min(proportion_recultivated) %>% .$site %>% capwords(),
  
  "max_10" = area_recult_threshold %>% filter(abn_threshold == 10, site != "mato_grosso") %>% slice_max(proportion_recultivated) %>% .$proportion_recultivated %>% round(digits = 4) * 100,
  "max_10_site" = area_recult_threshold %>% filter(abn_threshold == 10, site != "mato_grosso") %>% slice_max(proportion_recultivated) %>% .$site %>% capwords()
)

abn_duration_stats # see "get-summary-stats"

# ---------------------------------------------------------------------- #
# land cover stats --------------------- #
lc_stats <- list(
  forest_min = abn_prop_lc_2017 %>% 
    filter(lc_2017 == 2) %>% slice_min(prop_lc) %>% 
    select(prop_lc) %>% round(digits = 2) * 100,
  
  forest_min_grassland = (1 - abn_prop_lc_2017 %>% 
                     filter(lc_2017 == 2) %>% slice_min(prop_lc) %>% 
                     select(prop_lc) %>% round(digits = 2)) * 100,
  
  forest_min_site = abn_prop_lc_2017 %>% 
    filter(lc_2017 == 2) %>% slice_min(prop_lc) %>% .$site %>% capwords(),
  
  forest_max = abn_prop_lc_2017 %>% 
    filter(lc_2017 == 2) %>% slice_max(prop_lc) %>% 
    select(prop_lc) %>% round(digits = 2) * 100,
  
  forest_max_grassland = (1 - abn_prop_lc_2017 %>% 
                         filter(lc_2017 == 2) %>% slice_max(prop_lc) %>% 
                         select(prop_lc) %>% round(digits = 2)) * 100,
  
  forest_max_site = abn_prop_lc_2017 %>% filter(lc_2017 == 2) %>% slice_max(prop_lc) %>% .$site %>% capwords()
  )

# ---------------------------------------------------------------------- #
# decay model stats:
time_to_0.5 <- time_to_l3 %>% filter(p == 0.5) %>%
  select(site, time_to_value, proportion, p) %>% arrange(time_to_value)

time_to_0 <- time_to_l3 %>% filter(p == 0) %>%
  select(site, time_to_value, proportion, p) %>% arrange(time_to_value)

t0.5_max_temp <- time_to_0.5 %>%
  slice_max(time_to_value, n = 3) %>% slice_min(time_to_value)

t0.5_min_temp <- time_to_0.5 %>% slice_min(time_to_value)

t0_max_temp <- time_to_0 %>%
  slice_max(time_to_value, n = 3) %>% slice_min(time_to_value)

t0_min_temp <- time_to_0 %>% slice_min(time_to_value)

decay_stats <- list(
  
  "t0.5_max" = t0.5_max_temp %>% select(time_to_value) %>% round(., digits = 0),
  "t0.5_max_site" = t0.5_max_temp %>% .$site %>% gsub("_", " ",.) %>% capwords(),
  
  "t0.5_min" = t0.5_min_temp %>% select(time_to_value) %>% round(., digits = 0),
  "t0.5_min_site" = t0.5_min_temp %>% .$site %>% gsub("_", " ",.) %>% capwords(),
  
  "t0_max" = t0_max_temp %>% select(time_to_value) %>% round(., digits = 0),
  "t0_max_site" = t0_max_temp %>% .$site %>% gsub("_", " ",.) %>% capwords(),
  
  "t0_min" = t0_min_temp %>% select(time_to_value) %>% round(., digits = 0),
  "t0_min_site" = t0_min_temp %>% .$site %>% gsub("_", " ",.) %>% capwords(),
  
  "shaanxi_0.5" = round(time_to_l3 %>% filter(p == 0.5, site == "shaanxi") %>% .$time_to_value, digits = 0),
  "shaanxi_0" = round(time_to_l3 %>% filter(p == 0, site == "shaanxi") %>% .$time_to_value, digits = 0),
  
  "mg_0.5" = round(time_to_l3 %>% filter(p == 0.5, site == "mato_grosso") %>% .$time_to_value, digits = 0),
  "mg_0" = round(time_to_l3 %>% filter(p == 0, site == "mato_grosso") %>% .$time_to_value, digits = 0),
  
  "percent_at_20_min" = fitted_df_l3 %>% filter(age == 20) %>% arrange(fitted) %>% slice_min(fitted) %>% .$fitted %>% round(digits = 4) * 100,
  "percent_at_20_min_site" = fitted_df_l3 %>% filter(age == 20) %>% arrange(fitted) %>% slice_min(fitted) %>% .$site %>% capwords(),
  "percent_at_20_max" = fitted_df_l3 %>% filter(age == 20) %>% arrange(fitted) %>% slice_max(fitted) %>% .$fitted %>% round(digits = 4) * 100,
  "percent_at_20_max_site" = fitted_df_l3 %>% filter(age == 20) %>% arrange(fitted) %>% slice_max(fitted) %>% .$site %>% capwords()
)

# ---------------------------------------------------------------------- #
# extrapolation stats:
plateau_times <- extrapolate_df_l3 %>% 
    group_by(site) %>% slice_max(., mean_age, with_ties = FALSE) %>%
    arrange(mean_age) %>% 
    ungroup() %>% mutate(time = year - 1987)

extrap_prop <- 
  future_df_l3 %>% mutate(
  age_bin = cut(age, breaks = seq(from = 0, to = 140, by = 15), right = TRUE)) %>%
  filter(year == 2120) %>% 
  group_by(site) %>%
  summarise(total_abn_in_2120 = sum(exp_area_ha)) %>% 
  left_join(., 
            future_df_l3 %>% mutate(
              age_bin = cut(age, breaks = seq(from = 0, to = 140, by = 15), right = TRUE)) %>%
              filter(year == 2120, age > 30) %>% 
              group_by(site) %>%
              summarise(over_30 = sum(exp_area_ha)),
            by = "site") %>%
  mutate(prop_over_30 = 100 * over_30/total_abn_in_2120) %>%
  left_join(., 
            future_df_l3 %>% mutate(
              age_bin = cut(age, breaks = seq(from = 0, to = 140, by = 15), right = TRUE)) %>%
              filter(year == 2120, age > 50) %>% 
              group_by(site) %>%
              summarise(over_50 = sum(exp_area_ha)),
            by = "site") %>%
  mutate(prop_over_50 = 100 * over_50/total_abn_in_2120)

extrapolation_stats <- list(
  "plateau_min" = plateau_times %>% slice_min(mean_age) %>% .$mean_age %>% round(digits = 0),
  "plateau_min_year" = plateau_times %>% slice_min(mean_age) %>% .$year,
  "plateau_min_time" = plateau_times %>% slice_min(mean_age) %>% .$time,
  "plateau_min_site" = plateau_times %>% slice_min(mean_age) %>% .$site %>% capwords(),
  
  "plateau_max" = plateau_times %>% slice_max(mean_age) %>% .$mean_age %>% round(digits = 0),
  "plateau_max_year" = plateau_times %>% slice_max(mean_age) %>% .$year,
  "plateau_max_time" = plateau_times %>% slice_max(mean_age, n = 3) %>% slice_min(mean_age) %>% .$time,
  "plateau_max_site" = plateau_times %>% slice_max(mean_age) %>% .$site %>% capwords(),
  
  # proportions over 30
  "prop_over_30_upper_range" = extrap_prop %>% arrange(desc(prop_over_30)) %>% filter(!site %in% c("shaanxi", "mato_grosso")) %>% slice_max(prop_over_30) %>% .$prop_over_30 %>% round(digits = 0),
  
  "prop_over_30_upper_range_site" = extrap_prop %>% arrange(desc(prop_over_30)) %>% filter(!site %in% c("shaanxi", "mato_grosso")) %>% slice_max(prop_over_30) %>% .$site %>% capwords(),
  
   "prop_over_50_shaanxi" = extrap_prop %>% filter(site == "shaanxi") %>% .$prop_over_50 %>% round(digits = 0)
)

# extrapolate_df_l3$year %>% max()
# 
# extrapolate_df_l3 %>% filter(year == 2150)
# 
# gg_extrapolation_panel_age_b +
#   scale_x_continuous(breaks = seq(from = 2000, to = 2120, by = 40)) +
#   geom_vline(xintercept = 2008)
```

```{r load-2yr-diff, include = FALSE}
abn_2yr_overestimation <- 
  read_csv(file = paste0(p_derived2, 
                         "abn_2yr_overestimation", run_label, ".csv")) %>%  
  arrange(percent_diff) %>% 
  left_join(., site_df %>% select(site, description), by = "site")


abn_2yr_stats <- list(
  total_area_abn_Mha = round(abn_2yr_overestimation %>% group_by() %>% summarise("sum" = sum(area_2yr)) %>% as.numeric() / 10^6, digits = 2),
  low_percent = round(abn_2yr_overestimation %>% slice_min(percent_diff) %>% .$percent_diff, digits = 2),
  high_percent = round(abn_2yr_overestimation %>% slice_max(percent_diff) %>% .$percent_diff, digits = 2),
  
  low_p_site = abn_2yr_overestimation %>% slice_min(percent_diff) %>% .$description,
  high_p_site = abn_2yr_overestimation %>% slice_max(percent_diff) %>% .$description,
  
  jaccard_low = round(abn_2yr_overestimation %>% slice_min(jaccard) %>% .$jaccard, digits = 4) * 100,
  jaccard_high = round(abn_2yr_overestimation %>% slice_max(jaccard) %>% .$jaccard, digits = 4) * 100,
  
  jaccard_low_site = abn_2yr_overestimation %>% slice_min(jaccard) %>% .$description,
  jaccard_high_site = abn_2yr_overestimation %>% slice_max(jaccard) %>% .$description,
  
  percent_area_below_5_low = round(abn_2yr_overestimation %>% filter(site != "mato_grosso") %>% slice_min(percent_2yr_abn_area_less_than_5yrs_old) %>% .$percent_2yr_abn_area_less_than_5yrs_old, digits = 2),
  percent_area_below_5_high = round(abn_2yr_overestimation %>% filter(site != "mato_grosso") %>% slice_max(percent_2yr_abn_area_less_than_5yrs_old) %>% .$percent_2yr_abn_area_less_than_5yrs_old, digits = 2),
  
  percent_area_below_5_low_site = abn_2yr_overestimation %>% filter(site != "mato_grosso") %>% slice_min(percent_2yr_abn_area_less_than_5yrs_old) %>% .$description,
  percent_area_below_5_high_site = abn_2yr_overestimation %>% slice_max(percent_2yr_abn_area_less_than_5yrs_old) %>% .$description
)

abn_2yr_overestimation_char <- abn_2yr_overestimation %>%
  mutate(jaccard = jaccard %>% round(digits = 2), 
         area_ha_cc = area_ha_cc %>% round(digits = 0) %>% prettyNum(big.mark = ","),
         area_2yr = area_2yr %>% round(digits = 0) %>% prettyNum(big.mark = ","),
         percent_diff = percent_diff %>% round(digits = 2) %>% paste0(., "%"),
         percent_2yr_abn_area_less_than_5yrs_old = percent_2yr_abn_area_less_than_5yrs_old %>%
           round(digits = 2) %>% paste0(., "%"))

```

```{r prop-non-veg, include = FALSE}
# ----------------------------------------------------------- #
# Proportion of each site's area in non-vegetated land
# ----------------------------------------------------------- #
prop_non_veg <- area_dat %>% 
  filter(lc %in% c("Non-veg.", "Woody veg.", "Cropland", "Grassland"), year == 2017) %>%
  group_by(site) %>%
  summarise(total_site_area_ha = sum(area_ha)) %>% 
  left_join(area_dat, ., by = c("site")) %>% 
  mutate(prop_total_area = area_ha/total_site_area_ha)

max_prop_non_veg <- prop_non_veg %>%
  group_by(site, lc) %>%
  summarise(max_prop_in_non_veg = max(prop_total_area)) %>%
  arrange(max_prop_in_non_veg) %>%
  filter(., lc == "Non-veg.")  #%>%


non_veg_stats <- list(
  site1 = max_prop_non_veg %>% filter(max_prop_in_non_veg > 0.1) %>% .[1, ] %>% .$site %>% capwords(),
  site1_p = max_prop_non_veg %>% filter(max_prop_in_non_veg > 0.1) %>% .[1, ] %>% .$max_prop_in_non_veg %>% round(., digits = 4)*100,
  site2 = max_prop_non_veg %>% filter(max_prop_in_non_veg > 0.1) %>% .[2, ] %>% .$site %>% capwords(),
  site2_p = max_prop_non_veg %>% filter(max_prop_in_non_veg > 0.1) %>% .[2, ] %>% .$max_prop_in_non_veg %>% round(., digits = 4)*100
)

# prop_non_veg %>% filter(lc == "Non-veg.", year %in% c(1987, 2017)) %>% print(n = 22)


# # plot
#   ggplot(data = prop_non_veg %>% filter(., lc == "Non-veg.")) +
#     theme_classic() +
#     labs(y = expression("Area  (10"^{6}*" ha)"), x = "Year", 
#          title = "Area by Land Cover, with Abandonment",
#          color = NULL) + 
#     geom_line(mapping = aes(x = year, y = prop_total_area, #area_ha / (10^6), # convert to millions of ha
#                             group = lc, color = fct_reorder(lc, lc, .desc = TRUE)),
#               size = 1.5) + 
#     theme(legend.position = "bottom",
#           legend.title = element_text(size = 10)) +
#     guides(color = guide_legend(nrow = 2, ncol = 3)) +
#     
#     scale_color_manual(values = plot_cols) + 
#   facet_wrap(vars(site))
```

<!-- \tableofcontents -->
\listoftables
\listoffigures

\newpage

# Extended Results {#results-si}

Cropland abandonment at individual sites (excluding Mato Grosso, see Section S1.A.) ranged between `r area_abn_stats$min` ha (`r area_abn_stats$min_site`) and `r area_abn_stats$max` ha (`r area_abn_stats$max_site`) as of 2017 (Fig. \@ref(fig:area-abn-by-age-class)), and because our sites varied in size, this corresponded to between `r area_abn_stats$min_area_2017_as_prop_site`% (`r area_abn_stats$min_area_2017_as_prop_site_site`) and `r area_abn_stats$max_area_2017_as_prop_site`% (`r area_abn_stats$max_area_2017_as_prop_site_site`) of the total area of each site (Fig. \@ref(fig:area-abn-panel)).

On average, we found that cropland abandonment lasted for only `r abn_duration_stats$mean_of_means_duration` years (SD = `r abn_duration_stats$sd_of_mean_duration` years) across our time series at our eleven sites.
Note, however, that these summary statistics are calculated based on the mean abandonment duration at each site, to account for different site sizes.
The summary statistics reported are therefore the mean of the mean abandonment duration at each of our eleven sites, and the standard deviation of the mean abandonment duration at each of our eleven sites.

We also calculated the mean standard deviation of abandonment duration across our sites, which was `r abn_duration_stats$mean_of_sds_duration` years.
The former is a measure of the spread of mean abandonment lengths across the 11 sites, whereas the latter is a measure of the average spread of abandonment lengths at each site.
See Table \@ref(tab:summary-stats-table).

The area abandoned at each site is shown in Fig. \@ref(fig:area-abn-panel) (see also Table \@ref(tab:twoyr-diff-table)).
The area abandoned at each site, by age class, is shown in Fig. \@ref(fig:area-abn-by-age-class), and the area in each land cover class at each site is shown in Fig. \@ref(fig:area-by-lc).
Fig. \@ref(fig:area-abn-by-age-class) shows that the timing of abandonment varied across sites; some sites showed more abandonment earlier in the time series (e.g., Iraq; Bosnia & Herzegovina; Volgograd, Russia; Nebraska/Wyoming, USA; & Mato Grosso, Brazil), some showed consistent abandonment over time (e.g., Vitebsk, Belarus/Smolensk, Russia; Goiás, Brazil; and Wisconsin, USA), and others showed increasing abandonment later on in the time series (e.g., sites in Shaanxi/Shanxi and Chongqing, China).
Furthermore, Fig. \@ref(fig:turnover-grid) shows the annual gain, loss, and net change in the area of abandoned croplands abandoned at each site.

## Limited abandonment in Mato Grosso {#mato-grosso}

Mato Grosso, Brazil, was the only site that did not experience significant amounts of cropland abandonment during our time series.
This is unsurprising given the recent history of agriculturally-driven land-use change over the last few decades.
That being said, the abandonment that did take place in Mato Grosso was relatively more durable, requiring `r decay_stats$mg_0.5` years to decline by half and `r decay_stats$mg_0` years for complete turnover.
However, because Mato Grosso showed large amounts of new cultivation over the source of our time series and relatively little abandonment (`r area_abn_stats$mg` ha, or `r area_abn_stats$mg_abn_2017_as_percent_total_crop`% of the total cropland extent, as of 2017), these results should be interpreted with care.

## Biomes

Some ecosystems and biomes seem to recover more quickly than others, namely in relatively higher latitudes, relatively colder climates, and in relatively more humid biomes [@Prach2018].
Our sites cover a range of biomes (Fig. \@ref(fig:site-biomes)), including:

- Temperate Broadleaf and Mixed Forests (Vitebsk Belarus/Smolensk, Russia; Bosnia & Herzegovina; Wisconsin, USA),
- Temperate Grasslands, Savannas, and Shrublands (Nebraska/Wyoming, USA; Orenburg, Russia/Uralsk, Kazakhstan; Volgograd, Russia),
- Tropical Grassland (Goiás and Mato Grosso, Brazil),
- Tropical Moist Broadleaf Forests (Chongqing, China; Mato Grosso, Brazil),
- Montane Grassland and Shrublands (Shaanxi/Shanxi, China), and
- Deserts & Xeric Shrublands (Iraq).

The long-term land-cover outcomes for abandoned croplands are shown (as of 2017) in Fig. \@ref(fig:abn-prop-lc).
Land cover outcomes for abandoned croplands showed wide variation across sites, with most abandonment in Wisconsin being classified as forest by 2017 (`r lc_stats$forest_max`% forest, `r lc_stats$forest_max_grassland`% grassland), but remaining mostly in grassland elsewhere (Fig. \@ref(fig:abn-prop-lc)).
This limited woody vegetation regrowth may be a product of the biome, but it may simply be a result of insufficient time for woody biomass to develop.
Land cover alone cannot confidently serve as a proxy for ecosystem recovery.

## The effect of varying abandonment definitions {#abn-thresholds}

```{r, include = FALSE}

# mean_length_df %>% filter(length_type == "all") %>% arrange(site)

overall_means <- mean_length_df %>%
  group_by(abn_threshold, length_type) %>%
  summarise(overall_mean = mean(mean_duration, na.rm = TRUE)) %>% ungroup()


threshold_stats <- list(
  one = overall_means %>% filter(abn_threshold == 1, length_type == "all") %>% .$overall_mean %>% round(digits = 0),
  three = overall_means %>% filter(abn_threshold == 3, length_type == "all") %>% .$overall_mean %>% round(digits = 0),
  five = overall_means %>% filter(abn_threshold == 5, length_type == "all") %>% .$overall_mean %>% round(digits = 0),
  ten = overall_means %>% filter(abn_threshold == 10, length_type == "all") %>% .$overall_mean %>% round(digits = 0)
)
```

A relatively short-term definition of abandonment might result in an overestimation of recultivation, because short-term abandonment may be better understood as cyclical fallow periods, not true abandonment [@Munroe2013].
Because typical fallow period length may vary around the world, we tested multiple abandonment thresholds in order to test the sensitivity of our results to our choice of a five-year abandonment definition, following the FAO [@FAO2016].
As our abandonment threshold increased in length, the mean abandonment duration across our sites increased accordingly, ranging between `r threshold_stats$one` years (no threshold) and `r threshold_stats$ten` years (10-year threshold).
As expected, using a longer abandonment definition reduced the amount of cropland abandonment we detected, which is also shown in the area in the different colored age classes in Fig. \@ref(fig:area-abn-by-age-class).

The proportion of abandoned croplands that were recultivated by the end of the time series also responded to our abandonment threshold, with less recultivation for longer abandonment thresholds (Fig. \@ref(fig:recult-by-threshold)).
However, even at the longest abandonment definition (10 years), we still saw that between 10% and 30% of abandoned croplands were recultivated by the end of the time series.
We find that the mean area of abandoned croplands that get recultivated by the end of the time series declines from `r recult_stats$mean_thr_5`% with a 5 year threshold to `r recult_stats$mean_thr_7`% with a 7 year threshold, and `r recult_stats$mean_thr_10`% with a 10 year threshold.
This indicates that the abandonment and recultivation we observe is not merely a function of our five-year abandonment definition.

## Comparing annual and two-year estimates of abandonment {#twoyr-vs-annual}

Some studies estimate cropland abandonment by simply looking for areas where land cover is classified as "cultivated" in one year, but not in a later year (e.g., 1992 and 2015 in ref. [@Naess2021]).
In order to understand the magnitude of the differences that could result from using this two-year approach, we estimated cropland abandonment by simply identifying areas that were classified as "cropland" in 1987 and classified as either "woody vegetation" or "herbaceous vegetation" in 2017 (i.e., excluding "non-vegetation").

Table \@ref(tab:twoyr-diff-table) shows the area of abandoned croplands as identified using a five-year abandonment definition and the full annual time series (Column 2), and the area of abandoned croplands identified using only the difference between 2017 and 1987 (Column 3).
These two methods produced abandonment area estimates that ranged between `r abs(abn_2yr_stats$low_percent)`% lower (`r abn_2yr_stats$low_p_site`) and `r abn_2yr_stats$high_percent`% higher (`r abn_2yr_stats$high_p_site`) than the abandoned area identified using the full time series.

Not only do these methods produce different area estimates, but they also differ in the location of the abandonment they identify, with spatial agreement of only `r abn_2yr_stats$jaccard_low`% (`r abn_2yr_stats$jaccard_low_site`) to `r abn_2yr_stats$jaccard_high`% (`r abn_2yr_stats$jaccard_high_site`) (see Table \@ref(tab:twoyr-diff-table)).
We measure spatial agreement using the Jaccard similarity index [@Legendre2012], a measure of overlap between two sets, defined as the proportion of shared elements, or the intersection divided by the union (Equation \@ref(eq:jaccard-equation)) [@Legendre2012]:

\begin{equation}
J(a,b) = \frac{a\cap b}{a\cup b} (\#eq:jaccard-equation)
\end{equation}

Additionally, a large portion of the "abandoned" area identified with the two-year method does not meet our five year abandonment definition, leading to an overestimate of true abandonment. 
Column 6 in Table \@ref(tab:twoyr-diff-table) shows the percent of the "abandoned" area identified with the two-year method that has been abandoned for than 5 years, and therefore would not be considered "abandoned" by our definition.

## Maps of abandonment duration as of 2017 and maximum duration during time series

As described in the main text, because a pixel may be abandoned and recultivated multiple times throughout the time series, we calculated the mean abandonment duration in two ways: 1) across all periods of abandonment (as shown in Fig. 2), and 2) across only the longest period of abandonment experienced by each pixel. 
Maps of the maximum abandonment duration at each pixel at each site is shown in Fig. \@ref(fig:maps-max-abn-duration) (serving as a companion to Fig. 1).
The distribution of maximum duration values, and the corresponding mean maximum duration value at each site, is shown in Fig. \@ref(fig:mean-abn-duration-w-max) (serving as a companion to Fig. 2).

Expanded site-specific results are shown in Figs. \@ref(fig:panel-b)-\@ref(fig:panel-w).

# Extended Methods {#methods-si}

As noted in our main text, we build on annual land cover maps for 1987-2017 developed by Yin et al. [@Yin2020].
The following section outlines our data processing and analytical methods in more specific detail than was possible in the main text.
We processed and analyzed our abandonment map data in RStudio version `r rstudioapi::versionInfo()$version` [-@RStudio], using `r R.Version()$version.string`, relying heavily on the `{raster}` [@R-raster], `{terra}` [@R-terra], `{data.table}` [@R-data.table], and `{tidyverse}` [@R-tidyverse] packages.

## Classifying abandonment

Pixels that remained in cropland or non-cropland classes throughout the entire time series were excluded, as were periods of non-cropland that began in the first year of the time series, even if that pixel was later classified as cropland and subsequently abandoned.
In effect, we only counted periods of abandonment that we could verify had followed agricultural activity during our time series.

As noted, pixels that transitioned from cropland to the non-vegetation land cover class were not considered "abandoned," and therefore we excluded all non-vegetation pixels from our entire analysis.
These pixels accounted for <10% of total site area at all sites except `r non_veg_stats$site1` (`r non_veg_stats$site1_p`%) and `r non_veg_stats$site2` (`r non_veg_stats$site2_p`%), and remained stable or declined over time at all eleven sites (see Fig. \@ref(fig:area-by-lc)).

All area calculations were performed using the `{terra}` package's `cellSize()` function, which calculates the spherical area of each cell as defined by its four corners [@R-terra].

## Temporal filters {#temporal-filters}

In order to address potential classification errors in a single year, we implemented a series of temporal filters designed to smooth trajectories by looking for short-term land-cover changes that are temporally unlikely.
We applied five-year and eight-year moving-window filters that searched for short periods of land cover classifications that do not match those immediately before and after, and subsequently updated them to match the surrounding classifications.
Specifically, the five-year filter searched for one year periods that did not match the two years immediately before and after (i.e., patterns of `11011`, where `1` represents non-cropland and `0` represents cropland), and our eight-year filter searched for two year periods that did not match the three years before and after (i.e., `11100111`).
The central classifications were then updated to match the classes on either end.

```{r unused-edge-filter-text, include = FALSE, eval = FALSE}
# To be more conservative about the identification of abandonment, we also applied modified versions of these five- and eight-year moving window filters to the start of the times series. 
# By conservatively assuming the years immediately prior to our time series to be classified as non-cropland, we are able to use our moving window filters to exclude additional cases where a one or two year period of cropland may not represent stable cultivation (e.g., reading from left to right, starting in 1987: 011, 1011, 00111, 100111, and 1100111). 
# Non-cropland periods that follow potentially misclassified cropland would more accurately reflect a continuation of existing non-cropland, rather than cropland abandonment.
# 
# This has the effect of applying a three-year threshold on the number of consecutive years of cropland required at the start of the time series in order to confidently signify agricultural activity that could be subsequently abandoned.^[Where 1 represents non-cropland and 0 represents cropland:  
# 87__88__89__90__91__92__93__94  
# 0___1___1___1___1___1___1___1 - caught by edge filter (011)  
# 0___0___1___1___1___1___1___1 - caught by edge filter (00111)  
# 0___0___0___1___1___1___1___1 - Age count starts in '90, classified as abandoned in '94
# ]
# 
# Collectively, these filters mean that the first year a piece of land could be abandoned is 1990, as long as it remains consecutively uncultivated at least through 1994.
# These edge patterns were uncommon, however, with the edge filtering at the beginning of the time series affecting fewer than 7% of pixels at each site. *^[Should this be relative to all pixels, or those that experience some abandonment?]* See Fig. 
# 
# No special actions were taken on the end of the time series, with the possible effect of including erroneous recultivation at the end of the time series, making our estimates of the length of time abandoned conservative (i.e., shorter). 
# We decided to only address the edge cases at the start of the time series because we prefer to be conservative by excluding lands that may be consistently noncrop lands from our estimate of abandonment.
# In contrast, edge cases at the end of the time series only affect our estimate of the length of time abandoned, because one or two year periods of cropland, if misclassified, may erroneously mark recultivation in the final years of the time series.
# However, we decline to address any potential misclassifications at the end of the time series in order to take the more conservative approach with regards to recultivation.

knitr::include_graphics(path = paste0(p_plots, run_label, "/temp_filter_counts_plot_full.png"))
```

## Modeling abandonment decay {#decay-models-si}

Our mean abandonment duration metric tells us about the general persistence of abandoned croplands throughout the time series.
However, this value is limited by the time series length, and does not account for when the majority of the abandonment took place at a site, nor whether a period of abandonment ends as a results of recultivation or the end of the time series.
As a result, the mean abandonment duration does not tell us how long to expect a piece of land to remain abandoned, nor how abandonment length varies through time.
To address this constraint, we track the trajectory of each pixel through time following its initial abandonment, grouping pixels abandoned in a given year into "cohorts."
Decay rates provide information about how long it takes for land to be recultivated, complementing the mean abandonment length and providing a more nuanced story about how long to expect abandonment to last.

For example, a site may have a relatively short mean length of abandonment (e.g., Shaanxi/Shanxi [China], with a mean abandonment length of 13 years; see Fig. 1), but also have a gradual decay rate, indicating that land should stay abandoned for a relatively longer amount of time.
This may result from more abandonment occurring towards the end of the time series; this land simply does not have as long to age and shows up as younger in our data, regardless of how long it may last.
Looking at abandonment decay rates for each cohort individually allows us to produce a decay rate for each site in general in a way that accounts for when during the time series a piece of land was abandoned (i.e., giving us a sense of how long to expect a given piece of land to remain abandoned, even into the future).

### Model selection and diagnostics

We fit linear models using the `lm()` function in R's core statistics package `{stats}`, predicting the proportion of abandoned cropland in each cohort remaining abandoned as a function of time since initial abandonment at each site (n = 351 observations for each of our 11 sites).
The proportion of abandoned cropland remaining abandoned is measured relative to the area abandoned 5 years following the year of initial abandonment, as dictated by our five year abandonment definition.

We tested a range of model specifications, including linear and log transformations of both *proportion* and *time*.
Due to a linear relationship between model residuals and time when including only one term for *time*, we also tested models containing multiple *time* predictor terms, including both log and linear terms.

We chose a model with the following specifications shown in Equation 1 and reproduced here in Equation \@ref(eq:mod-spec-SI).
For cohorts of abandonment initially abandoned in years $y = 1988, ... , 2013$, we estimate the proportion $p$ of each cohort $y$ remaining abandoned as a function of time $t$ (i.e., based on the number of years after initial abandonment).

\begin{equation}
p_{y} = 1 + \beta_{1,y} log(t + 1) + \beta_{2,y} t (\#eq:mod-spec-SI)
\end{equation}

Where $\beta_{1,y}$ represents the regression coefficient on the log term of time $t$ for cohort $y$, and $\beta_{2,y}$ represents the regression coefficient on the linear term of time $t$ for cohort $y$.
We allow for *cohort* level fixed effects, fitting unique coefficients for each cohort at each site.
We ran individual models for each site, using a `stats::lm()` call of `lm(formula = I(proportion - 1)  ~ 0 + log(time + 1):cohort + I(time):cohort)` on data for only that site.
Taken together, these 11 models are correspond to a `stats::lm()` call of `lm(formula = I(proportion - 1)  ~ 0 + log(time + 1):cohort:site + I(time):cohort:site)`.

Model selection was performed based on Akaike Information Criterion (AIC) values (Fig. \@ref(fig:AIC)), selecting the model with the lowest (i.e., more negative) AIC value.
We confirmed that linear model assumptions were not violated through visual inspection of both residuals vs. fitted plots (Fig. \@ref(fig:diag-resid-fitted)) and Q-Q plots (Fig. \@ref(fig:diag-qq)).

### Recultivation ("decay") model results

The observed data, fitted values from these linear models, and mean decay rates for each site, are shown in Fig. \@ref(fig:decay-model-grid).

In order to calculate the mean decay trajectory at each site (as shown in Fig. 3), we took the mean of the log coefficients ($\beta_{1, \bar{y}}$) and the linear coefficients ($\beta_{1, \bar{y}}$) respectively across all cohorts $y$ at each site.
These mean values are shown in Fig. \@ref(fig:decay-mod-coef).
We then used these mean coefficient values ($\beta_{1, \bar{y}}$ and $\beta_{1, \bar{y}}$) to define a new function describing the mean recultivation (or decay) trajectory at each site, using the same for as Equation \@ref(eq:mod-spec-SI).

An alternative representation of the mean recultivation rate is shown in Fig. \@ref(fig:decay-time-to-range).

## Change in recultivation rates over time {#section-methods-rate-of-change}

We examined the rate of change of recultivation rates by calculating the half-life, $t_{half,s}$, defined as the time required for half (50%) of a given cohort of abandoned cropland to be recultivated, and parameterizing a simple linear model on these half-life values as a function of time, using the `stats::lm()` function in R's core statistics package `{stats}`.
This resulted in *n* = 26 half-life values (one for each cohort) at each of our 11 sites.
We estimate the half-life, $t_{half,s}$, as a function of the year of initial abandonment ($yearabn_{s}$), at each site $s$, as shown in Equation \@ref(eq:rate-of-change-lm).

\begin{equation}
t_{half,s} = \beta_{0,s} + \beta_{1,s} yearabn_{s} (\#eq:rate-of-change-lm)
\end{equation}

Where $\beta_{1,s}$ represents the regression slope on the year abandoned (cohort) for site $s$ ($yearabn_{s}$), and $\beta_{0,s}$ represents the intercept.
This corresponds to a `stats::lm()` call of `lm(formula = t_half ~ year_abandoned)`, run for each site individually.
Results are shown in Fig. \@ref(fig:decay-rate-of-change).

We confirmed that model assumptions were met through visual inspection of residuals vs. fitted plots (Fig. \@ref(fig:rate-of-change-diag-resid-fitted)) and Q-Q plots (Fig. \@ref(fig:rate-of-change-diag-qq)).

## Projecting abandonment duration into the future {#section-extrapolation-si}

The results of the projection highlighted in the main text (referred to here as "Extrapolation 1") are shown in Fig. \@ref(fig:extrapolation-combo) and Fig. \@ref(fig:extrapolation-area-by-age).
As noted in the main text, we make two simple assumptions in our projection of abandonment and recultivation into the future: specifically, that 1) recultivation rates remain the same (based on mean recultivation trends at each site, shown in Fig. 3, and that 2) a constant amount of cropland is newly abandoned each year, based on the mean annual gain in abandonment shown in Fig. \@ref(fig:annual-gain-trend)b (note: the annual gain in abandonment in Fig. \@ref(fig:annual-gain-trend)a corresponds to the dark green bars in Fig. \@ref(fig:turnover-grid)).

Given that abandonment may not continue indefinitely, we also explore an alternative to our second assumption about the amount of additional abandonment each year.
In this alternative assumption ("Extrapolation 2"), the area abandoned each year is the same as "Extrapolation 1" from 1987-2017, based on the mean annual gain in abandonment (Fig. \@ref(fig:annual-gain-trend)b), but linearly declines between 2017-2050, reaching 0 ha at each site in 2050 (see Figs. \@ref(fig:extrapolation2-combo) and \@ref(fig:extrapolation2-area-by-age)).

While mean age of abandoned land increased through time after 2017 (and most dramatically after 2050), it remained below 37 years at all sites by 2050.
Increases in mean abandonment duration were offset by recultivation, and total area abandoned declined quickly after 2020 at most sites.
The mean abandonment duration increases as annual abandonment declines, as the total pool of abandoned land grows older and is gradually recultivated.

\newpage

# References {-}

::: {#refs}
:::

\newpage

# Supplementary Tables

```{r include = FALSE}
summary_stats_table_df <- mean_length_df %>% filter(length_type == "all", abn_threshold == 5) %>% 
  left_join(., select(site_df, site, description)) %>%
  select(site = description, mean_duration, median_duration, sd_duration) %>%
  mutate(mean_duration = round(mean_duration, digits = 2), 
         sd_duration = round(sd_duration, digits = 2))
```

```{r summary-stats-table, echo = FALSE}
knitr::kable(summary_stats_table_df, 
             col.names = c("Site", "Mean", "Median", "Standard Deviation"),
             align = "r", #format = "simple",
             format = "latex",
             booktabs = TRUE,
             caption = "Summary statistics describing the duration of abandonment (in years) at our eleven sites between 1987 and 2017, using a five year abandonment definition, and incorporating all periods of abandonment (allowing for multiple per pixel)."
             ) %>%
  kableExtra::kable_styling(
    # latex_options = "scale_down"
    latex_options = "hold_position"
    )
```

```{r twoyr-diff-table, echo = FALSE}
abn_2yr_overestimation_char %>% 
  select(description, area_ha_cc, area_2yr, percent_diff, jaccard, percent_2yr_abn_area_less_than_5yrs_old) %>%

  knitr::kable(., 
             col.names = c("Site", "Area (annual, as of 2017)", 
                           "Area (two year: 2017-1987)", 
                           "Percent Difference", "Jaccard Similarity",
                           "Percent Area <5 Years Old (two year)"),
             align = "r", 
             format = "latex",
             booktabs = TRUE,
             caption = "Cropland abandonment (in Mha) as of 2017 as identified using a) our annual time series and a five-year abandonment definition and b) a two year method taking the difference between land cover in 1987 and 2017."
             ) %>%
  kableExtra::kable_styling(
    # latex_options = "scale_down"
    latex_options = "hold_position"
    )%>%
  column_spec(1, width = "4.2cm") %>%
  column_spec(c(2:3), width = "2cm") %>%
  # column_spec(3, width = "2cm") %>%
  column_spec(4:5, width = "1.7cm") %>%
  column_spec(6, width = "2cm")
```

\newpage

# Supplementary Figures

(ref:caption-global-map) The locations of our 11 sites, from Yin et al. [@Yin2020]. Sites are labeled as follows: (b) Vitebsk, Belarus / Smolensk, Russia; (bh) Bosnia & Herzegovina; (c) Chongqing, China; (g) Goiás, Brazil; (i) Iraq; (mg) Mato Grosso, Brazil; (n) Nebraska/Wyoming, USA; (o) Orenburg, Russia / Uralsk, Kazakhstan; (s) Shaanxi/Shanxi, China; (v) Volgograd, Russia; (w) Wisconsin, USA.

```{r global-map, fig.cap = '(ref:caption-global-map)', echo=FALSE}
# just plain site locations
knitr::include_graphics(path = paste0(p_plots, "fig0.pdf"))
```

(ref:caption-area-abn-panel) Area abandoned a) as of 2017, b) at any point between 1987-2017, c) as of 2017 as a proportion of the total cropland extent (i.e., the area of all lands that were cultivated at some point during the time series). Note that sites are shown in ascending order of area abandoned as of 2017 as a proportion of total cropland extent.

```{r area-abn-panel, fig.cap = '(ref:caption-area-abn-panel)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/area_abn_panel", run_label, ".pdf"))
```

(ref:caption-area-abn-by-age-class) Cumulative area abandoned at each site through time, according to age class (in years).

```{r area-abn-by-age-class, fig.cap = '(ref:caption-area-abn-by-age-class)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/abn_area_by_age_grid", run_label, ".pdf"))
```

(ref:caption-area-by-lc) Area in each land cover class at each site through time. Land cover classes are cropland, grassland, woody vegetation, non-vegetation, and abandoned (for at least 5 years).

```{r area-by-lc, fig.cap = '(ref:caption-area-by-lc)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/area_by_lc_grid", run_label, ".pdf"))
```

(ref:caption-turnover-grid) Annual turnover of abandoned croplands at each site, showing the annual gain (dark green) and annual loss (i.e., recultivation, light green) and net change (black line) of abandoned croplands.

```{r turnover-grid, fig.cap = '(ref:caption-turnover-grid)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/turnover_grid", run_label, ".pdf"))
```

(ref:caption-mean-abn-duration-w-max) The distribution of the maximum abandonment duration (in years) for each pixel at each site from 1987 to 2017. The y-scale shows the proportion of pixels with maximum duration values of a given duration at each site. As previously noted, abandonment and recultivation can occur multiple times at a single pixel during our time series, and this figure serves as a companion to the distribution of all abandonment values shown in Fig. 2. Site-level mean duration values are shown in the red and blue dots, corresponding to mean values calculated across all periods of abandonment (in red, including multiple periods per pixel) and mean values calculated across only the maximum duration of abandonment at each pixel (in blue). The vertical dashed lines represent the mean of these site-level mean duration values, for all abandonment periods (red) and only the maximum duration at each pixel (blue), respectively.

```{r mean-abn-duration-w-max, fig.cap = '(ref:caption-mean-abn-duration-w-max)', out.width = "11cm", echo=FALSE}
# (ref:caption-mean-abn-duration) Sites included in this study, from @Yin2020.
# cite inline using the following  \@ref(fig:mean-abn-duration)

# old version
# knitr::include_graphics(path = paste0(p_plots, run_label, "/mean_lengths", run_label, ".pdf")) 

# new version, flipped, with histograms
knitr::include_graphics(path = paste0(p_plots, "fig2_w_max.pdf"))
```

(ref:caption-maps-max-abn-duration) Maximum duration of cropland abandonment (in years) observed at each pixel between 1987 and 2017 in our eleven study sites. This serves as a companion to maps of the abandonment duration as of 2017 shown in Fig. 1. Site locations are shown in Fig. \@ref(fig:global-map).

```{r maps-max-abn-duration, fig.cap = '(ref:caption-maps-max-abn-duration)', out.width = "17.8cm", echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, "fig1_max.pdf"))
```

(ref:caption-abn-prop-lc) Proportion of abandoned cropland in each land cover class as of 2017.

```{r abn-prop-lc, fig.cap = '(ref:caption-abn-prop-lc)', out.width = "14cm", echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, run_label, "/abn_prop_lc_2017", run_label, ".pdf"))
```

(ref:caption-site-biomes) Site biomes, using biome classifications from The Nature Conservancy's Terrestrial Ecoregions of The World (TEOW) database, derived from Olson et al. [@Olson2001] and Olson and Dinerstein [@Olson2002].

```{r site-biomes, fig.cap = '(ref:caption-site-biomes)', echo=FALSE}
# just plain site locations
knitr::include_graphics(path = paste0(p_plots, "biomes_by_site.pdf"))
```

(ref:caption-abn-thresholds-mean-duration) Mean abandonment lengths shown for various abandonment thresholds.

```{r abn-thresholds-mean-duration, fig.cap = '(ref:caption-abn-thresholds-mean-duration)'}
knitr::include_graphics(path = paste0(p_output, "plots/", run_label, "/mean_lengths_by_threshold", run_label, ".pdf"))
```

(ref:caption-recult-by-threshold) Recultivation rates shown for various abandonment thresholds.

```{r recult-by-threshold, fig.cap = '(ref:caption-recult-by-threshold)'}
knitr::include_graphics(path = paste0(p_output, "plots/", run_label, "/recultivation_rates_by_threshold", run_label, ".pdf"))
```


(ref:caption-decay-model-grid) Decay model results for all sites, showing the proportion of each cohort of abandoned land (i.e., all pixels abandoned in a given year) remaining abandoned over time for each of our eleven sites. Points represent actual observations by cohort, dashed lines represent linear model predictions (fitted values) for each cohort as a function of time (including a linear and logarithmic term of time), and the solid black line represents the site-level mean trend across all cohorts (calculated by taking the mean of each time coefficient values across all cohorts, respectively, and using those two mean values to plot a mean trend). Colors of both points and dashed lines correspond to roughly five-year group of cohorts, ranging from dark purple (oldest cohorts) to green and yellow (most recent cohorts). The horizontal black dashed line shows a proportion of 0.5, indicating the point where half of a cohort has been recultivated. Model diagnostic plots are shown in Figs. \@ref(fig:diag-resid-fitted) and \@ref(fig:diag-qq).

```{r decay-model-grid, fig.cap = '(ref:caption-decay-model-grid)', echo = FALSE}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "decay_mod_grid", run_label, ".pdf"))
```

(ref:caption-AIC) Akaike Information Criterion (AIC) values for various recultivation ("decay") model specifications for each site. More negative AIC values indicate a better model fit.

```{r AIC, fig.cap = '(ref:caption-AIC)', fig.width = 7.5}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "mod_AIC_plot", run_label, ".pdf"))
```

(ref:caption-diag-resid-fitted) Residuals vs. fitted diagnostic plots for our linear models of the recultivation ("decay") of abandonment at each site. These models take the form shown in Equation \@ref(eq:mod-spec-SI), and are shown in Fig. \@ref(fig:decay-model-grid).

```{r diag-resid-fitted, fig.cap = '(ref:caption-diag-resid-fitted)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "l3_cohort_diag_resid_v_fitted", run_label, ".png"))
```

(ref:caption-diag-qq) QQ plots calculated using the `{car}` package [@R-car] for our linear models of the recultivation ("decay") of abandonment at each site. These models take the form shown in Equation \@ref(eq:mod-spec-SI), and are shown in Fig. \@ref(fig:decay-model-grid).

```{r diag-qq, fig.cap = '(ref:caption-diag-qq)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "l3_cohort_diag_qq_subset", run_label, ".png"))
```

(ref:caption-decay-mod-coef) Mean decay model coefficients across cohorts at each site. The left panel shows the mean coefficient on the log(time) terms and the right shows the site mean coefficient on the linear time terms. These mean coefficients are used to plot the mean decay trajectories shown in Fig. 3.

```{r decay-mod-coef, fig.cap = '(ref:caption-decay-mod-coef)', echo = FALSE}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "l3_cohort_coefs_by_site", run_label, ".png"))
```

(ref:caption-decay-time-to-range) An alternative representation of the mean decay rate for each site (also shown in Fig. 3). The color of each point corresponds to the proportion remaining after a given amount of time.

```{r decay-time-to-range, fig.cap = '(ref:caption-decay-time-to-range)', echo=FALSE}
# switch between 1-0 and 1-0.5 by adding or removing all
show_all <- TRUE

knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/time_to_range", ifelse(show_all, "_all", ""), "_l3", run_label, ".pdf"))
```

(ref:caption-decay-rate-of-change) The rate of change of decay rates (measured as the half-life, or the time required for 50% of each cohort to be recultivated) at each site over the course of the time series. Individual site trends are shown in panel a. Solid lines show simple linear regressions, the slopes of which are shown in panel b. Gray bands around the linear trends in panel a and the error bars on slope estimates in panel b both represent 95% confidence intervals. These models are described by Eq. \@ref(eq:rate-of-change-lm). Model diagnostic plots are shown in Figs. \@ref(fig:rate-of-change-diag-resid-fitted) and \@ref(fig:rate-of-change-diag-qq).

```{r decay-rate-of-change, fig.cap = '(ref:caption-decay-rate-of-change)', echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/rate_of_change_recultivation_speed_combo", "_indiv", run_label, ".pdf"))

# To include the figure using the linear combination, and a full model including all sites:
# Note - I decided to stick with individual models for each site, to match how the decay models were structured.

# knitr::include_graphics(path = paste0(p_plots, run_label,
#                                       "/decay/rate_of_change_recultivation_speed_combo", 
#                                       "_lincom", run_label, ".pdf"))


# old confidence intervals
# knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/rate_of_change_recultivation_speed_combo",
#                                       "_old", run_label, ".pdf"))


# old version, with quadrants, and old CIs
# knitr::include_graphics(path = paste0(p_plots, run_label, "/presentation/rate_of_change_recultivation_speed", run_label, ".pdf"))
# knitr::include_graphics(path = paste0(p_plots, run_label, "/presentation/rate_of_change_recultivation_speed_old", run_label, ".pdf"))
```

(ref:caption-rate-of-change-diag-resid-fitted) Residuals vs. fitted diagnostic plots for each site, for a simple `lm` call corresponding to Eq. \@ref(eq:rate-of-change-lm), in which the half-life (i.e., the time required for half (50%) of a given cohort of abandoned cropland to be recultivated) is modeled as a function of the year of initial abandonment at each site.

```{r rate-of-change-diag-resid-fitted, fig.cap = '(ref:caption-rate-of-change-diag-resid-fitted)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "rate_of_change_l3_diag_ind_resid_v_fitted", run_label, ".png"))
```

(ref:caption-rate-of-change-diag-qq) QQ plots calculated using the `car` package (@R-car), for a simple `lm` call corresponding to Eq. \@ref(eq:rate-of-change-lm), in which the half-life (i.e., the time required for half (50%) of a given cohort of abandoned cropland to be recultivated) is modeled as a function of the year of initial abandonment at each site.

```{r rate-of-change-diag-qq, fig.cap = '(ref:caption-rate-of-change-diag-qq)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "rate_of_change_l3_diag_ind_qq_car", run_label, ".png"))
```

(ref:caption-annual-gain-trend) Annual gain in newly abandoned cropland at our eleven sites. Panel a shows the trend in annual abandonment over time at each site (in $10^3$ ha), and Panel b shows the mean annual abandonment (in $10^3$ ha) at each site. The mean values in panel b feed into the extrapolations. Note that the annual gain in abandonment corresponds to the dark green bars in Fig. \@ref(fig:turnover-grid)).

```{r annual-gain-trend, fig.cap = '(ref:caption-annual-gain-trend)', echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "annual_gain_trend", run_label, ".pdf"))
```

(ref:caption-extrapolation-combo) The results of our simple extrapolation, including a) the mean age of abandonment, and b) the total area abandoned into the future. Colors corresponding to each site are consistent across the three panels. These extrapolation assume recultivation based on the mean decay trend for each site Fig. 3 and annual new abandonment based on the mean annual gain in abandonment shown in Fig. \@ref(fig:turnover-grid) (dark green bars).

```{r extrapolation-combo, fig.cap = '(ref:caption-extrapolation-combo)', echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "extrapolation1_SI", run_label, ".pdf"))
```

(ref:caption-extrapolation-area-by-age) Extrapolating area by age bin, assuming a 1) each site follows the mean recultivation ("decay") rate, and 2) a constant area abandoned each year (based on the mean annual area abandoned at each site).

```{r extrapolation-area-by-age, fig.cap = '(ref:caption-extrapolation-area-by-age)', echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "extrapolation1_ages", run_label, ".pdf"))
```

(ref:caption-extrapolation2-combo) The results of our second extrapolation, including a) the mean age of abandonment, and b) the total area abandoned into the future. Colors corresponding to each site are consistent across the three panels. These extrapolation assume recultivation based on the mean decay trend for each site Fig. 3 and annual new abandonment based on the mean annual gain in abandonment shown in Fig. \@ref(fig:turnover-grid) (dark green bars).

```{r extrapolation2-combo, fig.cap = '(ref:caption-extrapolation2-combo)', echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "extrapolation2_SI", run_label, ".pdf"))
```

(ref:caption-extrapolation2-area-by-age) Extrapolating area by age bin, assuming a 1) each site follows the mean recultivation ("decay") rate, and 2) a constant area abandoned each year until 2017 (based on the mean annual area abandoned at each site), followed by a linearly declining area abandoned each year until reaching 0 in 2050.

```{r extrapolation2-area-by-age, fig.cap = '(ref:caption-extrapolation2-area-by-age)', echo=FALSE}
# knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "extrapolation2_ages", run_label, ".pdf"))
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "extrapolation2_ages_const", run_label, ".pdf"))
```

(ref:caption-mean-duration-2050) Comparing the mean duration of abandonment at our 11 sites observed between 1987 and 2017 with the extrapolated mean duration as of 2050 for our two extrapolations.

```{r mean-duration-2050, fig.cap = '(ref:caption-mean-duration-2050)', echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, run_label, "/mean_age_in_2050", run_label, ".pdf"))
```

(ref:caption-panel-b) Abandonment patterns for `r site_df$description[1]`, showing a) accumulation of abandoned land by age class, b) decay of abandoned land by year abandoned, c) the area in each land cover class through time (including both land that has been abandoned for five or more years, as well as any land abandoned for 1 or more years, therefore including short-term fallows), d) the annual turnover of abandoned land through time, and e) the distribution of abandonment duration for all periods of cropland abandonment (top) and the maximum duration of abandonment at each pixel (bottom).

(ref:caption-panel-bh) Abandonment patterns for `r site_df$description[2]`, following Fig. \@ref(fig:panel-b).
(ref:caption-panel-c) Abandonment patterns for `r site_df$description[3]`, following Fig. \@ref(fig:panel-b).
(ref:caption-panel-g) Abandonment patterns for `r site_df$description[4]`, following Fig. \@ref(fig:panel-b).
(ref:caption-panel-i) Abandonment patterns for `r site_df$description[5]`, following Fig. \@ref(fig:panel-b).
(ref:caption-panel-mg) Abandonment patterns for `r site_df$description[6]`, following Fig. \@ref(fig:panel-b).
(ref:caption-panel-n) Abandonment patterns for `r site_df$description[7]`, following Fig. \@ref(fig:panel-b).
(ref:caption-panel-o) Abandonment patterns for `r site_df$description[8]`, following Fig. \@ref(fig:panel-b).
(ref:caption-panel-s) Abandonment patterns for `r site_df$description[9]`, following Fig. \@ref(fig:panel-b).
(ref:caption-panel-v) Abandonment patterns for `r site_df$description[10]`, following Fig. \@ref(fig:panel-b).
(ref:caption-panel-w) Abandonment patterns for `r site_df$description[11]`, following Fig. \@ref(fig:panel-b).

```{r panel-b, fig.cap = '(ref:caption-panel-b)', echo=FALSE}
si_panel_figs <- list.files(paste0(p_plots, run_label), pattern = "si_panel", full.names = TRUE)
# grep("_b.png", si_panel_figs, value = TRUE)

knitr::include_graphics(path = si_panel_figs[1])
```

```{r panel-bh, fig.cap = '(ref:caption-panel-bh)', echo=FALSE}
knitr::include_graphics(path = si_panel_figs[2])
```

```{r panel-c, fig.cap = '(ref:caption-panel-c)', echo=FALSE}
knitr::include_graphics(path = si_panel_figs[3])
```

```{r panel-g, fig.cap = '(ref:caption-panel-g)', echo=FALSE}
knitr::include_graphics(path = si_panel_figs[4])
```

```{r panel-i, fig.cap = '(ref:caption-panel-i)', echo=FALSE}
knitr::include_graphics(path = si_panel_figs[5])
```

```{r panel-mg, fig.cap = '(ref:caption-panel-mg)', echo=FALSE}
knitr::include_graphics(path = si_panel_figs[6])
```

```{r panel-n, fig.cap = '(ref:caption-panel-n)', echo=FALSE}
knitr::include_graphics(path = si_panel_figs[7])
```

```{r panel-o, fig.cap = '(ref:caption-panel-o)', echo=FALSE}
knitr::include_graphics(path = si_panel_figs[8])
```

```{r panel-s, fig.cap = '(ref:caption-panel-s)', echo=FALSE}
knitr::include_graphics(path = si_panel_figs[9])
```

```{r panel-v, fig.cap = '(ref:caption-panel-v)', echo=FALSE}
knitr::include_graphics(path = si_panel_figs[10])
```

```{r panel-w, fig.cap = '(ref:caption-panel-w)', echo=FALSE}
knitr::include_graphics(path = si_panel_figs[11])
```
