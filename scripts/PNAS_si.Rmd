---
title: Impermanence of cropland abandonment limits potential for environmental benefits

# Use letters for affiliations, numbers to show equal authorship (if applicable) and to indicate the corresponding author
author:
  - name: Christopher L. Crawford
    affiliation: a,1
  - name: He Yin
    affiliation: b
  - name: Volker C. Radeloff
    affiliation: c
  - name: David S. Wilcove
    affiliation: a,d
address:
  - code: a
    address: Princeton School of Public and International Affairs, Princeton University, Princeton, NJ
  - code: b
    address: Department of Geography, Kent State University, Kent, OH
  - code: c
    address: SILVIS Lab, Department of Forest & Wildlife Ecology, University of Wisconsin - Madison, Madison, WI
  - code: d
    address: Department of Ecology & Evolutionary Biology, Princeton University, Princeton, NJ

corresponding_author:
  code: 1
  text: "To whom correspondence should be addressed. E-mail: ccrawford@princeton.edu"

# For footer text
lead_author_surname: Crawford

author_contributions: |
  Please provide details of author contributions here.

## Remove this if not required
conflict_of_interest: |
  Please declare any conflict of interest here.

abstract: |
  Agricultural expansion is a major cause of land-use change globally, but millions of hectares of cropland are simultaneously being abandoned as a result of demographic, economic, and environmental changes. These abandoned croplands could be immensely valuable for carbon sequestration and biodiversity restoration. However, their environmental value depends on the duration and persistence of abandonment, which is poorly known. Here, we use 30-m annual land-cover maps to examine the duration and persistence of abandonment at eleven sites across four continents that experienced cropland abandonment from 1987 and 2017. We find that abandonment is by and large fleeting, lasting on average only 14.42 years (SD = 1.52). At most sites, we project >50% of abandoned croplands to be recultivated within 25 years, and sites in Eastern Europe, Russia, and the US had accelerating rates of recultivation. If current rates of abandonment and recultivation persist, the mean duration of abandonment at most sites will plateau between 10 and 22.3 years by about 2040. Counter to optimistic assumptions, most abandonment is unlikely to be permanent and will produce little in the way of benefits for carbon sequestration or biodiversity conservation as a result. New policies and incentives will be needed to lengthen the period of abandonment so as to generate these and other benefits. Until then, abandoned croplands will remain untapped opportunities.

significance: |
  Demographic, economic, and environmental changes often result in cropland abandonment. While sometimes seen as a threat to food security and cultural landscapes, abandonment is increasing viewed as an opportunity for carbon sequestration and habitat restoration. However, those environmental benefits largely depend on how long ecosystems have to regenerate and accumulate carbon and biodiversity following abandonment. Existing studies often rely on single snapshots in time to estimate abandonment, and ignore recultivation. Using annual land-cover maps, we tracked abandonment and recultivation at eleven sites across four continents. Contrary to previous assumptions, abandonment was short-lived and most abandoned croplands were recultivated within three decades. Unless policymakers take steps to reduce recultivation and provide incentives for regeneration, abandonment will remain a missed opportunity.

acknowledgements: |
  We thank the following researchers at the University of Wisconsin-Madison, whose land cover maps made this analysis possible: Amintas Brandão, Johanna Buchner, David Helmers, Benjamin G. Iuliano, Niwaeli E. Kimambo, Katarzyna E. Lewińska, Elena Razenkova, Afag Rizayeva, Natalia Rogova, Seth A. Spawn, & Yanhua Xie. We are deeply indebted to Alex Wiebe, whose statistical advice significantly improved our models of abandonment decay and recultivation. We also thank the Drongos research group for invaluable advice and companionship. This work was supported by the High Meadows Foundation and performed using Princeton Research Computing resources at Princeton University.

keywords:
  - Agriculture
  - Cropland abandonment
  - Biodiversity conservation
  - Secondary succession
  - Carbon sequestration
  - Land-cover mapping

## must be one of: pnasresearcharticle (usual two-column layout), pnasmathematics (one column layout), or pnasinvited (invited submissions only)
pnas_type: pnassupportinginfo

bibliography: [/Users/christophercrawford/Google_Drive/Library/library.bib, packages.bib]
csl: pnas.csl

## change to true to add optional line numbering
lineno: true

output: 
  bookdown::pdf_book:
    base_format: rticles::pnas_article

header-includes:
  \newcommand{\beginsupplement}{\setcounter{figure}{0} \setcounter{section}{0} \setcounter{table}{0} \setcounter{equation}{0} \renewcommand{\thefigure}{S\arabic{figure}} \renewcommand{\thesection}{S\arabic{section}} \renewcommand{\thetable}{S\arabic{table}} \renewcommand\theequation{S\arabic{equation}}}
---
```{r load-packages-functions, eval = TRUE, echo = FALSE, include = FALSE}
source("/Users/christophercrawford/Google_Drive/_Projects/abandonment_trajectories/scripts/0_start.R")
# source(paste0(p_proj, "scripts/util/_util_master.R"))
# devtools::install_github("benmarwick/wordcountaddin", type = "source", dependencies = TRUE)
```

```{r preview-chapter, eval=FALSE, include = FALSE}
rmarkdown::render("scripts/abn_trajectories_ms.Rmd",
                  output_file = 
                    paste0(p_proj, "writing/previews/", "abn_duration_draft",
                           format(Sys.Date(), ("_%Y_%m_%d")), ".docx"))


# Save PDF with SI for linking below:
rmarkdown::render("scripts/abn_trajectories_ms.Rmd",
                  output_file = paste0(p_proj, "writing/previews/", "abn_duration_draft_w_SI.pdf"),
                  output_format = "bookdown::pdf_document2")


# # Save html for troubleshooting:
# rmarkdown::render("scripts/abn_trajectories_ms.Rmd",
#                   output_file = paste0(p_proj, "writing/previews/", "abn_duration_draft_w_SI.html"),
#                   output_format = "bookdown::html_document2")

# bookdown::preview_chapter(
#   input = "abn_trajectories_ms.Rmd",
#   output_format = "bookdown::word_document2",
#   output_file = paste0("abn_duration_draft", format(Sys.Date(), ("_%Y_%m_%d")), ".docx"),
#   output_dir = paste0(p_proj, "writing/previews"),
#   output_options = 
#     list(reference_docx = "/Users/christophercrawford/Google_Drive/_Projects/writing/scripts/word_style_ref.docx"),
#   preview = TRUE)
```

```{r set-chunk-opts, include = FALSE}
# set default chunk options
knitr::opts_chunk$set(
  out.width = "1\\textwidth",  # if compiling a pdf, include this option
  # comment = NA,
  # fig.width=6, fig.height=6, 
  echo = FALSE # the code itself will NOT be printed with results
  )

options(knitr.table.format = function() {
  if (knitr::is_latex_output())
    "latex" else "pipe"
})
```

```{r produce-package-bib, include = FALSE, echo = FALSE}
# needed_packages
# github_packages
knitr::write_bib(x = c(needed_packages, github_packages), file = 'packages.bib')
# knitr::write_bib(x = c("car"), file = 'extra.bib')

# citation(package = needed_packages[1])

# knitr::write_bib(x = c(needed_packages[c(14)]), file = 'packages_top.bib')
# knitr::write_bib(x = c(needed_packages[3]), file = 'terra.bib')

# 
# needed_packages[1]
# packageDescription(needed_packages[1])
```

```{r load-files, include = FALSE}

# set run:
run_label <- "_2021_03_13"

# Additional paths --------------------------------------------------- #
p_plots <- "/Users/christophercrawford/Google_Drive/_Projects/abandonment_trajectories/output/plots/"

# load general spatial data on site locations --------------------------------------------------- #
site_df <- read.csv(file = paste0(p_dat_derived, "site_df.csv"))
site_df_w_size <- read.csv(file = paste0(p_dat_derived, "site_df_w_size.csv"))
site_sf <- st_read(paste0(p_dat_derived, "site_sf.shp"))


# load all length data (distilled)
length_distill_df <- read_csv(file = paste0(p_dat_derived, run_label, "/", 
                                            "length_distill_df", run_label, ".csv"))

# load mean length data
mean_length_df <- read_csv(file = paste0(p_dat_derived, run_label, "/", "mean_length_df", run_label, ".csv"))


# load summary statistic derived from lengths
summary_stats_all_sites <- read_csv(file = paste0(p_dat_derived, run_label, "/", "summary_stats_all_siteS", run_label, ".csv"))
summary_stats_all_sites_pooled <- read_csv(file = paste0(p_dat_derived, run_label, "/", "summary_stats_all_sites_pooled", run_label, ".csv"))

# load area summary stats:
area_summary_df <- read_csv(file = paste0(p_dat_derived, run_label, "/", "area_summary_df", run_label, ".csv"))
area_recult_threshold <- read_csv(file = paste0(p_dat_derived, run_label, "/", "area_recult_threshold", run_label, ".csv"))


# load stats on proportion of abandoned cropland by land cover
abn_lc_count_2017 <- read_csv(file = paste0(p_dat_derived, run_label, "/", "abn_lc_count_2017", run_label, ".csv"))
abn_prop_lc_2017 <- read_csv(file = paste0(p_dat_derived, run_label, "/", "abn_prop_lc_2017", run_label, ".csv"))


# load combined persistence, area, and turnover datasets:
# also known as dat_l in "4_decay_models.Rmd"

persistence_dat <- 
  # dat_l <- 
  read_csv(file = paste0(p_dat_derived, "persistence_dat", run_label, ".csv")) %>%
  mutate(site = as.factor(site),
         bins = as.factor(bins),
         year_abn_bins = as.factor(year_abn_bins),
         cohort = as.factor(cohort))

area_dat <- read_csv(file = paste0(p_dat_derived, "area_dat", run_label, ".csv"))
turnover_dat <- read_csv(file = paste0(p_dat_derived, "turnover_dat", run_label, ".csv"))



# load decay rate data
load(file = paste0(p_dat_derived, run_label, "/decay_mod_coef_dfs.rds"), 
     verbose = TRUE)

# load extrapolation data
extrapolate_df_l3 <- read_csv(file = paste0(p_dat_derived, run_label, "/extrapolate_df_l3", run_label, ".csv"))
extrapolate_df_l3_a2 <- read_csv(file = paste0(p_dat_derived, run_label, "/extrapolate_df_l3_a2", run_label, ".csv"))


# load data for shaanxi maps --------------------------------------------------- #

# load data for decay models --------------------------------------------------- #
fitted_df_l3 <- read_csv(file = paste0(p_dat_derived, run_label, "/decay_mod_fitted_df_l3", run_label, ".csv"))

load(file = paste0(p_dat_derived, run_label, "/decay_mod_coef_dfs.rds"), verbose = TRUE)
# contains:
# coef_df_l3, coef_df_wide_l3, mean_coef_df_l3, mean_coef_df_wide_l3, mean_coef_proj_l3, time_to_l3


# load extrapolation data
extrapolate_df_l3 <- read_csv(file = paste0(p_dat_derived, run_label, "/extrapolate_df_l3", run_label, ".csv"))

future_df_l3 <- read_csv(file = paste0(p_dat_derived, run_label, "/future_df_l3", run_label, ".csv"))

```

```{r misc-notes, eval = FALSE}
# --------------------------------------------------
# Miscellaneous YAML
# --------------------------------------------------
# Right after csl:
#   
# nocite: |
#   @RStudio, @R-rmarkdown, @R-bookdown, @R-knitr

# 
# - $^a$Princeton School of Public and International Affairs, Princeton University, Princeton, NJ
# - $^b$Department of Geography, Kent State University, Kent, OH
# - $^c$Department of Forest & Wildlife Ecology, University of Wisconsin - Madison, Madison, WI
# - $^d$Department of Ecology & Evolutionary Biology, Princeton University, Princeton, NJ
# 

# date: '`r format(Sys.Date(), "%B %d, %Y")`'
# 
# - Christopher L. Crawford^[Corresponding Author, ccrawford@princeton.edu, Robertson
#   Hall, Princeton University, Princeton, NJ] ^[Princeton University]
# - He Yin^[Kent State University]
# - Volker Radeloff^[University of Wisconsin, Madison]
# - David S. Wilcove^[Princeton University]

# author:
# - Christopher L. Crawford^[Corresponding Author, ccrawford@princeton.edu, Robertson Hall, Princeton University, Princeton, NJ] $^1$
# - He Yin$^2$
# - Volker Radeloff$^3$
# - David S. Wilcove$^{1, 4}$
# date: 
#   $^1$Princeton School of Public and International Affairs, Princeton University, Princeton, NJ \newline 
#   $^2$Department of Geography, Kent State University, Kent, OH \newline 
#   $^3$Department of Forest & Wildlife Ecology, University of Wisconsin - Madison, Madison, WI \newline 
#   $^4$Department of Ecology & Evolutionary Biology, Princeton University, Princeton, NJ


# --------------------------------------------------
# rmd-tips
# --------------------------------------------------

# Reference sections by including a tag directly after a header, such as {#section-label}, and then reference in line with the following:
# See Section \@ref(section-label)


# figures:
# this is a chunk for including a pre-existing plot or graphic.
#knitr::include_graphics("/Users/christophercrawford/Google_Drive/_Projects/Zambia/agroEcoTradeoff/external/plots/Estes-plots_test.png")

# Figure captions:
# https://bookdown.org/yihui/rmarkdown-cookbook/cross-ref.html

# manually write figure captions outside of chunk with the following
# (ref:caption-label) Figure caption text.

# Chunk options:
# include = FALSE - this means that the code will still be evaluated, but none of the output will be included in the resulting document.

# fig.cap = '(ref:caption-label)' in the chunk options

# cross reference in line with: \@ref(fig:chunk-label) (or eq:label, or tab:label)

# can also include a list of figures by including the following in the YAML
# lof: True
# or, as I currently have it.
# \listoffigures





# --------------------------------------------------
# PNAS Formatting
# --------------------------------------------------
# https://www.pnas.org/authors/submitting-your-manuscript
# PNAS direct submission articles are usually about 4000 words with 50 references and 4 figures (though there is some variation and flexibility). The format follows: Intro, Results (possibly with sections), Discussion, Materials & Methods, Acknowledgements, References (in order they are cited). Though submissions are “format neutral” at the start, it doesn’t seem too difficult to format to match this from the start. 
# Some recent relevant articles in PNAS: Rudel et al. 2009, Wright & Wimberly 2013, Norden et al. 2015, Lambin & Meyfroidt 2011, Griscom et al. 2017, Nerlekar & Veldman 2020.

```

```{r get-summary-stats, include = FALSE}
summary_stats_all_sites
extrapolate_df_l3

abn_duration_stats <- list(
  mean_of_means_duration = summary_stats_all_sites$mean_of_means %>% round(digits = 2),
  mean_of_sds_duration = summary_stats_all_sites$mean_of_sds %>% round(digits = 2),
  sd_of_mean_duration = summary_stats_all_sites$sd_of_means %>% round(digits = 2),
  
  extrapolation_low = extrapolate_df_l3 %>% select(site, max_mean_age) %>% unique() %>% arrange(max_mean_age) %>% .$max_mean_age %>% .[1] %>% round(digits = 1),
  extrapolation_high = extrapolate_df_l3 %>% select(site, max_mean_age) %>% unique() %>% arrange(max_mean_age) %>% .$max_mean_age %>% .[9] %>% round(digits = 1),
  
  duration_min = mean_length_df %>% 
    filter(abn_threshold == 5, length_type == "all") %>% 
    slice_min(mean_duration) %>% 
    select(mean_duration) %>% round(digits = 2),
  
  duration_min_site = mean_length_df %>% 
    filter(abn_threshold == 5, length_type == "all") %>% 
    slice_min(mean_duration) %>% .$site %>% capwords(),
  
  duration_max = mean_length_df %>% 
    filter(abn_threshold == 5, length_type == "all") %>% 
    slice_max(mean_duration) %>% 
    select(mean_duration) %>% round(digits = 2),
  
  duration_max_site = mean_length_df %>% 
    filter(abn_threshold == 5, length_type == "all") %>% 
    slice_max(mean_duration) %>% .$site %>% gsub("_", " & ",.) %>% capwords(),
  
  sd_min = mean_length_df %>% filter(abn_threshold == 5, length_type == "all") %>% slice_min(sd_duration) %>% select(sd_duration) %>% round(digits = 2),
  sd_min_site = mean_length_df %>% filter(abn_threshold == 5, length_type == "all") %>% slice_min(sd_duration) %>% .$site %>% capwords(),
  
  sd_max = mean_length_df %>% filter(abn_threshold == 5, length_type == "all") %>% slice_max(sd_duration) %>% select(sd_duration) %>% round(digits = 2),
  sd_max_site = mean_length_df %>% filter(abn_threshold == 5, length_type == "all") %>% slice_max(sd_duration) %>% .$site %>% gsub("_", " ",.) %>% capwords()
)


mean_length_df %>% filter(abn_threshold == 5, length_type == "all") %>% summarise(mean_sd = mean(sd_duration))
```

# Supporting Information

\listoffigures

# Extended results {#results-si}
```{r get-results-stats, include = FALSE}
# site_r$shaanxi$y2017
# test_area <- raster::area(site_r$shaanxi$y2017)
# plot(test_area)
# ncell(site_r$shaanxi$y2017)
# ncell(test_area)
# names(test_area) <- "area_km2"
# test_dt <- as.data.table.raster(stack(site_r$shaanxi$y2017, test_area))
# test_dt[,sum(area_km2 * 100), by = y2017]
# 1332.768 + 1021861.526 + 153480.420 + 246237.428+ 151124.082

site_df_w_size # note that this includes NA or 0 lc class cells, so is an overestimate. Use the site area from area_summary_df
area_summary_df %>% names

area_summary_df %>% 
  select(site, area_abn_ha_2017, area_ever_abn_ha, cropland_area_1987, total_crop_extent_ha, total_site_area_ha_2017, 
         area_as_prop_site, area_as_prop_total_crop, area_as_prop_crop87) %>% 
  arrange(area_as_prop_total_crop)

area_summary_df %>% 
  select(site, area_abn_ha_2017, area_ever_abn_ha, cropland_area_1987, total_crop_extent_ha, area_as_prop_total_crop, area_as_prop_crop87) %>% 
  arrange(area_as_prop_total_crop) %>% 
  mutate(prop_crop_total_to_87 = total_crop_extent_ha/cropland_area_1987)


area_summary_df %>% select(site, area_abn_ha_2017, total_site_area_ha_2017, area_as_prop_site) %>% arrange(area_as_prop_site)


# ---------------------------------------------------------------------- #
# area abandoned statistics
area_abn_stats <- list(
  "min" = area_summary_df %>% filter(site != "mato_grosso") %>% slice_min(area_abn_ha_2017) %>% select(area_abn_ha_2017) %>% 
    # as.numeric() %>% 
    prettyNum(big.mark = ","),
  "min_site" = area_summary_df %>% filter(site != "mato_grosso") %>% slice_min(area_abn_ha_2017) %>% .$site %>% capwords(),
  
  "max" = area_summary_df %>% slice_max(area_abn_ha_2017) %>% select(area_abn_ha_2017) %>% round(digits = 0) %>% as.numeric() %>% prettyNum(big.mark = ","),
  "max_site" = area_summary_df %>% slice_max(area_abn_ha_2017) %>% .$site %>% capwords(),

  "mg" = area_summary_df %>% filter(site == "mato_grosso") %>% select(area_abn_ha_2017) %>% round(digits = 0) %>% as.numeric() %>% prettyNum(big.mark = ","),
  "mg_abn_as_percent_total_crop" = area_summary_df %>% filter(site == "mato_grosso") %>% select(area_as_prop_total_crop) %>% round(digits = 4) * 100,
  
  "total_area_Mha_2017_all_sites" = round(area_summary_df$total_site_area_ha_2017 %>% sum() / 10^6 , digits = 2),
  "total_crop_extent_area_Mha_2017_all_sites" = round(area_summary_df$total_crop_extent_ha %>% sum() / 10^6 , digits = 2),
  
  "total_area_ever_abn_Mha_all_sites" = round(area_summary_df %>% summarise(total_ever_abn_Mha = sum(area_ever_abn_ha)/1e6), digits = 2),
  
  
  "total_crop_area_1987_Mha_all_sites" = round(area_summary_df$cropland_area_1987 %>% sum() / 10^6 , digits = 2),
  "total_area_abn_Mha_2017_all_sites" = round(area_summary_df$area_abn_ha_2017 %>% sum() / 10^6, digits = 2),
  
  "total_area_abn_2017_as_percent_of_total" = round((area_summary_df$area_abn_ha_2017 %>% sum()) / (area_summary_df$total_site_area_ha_2017 %>% sum()), digits = 4) * 100,
  
  "total_area_abn_2017_as_percent_of_crop87" = round(
    (sum(area_summary_df$area_abn_ha_2017) / sum(area_summary_df$cropland_area_1987)), 
    digits = 4) * 100,
  
  "total_area_abn_2017_as_percent_of_total_crop_extent" = round(
    (sum(area_summary_df$area_abn_ha_2017) / sum(area_summary_df$total_crop_extent_ha)), 
    digits = 4) * 100,
  
  
  "min_area_as_prop_site" = area_summary_df %>% filter(site != "mato_grosso") %>% slice_min(area_as_prop_site) %>% select(area_as_prop_site) %>% round(digits = 4) * 100,
  "min_area_as_prop_site_site" =  area_summary_df %>% filter(site != "mato_grosso") %>% slice_min(area_as_prop_site) %>% .$site %>% capwords(),
  
  "max_area_as_prop_site" = area_summary_df %>% slice_max(area_as_prop_site) %>% select(area_as_prop_site) %>% round(digits = 4) * 100,
  "max_area_as_prop_site_site" = area_summary_df %>% slice_max(area_as_prop_site) %>% .$site %>% capwords(),
  
  # area_as_prop_total_crop
  "min_area_as_prop_total_crop" = area_summary_df %>% filter(site != "mato_grosso") %>% slice_min(area_as_prop_total_crop) %>% select(area_as_prop_total_crop) %>% round(digits = 4) * 100,
  "min_area_as_prop_total_crop_site" =  area_summary_df %>% filter(site != "mato_grosso") %>% slice_min(area_as_prop_total_crop) %>% .$site %>% capwords(),
  
  "max_area_as_prop_total_crop" = area_summary_df %>% slice_max(area_as_prop_total_crop) %>% select(area_as_prop_total_crop) %>% round(digits = 4) * 100,
  "max_area_as_prop_total_crop_site" = area_summary_df %>% slice_max(area_as_prop_total_crop) %>% .$site %>% gsub("_", " & ", .) %>% capwords()
)

# ---------------------------------------------------------------------- #
area_recult_threshold %>% filter(abn_threshold == 10) %>% select(site, proportion_recultivated) %>% arrange(proportion_recultivated)

# recultivation statistics
recult_stats <- list(
  "mean_thr_5" = area_recult_threshold %>% group_by(abn_threshold) %>% 
    summarise(mean_proportion = mean(proportion_recultivated),
              sd_proportion = sd(proportion_recultivated)) %>% 
    filter(abn_threshold == 5) %>% select(mean_proportion) %>% round(digits = 4) * 100,
  
  "sd_thr_5" = area_recult_threshold %>% group_by(abn_threshold) %>% 
    summarise(mean_proportion = mean(proportion_recultivated),
              sd_proportion = sd(proportion_recultivated)) %>% 
    filter(abn_threshold == 5) %>% select(sd_proportion) %>% round(digits = 4) * 100,
  
  "mean_thr_7" = area_recult_threshold %>% group_by(abn_threshold) %>% summarise(mean_proportion = mean(proportion_recultivated)) %>% 
    filter(abn_threshold == 7) %>% select(mean_proportion) %>% round(digits = 4) * 100,
  
  "mean_thr_10" = area_recult_threshold %>% group_by(abn_threshold) %>% summarise(mean_proportion = mean(proportion_recultivated)) %>% 
    filter(abn_threshold == 10) %>% select(mean_proportion) %>% round(digits = 4) * 100,
  
  "min_5" = area_recult_threshold %>% filter(abn_threshold == 5) %>% slice_min(proportion_recultivated) %>% .$proportion_recultivated %>% round(digits = 4) * 100,
  "min_5_site" = area_recult_threshold %>% filter(abn_threshold == 5) %>% slice_min(proportion_recultivated) %>% .$site %>% capwords(),
  
  "max_5" = area_recult_threshold %>% filter(abn_threshold == 5, site != "mato_grosso") %>% slice_max(proportion_recultivated) %>% .$proportion_recultivated %>% round(digits = 4) * 100,
  "max_5_site" = area_recult_threshold %>% filter(abn_threshold == 5, site != "mato_grosso") %>% slice_max(proportion_recultivated) %>% .$site %>% capwords(),
  
  "min_10" = area_recult_threshold %>% filter(abn_threshold == 10) %>% slice_min(proportion_recultivated) %>% .$proportion_recultivated %>% round(digits = 4) * 100,
  "min_10_site" = area_recult_threshold %>% filter(abn_threshold == 10) %>% slice_min(proportion_recultivated) %>% .$site %>% capwords(),
  
  "max_10" = area_recult_threshold %>% filter(abn_threshold == 10, site != "mato_grosso") %>% slice_max(proportion_recultivated) %>% .$proportion_recultivated %>% round(digits = 4) * 100,
  "max_10_site" = area_recult_threshold %>% filter(abn_threshold == 10, site != "mato_grosso") %>% slice_max(proportion_recultivated) %>% .$site %>% capwords()
)

abn_duration_stats # see "get-summary-stats"

# ---------------------------------------------------------------------- #
# land cover stats --------------------- #
lc_stats <- list(
  forest_min = abn_prop_lc_2017 %>% 
    filter(lc_2017 == 2) %>% slice_min(prop_lc) %>% 
    select(prop_lc) %>% round(digits = 2) * 100,
  
  forest_min_grassland = (1 - abn_prop_lc_2017 %>% 
                     filter(lc_2017 == 2) %>% slice_min(prop_lc) %>% 
                     select(prop_lc) %>% round(digits = 2)) * 100,
  
  forest_min_site = abn_prop_lc_2017 %>% 
    filter(lc_2017 == 2) %>% slice_min(prop_lc) %>% .$site %>% capwords(),
  
  forest_max = abn_prop_lc_2017 %>% 
    filter(lc_2017 == 2) %>% slice_max(prop_lc) %>% 
    select(prop_lc) %>% round(digits = 2) * 100,
  
  forest_max_grassland = (1 - abn_prop_lc_2017 %>% 
                         filter(lc_2017 == 2) %>% slice_max(prop_lc) %>% 
                         select(prop_lc) %>% round(digits = 2)) * 100,
  
  forest_max_site = abn_prop_lc_2017 %>% filter(lc_2017 == 2) %>% slice_max(prop_lc) %>% .$site %>% capwords()
  )

# ---------------------------------------------------------------------- #
# decay model stats:
time_to_0.5 <- time_to_l3 %>% filter(p == 0.5) %>%
  select(site, time_to_value, proportion, p) %>% arrange(time_to_value)

time_to_0 <- time_to_l3 %>% filter(p == 0) %>%
  select(site, time_to_value, proportion, p) %>% arrange(time_to_value)

t0.5_max_temp <- time_to_0.5 %>%
  slice_max(time_to_value, n = 3) %>% slice_min(time_to_value)

t0.5_min_temp <- time_to_0.5 %>% slice_min(time_to_value)

t0_max_temp <- time_to_0 %>%
  slice_max(time_to_value, n = 3) %>% slice_min(time_to_value)

t0_min_temp <- time_to_0 %>% slice_min(time_to_value)

decay_stats <- list(
  
  "t0.5_max" = t0.5_max_temp %>% select(time_to_value) %>% round(., digits = 0),
  "t0.5_max_site" = t0.5_max_temp %>% .$site %>% gsub("_", " ",.) %>% capwords(),
  
  "t0.5_min" = t0.5_min_temp %>% select(time_to_value) %>% round(., digits = 0),
  "t0.5_min_site" = t0.5_min_temp %>% .$site %>% gsub("_", " ",.) %>% capwords(),
  
  "t0_max" = t0_max_temp %>% select(time_to_value) %>% round(., digits = 0),
  "t0_max_site" = t0_max_temp %>% .$site %>% gsub("_", " ",.) %>% capwords(),
  
  "t0_min" = t0_min_temp %>% select(time_to_value) %>% round(., digits = 0),
  "t0_min_site" = t0_min_temp %>% .$site %>% gsub("_", " ",.) %>% capwords(),
  
  "shaanxi_0.5" = round(time_to_l3 %>% filter(p == 0.5, site == "shaanxi") %>% .$time_to_value, digits = 0),
  "shaanxi_0" = round(time_to_l3 %>% filter(p == 0, site == "shaanxi") %>% .$time_to_value, digits = 0),
  
  "mg_0.5" = round(time_to_l3 %>% filter(p == 0.5, site == "mato_grosso") %>% .$time_to_value, digits = 0),
  "mg_0" = round(time_to_l3 %>% filter(p == 0, site == "mato_grosso") %>% .$time_to_value, digits = 0),
  
  "percent_at_20_min" = fitted_df_l3 %>% filter(age == 20) %>% arrange(fitted) %>% slice_min(fitted) %>% .$fitted %>% round(digits = 4) * 100,
  "percent_at_20_min_site" = fitted_df_l3 %>% filter(age == 20) %>% arrange(fitted) %>% slice_min(fitted) %>% .$site %>% capwords(),
  "percent_at_20_max" = fitted_df_l3 %>% filter(age == 20) %>% arrange(fitted) %>% slice_max(fitted) %>% .$fitted %>% round(digits = 4) * 100,
  "percent_at_20_max_site" = fitted_df_l3 %>% filter(age == 20) %>% arrange(fitted) %>% slice_max(fitted) %>% .$site %>% capwords()
)

# ---------------------------------------------------------------------- #
# extrapolation stats:
plateau_times <- extrapolate_df_l3 %>% 
    group_by(site) %>% slice_max(., mean_age, with_ties = FALSE) %>%
    arrange(mean_age) %>% 
    ungroup() %>% mutate(time = year - 1987)

extrap_prop <- 
  future_df_l3 %>% mutate(
  age_bin = cut(age, breaks = seq(from = 0, to = 140, by = 15), right = TRUE)) %>%
  filter(year == 2120) %>% 
  group_by(site) %>%
  summarise(total_abn_in_2120 = sum(exp_area_ha)) %>% 
  left_join(., 
            future_df_l3 %>% mutate(
              age_bin = cut(age, breaks = seq(from = 0, to = 140, by = 15), right = TRUE)) %>%
              filter(year == 2120, age > 30) %>% 
              group_by(site) %>%
              summarise(over_30 = sum(exp_area_ha)),
            by = "site") %>%
  mutate(prop_over_30 = 100 * over_30/total_abn_in_2120) %>%
  left_join(., 
            future_df_l3 %>% mutate(
              age_bin = cut(age, breaks = seq(from = 0, to = 140, by = 15), right = TRUE)) %>%
              filter(year == 2120, age > 50) %>% 
              group_by(site) %>%
              summarise(over_50 = sum(exp_area_ha)),
            by = "site") %>%
  mutate(prop_over_50 = 100 * over_50/total_abn_in_2120)

extrapolation_stats <- list(
  "plateau_min" = plateau_times %>% slice_min(mean_age) %>% .$mean_age %>% round(digits = 0),
  "plateau_min_year" = plateau_times %>% slice_min(mean_age) %>% .$year,
  "plateau_min_time" = plateau_times %>% slice_min(mean_age) %>% .$time,
  "plateau_min_site" = plateau_times %>% slice_min(mean_age) %>% .$site %>% capwords(),
  
  "plateau_max" = plateau_times %>% slice_max(mean_age) %>% .$mean_age %>% round(digits = 0),
  "plateau_max_year" = plateau_times %>% slice_max(mean_age) %>% .$year,
  "plateau_max_time" = plateau_times %>% slice_max(mean_age, n = 3) %>% slice_min(mean_age) %>% .$time,
  "plateau_max_site" = plateau_times %>% slice_max(mean_age) %>% .$site %>% capwords(),
  
  # proportions over 30
  "prop_over_30_upper_range" = extrap_prop %>% arrange(desc(prop_over_30)) %>% filter(!site %in% c("shaanxi", "mato_grosso")) %>% slice_max(prop_over_30) %>% .$prop_over_30 %>% round(digits = 0),
  
  "prop_over_30_upper_range_site" = extrap_prop %>% arrange(desc(prop_over_30)) %>% filter(!site %in% c("shaanxi", "mato_grosso")) %>% slice_max(prop_over_30) %>% .$site %>% capwords(),
  
   "prop_over_50_shaanxi" = extrap_prop %>% filter(site == "shaanxi") %>% .$prop_over_50 %>% round(digits = 0)
)


# extrapolate_df_l3$year %>% max()
# 
# extrapolate_df_l3 %>% filter(year == 2150)
# 
# gg_extrapolation_panel_age_b +
#   scale_x_continuous(breaks = seq(from = 2000, to = 2120, by = 40)) +
#   geom_vline(xintercept = 2008)
```
```{r load-2yr-diff, include = FALSE}
abn_2yr_overestimation <- 
  read_csv(file = paste0(p_dat_derived, run_label, "/", 
                         "abn_2yr_overestimation", run_label, ".csv")) %>%  
  arrange(percent_diff) %>% 
  left_join(., site_df %>% select(site, description), by = "site")

abn_2yr_stats <- list(
  total_area_abn_Mha = round(abn_2yr_overestimation %>% group_by() %>% summarise("sum" = sum(area_2yr)) %>% as.numeric() / 10^6, digits = 2),
  low_percent = round(abn_2yr_overestimation %>% slice_min(percent_diff) %>% .$percent_diff, digits = 2),
  high_percent = round(abn_2yr_overestimation %>% slice_max(percent_diff) %>% .$percent_diff, digits = 2),
  
  low_p_site = abn_2yr_overestimation %>% slice_min(percent_diff) %>% .$description,
  high_p_site = abn_2yr_overestimation %>% slice_max(percent_diff) %>% .$description,
  
  jaccard_low = round(abn_2yr_overestimation %>% slice_min(jaccard) %>% .$jaccard, digits = 4) * 100,
  jaccard_high = round(abn_2yr_overestimation %>% slice_max(jaccard) %>% .$jaccard, digits = 4) * 100,
  
  jaccard_low_site = abn_2yr_overestimation %>% slice_min(jaccard) %>% .$description,
  jaccard_high_site = abn_2yr_overestimation %>% slice_max(jaccard) %>% .$description
  
)

abn_2yr_overestimation_char <- abn_2yr_overestimation %>%
  mutate(jaccard = jaccard %>% round(digits = 2), 
         area_ha_cc = area_ha_cc %>% round(digits = 0) %>% prettyNum(big.mark = ","),
         area_2yr = area_2yr %>% round(digits = 0) %>% prettyNum(big.mark = ","),
         percent_diff = percent_diff %>% round(digits = 2) %>% paste0(., "%"))

```

(ref:caption-global-map) The locations of our 11 sites, from @Yin2020.

```{r global-map, fig.cap = '(ref:caption-global-map)', echo=FALSE}
# just plain site locations
knitr::include_graphics(path = paste0(p_plots, "fig0.pdf"))
```

Cropland abandonment at individual sites ranged between `r area_abn_stats$min` ha (`r area_abn_stats$min_site`) and `r area_abn_stats$max` ha (`r area_abn_stats$max_site`) as of 2017 (Figure \@ref(fig:area-abn-by-age-class)), and because our sites varied in size, this corresponded to between `r area_abn_stats$min_area_as_prop_site`% (`r area_abn_stats$min_area_as_prop_site_site`) and `r area_abn_stats$max_area_as_prop_site`% (`r area_abn_stats$max_area_as_prop_site_site`) of the total area of each site (Figure \@ref(fig:area-abn-panel)).

We report the standard deviation of mean abandonment durations across our 11 sites (`r abn_duration_stats$sd_of_mean_duration` years).
We also calculated the mean standard deviation of abandonment durations across our sites, which was `r abn_duration_stats$mean_of_sds_duration` years.
The former is a measure of spread of mean abandonment lengths across the 11 sites, whereas the later is a measure of the average spread of abandonment lengths at each site.

The area abandoned at each site is shown in Figure \@ref(fig:area-abn-panel). 
Area by land cover class is shown for each site in Figure \@ref(fig:area-by-lc), and the area abandoned is shared by age class in Figure \@ref(fig:area-abn-by-age-class). 

We also find that a significant area of abandoned croplands were recultivated by the end of our time series (Figure \@ref(fig:recult-by-threshold)).

<!-- (Previously in Main Text Results) -->
The timing of abandonment varied across sites (Figure \@ref(fig:area-abn-by-age-class)), with some sites showing more abandonment earlier in the time series (e.g. Iraq; Bosnia & Herzegovina; Volgograd, Russia; Nebraska/Wyoming, USA; & Mato Grosso, Brazil), some showing consistent abandonment over time (e.g. Vitebsk, Belarus/Smolensk, Russia; Goiás, Brazil; and Wisconsin, USA), and others showing abandonment increasing later in the time series (e.g. sites in Shaanxi/Shanxi and Chongqing, China).

(ref:caption-area-abn-by-age-class) Cumulative area abandoned at each site through time, according to age class (in years).
<!-- ^[Previously included in main text, and can be moved back if there is room.] -->

```{r area-abn-by-age-class, fig.cap = '(ref:caption-area-abn-by-age-class)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/abn_area_by_age_grid", run_label, ".pdf"))
```

(ref:caption-area-abn-panel) Area abandoned a) as of 2017, b) at any point between 1987-2017, c) as a proportion of the total site area, and d) as a proportion of the total cropland area in 1987. Note that sites are shown in ascending order of area as a proportion of total site area.

```{r area-abn-panel, fig.cap = '(ref:caption-area-abn-panel)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/area_abn_panel", run_label, ".pdf"))
```

(ref:caption-area-by-lc) Area in each land cover class at each site through time. Land cover classes are cropland, grassland, woody vegetation, non-vegetation, and abandoned (for at least 5 years).

```{r area-by-lc, fig.cap = '(ref:caption-area-by-lc)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/area_by_lc_grid", run_label, ".pdf"))
```

(ref:caption-turnover-grid) Annual turnover of abandoned croplands at each site, showing the annual gain (dark green) and annual loss (i.e. recultivation, light green) and net change (black line) of abandoned croplands.

```{r turnover-grid, fig.cap = '(ref:caption-turnover-grid)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/turnover_grid", run_label, ".pdf"))
```

Land-cover outcomes are shown in Figure \@ref(fig:abn-prop-lc).

(ref:caption-abn-prop-lc) Proportion of abandoned cropland in each land cover class as of 2017.

```{r abn-prop-lc, fig.cap = '(ref:caption-abn-prop-lc)', echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, run_label, "/abn_prop_lc_2017", run_label, ".pdf"))
```

## Limited abandonment at Mato Grosso {#mato-grosso}

Mato Grosso was the only site that did not experience significant amounts of cropland abandonment during our time series; unsurprising given the recent history of agriculturally-drive land-use change over the last few decades.
As a result, we interpret the trends we see in Mato Grosso regarding abandonment persistence and decay with caution.  
<!-- (Previously in Main Text Results) -->
Mato Grosso also showed relatively more durable abandonment, requiring `r decay_stats$mg_0.5` years to decline by half and `r decay_stats$mg_0` years for complete turnover. 
However, because Mato Grosso showed large amounts of new cultivation over the source of our time series and relatively little abandonment (`r area_abn_stats$mg` ha, or `r area_abn_stats$mg_abn_as_percent`% of total site area, as of 2017), these results should be interpreted with care.

## Biomes

Some ecosystems and biomes seem to recover more quickly and successfully than others, namely in relatively higher latitudes, relatively colder climates, and in relatively more humid biomes [@Prach2018].
Our sites cover a range of biomes, including Temperate Broadleaf and Mixed Forests (Vitebsk Belarus/Smolensk, Russia; Bosnia & Herzegovina; Wisconsin, USA), Temperate Grasslands, Savannas, and Shrublands (Nebraska/Wyoming, USA; Orenburg, Russia/Oral, Kazakhstan; Volgograd, Russia), and Tropical Grassland (Goiás and Mato Grosso, Brazil), Tropical Moist Broadleaf Forests (Chongqing, China; Mato Grosso, Brazil), Montane Grassland and Shrublands (Shaanxi/Shanxi, China), and Deserts & Xeric Shrublands (Iraq) (Figure \@ref(fig:site-biomes)).
Land cover outcomes for abandoned croplands showed wide variation across sites, with most abandonment in Wisconsin being classified as forest by 2017 (`r lc_stats$forest_max`% forest, `r lc_stats$forest_max_grassland`% grassland), but remaining mostly in grassland elsewhere (Figure \@ref(fig:abn-prop-lc)).
This limited woody vegetation regrowth may be a product of the biome or simply insufficient time for woody biomass to develop, and land cover alone cannot confidently serve as a proxy for ecosystem recovery.

(ref:caption-site-biomes) Site biomes, using biome classifications from The Nature Conservancy's Terrestrial Ecoregions of The World (TEOW) database, derived from @Olson2001 and @Olson2002.

```{r site-biomes, fig.cap = '(ref:caption-site-biomes)', echo=FALSE}
# just plain site locations
knitr::include_graphics(path = paste0(p_plots, "biomes_by_site.pdf"))
# plot(cars)
```


## The effect of varying abandonment definitions {#abn-thresholds}

- Abandonment threshold, including a higher threshold (something like 6 or 10 years), along with how thresholds change total pixels/area.


```{r, include = FALSE}

# mean_length_df %>% filter(length_type == "all") %>% arrange(site)

overall_means <- mean_length_df %>%
  group_by(abn_threshold, length_type) %>%
  summarise(overall_mean = mean(mean_duration, na.rm = TRUE)) %>% ungroup()


threshold_stats <- list(
  one = overall_means %>% filter(abn_threshold == 1, length_type == "all") %>% .$overall_mean %>% round(digits = 0),
  three = overall_means %>% filter(abn_threshold == 3, length_type == "all") %>% .$overall_mean %>% round(digits = 0),
  five = overall_means %>% filter(abn_threshold == 5, length_type == "all") %>% .$overall_mean %>% round(digits = 0),
  ten = overall_means %>% filter(abn_threshold == 10, length_type == "all") %>% .$overall_mean %>% round(digits = 0)
)
```

A relatively short-term definition of abandonment might result in an overestimation of recultivation, because short term abandonment may be better understood as cyclical fallow periods, not true abandonment. 
Because fallow periods may vary around the world, we tested multiple abandonment thresholds, and mean abandonment duration across our sites increased accordingly, ranging between `r threshold_stats$one` (no threshold) and `r threshold_stats$ten` (10 years) years.
The proportion of abandoned croplands that were recultivated by the end of the time series also responded to our abandonment threshold, but even at the longest abandonment definition (10 years), we still saw that between 10 and 30% of abandoned croplands were recultivated by the end of the time series.
This indicates that the abandonment and recultivation we observe is not merely a function of our five year abandonment definition.

(ref:caption-abn-thresholds-mean-duration) Mean abandonment lengths shown for various abandonment thresholds.

```{r abn-thresholds-mean-duration, fig.cap = '(ref:caption-abn-thresholds-mean-duration)'}
knitr::include_graphics(path = paste0(p_output, "plots/", run_label, "/mean_lengths_by_threshold", run_label, ".png"))
# plot(cars)

```

Like the mean duration of abandonment, the amount of recultivation depends on our definition of abandonment (Figure \@ref(fig:recult-by-threshold)). We find that the mean area of abandoned croplands that get recultivated by the end of the time series declines from `r recult_stats$mean_thr_5`% with a 5 year threshold to `r recult_stats$mean_thr_7`% with a 7 year threshold, and `r recult_stats$mean_thr_10`% with a 10 year threshold. 

(ref:caption-recult-by-threshold) Recultivation rates shown for various abandonment thresholds.

```{r recult-by-threshold, fig.cap = '(ref:caption-recult-by-threshold)'}
knitr::include_graphics(path = paste0(p_output, "plots/", run_label, "/recultivation_rates_by_threshold", run_label, ".pdf"))
# plot(cars)

```


## Comparing our annual identification of abandonment with a two-year method {#twoyr-vs-annual}

In order to understand the potential for an over- or under-estimation of abandonment when using a shorter time-series or two snapshots in time, we used our land cover maps to simply identify those areas identified as cropland in 1987 that are not cropland in 2017. 

\newpage

```{r twoyr-diff-table, echo = FALSE}
abn_2yr_overestimation_char %>% 
  select(description, area_ha_cc, area_2yr, percent_diff, jaccard) %>%

  knitr::kable(., 
             col.names = c("Site", "Area (annual, as of 2017)", "Area (2017-1987)", 
                           "Percent Difference", "Jaccard Similarity"),
             align = "r", format = "simple",
             caption = "Cropland abandonment (in Mha) as of 2017 as identified using a) our annual time series and a five-year abandonment definition and b) the difference between only two years."
             )

```

\newpage

## Maps of abandonment duration as of 2017 and maximum duration during time series

(ref:caption-map-abn-age-max) Maximum duration of cropland abandonment (in years) at each pixel between 1987-2017.

```{r map-abn-age-max, fig.cap = '(ref:caption-map-abn-age-max)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/maps/max_age_maps.pdf"))
# plot(cars)
```

<!-- We can also include maps for each site of both a) abandonment *age in 2017* (e.g. Figure \@ref(fig:map-abn-age-2017-s)) and b) *max age* (e.g. Figure \@ref(fig:map-abn-age-max-s)) for all sites. -->

<!-- See function `cc_age_levelplot_hist()` to produce these side by side, with site name in the title -->

<!-- (ref:caption-map-abn-age-2017-s) Duration of abandonment (in years) as of 2017, `r site_df$description[9]`. -->

<!-- ```{r map-abn-age-2017-s, fig.cap = '(ref:caption-map-abn-age-2017-s)'} -->
<!-- knitr::include_graphics(path = paste0(p_plots, run_label, "/spatial_reg/age_duration_2017_w_dist", run_label, site_df$label[9], ".pdf")) -->

<!-- # plot(cars) -->
<!-- ``` -->

<!-- (ref:caption-map-abn-age-max-s) Maximum duration of abandonment (in years), `r site_df$description[9]`. -->

<!-- ```{r map-abn-age-max-s, fig.cap = '(ref:caption-map-abn-age-max-s)'} -->
<!-- knitr::include_graphics(path = paste0(p_plots, run_label, "/spatial_reg/age_duration_max_w_dist", run_label, site_df$label[9], ".pdf")) -->

<!-- # plot(cars) -->
<!-- ``` -->


<!-- ### Summary composite figures -->

<!-- (ref:caption-abn-panel-s) Abandonment at a single site (Shaanxi/Shanxi, China), showing a) accumulation of abandoned land by age class, b) decay of abandoned land by year abandoned, c) the area in each land cover class through time (including both land that has been abandoned for five or more years, as well as any land abandoned for 1 or more years, therefore including short-term fallows), and d) the annual turnover of abandoned land through time. Corresponding results for our other sites are shown in Figures \@ref(fig:panel-b)-\@ref(fig:panel-w). -->

<!-- ```{r abn-panel-s, fig.cap = '(ref:caption-abn-panel-s)', echo=FALSE} -->
<!-- # note: this the results panel figure of just Shaanxi province, as an example I had previously intended to have in the main text. -->
<!-- knitr::include_graphics(path = paste0(p_plots, run_label, "/ms_panel", run_label, "_s.png")) -->
<!-- ``` -->

\newpage

# Extended Methods {#methods-si}

As previously noted, we build on annual land cover maps for 1987-2017 developed by @Yin2020.
The following supplement outlines our methodological steps in more specific detail than was possible in the main text.
We processed and analyzed our abandonment map data in RStudio version `r rstudioapi::versionInfo()$version` [-@RStudio], using `r R.Version()$version.string`, relying heavily on the `raster` [@R-raster], `terra` [@R-terra], `data.table` [@R-data.table], and `tidyverse` [@R-tidyverse] packages.

## Classifying abandonment
Pixels that remained in cropland or non-cropland classes throughout the entire time series were excluded, as were periods of non-cropland that began in the first year of the time series, even if that pixel was later classified as cropland and subsequently abandoned (leaving only periods of abandonment that we could verify had followed agricultural activity during our time series).

As noted, pixels that transitioned from cropland to the non-vegetation class were not considered "abandoned," and therefore we excluded all non-vegetation pixels from our analysis.
These pixels represent a very small portion of our dataset, and non-vegetated land remained about constant or declined over time at most sites.
See Figure \@ref(fig:area-by-lc).

Restricting the mean abandonment duration to account for only those pixels that are both abandoned and recultivated within the time series would exclude a large portion of our data, and may underestimate the eventual lengths of many periods of abandonment that begin close to the end of our time series.
(Note: assessing temporal changes in mean length abandoned would involve looking at the mean length of time abandoned at each year of Figure \@ref(fig:panel-s)a).

All area calculations were performed using the `raster::area()` function.


## Temporal filters {#temporal-filters}

In order to address potential classification errors in a single year, we implemented a series of temporal filters intended to smooth the trajectories in our time series by looking for short-term land-cover changes that are temporally unlikely.
We applied five-year and eight-year moving window filters designed to search for short periods of land cover classifications that do not match those immediately before and after, and subsequently update them to match the surrounding classifications.
Specifically, the five-year filter searched for one year periods that did not match the two years immediately before and after (i.e. patterns of 11011, where 1 represents non-cropland and 0 represents cropland), and our eight-year filter searched for two year periods that did not match the three years before and after (i.e. 11100111). 
The central classifications were then updated to match the classes on either end.
We also considered applying modified versions of these moving window filters to the start of the time series, but decided against it, for the sake of consistency and parsimony.

```{r unused-edge-filter-text, include = FALSE, eval = FALSE}
# To be more conservative about the identification of abandonment, we also applied modified versions of these five- and eight-year moving window filters to the start of the times series. 
# By conservatively assuming the years immediately prior to our time series to be classified as non-cropland, we are able to use our moving window filters to exclude additional cases where a one or two year period of cropland may not represent stable cultivation (e.g. reading from left to right, starting in 1987: 011, 1011, 00111, 100111, and 1100111). 
# Non-cropland periods that follow potentially misclassified cropland would more accurately reflect a continuation of existing non-cropland, rather than cropland abandonment.
# 
# This has the effect of applying a three-year threshold on the number of consecutive years of cropland required at the start of the time series in order to confidently signify agricultural activity that could be subsequently abandoned.^[Where 1 represents non-cropland and 0 represents cropland:  
# 87__88__89__90__91__92__93__94  
# 0___1___1___1___1___1___1___1 - caught by edge filter (011)  
# 0___0___1___1___1___1___1___1 - caught by edge filter (00111)  
# 0___0___0___1___1___1___1___1 - Age count starts in '90, classified as abandoned in '94
# ]
# 
# Collectively, these filters mean that the first year a piece of land could be abandoned is 1990, as long as it remains consecutively uncultivated at least through 1994.
# These edge patterns were uncommon, however, with the edge filtering at the beginning of the time series affecting fewer than 7% of pixels at each site. *^[Should this be relative to all pixels, or those that experience some abandonment?]* See Figure 
# 
# No special actions were taken on the end of the time series, with the possible effect of including erroneous recultivation at the end of the time series, making our estimates of the length of time abandoned conservative (i.e. shorter). 
# We decided to only address the edge cases at the start of the time series because we prefer to be conservative by excluding lands that may be consistently noncrop lands from our estimate of abandonment.
# In contrast, edge cases at the end of the time series only affect our estimate of the length of time abandoned, because one or two year periods of cropland, if misclassified, may erroneously mark recultivation in the final years of the time series.
# However, we decline to address any potential misclassifications at the end of the time series in order to take the more conservative approach with regards to recultivation.

knitr::include_graphics(path = paste0(p_plots, run_label, "/temp_filter_counts_plot_full.png"))

# plot(cars)
```

## Modeling abandonment decay {#decay-models-si}

<!-- From methods in main text -->
The mean abandonment duration tells us about the general persistence of abandoned croplands throughout the time series. 
However, this value is limited by the time series length, and does not account for when the majority of the abandonment took place at a site, nor whether a period of abandonment ends as a results of recultivation or the end of the time series.
As a result, the mean abandonment duration does not tell us how long to expect a piece of land to remain abandoned, nor how abandonment length varies through time.
To address this constraint, we track the trajectory of each pixel through time following its initial abandonment, grouping pixels abandoned in a given year into "cohorts."

Decay rates provide information about how long it takes for land to be recultivated, complementing the mean abandonment length and providing a more nuanced story about how long to expect abandonment to last. 

For example, a site may have a relatively short mean length of abandonment (e.g. Shaanxi/Shanxi [China], with a mean abandonment length of 13 years; see Figure \@ref(fig:maps-abn-duration)), but also have a gradual decay rate, indicating that land should stay abandoned for a relatively longer amount of time. 
This may result from more abandonment occurring towards the end of the time series; this land simply does not have as long to age and shows up as younger in our data, regardless of how long it may last.

Looking at abandonment decay rates for each cohort individually allows us to produce a decay rate for each site in general in a way that accounts for when during the time series a piece of land was abandoned (i.e. giving us a sense of how long to expect a given piece of land to remain abandoned, even into the future).

(Note: the following three sentences may be redundant.)
For example, imagine two fields, one abandoned in 1990 and the other abandoned in 2010.
They may both end up remaining abandoned for 15 years, but the second field will show up as having an age of 7 at the end of our time series (which ends in 2017), regardless of how long it lasts.
One way we could deal with this is to only look at land that was affirmatively recultivated; another is to look at decay rates for each cohort, over time.

### Model selection and diagnostics

We then ran linear models (using the `stats::lm()` function in R's core statistics package), predicting the proportion of abandoned cropland in each cohort remaining abandoned as a function of time since initial abandonment.
We tested a range of  model specifications, including linear and log transformations of both *proportion* and *time*.
Importantly, we also include *cohort* fixed effects, allowing for the estimation of unique coefficients for each cohort of abandoned land.
Due to a linear relationship between model residuals and time when including only one term for *time*, we also tested models containing multiple *time* predictor terms, including both log and linear terms.

We chose a model with the following specifications shown in Equation \@ref(eq:mod-spec-SI).
For cohorts of abandonment initially abandoned in years $y = 1988 ... 2013$, we estimate the proportion $p$ of each cohort $y$ remaining abandoned as a function of time $t$ (i.e. based on the number of years after initial abandonment).

\begin{equation}
p_{y} = 1 + \beta_{1,y} log(t + 1) + \beta_{2,y} t (\#eq:mod-spec-SI)
\end{equation}

Where $\beta_{1,y}$ represents the regression coefficient on the log term of time $t$ for cohort $y$, and $\beta_{2,y}$ represents the regression coefficient on the linear term of time $t$ for cohort $y$.
We allow for site and cohort level fixed effects, fitting unique coefficients for each cohort at each site.

This corresponds to a `stats::lm()` call of `lm(formula = I(proportion - 1)  ~ 0 + log(time + 1):cohort:site + I(time):cohort:site)`

Model selection was done based on Akaike Information Criterion (AIC) values (Figure \@ref(fig:AIC)).
We checked linear model assumptions through visual inspection of both residuals vs. fitted plots (Figure \@ref(fig:diag-resid-fitted)) and Q-Q plots (Figure \@ref(fig:diag-qq)).

<!-- See also Figure \@ref(fig:diag-combo) to see diagnostic plots for the full model, including all sites. -->

(ref:caption-AIC) Akaike Information Criterion (AIC) values for various model specifications for each site. More negative AIC values indicate a better model fit.

```{r AIC, fig.cap = '(ref:caption-AIC)', fig.width = 7.5}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "mod_AIC_plot", run_label, ".pdf"))
# plot(cars)

```

(ref:caption-diag-resid-fitted) Residuals vs. fitted diagnostic plots for each site.

```{r diag-resid-fitted, fig.cap = '(ref:caption-diag-resid-fitted)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "l3_cohort_diag_resid_v_fitted", run_label, ".png"))
# plot(cars)
```

(ref:caption-diag-qq) QQ plots for each site, calculated using the `car` package (@R-car).

```{r diag-qq, fig.cap = '(ref:caption-diag-qq)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "l3_cohort_diag_qq_subset", run_label, ".png"))
# plot(cars)

```

<!-- <!-- Possibly remove --> -->
<!-- (ref:caption-AIC-mega) Akaike Information Criterion (AIC) values for various model specifications, calculated for models including all sites together. More negative AIC values indicate a better model fit. -->

<!-- ```{r AIC-mega, fig.cap = '(ref:caption-AIC-mega)', fig.width = 7.5} -->
<!-- knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "mod_AIC_mega_plot", run_label, ".png")) -->
<!-- ``` -->

<!-- <!-- Possibly remove --> -->
<!-- (ref:caption-diag-combo) Diagnostic plots for all sites together. -->

<!-- ```{r diag-combo, fig.cap = '(ref:caption-diag-combo)'} -->
<!-- knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "l3_cohort_diag_combo", run_label, ".png")) -->
<!-- ``` -->

### Decay model results

(ref:caption-decay-model-grid) Decay model results for all sites, showing raw data (green points) and modeled abandonment trajectories for individual years (green lines). The mean decay trajectory for the site is calculated as the mean of the coefficients for each cohort (solid blue line). Larger model results are shown in Figures \@ref(fig:decay-model-indiv-site-b)-\@ref(fig:decay-model-indiv-site-w).

```{r decay-model-grid, fig.cap = '(ref:caption-decay-model-grid)', echo = FALSE}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "decay_mod_grid", run_label, ".pdf"))
# plot(cars)


```

Model results:

- Decay rate rate of change for each site, in four quadrants, with linear regression coefficients (Figure \@ref(fig:decay-rate-of-change))
- Projected proportions remaining after set periods of time (10 years, 20 years, 30 years, etc.)
- Decay curves with model fitted values for each site. (Figure \@ref(fig:decay-rate-of-change), and individual models )
- an alternative representation of the mean decay rate (Figure \@ref(fig:decay-time-to-range))


(ref:caption-decay-mod-coef) Mean decay model coefficients across cohorts at each site. The left panel shows the mean coefficient on the log(time) terms and the right shows the site mean coefficient on the linear time terms. These mean coefficients are used to plot the mean decay trajectories shown in Figure \@ref(fig:decay-curves-by-site).

```{r decay-mod-coef, fig.cap = '(ref:caption-decay-mod-coef)', echo = FALSE}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "l3_cohort_coefs_by_site", run_label, ".png"))
# plot(cars)

```


\newpage

## Change in recultivation rates over time {#section-methods-rate-of-change}

We examined the rate of change of recultivation rates by calculating the time required for 50% of each cohort to be recultivated and running a simple linear regression on these values as a function of time, using the `stats::lm()` function in R's core statistics package. 
We estimate the time required for half (50%) of a given cohort of abandoned cropland to be recultivated, $t_{half,s}$, as a function of the year of initial abandonment ($yearabn_{s}$), at each site $s$.
This model is shown in Equation \@ref(eq:rate-of-change-lm).

\begin{equation}
t_{half,s} = \beta_{0,s} + \beta_{1,s} yearabn_{s} (\#eq:rate-of-change-lm)
\end{equation}

Where $\beta_{1,s}$ represents the regression slope on the year abandoned for site $s$ ($yearabn_{s}$), and $\beta_{0,s}$ represents the intercept.
This corresponds to a `lm()` call of `lm(formula = t_half ~ year_abandoned)` run for each site individually.
Results are shown in Figure \@ref(fig:decay-rate-of-change).

We confirmed that model assumptions were met through visual inspection of residuals vs. fitted plots (Figure \@ref(fig:rate-of-change-diag-resid-fitted)) and Q-Q plots (Figure \@ref(fig:rate-of-change-diag-qq)).

(ref:caption-decay-rate-of-change) The rate of change of decay rates (measured by the time required for 50% of each cohort to be recultivated) at each site over the course of the time series. Individual site trends are shown in the grid at left. Solid lines show simple linear regressions, the slopes of which are shown at right. Gray bands around the linear trends at left and the error bars on slope estimates at the right both represent 95% confidence intervals.

```{r decay-rate-of-change, fig.cap = '(ref:caption-decay-rate-of-change)', echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/rate_of_change_recultivation_speed_combo", "_indiv", run_label, ".pdf"))

# plot(cars)


# if I go with the linear combination:
# knitr::include_graphics(path = paste0(p_plots, run_label,
#                                       "/decay/rate_of_change_recultivation_speed_combo", 
#                                       "_lincom", run_label, ".pdf"))


# old confidence intervals
# knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/rate_of_change_recultivation_speed_combo",
#                                       "_old", run_label, ".pdf"))


# old version, with quadrants, and old CIs
# knitr::include_graphics(path = paste0(p_plots, run_label, "/presentation/rate_of_change_recultivation_speed", run_label, ".pdf"))
# knitr::include_graphics(path = paste0(p_plots, run_label, "/presentation/rate_of_change_recultivation_speed_old", run_label, ".pdf"))
```

(ref:caption-rate-of-change-diag-resid-fitted) Residuals vs. fitted diagnostic plots for each site, for simple `lm` call corresponding to Eq. \@ref(eq:rate-of-change-lm).

```{r rate-of-change-diag-resid-fitted, fig.cap = '(ref:caption-rate-of-change-diag-resid-fitted)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "rate_of_change_l3_diag_ind_resid_v_fitted", run_label, ".png"))
# plot(cars)

```

(ref:caption-rate-of-change-diag-qq) QQ plots for each site, calculated using the `car` package (@R-car).

```{r rate-of-change-diag-qq, fig.cap = '(ref:caption-rate-of-change-diag-qq)'}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "rate_of_change_l3_diag_ind_qq_car", run_label, ".png"))
# plot(cars)

```

(ref:caption-decay-time-to-range) An alternative representation of the mean decay rate for each site (also shown in Figure \@ref(fig:decay-curves-by-site)). The color of each dot corresponds to the proportion remaining after a given amount of time.

```{r decay-time-to-range, fig.cap = '(ref:caption-decay-time-to-range)', echo=FALSE}
# (ref:caption-decay-time-to-range) Sites included in this study, from @Yin2020.
# cite inline using the following  \@ref(fig:decay-time-to-range)

# switch between 1-0 and 1-0.5 by adding or removing all
show_all <- TRUE

knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/time_to_range", ifelse(show_all, "_all", ""), "_l3", run_label, ".pdf"))

# plot(cars)

```


\newpage

## Extrapolating abandonment duration {#section-extrapolation-si}

(ref:caption-extrapolation-combo) The results of our simple extrapolation, including a) the mean age of abandonment, and b) the total area abandoned into the future. Colors corresponding to each site are consistent across the three panels. These extrapolation assume recultivation based on the mean decay trend for each site Figure \@ref(fig:decay-curves-by-site) and annual new abandonment based on the mean annual gain in abandonment shown in Figure \@ref(fig:turnover-grid) (dark green bars).

```{r extrapolation-combo, fig.cap = '(ref:caption-extrapolation-combo)', echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "extrapolation1_SI", run_label, ".pdf"))

# plot(cars)

```

(ref:caption-extrapolation-area-by-age) Extrapolating area by age bin, assuming a 1) each site follows the mean recultivation ("decay") rate, and 2) a constant area abandoned each year (based on the mean annual area abandoned at each site).

```{r extrapolation-area-by-age, fig.cap = '(ref:caption-extrapolation-area-by-age)', echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "extrapolation1_ages", run_label, ".pdf"))
# plot(cars)

```

### Alternative assumptions about annual additional abandonment

As noted above, we make two simple assumptions in our extrapolation of abandonment and recultivation: specifically, that 1) recultivation rates remain the same (based on mean recultivation trends at each site, shown in Figure \@ref(fig:decay-curves-by-site), and that 2) a constant amount of cropland is newly abandoned each year, based on the mean annual gain in abandonment shown in Figure \@ref(fig:turnover-grid) (dark green bars).

However, the second assumption, that a constant amount of cropland is newly abandoned indefinitely is almost certainly unrealistic.
We also considered an alternative assumption, in which annual abandonment linearly declined to 0 between 2017 and 2050 (see Figures \@ref(fig:extrapolation2-combo) and \@ref(fig:extrapolation2-area-by-age)).
While mean age of abandoned land increased through time after 2017 (and most dramatically after 2050), it remained below 37 years at all sites by 2050.
Increases in mean abandonment duration were offset by recultivation, and total area abandoned declined quickly after 2020 at most sites.

The mean abandonment duration increases as annual abandonment declines, as the total pool of abandoned land grows older and is gradually recultivated.


(ref:caption-extrapolation2-combo) The results of our second extrapolation, including a) the mean age of abandonment, and b) the total area abandoned into the future. Colors corresponding to each site are consistent across the three panels. These extrapolation assume recultivation based on the mean decay trend for each site Figure \@ref(fig:decay-curves-by-site) and annual new abandonment based on the mean annual gain in abandonment shown in Figure \@ref(fig:turnover-grid) (dark green bars).

```{r extrapolation2-combo, fig.cap = '(ref:caption-extrapolation2-combo)', echo=FALSE}
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "extrapolation2_SI", run_label, ".pdf"))

# plot(cars)

```

(ref:caption-extrapolation2-area-by-age) Extrapolating area by age bin, assuming a 1) each site follows the mean recultivation ("decay") rate, and 2) a constant area abandoned each year until 2017 (based on the mean annual area abandoned at each site), followed by a linearly declining area abandoned each year until reaching 0 in 2050.

```{r extrapolation2-area-by-age, fig.cap = '(ref:caption-extrapolation2-area-by-age)', echo=FALSE}

# knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "extrapolation2_ages", run_label, ".pdf"))
knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/", "extrapolation2_ages_const", run_label, ".pdf"))
# plot(cars)

```

(ref:caption-mean-duration-2050) Comparing the mean duration of abandonment at our 11 sites observed between 1987 and 2017 with the extrapolated mean duration as of 2050 for our two extrapolations.

```{r mean-duration-2050, fig.cap = '(ref:caption-mean-duration-2050)', echo=FALSE}

# assumption 1 - constant initial area abandoned

mean_age_in_2050 <- mean_length_df %>% filter(abn_threshold == 5, length_type == "all") %>%
  select(site, mean_age_obs = mean_duration) %>%
  left_join(., extrapolate_df_l3 %>% filter(year == 2050) %>% select(site, mean_age_extrap1 = mean_age), by = "site") %>%
  left_join(., extrapolate_df_l3_a2 %>% filter(year == 2050) %>% select(site, mean_age_extrap2 = mean_age), by = "site") %>%
  arrange(mean_age_obs)
   
mean_age_in_2050 %>%
  pivot_longer(cols = c(2:4), names_to = "variable") %>%
  ggplot(data = ., mapping = aes(x = fct_reorder(site, value), y = value, fill = variable)) + 
  labs(x = "Site", y = "Mean abandonment duration (years)") +
  geom_col(position = position_dodge()) + coord_flip() + 
  scale_fill_discrete(name = "Mean duration type: ", 
                      labels = c(mean_age_obs = "Observed (1987-2017)", 
                                 mean_age_extrap1 = "Extrapolation 1 (2050)",
                                 mean_age_extrap2 = "Extrapolation 2 (2050)")) +
  scale_x_discrete(labels = c("belarus" = "Vitebsk, Belarus /\n Smolensk, Russia",
                              "bosnia_herzegovina" = "Bosnia & Herzegovina",
                              "chongqing" = "Chongqing, China",
                              "goias" = "Goiás, Brazil",
                              "iraq" = "Iraq",
                              "mato_grosso" = "Mato Grosso, Brazil",
                              "nebraska" = "Nebraska/Wyoming, USA",
                              "orenburg" = "Orenburg, Russia /\n Uralsk, Kazakhstan",
                              "shaanxi" = "Shaanxi/Shanxi, China",
                              "volgograd" = "Volgograd, Russia",
                              "wisconsin" = "Wisconsin, USA")) +
  theme_classic()

```

<!-- #### (*REMOVE*) Alternative mean decay rates -->

<!-- Currently, to get the mean decay rate for each site, I simply average each coefficient (for the log and the linear terms) across all cohorts, and then use these two mean values as the coefficients for the mean site trend (the solid blue lines in Figure \@ref(fig:decay-model-grid)). -->
<!-- I think this makes sense, because it treats each cohort of abandonment equally (rather than giving more weight to cohorts with more observations, i.e. older cohorts).  -->
<!-- Having cohort fixed effects allows for a unique decay rate for each year of abandonment, which makes the models fit very well.  -->
<!-- But, the fits for the recent cohorts with few observations are quite straight.  -->

<!-- Alternatively, however, I can also just run a single regression without the cohort fixed effects, which produces a single estimate for the log and linear coefficients, weighting all points equally (therefore giving more weight to older cohorts with more points; the dashed blue lines in Figure \@ref(fig:decay-model-grid)). -->

<!-- I can then conduct the extrapolation based on the decay rates derived from that single linear regression for each site (in other words, across all cohorts of abandonment). -->
<!-- These extrapolation results are shown below in Figures \@ref(fig:extrapolation-combo-no-fe) and \@ref(fig:extrapolation-area-by-age-no-fe). -->

<!-- However, as you can see, some of the sites have a decay curve that clearly doesn't make sense when extrapolated out (eventually curving upwards over time).  -->
<!-- As a result, I think we should stick with our original method of calculating the mean trend at each site (averaging across the coefficients for each cohort), but I just wanted to call it to your attention. -->

<!-- (ref:caption-extrapolation-combo-no-fe) The results of our simple extrapolation, but assuming a decay trend for each site calculated without cohort fixed effects (a), resulting in b) the mean age of abandonment, and c) the total area abandoned into the future. Colors corresponding to each site are consistent across the three panels. -->

<!-- ```{r extrapolation-combo-no-fe, fig.cap = '(ref:caption-extrapolation-combo-no-fe)', echo=FALSE} -->
<!-- knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/",  -->
<!--                                      "extrapolation_combo_no_fe_tall", run_label, ".pdf")) -->
<!-- ``` -->

<!-- (ref:caption-extrapolation-area-abn-no-fe) Extrapolating total area abandoned, using site decay rates that do not allow for abandonment cohort fixed effects. -->

<!-- ```{r extrapolation-area-abn-no-fe, fig.cap = '(ref:caption-extrapolation-area-abn-no-fe)', include = FALSE, echo=FALSE} -->
<!-- knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/",  -->
<!--                                       "extrapolate_area_abn_no_fe", run_label, ".png")) -->
<!-- ``` -->

<!-- (ref:caption-extrapolation-mean-age-no-fe) Extrapolating area by age bin, no fixed effects. -->

<!-- ```{r extrapolation-mean-age-no-fe, fig.cap = '(ref:caption-extrapolation-mean-age-no-fe)', include = FALSE, echo=FALSE} -->
<!-- knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/",  -->
<!--                                       "extrapolate_mean_age_no_fe", run_label, ".png")) -->
<!-- ``` -->

<!-- (ref:caption-extrapolation-area-by-age-no-fe) Extrapolating area by age bin, assuming site decay rates derived from linear models that do not use cohort fixed effects (treating each observation equally). -->

<!-- ```{r extrapolation-area-by-age-no-fe, fig.cap = '(ref:caption-extrapolation-area-by-age-no-fe)', echo=FALSE} -->
<!-- knitr::include_graphics(path = paste0(p_plots, run_label, "/decay/",  -->
<!--                                       "extrapolate_age_by_age_bin_no_fe", run_label, ".pdf")) -->
<!-- ``` -->

\newpage

# Expanded Site-specific Results

## Composite Results Figures

(ref:caption-panel-b) Abandonment patterns for `r site_df$description[1]`, showing a) accumulation of abandoned land by age class, b) decay of abandoned land by year abandoned, c) the area in each land cover class through time (including both land that has been abandoned for five or more years, as well as any land abandoned for 1 or more years, therefore including short-term fallows), d) the annual turnover of abandoned land through time, and e) the distribution of abandonment duration for all periods of cropland abandonment (top) and the maximum duration of abandonment at each pixel (bottom).
(ref:caption-panel-bh) Abandonment patterns for `r site_df$description[2]`, following Figure \@ref(fig:panel-b).
(ref:caption-panel-c) Abandonment patterns for `r site_df$description[3]`, following Figure \@ref(fig:panel-b).
(ref:caption-panel-g) Abandonment patterns for `r site_df$description[4]`, following Figure \@ref(fig:panel-b).
(ref:caption-panel-i) Abandonment patterns for `r site_df$description[5]`, following Figure \@ref(fig:panel-b).
(ref:caption-panel-mg) Abandonment patterns for `r site_df$description[6]`, following Figure \@ref(fig:panel-b).
(ref:caption-panel-n) Abandonment patterns for `r site_df$description[7]`, following Figure \@ref(fig:panel-b).
(ref:caption-panel-o) Abandonment patterns for `r site_df$description[8]`, following Figure \@ref(fig:panel-b).
(ref:caption-panel-s) Abandonment patterns for `r site_df$description[9]`, following Figure \@ref(fig:panel-b).
(ref:caption-panel-v) Abandonment patterns for `r site_df$description[10]`, following Figure \@ref(fig:panel-b).
(ref:caption-panel-w) Abandonment patterns for `r site_df$description[11]`, following Figure \@ref(fig:panel-b).

```{r panel-b, fig.cap = '(ref:caption-panel-b)', echo=FALSE}
# list.files(path = p_plots)

si_panel_figs <- list.files(paste0(p_plots, run_label), pattern = "si_panel", full.names = TRUE)
# grep("_b.png", si_panel_figs, value = TRUE)

knitr::include_graphics(path = si_panel_figs[1])
# plot(cars)

```

```{r panel-bh, fig.cap = '(ref:caption-panel-bh)', echo=FALSE}
knitr::include_graphics(path = si_panel_figs[2])
# plot(cars)

```

```{r panel-c, fig.cap = '(ref:caption-panel-c)', echo=FALSE}
knitr::include_graphics(path = si_panel_figs[3])
# plot(cars)

```

```{r panel-g, fig.cap = '(ref:caption-panel-g)', echo=FALSE}
knitr::include_graphics(path = si_panel_figs[4])
# plot(cars)

```

```{r panel-i, fig.cap = '(ref:caption-panel-i)', echo=FALSE}
knitr::include_graphics(path = si_panel_figs[5])
# plot(cars)

```

```{r panel-mg, fig.cap = '(ref:caption-panel-mg)', echo=FALSE}
knitr::include_graphics(path = si_panel_figs[6])
# plot(cars)

```

```{r panel-n, fig.cap = '(ref:caption-panel-n)', echo=FALSE}
knitr::include_graphics(path = si_panel_figs[7])
# plot(cars)

```

```{r panel-o, fig.cap = '(ref:caption-panel-o)', echo=FALSE}
knitr::include_graphics(path = si_panel_figs[8])
# plot(cars)

```

```{r panel-s, fig.cap = '(ref:caption-panel-s)', echo=FALSE}
knitr::include_graphics(path = si_panel_figs[9])
# plot(cars)

```

```{r panel-v, fig.cap = '(ref:caption-panel-v)', echo=FALSE}
knitr::include_graphics(path = si_panel_figs[10])
# plot(cars)

```

```{r panel-w, fig.cap = '(ref:caption-panel-w)', echo=FALSE}
knitr::include_graphics(path = si_panel_figs[11])
# plot(cars)

```

\newpage

## Individual Decay Model Results

(ref:caption-decay-model-indiv-site-b) Decay model results for Vitebsk, Belarus and Smolensk, Russia, showing raw data (green points), modeled abandonment trajectories for individual years (green lines), and the mean decay trajectory for the site as a whole (blue lines). The mean decay trajectory is calculated in two ways: 1) from the mean of the coefficients for each cohort (solid blue line), and 2) as a single linear regression without cohort-level fixed effects (F.E.; dashed blue line).

(ref:caption-decay-model-indiv-site-bh) Decay model results for Bosnia & Herzegovina, following Figure \@ref(fig:decay-model-indiv-site-b).

(ref:caption-decay-model-indiv-site-c) Decay model results for Chongqing (China), following Figure \@ref(fig:decay-model-indiv-site-b).

(ref:caption-decay-model-indiv-site-g) Decay model results for Goiás, Brazil, following Figure \@ref(fig:decay-model-indiv-site-b).

(ref:caption-decay-model-indiv-site-i) Decay model results for Iraq, following Figure \@ref(fig:decay-model-indiv-site-b).

(ref:caption-decay-model-indiv-site-mg) Decay model results for Mato Grosso, Brazil, following Figure \@ref(fig:decay-model-indiv-site-b).

(ref:caption-decay-model-indiv-site-n) Decay model results for Nebraska, USA, following Figure \@ref(fig:decay-model-indiv-site-b).

(ref:caption-decay-model-indiv-site-o) Decay model results for Orenburg, Russia, following Figure \@ref(fig:decay-model-indiv-site-b).

(ref:caption-decay-model-indiv-site-s) Decay model results for Shaanxi/Shanxi (China), following Figure \@ref(fig:decay-model-indiv-site-b).

(ref:caption-decay-model-indiv-site-v) Decay model results for Volgograd, Russia, following Figure \@ref(fig:decay-model-indiv-site-b).

(ref:caption-decay-model-indiv-site-w) Decay model results for Wisconsin, USA, following Figure \@ref(fig:decay-model-indiv-site-b).

```{r decay-model-indiv-site-b, fig.cap = '(ref:caption-decay-model-indiv-site-b)', echo = FALSE}
decay_model_figs <- list.files(paste0(p_plots, run_label, "/decay"), 
                               pattern = paste0("^l3_cohort_plus", run_label), full.names = TRUE)
# note - you can include just the mean trend (with FE) by removing the "_plus" in the file paths

knitr::include_graphics(path = decay_model_figs[1])
# plot(cars)
```


```{r decay-model-indiv-site-bh, fig.cap = '(ref:caption-decay-model-indiv-site-bh)', echo=FALSE}
knitr::include_graphics(path = decay_model_figs[2])
# plot(cars)

```

```{r decay-model-indiv-site-c, fig.cap = '(ref:caption-decay-model-indiv-site-c)', echo=FALSE}
knitr::include_graphics(path = decay_model_figs[3])
# plot(cars)

```

```{r decay-model-indiv-site-g, fig.cap = '(ref:caption-decay-model-indiv-site-g)', echo=FALSE}
knitr::include_graphics(path = decay_model_figs[4])
# plot(cars)

```

```{r decay-model-indiv-site-i, fig.cap = '(ref:caption-decay-model-indiv-site-i)', echo=FALSE}
knitr::include_graphics(path = decay_model_figs[5])
# plot(cars)

```

```{r decay-model-indiv-site-mg, fig.cap = '(ref:caption-decay-model-indiv-site-mg)', echo=FALSE}
knitr::include_graphics(path = decay_model_figs[6])
# plot(cars)

```

```{r decay-model-indiv-site-n, fig.cap = '(ref:caption-decay-model-indiv-site-n)', echo=FALSE}
knitr::include_graphics(path = decay_model_figs[7])
# plot(cars)

```

```{r decay-model-indiv-site-o, fig.cap = '(ref:caption-decay-model-indiv-site-o)', echo=FALSE}
knitr::include_graphics(path = decay_model_figs[8])
# plot(cars)

```

```{r decay-model-indiv-site-s, fig.cap = '(ref:caption-decay-model-indiv-site-s)', echo=FALSE}
knitr::include_graphics(path = decay_model_figs[9])
# plot(cars)

```

```{r decay-model-indiv-site-v, fig.cap = '(ref:caption-decay-model-indiv-site-v)', echo=FALSE}
knitr::include_graphics(path = decay_model_figs[10])
# plot(cars)

```

```{r decay-model-indiv-site-w, fig.cap = '(ref:caption-decay-model-indiv-site-w)', echo=FALSE}
knitr::include_graphics(path = decay_model_figs[11])
# plot(cars)

```



<!-- Leave these lines as they are at the end of your .Rmd file to ensure placement of methods & acknowledgements sections before the references-->
\showmatmethods
\showacknow
\pnasbreak
